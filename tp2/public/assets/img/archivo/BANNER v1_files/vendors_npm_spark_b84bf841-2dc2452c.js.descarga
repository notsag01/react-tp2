(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[35],{"16hp":function(e,t,r){var o,n=t,i=r("oAGj"),a=r("CaSj"),l=r("UGKO"),s=r("FNB+"),u=r("cmoc"),c=r("eiag"),h=r("xe42"),g=r("OYRJ"),f=r("9Lk3"),p=r("fdtz"),d=r("lmwz"),m=r("fNpk"),v=r("3DEm"),y=r("K0Rh"),S=r("enh0"),C=r("sIWg"),F=r("1NAc");n.FormaPlacementSuggester=(o=function(e,t){a.DesignSuggester.call(this,e,t),this.maxSuggestions=3},i.defineClass({name:"FormaPlacementSuggester",ctor:o,superName:"DesignSuggester",statics:{KIND:{get:function(){return"FormaPlacementSuggester"}},createPlacementInputs:function(e,t){var r=[],o=[],n=[],a=[],l=[],h=[];return t.visitAll(s.FormaTraversal.PreOrder,(function(t){if(!(i.eq(s._equality_Forma_Forma,e,t)||t instanceof S.TextForma||null==t.controller)){var c=t.finalFrame;null!=c?((t.isBackgroundImage()||f.GridController.isBackgroundColoredCell(t))&&h.push(t),t instanceof u.FrameForma&&(o.push(c),l.push(t),e.originalID!=t.originalID&&a.push(c)),t.isTypeLockup()&&(r.push(c),e.originalID!=t.originalID&&a.push(c)),null!=t.controller&&t.controller.floating&&t.kind!=p.ImageForma.KIND&&e.originalID!=t.originalID&&(n.push(c),a.push(c))):m.LegacyCoreAssert.fail("something is wrong with this document. a forma has a nil frame",void 0,"FormaPlacementSuggester.createPlacementInputs","FormaPlacementSuggester.swift",201)}})),new c.FormaPlacementInput(e,i.clone(a),i.clone(n),i.clone(r),i.clone(o),i.clone(l),i.clone(h))},createPlacementSuggestion:function(e,t,r,o,n){for(var a=0,l=0,s=0,u=i.iter(i.range(0,o.imageRects.length,!1));!u.done;u.next()){var c=u.value,f=o.imageRects[c];if(null!=(N=t.intersectionWith(f))&&N.area==t.area&&f.area>t.area){var p=o.images[c];a=v.MathUtils.maxDouble(a,p.controller.getAverageEdge(t)),l=v.MathUtils.maxDouble(l,p.controller.getFaceIntersections(t))}else null!=N&&(s+=N.area)}for(var d=r,m=0,y=i.iter(o.backgroundRegions);!y.done;y.next()){var S=y.value;(N=t.intersectionWith(S.finalFrame))&&(Math.abs(N.area-t.area)>100?m+=1:d=S.finalFrame)}n.setFeature(h.FormaPlacementScore.Features.REGION_BOUNDARY_OVERLAP,i.toDouble(m)),n.setFeature(h.FormaPlacementScore.Features.DISTANCE_TO_CENTER,t.center.distanceTo(r.center)/Math.max(r.width,r.height)),n.setFeature(h.FormaPlacementScore.Features.FACE,l),n.setFeature(h.FormaPlacementScore.Features.EDGE,a),n.setFeature(h.FormaPlacementScore.Features.IMAGE_EDGE_OVERLAP,s/r.area),n.setFeature(h.FormaPlacementScore.Features.SIZE,t.area/r.area);var C=1-Math.abs(t.width/r.width-2*t.height/r.height);n.setFeature(h.FormaPlacementScore.Features.ASPECT_RATIO,C);var F=t.minX-d.minX,I=d.maxX-t.maxX,T=1-Math.abs(F-I)/d.width;T<.98&&(T=0),n.setFeature(h.FormaPlacementScore.Features.XSYMM,T);var _=t.minY-d.minY,k=d.maxY-t.maxY,x=1-Math.abs(_-k)/d.height;x<.98&&(x=0),n.setFeature(h.FormaPlacementScore.Features.YSYMM,x);for(var L=0,D=i.iter(o.textRects);!D.done;D.next()){var b=D.value;Math.abs(b.center.x-t.center.x)<3&&(L+=1),Math.abs(b.minY-t.minY)<3?L+=.25:Math.abs(b.center.y-t.center.y)<3&&(L+=.1)}n.setFeature(h.FormaPlacementScore.Features.ALIGNMENT,L);for(var A=0,M=i.iter(o.textRects);!M.done;M.next()){var P=M.value;null!=(N=t.intersectionWith(P))&&(A+=N.area)}n.setFeature(h.FormaPlacementScore.Features.TEXT_OVERLAP,A/r.area);for(var R=0,E=i.iter(o.floatingRects);!E.done;E.next()){var N,G=E.value;(N=t.intersectionWith(G))&&(R+=N.area)}return n.setFeature(h.FormaPlacementScore.Features.FLOATING_ELEMENT_OVERLAP,R/r.area),new g.FormaPlacementSuggestion(e,t,n)}},props:{createSuggestions:function(){return this.createPlacementSuggestions(!0)},createPlacementSuggestions:function(e,t){if(void 0===t&&(t=null),null==this.group.frame)return[];var r=this.group.frame;this.group.kind==y.RootForma.KIND&&(r=C.TheoRect.fromSize(this.group.page.pageSize));var n,a=t;null==a&&this.forma.isImage()&&(n=d.ImageFacade.getImageFormaForForma(this.forma))&&(a=i.opt(n.bounds,(function(e){return e.aspectRatio})));var s=o.createPlacementInputs(this.forma,this.group),u=i.clone(this.getSearchLocations(this.forma,r,s,e,a));if(0==u.length){var c,g=r;if(null!=(c=a)){var f=r.fitAspectRatioWithin(c);g=C.TheoRect.fromSize(f).offset(r.origin)}u.push(g)}for(var p,m=-1/0,S=new h.FormaPlacementScore(s),F=[],I=i.iter(u);!I.done;I.next()){var T=I.value,_=o.createPlacementSuggestion(this.forma,T,r,s,S);_.weightedScore.reject()||(F.push(_),S=new h.FormaPlacementScore(s)),_.score>m&&(m=_.score,p=_,S=new h.FormaPlacementScore(s))}if(e)return o.createPlacementSuggestion(this.forma,p.location,r,s,S),[i.as(p,l.IDesignSuggestion)];var k=[];k.push(p),i.sortInPlace(F,(function(e,t){return e.score>t.score}));for(var x=F.length,L=0,D=i.iter(i.range(0,this.maxSuggestions,!1));!D.done;D.next()){var b=null;for(L+=1;L<x;){for(var A=9999,M=i.iter(i.range(0,k.length,!1));!M.done;M.next()){var P=M.value;A=v.MathUtils.minDouble(A,F[L].distanceTo(k[P]))}if(A>.1){b=F[L];break}L+=1}if(null==b)break;k.push(b)}return k=k.slice(1,k.length),i.sortInPlace(k,(function(e,t){return e.location.center.x<t.location.center.x})),i.info("finished suggester"),[i.as(p,l.IDesignSuggestion)].concat(k)},fastPlacement:function(){var e=i.clone(this.createPlacementSuggestions(!0));return e.length>0?e[0]:null},getSearchLocations:function(e,t,r,o,n){void 0===n&&(n=null);var a=[],l=[],s=[],u=[],c=C.TheoRect.fromXXYY(v.MathUtils.minDouble(t.width/4,200),t.width-10,v.MathUtils.minDouble(t.height/4,100),t.height-10);o&&(c=C.TheoRect.fromXXYY(v.MathUtils.minDouble(t.width/4,200),t.width-10,v.MathUtils.minDouble(t.height/4,100),t.height-10));var h=t.area/10,g=t.area/5,f=c.minX,p=c.maxX,d=c.minY,y=c.maxY,S=t.width/20,I=t.height/20,T=o?5:8;null!=n&&(T*=T);var _=c.width/T,k=c.height/T;o&&(S=v.MathUtils.maxDouble(t.width/20,30),I=v.MathUtils.maxDouble(t.height/20,30)),l.push((t.minX+t.maxX)/2),s.push((t.minY+t.maxY)/2);for(var x=i.iter(r.otherRects.concat(r.backgroundRegions.map((function(e){return e.finalFrame}),this)));!x.done;x.next()){var L=x.value;l.push(L.center.x),s.push(L.center.y),s.push(L.minY)}for(var D=t.minX+5;D<t.maxX-5;)l.push(D),D+=S;for(var b=t.minY+5;b<t.maxY-5;)s.push(b),b+=I;var A=f;if(null==n)for(;A<p;){for(var M=d;M<y;)A*M>=h&&A*M<=g&&u.push(new F.TheoSize(A,M)),M+=k;A+=_}else{for(var P,R=0;A<p;){var E=A*(M=A/n);if(E>=h&&E<=g)u.push(new F.TheoSize(A,M));else if(0==u.length){var N=E<h?E/h:g/E;N>R&&(R=N,P=new F.TheoSize(A,M))}A+=_}0==u.length&&null!=P&&u.push(P)}for(var G=i.iter(l);!G.done;G.next())for(var w=G.value,O=i.iter(s);!O.done;O.next())for(var B=O.value,W=i.iter(u);!W.done;W.next()){var U=W.value;if(A=U.width,M=U.height,D=w-U.width/2,b=B-U.height/2,!(D+A>=t.maxX-5||b+M>=t.maxY-5||D<=t.minX+5||b<=t.minY+5||A/M<.5)){var V=C.TheoRect.fromXYWH(D,b,A,M);null!=n&&m.LegacyCoreAssert.isTrue(Math.abs(V.aspectRatio-n)<.001,"invalid candidate location: does not match aspect ratio",void 0,"FormaPlacementSuggester.getSearchLocations","FormaPlacementSuggester.swift",519),a.push(V)}}return a}}}),o)},"2wfq":function(e,t,r){r("oAGj")},"3v9D":function(e,t,r){var o,n,i,a,l=t,s=r("oAGj"),u=r("CaSj"),c=r("FNB+"),h=r("6ZWm"),g=r("tQF8"),f=r("TP4q"),p=r("v/sv"),d=r("bSZx"),m=r("4mVB"),v=r("iCxV"),y=r("fNpk"),S=r("Dq5S"),C=r("uxH+"),F=r("8t9B"),I=r("ThKb"),T=r("sIWg");l.LayoutSuggester=(o=function(){this.scoringWeights_=null,this.layoutTypeModel_=null,this.group_=null},s.defineClass({name:"LayoutSuggester",ctor:o,superName:"CoreObject",statics:{KIND:{get:function(){return"LayoutSuggester"}},createContentAwareSuggestions:function(e){var t;return(t=s.opt(s.as(e.controller,C.RootController),(function(e){return e.getGridController()})))?o.init_abc1(t.gridForma).createSuggestions(!0,!1,!1):[]}},props:{init_abc1:function(e,t){void 0===t&&(t=null);var r=s.clone(e.filterWithCallback((function(e){return e.isBackgroundImage()}),c.FormaTraversal.JustChildren)),o=s.clone(e.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}),c.FormaTraversal.JustChildren));this.layoutItems_=r.map((function(e){return[S.LayoutItem.init_b14a(e)]}),this),this.imageCount_=this.layoutItems_.length;var n=o.map((function(e){return S.LayoutItem.init_b14a(e)}),this);this.layoutItems_.push(s.clone(n)),this.floatingCount_=n.length,y.LegacyCoreAssert.isTrue(null!=e.parent,"group to suggest layout for does not have a parent",void 0,"LayoutSuggester.init","LayoutSuggester.swift",40),this.scoringWeights_=s.clone(t),this.gridFrame_=e.frame,this.group_=e},init_cb42:function(e,t){void 0===t&&(t=null),this.layoutItems_=[];for(var r=[],o=s.iter(e.layoutItems);!o.done;o.next()){var n=o.value;n.type==S.ItemContentType.Image&&this.layoutItems_.push([n]),n.type==S.ItemContentType.Floating&&r.push(n)}this.imageCount_=this.layoutItems_.length,this.floatingCount_=r.length,this.layoutItems_.push(s.clone(r)),this.scoringWeights_=s.clone(t),this.gridFrame_=e.gridFrame},layoutTypeModel:{get:function(){return this.layoutTypeModel_},set:function(e){this.layoutTypeModel_=e}},createSuggestions:function(e,t,r,o,n){if(void 0===e&&(e=!0),void 0===t&&(t=!1),void 0===r&&(r=!0),void 0===o&&(o=!1),void 0===n&&(n=1),this.imageCount_<1)return[];var i=[];return e&&s.append(i,this.createContentAwareSuggestions(r,n,o)),t&&s.append(i,this.createFixedGridSuggestions(r,n)),s.sortInPlace(i,(function(e,t){return e.score>t.score})),i},createEqualSizeSuggestions:function(e,t){return void 0===e&&(e=!0),void 0===t&&(t=1),this.imageCount_<1?[]:this.getEqualSizeGridSuggestions(e,t)},createFixedGridSuggestions:function(e,t){void 0===t&&(t=1);var r=this;if(this.imageCount_<1)return[];for(var o=s.clone(e&&this.floatingCount_>=1?this.layoutItems_:this.layoutItems_.slice(0,this.imageCount_)),n=o.length,i=s.clone(u.DesignSuggester.getPermutations(n,350)),a=null,l=-1e6,c=s.toArray(s.range(1,n,!0)).map((function(e){return r.getFixedGrids(n,e,!1)}),this),h=s.toArray(s.range(1,n,!0)).map((function(e){return r.getFixedGrids(n,e,!0)}),this),g=s.iter(i);!g.done;g.next()){var f=g.value.map((function(e){return o[e]}),this),p=this.fillFixedGrids(n,[c,h],s.clone(f));p.score>l&&(a=p.suggestion,l=p.score)}return[a]},getEqualSizeGridSuggestions:function(e,t){void 0===t&&(t=1);for(var r=s.clone(e&&this.floatingCount_>=1?this.layoutItems_:this.layoutItems_.slice(0,this.imageCount_)),o=r.length,n=[],i=s.iter(s.range(1,o,!0));!i.done;i.next()){var a=i.value,l=a;if(o%a==0){var c=s.toInt(o/a),h=s.clone(this.getGrids(l,c)),g=s.clone(u.DesignSuggester.getPermutations(o,1))[0].map((function(e){return r[e]}),this),p=g.map((function(e){return e[0]}),this),m=this.createGridStyle(s.clone(h),s.clone(g),"equal_size_layout_"+l+"_"+c),v=new f.GridScore(m,this.gridFrame_,s.clone(p),null,!1,s.clone(this.scoringWeights_)),y=new d.GridSuggestion(void 0,m,v);n.push(y)}}return s.sortInPlace(n,(function(e,t){return e.score>t.score})),n.slice(0,Math.min(n.length,t))},getGrids:function(e,t){for(var r=1/s.toDouble(e),o=1/s.toDouble(t),n=[],i=s.iter(s.range(0,e,!1));!i.done;i.next())for(var a=i.value,l=s.iter(s.range(0,t,!1));!l.done;l.next()){var u=l.value,c=s.toDouble(a)*r,h=s.toDouble(u)*o,f=s.toDouble(a+1)*r,p=s.toDouble(u+1)*o;n.push(new g.GridCell(new T.TheoRect(c,h,f,p)))}return n},createContentAwareSuggestions:function(e,t,r){if(void 0===t&&(t=1),void 0===r&&(r=!1),this.imageCount_<1)return[];for(var o=s.clone(e&&this.floatingCount_>=1?this.layoutItems_:this.layoutItems_.slice(0,this.imageCount_)),n=o.length,i=this.gridFrame_.aspectRatio,a=[],l=Math.max(200-25*n,25),c=s.clone(u.DesignSuggester.getPermutations(n,l)),h=[],g=[],f=[],p=[],d=[],m=[],v=s.iter(s.toSequence(c));!v.done;v.next()){var y=v.value,S=y.offset,C=y.element.map((function(e){return o[e]}),this),F=this.generateContentAwareGrids(n,s.clone(C),i,r);s.append(h,F.heights),s.append(g,F.widths),s.append(f,F.scores),s.append(p,F.orders),s.append(d,F.flipDimensions);for(var I=s.iter(s.range(0,F.scores.length,!1));!I.done;I.next())m.push(S)}for(var T=s.sort(f),_=0;a.length<t&&_<T.length;){for(var k=T[T.length-1-_],x=s.indexOf(f,k),L=s.clone(c[m[x]]).map((function(e){return o[e]}),this),D=s.clone(h[x]),b=s.clone(p[x]),A=s.clone(g[x]),M=d[x],P=D.map((function(e){return 1/e}),this),R=this.buildBestContentAwareGrid(s.clone(L),s.clone(A),i,s.clone(b),M,s.clone(P),r),E=1,N=s.iter(a);!N.done;N.next()){var G=N.value;if((E=Math.min(E,G.gridStyle.similarity(R.gridStyle)))<.05)break}E>.05&&a.push(R),_+=1}return a},createGridStyle:function(e,t,r){var o=m.GridStyle.init_bf40(r,void 0,s.clone(e)),n=s.clone(this.getGridCellFormaMapping(s.clone(e),s.clone(t)));return o.forma=this.group_,o.setFormaMapping(s.clone(n)),o},getGridCellFormaMapping:function(e,t){for(var r={},o=s.iter(s.toSequence(t));!o.done;o.next())for(var n=o.value,i=n.offset,a=n.element,l=s.iter(a);!l.done;l.next())r[l.value.id]=e[i];return r},fillFixedGrids:function(e,t,r){for(var o=null,n=-1e6,i=r.map((function(e){return e[0]}),this),a=s.iter(s.stride(0,e,1));!a.done;a.next())for(var l=a.value,u=s.iter(t);!u.done;u.next())for(var c=u.value,h=s.iter(c[l]);!h.done;h.next()){var g=h.value,p=this.createGridStyle(s.clone(g),s.clone(r),"Test Layout"),m=new f.GridScore(p,this.gridFrame_,s.clone(i),null,!1,s.clone(this.scoringWeights_)),v=m.score;v>n&&(o=new d.GridSuggestion(void 0,p,m),n=v)}return{score:n,suggestion:o}},generateContentAwareGrids:function(e,t,r,o){for(var n=[],i=[],a=[],l=[],u=[],c=s.iter([!1,!0]);!c.done;c.next())for(var h=c.value,g=s.iter(s.stride(1,Math.min(6,e+1),1));!g.done;g.next()){for(var p=g.value,d=s.toArray(s.range(1,p,!0)).map((function(e){return s.toDouble(e)/s.toDouble(p)}),this),m=this.buildCellArray(s.clone(d),s.clone(t),h?1/r:r,void 0,h,void 0,o),v=s.clone(m.heights),y=s.clone(m.order),S=[],C=s.repeat(0,p),F=0;F<10;){var I=s.toArray(s.range(0,p,!1)).map((function(e){return 1/(s.toDouble(p)*s.toDouble(v[e]))+C[e]}),this),T=1/I.reduce((function(e,t){return e+t}),0);S=I.map((function(e){return e*T}),this);for(var _=!1,k=s.iter(s.range(0,S.length,!1));!k.done;k.next()){var x=k.value;S[x]<.1&&(C[x]+=.1,_=!0)}for(var L=0,D=s.iter(s.range(0,S.length,!1));!D.done;D.next()){var b=D.value;S[b]+=L,L=S[b]}if(S[S.length-1]=1,!_)break;F+=1}for(var A=this.buildCellArray(s.clone(S),s.clone(t),h?1/r:r,s.clone(y),h,void 0,o),M=s.clone(A.heights),P=M.map((function(e){return 1/e}),this),R=this.buildCellArray(s.clone(S),s.clone(t),h?1/r:r,s.clone(y),h,s.clone(P),o),E=[],N=s.iter(t);!N.done;N.next()){var G=N.value;s.append(E,G)}var w=s.clone(this.getGridCellFormaMapping(s.clone(R.cells),s.clone(t))),O=new f.GridScore(void 0,this.gridFrame_,s.clone(E),null,!0,s.clone(this.scoringWeights_),s.clone(w),s.clone(R.cells));i.push(s.clone(S)),n.push(s.clone(M)),a.push(O.score),l.push(s.clone(y)),u.push(h)}var B=s.sort(a);return{widths:i,heights:n,orders:l,scores:a,flipDimensions:u,maxScore:B[B.length-1]}},buildBestContentAwareGrid:function(e,t,r,o,n,i,a){var l=this.buildCellArray(s.clone(t),s.clone(e),n?1/r:r,s.clone(o),n,s.clone(i),a),u=s.clone(l.cells),c=s.clone(this.snapBounds(s.clone(u),this.gridFrame_.size,n)),g=this.createGridStyle(s.clone(c),s.clone(e),m.GridStyle.BALANCED_LAYOUT_NAME);g.cropType=a?h.CropType.FillFocus:h.CropType.FitBorder;for(var p=[],v=s.iter(e);!v.done;v.next()){var y=v.value;s.append(p,y)}var S=new f.GridScore(g,this.gridFrame_,s.clone(p),null,!0,s.clone(this.scoringWeights_));return new d.GridSuggestion(this.group_,g,S)},buildCellArray:function(e,t,r,o,n,i,a){var l,u,c;void 0===o&&(o=null),void 0===n&&(n=!1),void 0===i&&(i=null),void 0===a&&(a=!1);var h=null;null==o&&(h=[]);for(var f,p=s.repeat(0,e.length),d=[],m=0,v=s.iter(s.toSequence(t));!v.done;v.next()){var y=v.value,C=y.offset,F=y.element;if(null==o){var I=s.sort(p);f=s.indexOf(p,I[0]),h.push(f)}else f=o[C];var _,k,x=e[f];if(m=0==f?0:e[f-1],1==F.length&&F[0].type==S.ItemContentType.Image){var L=a&&null!=F[0].focusRegion?F[0].focusRegion.width:(l=F[0].width)||null!=l?l:1,D=a&&null!=F[0].focusRegion?F[0].focusRegion.height:(u=F[0].height)||null!=u?u:1;_=1/(n?s.toDouble(D)/s.toDouble(L):s.toDouble(L)/s.toDouble(D))*(x-m)*r}else{var b,A;if(null!=(b=s.opt(s.opt(s.opt(F[0].forma,(function(e){return e.parent})),(function(e){return e.bounds})),(function(e){return e.width})))&&null!=(A=s.opt(s.opt(s.opt(F[0].forma,(function(e){return e.parent})),(function(e){return e.bounds})),(function(e){return e.height})))){for(var M=0,P=s.iter(F);!P.done;P.next()){var R=P.value;M+=(c=s.opt(R.textInfo,(function(e){return e.textLength})))||null!=c?c:0}(_=this.getTextCellHeight(F.length,s.toDouble(M),m*b,x*b,b,A)/A)<.15&&(_=.15)}else _=(x-m)*r}null!=(k=s.opt(i,(function(e){return e[f]})))&&1-(_*=k)<.001&&(_=1);var E=null;E=n?new g.GridCell(new T.TheoRect(p[f],m,_+p[f],x)):new g.GridCell(new T.TheoRect(m,p[f],x,_+p[f])),d.push(E),p[f]=_+p[f]}return{cells:d,heights:p,order:null==h?o:h}},snapBounds:function(e,t,r,o){void 0===o&&(o=60);var n=e.map((function(e){return e.clone()}),this),i=[];e.forEach((function(e){return i.push(e)}));var a=[];if(r)for(var l=s.iter(s.range(0,i.length,!1));!l.done;l.next()){g=l.value,f=i[g],a.push(f);var u=f.bounds.maxX;if(u<1)for(var c=s.iter(s.range(g+1,i.length,!1));!c.done;c.next())if(v=c.value,y=(m=e[g]).bounds,Math.abs(m.bounds.maxX-u)*t.width<o&&1!=m.bounds.maxX&&m.bounds.maxX!=u&&(m=m.copyTo(new T.TheoRect(y.minX,y.minY,u,y.maxY)),i[v]=m),Math.abs(m.bounds.minX-u)*t.width<o&&0!=m.bounds.minX&&m.bounds.minX!=u&&(m=m.copyTo(new T.TheoRect(u,y.minY,y.maxX,y.maxY)),i[v]=m),m.bounds.width<.05)return n}else for(var h=s.iter(s.range(0,i.length,!1));!h.done;h.next()){var g=h.value,f=i[g];a.push(f);var p=f.bounds.maxY;if(p<1)for(var d=s.iter(s.range(g+1,i.length,!1));!d.done;d.next()){var m,v=d.value,y=(m=i[v]).bounds;if(Math.abs(m.bounds.maxY-p)*t.height<o&&1!=m.bounds.maxY&&m.bounds.maxY!=p&&(m=m.copyTo(new T.TheoRect(y.minX,y.minY,y.maxX,p)),i[v]=m),Math.abs(m.bounds.minY-p)*t.height<o&&0!=m.bounds.minY&&m.bounds.minY!=p&&(m=m.copyTo(new T.TheoRect(y.minX,p,y.maxX,y.maxY)),i[v]=m),m.bounds.height<.05)return n}}return a},getTextCellHeight:function(e,t,r,o,n,i){var a=.13358679,l=-.0261477,u=-.11470111,c=.03862264,h=-.02888805,g=.00561106,f=.03671017,p=.13522773,d=-.0499348,m=.02618676,v=1043.48108,y=3.14978552,S=1.15001079,C=167.10292,F=.639915899,I=.0844010175,T=.0901829377,_=.517425544,k=.44141582,x=78.7709665,L=248.39949567,D=2.99889961,b=1.20115851,A=260.27180508,M=.48002452,P=.27798828,R=.28644367,E=.49969626,N=.49655603,G=117.5756354,w=s.toDouble(this.floatingCount_),O=r,B=o,W=.6568033208493654;return W+=(i-v)/L*a,W+=(w-y)/D*l,W+=(s.toDouble(this.imageCount_)-S)/b*u,W+=(O-C)/A*c,W+=((1==e?1:0)-F)/M*h,W+=((3==e?1:0)-I)/P*g,W+=((e>3?1:0)-T)/R*f,W+=(s.toDouble(e)/w-_)/E*p,W+=((B-O)/n-k)/N*d,W+=(t-x)/G*m,W*=1e3},getFixedGrids:function(e,t,r){if(t>e)return[];for(var o=s.toArray(s.range(0,t,!0)).map((function(e){return s.toDouble(e+1)/s.toDouble(t)}),this),n=[s.repeat(1,t)],i=s.iter(s.range(t,e,!1));!i.done;i.next()){for(var a=[],l=s.iter(n);!l.done;l.next())for(var u=l.value,c=s.iter(s.range(0,t,!1));!c.done;c.next()){var h=c.value,f=u.concat();f[h]+=1,a.push(s.clone(f))}n=s.clone(a)}s.shuffleInPlace(n),n=n.slice(0,Math.min(350,n.length));for(var p=[],d=s.iter(n);!d.done;d.next()){for(var m=d.value,v=[],y=s.iter(s.toSequence(m));!y.done;y.next())for(var S=y.value,C=S.offset,F=S.element,I=0==C?0:o[C-1],_=o[C],k=0,x=s.iter(s.stride(1,s.toDouble(F+1),1));!x.done;x.next()){var L=x.value;r?v.push(new g.GridCell(new T.TheoRect(k,I,L/s.toDouble(F),_))):v.push(new g.GridCell(new T.TheoRect(I,k,_,L/s.toDouble(F)))),k=L/s.toDouble(F)}p.push(s.clone(v))}return p},createLayoutIdFeatures:function(e,t,r,o,n){var i=1==o?1:0,a=2==o?1:0,l=3==o?1:0,u=o>3?1:0,c=1==r?1:0,h=2==r?1:0,g=3==r?1:0,f=r>3?1:0,p=Math.atan2(t,e),d=e*t,m=0,v=0,y=0;if(n.length>0){m=n.reduce((function(e,t){return e+t}),0)/s.toDouble(n.length);var S=s.sort(n);y=S[S.length-1],v=S[0]}var C=[e,t,s.toDouble(r),s.toDouble(o),i,a,l,u,c,h,g,f,m,v,y,d,p];return new I.TheoMatrix([C])},predictLayoutIds:function(e,t){var r=s.opt(this.group_,(function(e){return e.root}));if(this.layoutTypeModel_=s.opt(r,(function(e){return e.page.layoutLibrary.layoutSuggestionModel})),null==r||null==this.layoutTypeModel_)return[];for(var o=r.filterWithCallback((function(e){return e.isBackgroundImage()})).length,n=s.clone(r.filterWithCallback((function(e){return e.isTypeLockup()}))),i=[],a=s.iter(n);!a.done;a.next()){var l,u=a.value;(l=s.as(u.controller,F.TypeLockupController))&&i.push(s.toDouble(l.text.length))}for(var c=r.page.pageSize.width,h=r.page.pageSize.height,g=Math.atan2(h,c),f=this.createLayoutIdFeatures(c,h,n.length,o,s.clone(i)),d=this.layoutTypeModel_.featureScalingMean,m=this.layoutTypeModel_.featureScalingStd,y=s.clone(this.layoutTypeModel_.layoutIDs),S=f.subtract(d).divide(m),C=s.repeat(0,this.layoutTypeModel_.models[0].intercepts.asFlatArray.length),I=s.iter(this.layoutTypeModel_.models);!I.done;I.next()){var T=I.value;if(T.minAngle<g&&g<=T.maxAngle){var _=S.matrixMultiply(T.coefficients.transpose()).sumDim(0);C=s.clone(T.intercepts.add(_).asFlatArray)}}if(C.length!=y.length)return s.opt(v.Host.logging,(function(e){return e.error("model scores don't match class labels")})),[];for(var k=s.sort(C,(function(e,t){return e>t})),x=[],L=s.clone(r.page.layoutLibrary.getAllGrids()),D=!1,b=!1,A=s.iter(s.range(0,y.length,!1));!A.done;A.next()){var M=A.value;if(x.length>=e)break;for(var P=y[s.indexOf(C,k[M])],R=s.iter(L);!R.done;R.next()){var E=R.value;if(E.name==P){var N=E.nonOverlappingCells().length;if(N>=o){if(N==o){if(D)continue;D=!0}if(2==N){if(b)continue;b=!0}var G=E;if(E.gridCells.length<=3){var w=E.flipRegion(),O=s.clone(new p.GridSuggester(this.group_,E).createSuggestions()),B=s.clone(new p.GridSuggester(this.group_,w).createSuggestions());O.length>0&&B.length>0&&(G=O[0].score>B[0].score?E:w)}for(var W=!1,U=s.iter(t);!U.done;U.next())if(U.value.similarity(G)<.02){W=!0;break}W||x.includes(G.name)||x.push(G.name)}}}}return x}}}),o),l.GridDocument=(n=function(){},s.defineClass({name:"GridDocument",ctor:n,props:{init_d4b4:function(e,t,r,o,n,i){this.docID=e,this.userID=t,this.database=r,this.gridFrame=o,this.gridStyle=n,this.layoutItems=s.clone(i)},init_implicit:function(e,t,r,o,n,i){this.gridFrame=e,this.gridStyle=t,this.layoutItems=s.clone(r),this.docID=o,this.userID=n,this.database=i},clone:function(){return n.init_implicit(this.gridFrame,this.gridStyle,this.layoutItems,this.docID,this.userID,this.database)}}}),n),l.RangedLayoutLinearModel=(i=function(e,t,r,o){this.minAngle=e,this.maxAngle=t,this.coefficients=r,this.intercepts=o},s.defineClass({name:"RangedLayoutLinearModel",ctor:i,props:{clone:function(){return new i(this.minAngle,this.maxAngle,this.coefficients,this.intercepts)}}}),i),l.LayoutSuggestionsLinearModel=(a=function(e,t,r,o){this.featureScalingMean=e,this.featureScalingStd=t,this.layoutIDs=s.clone(r),this.models=s.clone(o)},s.defineClass({name:"LayoutSuggestionsLinearModel",ctor:a,superName:"CoreObject"}),a)},"4ZS9":function(e,t,r){var o,n=t,i=r("oAGj"),a=r("gXiO"),l=r("mGL3"),s=r("3UhB");n.FontSuggestionContext=(o=function(){this.currentDocumentFonts_=new l.OrderedFontSet,this.recentlyUsedFonts_=new l.OrderedFontSet,a.CoreObject.call(this)},i.defineClass({name:"FontSuggestionContext",ctor:o,superName:"CoreObject",props:{snapshotCurrentFonts:function(e){this.currentDocumentFonts_=s.TypeLockupUtils.fontsInDocument(e)},currentDocumentFonts:{get:function(){return this.currentDocumentFonts_}},addRecentlyUsedFont:function(e){var t=this,r=null;if(this.recentlyUsedFonts_.contains(e)){var o=e.displayFamilyName;r=i.clone(this.recentlyUsedFonts_.facesInFamily(o))}i.opt(r,(function(e){return e.forEach((function(e){return t.recentlyUsedFonts_.remove(e)}))})),i.opt(r,(function(e){return e.forEach((function(e){return t.recentlyUsedFonts_.append(e)}))})),this.recentlyUsedFonts_.append(e)},clearRecentFonts:function(){this.recentlyUsedFonts_=new l.OrderedFontSet},recentlyUsedFonts:{get:function(){return this.recentlyUsedFonts_}}}}),o)},"6vbT":function(e,t,r){r("oAGj")},"9BFu":function(e,t,r){var o,n,i=t,a=r("oAGj"),l=r("gXiO"),s=r("fNpk"),u=r("jC54");i.ScoreComponent=(o=function(e,t,r,o){this.std=1,this.mean=0,this.feature=e,this.weight=t,this.functionParam=r,this.featureName=o},a.defineClass({name:"ScoreComponent",ctor:o,props:{normalFeature:{get:function(){return(this.feature-this.mean)/this.std}}}}),o),i.applyFieldWidth=function(e,t){var r=e.length;return r>=t?e:a.toString(" ",t-r)+e},i.WeightedScore=(n=function(e){this.initScore=-1*a.toDouble(a.MAXFLOAT),this.components_=[],this.score_=0,this.recalculateScore_=!0,this.versionNumber=1;for(var t=a.iter(a.range(0,e,!1));!t.done;t.next())this.components_.push(new i.ScoreComponent(0,1,1e-5,"Feature"));l.CoreObject.call(this)},a.defineClass({name:"WeightedScore",ctor:n,superName:"CoreObject",props:{setFeature:function(e,t){this.recalculateScore_=!0,this.components_[e].feature=t},setStd:function(e,t){t>0&&(this.recalculateScore_=!0,this.components_[e].std=t)},setMean:function(e,t){this.recalculateScore_=!0,this.components_[e].mean=t},getFeatureValue:function(e){return this.components_[e].feature},setWeight:function(e,t){this.recalculateScore_=!0,this.components_[e].weight=t},getWeights:function(){for(var e=[],t=a.iter(this.components_);!t.done;t.next()){var r=t.value;e.push(r.weight)}return e},getNames:function(){for(var e=[],t=a.iter(this.components_);!t.done;t.next()){var r=t.value;e.push(r.featureName)}return e},getFeatures:function(){for(var e=[],t=a.iter(this.components_);!t.done;t.next()){var r=t.value;e.push(r.feature)}return e},setWeights:function(e){this.recalculateScore_=!0;for(var t=a.iter(a.range(0,e.length,!1));!t.done;t.next()){var r=t.value;this.components_[r].weight=e[r]}},setFunctionParam:function(e,t){this.recalculateScore_=!0,this.components_[e].functionParam=t},setFeatureName:function(e,t){this.components_[e].featureName=t},clearFeatures:function(){this.components_.forEach((function(e){e.feature=0}))},score:{get:function(){return this.recalculateScore_&&this.calculateScore(),isNaN(this.score_)&&s.LegacyCoreAssert.fail("nan score",void 0,"WeightedScore","WeightedScore.swift",132),this.score_}},calculateScore:function(){var e=0;this.components_.forEach((function(t){return e+=Math.atan(t.normalFeature*t.functionParam)/Math.atan(t.functionParam)*t.weight})),this.recalculateScore_=!1,this.score_=e},asString:{get:function(){return this.getOutputString(!1,!1)}},nonZeroValues:{get:function(){return this.getOutputString(!0,!0)}},asSortedString:{get:function(){return this.getOutputString(!0,!1)}},getOutputString:function(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1);var r="",o=this.score,n=0;if(this.components_.length>0){r+="Features:\n";var l=[];this.components_.forEach((function(e){if(!t||0!=e.normalFeature){var r=Math.atan(e.normalFeature*e.functionParam)/Math.atan(e.functionParam);n+=e.weight*r;var o=Math.round(1e3*e.feature)/1e3,a=Math.round(1e3*e.normalFeature)/1e3,s=Math.round(1e3*e.mean)/1e3,u=Math.round(1e3*e.std)/1e3,c=Math.round(1e3*e.weight)/1e3,h=Math.round(100*c*a)/100,g=" "+i.applyFieldWidth(e.featureName,10)+":\t ("+o+" - "+s+") / "+u+" * "+c+": "+h+" \n";l.push({value:c*a,out:g})}})),e&&a.sortInPlace(l,(function(e,t){return e.value<t.value}));for(var s=a.iter(l);!s.done;s.next())r+=s.value.out}return Math.abs(n-o)>.001&&(r+="ERROR. scores don't match: "+n+", "+o+" \n"),r+="Total: "+Math.round(1e3*o)/1e3+" \n"},reject:function(){return!1},getVersion:function(){return"v"+this.versionNumber},writeFeatureDict:function(e,t){var r=this,o=0;a.each(t,(function(t,n){var i=u.ModelWeightLibrary.getData(e,t);r.setFeatureName(o,t),r.setMean(o,i.mean),r.setStd(o,i.std),r.setWeight(o,i.weight),r.setFeature(o,n),o+=1}))}}}),n)},CaSj:function(e,t,r){var o,n=t,i=r("oAGj");n.DesignSuggester=(o=function(e,t){this.maxSuggestions_=100,this.forma_=e,this.group_=t},i.defineClass({name:"DesignSuggester",ctor:o,superName:"CoreObject",statics:{perms:function(e){return o.permute(i.clone(e),i.clone([]))},permute:function(e,t){if(0==e.length)return[t];for(var r=[],n=i.iter(i.range(0,e.length,!1));!n.done;n.next()){var a=n.value,l=i.clone(e),s=i.clone(t);s.push(l[a]),l.splice(a,1),i.append(r,o.permute(i.clone(l),i.clone(s)))}return r},getPermutations:function(e,t){void 0===t&&(t=50);var r=[];if(e<5){var n=i.toArray(i.range(0,e,!1));(r=i.clone(o.perms(i.clone(n)))).length>t&&(i.shuffleInPlace(r),r=r.slice(0,t))}else for(var a=i.iter(i.range(0,t,!1));!a.done;a.next())n=i.toArray(i.range(0,e,!1)),i.shuffleInPlace(n),r.push(i.clone(n));return r}},props:{maxSuggestions:{get:function(){return this.maxSuggestions_},set:function(e){this.maxSuggestions_=e}},forma:{get:function(){return this.forma_}},group:{get:function(){return this.group_}},createSuggestions:function(){return[]}}}),o)},Dq5S:function(e,t,r){var o,n,i=t,a=r("oAGj"),l=r("lmwz"),s=r("fNpk"),u=r("8t9B");i.ItemContentType=a.defineEnum("ItemContentType",{Image:0,Floating:1}),i.TextInfo=(o=function(){},a.defineClass({name:"TextInfo",ctor:o,props:{init_91e2:function(e,t,r){this.textLength=e,this.font=t,this.backingShape=r},init_implicit:function(e,t,r){this.textLength=e,this.font=t,this.backingShape=r},clone:function(){return o.init_implicit(this.textLength,this.font,this.backingShape)}}}),o),i.LayoutItem=(n=function(){this.aspectRatios_=null,this.importance_=null,this.focus_=null},a.defineClass({name:"LayoutItem",ctor:n,props:{init_b14a:function(e){this.id_=e.formaID,this.forma_=e;var t,r,o=this.forma_.controller.floating,n=l.ImageFacade.getImageFormaForForma(e);if(o||null==n){if(s.LegacyCoreAssert.isTrue(this.forma_.controller.floating,"Layout item does not support non-floating formae other than background images",void 0,"LayoutItem.init","LayoutItem.swift",66),this.type_=i.ItemContentType.Floating,t=a.as(e.controller,u.TypeLockupController)){var c=t.text.length,h=a.opt(a.opt(t.lockupStyle,(function(e){return e.font})),(function(e){return e.fontData.postScriptName})),g=a.opt(t.lockupStyle,(function(e){return e.backingShapeID}));this.textInfo_=a.clone(i.TextInfo.init_91e2(c,h,g))}}else this.type_=i.ItemContentType.Image,(r=n.contentNode)&&(this.width_=a.toDouble(r.pixelWidth),this.height_=a.toDouble(r.pixelHeight),this.focus_=r.focusRegion)},init_e2cb:function(e,t,r,o,n,i,l){void 0===i&&(i=null),void 0===l&&(l=null),this.id_=e,this.type_=t,this.width_=r,this.height_=o,this.textInfo_=a.clone(n),this.aspectRatios_=a.clone(i),this.importance_=l,this.forma_=null},id:{get:function(){return this.id_}},forma:{get:function(){return this.forma_}},type:{get:function(){return this.type_}},width:{get:function(){return this.width_}},height:{get:function(){return this.height_}},textInfo:{get:function(){return this.textInfo_}},focusRegion:{get:function(){return this.focus_}},aspectRatios:{get:function(){return this.aspectRatios_},set:function(e){this.aspectRatios_=a.clone(e)}},importance:{get:function(){return this.importance_},set:function(e){this.importance_=e}}}}),n)},HG3C:function(e,t,r){var o,n,i=t,a=r("oAGj"),l=r("YSlt"),s=r("FNB+"),u=r("c+uM"),c=r("TkOd"),h=r("3DEm"),g=r("35Q0"),f=r("8t9B"),p=r("3UhB");i.ReadabilityInformation=(o=function(e,t){this.readabilityScore=e,this.readabilityString=t},a.defineClass({name:"ReadabilityInformation",ctor:o,props:{clone:function(){return new o(this.readabilityScore,this.readabilityString)}}}),o),i.LockupReadabilityEvaluator=(n=function(e,t){this.currentVersion="1.1",this.backgroundVariance=e,this.currentPosition=t.placement},a.defineClass({name:"LockupReadabilityEvaluator",ctor:n,statics:{calculateBackgroundVariance:function(e){var t,r=new l.ColorRankSuggester,o=[];if(t=a.as(e.controller,f.TypeLockupController))for(var n=a.iter(t.getBackgroundColorsFullList());!n.done;n.next()){var i=n.value;o.push(a.clone(l.ColorForComparison.init_c063(i,1)))}return r.getVarianceOfColors(a.clone(o))}},props:{getAllLockupVisualWeights:function(e){var t=this,r={};return e.root.page.root.visitAll(s.FormaTraversal.PreOrder,(function(e){var o=e.formaID;if(a.as(e.controller,f.TypeLockupController)){var n=a.clone(t.getLockupVisualWeight(e));r[o]=a.clone(n)}})),r},getLockupReadabilityInformation:function(e,t){var r;if(this.updateVarianceIfPositionHasChanged(e),null!=(r=this.getDensity(e,t))){var o=this.getBackgroundColorVariance(e,t);o<=.01&&(o=.01);var n=this.getLockupContrast(e,t),a=this.getPointSize(e),l=r/100*(n/o)/100*a/100,s="{score:"+h.MathUtils.roundDoubleToString(l,6)+",density:"+h.MathUtils.roundDoubleToString(r,6)+",variance:"+h.MathUtils.roundDoubleToString(o,6)+",backVar:"+h.MathUtils.roundDoubleToString(this.backgroundVariance,6)+",contrast:"+h.MathUtils.roundDoubleToString(n,6)+",size:"+h.MathUtils.roundDoubleToString(a,6)+",ver:"+this.currentVersion+"}";return new i.ReadabilityInformation(l,s)}return null},getLockupVisualWeight:function(e){var t,r=[1,1,1],o=this.getLockupSize(e),n=this.getLockupContrast(e,e.style);return null!=(t=this.getDensity(e,e.style))?{Contrast:n,Density:t,Size:o,VisualWeight:n*r[0]+t*r[1]+o*r[2]}:{Contrast:n,Density:-1,Size:o,VisualWeight:n*r[0]+o*r[2]}},getDensity:function(e,t){var r,o,n;return null!=(r=a.opt(t.font,(function(e){return e.fontData.postScriptName})))&&(o=p.TypeLockupUtils.getFontDescriptorFromPostScriptName(e,r))&&null!=(n=o.characterFeatures.area_perimeter_ratio)?n:null},getLockupSize:function(e){var t,r,o=0;return(t=a.as(e.controller,f.TypeLockupController))&&(r=t.size)&&(o=r.area),r=o/e.page.pageSize.area},getLockupContrast:function(e,t){var r,o=new c.InterestingPageData(e),n=new l.ColorRankSuggester,i=c.lockupStyleToLockupStyleAttributes(t,e.page.document),s=(g.ShapeLibrary.shapeDictionary[i.backing]||g.ShapeLibrary.shapeDictionary.none).filled,h=u.LockupStyle.isKnockoutLook(t.textLook),f=i.primaryColor,p=[];h?(r=e.page.colorLibraryController.getSolidColorForKey(i.secondaryColor))&&p.push(r):(r=e.page.colorLibraryController.getSolidColorForKey(f))&&p.push(r);var d,m=[];if(0==s||h)for(var v=a.iter(o.colorsBehindSelectedLockup);!v.done;v.next()){var y=v.value;m.push(a.clone(l.ColorForComparison.init_c063(y,1)))}else(d=e.page.colorLibraryController.getSolidColorForKey(i.secondaryColor))&&m.push(a.clone(l.ColorForComparison.init_c063(d,1)));return a.clone(n.weightedColorContrastRanker(a.clone(m),a.clone(p)))[0]/a.toDouble(m.length)},getBackgroundColorVariance:function(e,t){var r=c.lockupStyleToLockupStyleAttributes(t,e.page.document),o=0;return 0==(g.ShapeLibrary.shapeDictionary[r.backing]||g.ShapeLibrary.shapeDictionary.none).filled&&(o=this.backgroundVariance),o},getPointSize:function(e){var t,r=0;return(t=a.as(e.controller,f.TypeLockupController))&&(r=t.getAverageFontSize()),r},updateVarianceIfPositionHasChanged:function(e){e.placement.equal(this.currentPosition)||(this.currentPosition=e.placement,this.backgroundVariance=n.calculateBackgroundVariance(e))}}}),n)},HWAX:function(e,t,r){var o,n=t,i=r("oAGj"),a=r("yhkb"),l=r("C42b"),s=r("YSlt"),u=r("fNpk"),c=r("jcfx"),h=r("7Ta2");n.ColorSelectorUtils=(o=function(){},i.defineClass({name:"ColorSelectorUtils",ctor:o,statics:{getLightDarkColorToPreventIllegibility:function(e,t){for(var r=null,n=e.page.colorLibraryController.getProfilingColorKeys().concat(e.page.colorLibraryController.getThemeColorKeys()).concat(a.ColorLibraryController.BW_KEYS),l=[],u=i.iter(i.range(0,n.length,!1));!u.done;u.next()){var c,h=u.value;(c=e.page.colorLibraryController.getSolidColorForKey(n[h]))&&l.push(c)}var g,f=new s.ColorRankSuggester,p=i.clone(f.weightedColorContrastRanker(i.clone(t),i.clone(l)));return null!=(g=o.getIndexOfContrastingColorChoice(i.clone(p)))&&(r=n[g]),r},getIndexOfContrastingColorChoice:function(e){var t=null,r=i.clone(e);i.sortInPlace(r);for(var o=0,n=r.length>5?r.length-5:0,a=i.iter(i.range(n,r.length,!1).reversed());!a.done;a.next()){var s=a.value;r[s]>0&&(o=r[s])}for(var u=!1;!u&&o>0;){var c=l.CoreRandom.nextIntUniform(100)%e.length;e[c]>=o&&(t=c,u=!0)}return t},getComparisonColors:function(e,t,r){var o=[];if(null!=t)for(var n=i.iter(t);!n.done;n.next()){var a=n.value;o.push(i.clone(s.ColorForComparison.init_c063(a,1)))}return null!=r&&o.push(i.clone(r)),o},getSolidColorForChoices:function(e,t,r){for(var o=[],n=i.iter(i.range(0,r.length,!1));!n.done;n.next()){var a,l=n.value;(a=e.page.colorLibraryController.getSolidColorForKey(r[l]))&&o.push(a)}return o},mapInferredRoleToProfilingRole:function(e,t){void 0===t&&(t=null);var r=i.clone(t||(new h.RoleSuggester).getRole(e));return(new c.ProfilingColorMap).getProfilingCategoryForInferredRole(i.clone(r))},makeFinalDecisionOnColorChoice:function(e,t,r,n,a,l,c){if(void 0===a&&(a=!1),void 0===c&&(c=!1),0==r.length)return null;var h,g,f,p,d=new s.ColorRankSuggester,m=i.clone(d.weightedColorContrastRanker(i.clone(t),i.clone(n),a)),v=null,y=i.max(m);null!=y&&y>0?v=this.getContrastingChoice(c,i.clone(m),i.clone(r)):(null==(v=o.getLightDarkColorToPreventIllegibility(e,i.clone(t)))&&(g=e.root)&&(f=e.finalFrame)&&(p=g.finalFrame)&&(f.intersects(p)||(v=r[0])),u.LegacyCoreAssert.isTrue(null!=v,"Error: we couldn't find a legible color :(",void 0,"ColorSelectorUtils.makeFinalDecisionOnColorChoice","ColorSelectorUtils.swift",155));if(null!=(h=v)){var S,C=this.handlePaletteMappingOverride(h,e,l,i.clone(m),i.clone(r));(S=e.page.colorLibraryController.getSolidColorForKey(C))&&(0!=i.clone(d.weightedColorContrastRanker(i.clone(t),[S],a))[0]||l)&&(v=C)}return null==v&&(v=r[0]),v},getContrastingChoice:function(e,t,r){var o=null,n=i.max(t);if(e)o=r[i.indexOf(t,n)];else for(var a=i.iter(i.range(0,t.length,!1));!a.done;a.next()){var l=a.value;if(0!=t[l]){o=r[l];break}}return o},handlePaletteMappingOverride:function(e,t,r,o,n){var a="None";return a=r?t.formaID+c.ProfilingColorMap.backingColorKey:t.formaID,(new c.ProfilingColorMap).overridePaletteMappingDueToContrastAndForceDifference(e,a,i.clone(o),i.clone(n))},compareTwoColorStringsWithMargin:function(e,t){for(var r=!0,n=i.clone(o.convertColorStringToInt(e)),a=i.clone(o.convertColorStringToInt(t)),l=i.iter(i.range(0,n.length,!1));!l.done;l.next()){var s=l.value;n[s]!=a[s]&&n[s]!=a[s]-1&&n[s]!=a[s]+1&&(r=!1)}return r},convertColorStringToInt:function(e){for(var t=[],r=i.iter(i.range(0,i.toInt(e.length/3),!1));!r.done;r.next()){var o,n=r.value,a=e.substr(3*n,3);null!=(o=i.toInt(a))&&t.push(o)}return t}}}),o)},LqGn:function(e,t,r){var o,n=t,i=r("oAGj"),a=r("SpAV"),l=r("ascj"),s=r("FNB+"),u=r("P83h"),c=r("9Lk3"),h=r("ZK0l"),g=r("pnSN"),f=r("iCxV"),p=r("fNpk"),d=r("MYNe"),m=r("c+uM"),v=r("tGKA"),y=r("JFv5"),S=r("uxH+"),C=r("AxS/"),F=r("ODYV"),I=r("K0Rh"),T=r("MZST"),_=r("iSwi"),k=r("Zifs"),x=r("35Q0"),L=r("8t9B"),D=r("oKlP"),b=r("sIWg");n.RetargetSuggestion=(o=function(e,t,r,o,n,a){this.correspondence_=i.clone(n),this.modelDoc_=o,this.forma_=e,this.modelForma_=r,this.score_=new T.RetargetScore(t,r,i.clone(n)),this.layoutUpdate_=a,this.disableFallback_=!1},i.defineClass({name:"RetargetSuggestion",ctor:o,superName:"CoreObject",statics:{_implements:function(e){return"IDesignSuggestion"==e}},props:{score:{get:function(){return i.opt(this.score_,(function(e){return e.score}))}},weightedScore:{get:function(){return this.score_}},forma:{get:function(){return this.forma_}},disableFallback:{get:function(){return this.disableFallback_},set:function(e){this.disableFallback_=e}},distanceTo:function(e){return p.LegacyCoreAssert.fail("no distance",void 0,"RetargetSuggestion.distanceTo","RetargetSuggestion.swift",47),0},getGroupCorrespondences:function(){for(var e=this.forma_,t=[],r=i.iter(this.correspondence_);!r.done;r.next()){for(var o=r.value,n=[],a=i.iter(o.a);!a.done;a.next()){var l=a.value;e.visitAll(s.FormaTraversal.PreOrder,(function(e){e.originalID==l.originalID&&n.push(e)}))}t.push({a:n,b:o.b})}return t},matchGroupStyle:function(e,t){var r,o,n,a,l=this;if(0!=e.length&&0!=t.length){var u,c,h=e.filter((function(e){return e.kind==I.RootForma.KIND}),this),g=t.filter((function(e){return e.kind==I.RootForma.KIND}),this);h.length>0&&g.length>0&&(u=i.opt(i.as(h[0].controller,S.RootController),(function(e){return e.getGridController()})))&&(c=i.opt(i.as(g[0].controller,S.RootController),(function(e){return e.getGridController()})))&&(h[0].matchColors(g[0]),u.matchStyle(c));for(var f=[],p=[],d=i.iter(e);!d.done;d.next()){var v=d.value,y=i.clone(v.controller.userGroup?v.visitAsArray(s.FormaTraversal.PreOrder):[v]);i.append(f,y.filter((function(e){return l.considerFormaForRestyle(e)}),this))}for(var C=i.iter(t);!C.done;C.next())v=C.value,y=i.clone(v.controller.userGroup?v.visitAsArray(s.FormaTraversal.PreOrder):[v]),i.append(p,y.filter((function(e){return l.considerFormaForRestyle(e)}),this));if(0!=f.length){f=i.sort(f,(function(e,t){return((r=e.controller.currentHeightScale)||null!=r?r:0)>((o=t.controller.currentHeightScale)||null!=o?o:0)})),p=i.sort(p,(function(e,t){return((n=e.controller.currentHeightScale)||null!=n?n:0)>((a=t.controller.currentHeightScale)||null!=a?a:0)}));for(var F=i.clone(this.getUniqueStyles(i.clone(p))),T=i.clone(this.getUniqueStyles(i.clone(f))),_=i.iter(i.range(0,Math.min(F.length,T.length),!1));!_.done;_.next())for(var k=_.value,x=F[k],D=T[k].clone(),b=i.clone(this.styleMatchedForma(i.clone(f),D)),A=i.clone(this.styleMatchedForma(i.clone(p),x)),M=i.iter(b);!M.done;M.next()){var P,R=M.value;(O=i.as(R.controller,L.TypeLockupController))&&(B=O.lockupStyle)&&(P=i.as(x.clone(),m.LockupStyle))&&(b.length>1&&A.length<=1&&P.backing==m.LockupBacking.SVGBackground&&!m.LockupStyle.isKnockoutLook(P.textLook)&&(P.backing=m.LockupBacking.None),P.layout=B.layout,P.alignment=B.alignment,P.pathID=B.pathID,R.applyStyle(P),m.LockupStyle.isKnockoutLook(x.textLook)&&(x.backing=m.LockupBacking.None,m.LockupStyle.isKnockoutLook(x.textLook)&&(x.textLook=m.LockupTextLook.Fill)))}if(T.length>F.length)for(var E=i.iter(i.range(F.length,T.length,!1));!E.done;E.next())for(var N=E.value,G=m.LockupStyle.createDefault(),w=(D=T[N],i.iter(f));!w.done;w.next()){var O,B;R=w.value,(O=i.as(R.controller,L.TypeLockupController))&&(B=O.lockupStyle)&&this.styleMatch(D,B)&&(B.colors.match(G.colors),B.font=G.font)}}}},considerFormaForRestyle:function(e){var t;return!!(t=i.as(e.controller,L.TypeLockupController))&&t.text.length>1},getUniqueStyles:function(e){for(var t=this,r=[],o=i.iter(e);!o.done;o.next()){var n,a,l=o.value;(n=i.as(l.controller,L.TypeLockupController))&&(a=n.lockupStyle)&&(r.filter((function(e){return t.styleMatch(a,e)}),this).length>0||r.push(a.clone()))}return r},styleMatchedForma:function(e,t){for(var r=[],o=i.iter(e);!o.done;o.next()){var n,a,l=o.value;(n=i.as(l.controller,L.TypeLockupController))&&(a=n.lockupStyle)&&this.styleMatch(a,t)&&r.push(l)}return r},styleMatch:function(e,t){return i.opt(e.font,(function(r){return r.fontData.postScriptName==i.opt(t.font,(function(e){return e.fontData.postScriptName}))&&i.eq(k._equality_SolidColor_SolidColor,e.colors.fieldPrimary,t.colors.fieldPrimary)&&i.eq(k._equality_SolidColor_SolidColor,e.colors.fieldSecondary,t.colors.fieldSecondary)}))},getParentExpansionFrame:function(e){for(var t=null,r=i.iter(i.range(0,e.length,!1));!r.done;r.next()){var o=e[r.value].controller.visualParentExpansionFrame;t=null==t?o:t.unionWith(o)}return t},getUnionFrame:function(e){for(var t=null,r=i.iter(i.range(0,e.length,!1));!r.done;r.next()){var o,n=r.value,a=e[n].frame;(o=i.as(e[n],g.GroupForma))&&(a=o.childrenFrame),t=null==t?a:t.unionWith(a)}return t},matchGroupLayout:function(e,t,r){if(void 0===r&&(r=null),0==e.length||0==t.length)return a.CoreAssertDebugOnly.fail("can't have an empty match",void 0,"RetargetSuggestion.matchGroupLayout","RetargetSuggestion.swift",273),!1;var o=i.clone(t),n=i.clone(d.LayerFacade.sortInZOrder(i.clone(e))),l=this.getParentExpansionFrame(i.clone(o)),s=this.getUnionFrame(i.clone(o)),u=this.getUnionFrame(i.clone(n)),c=t[0].root.finalFrame;p.LegacyCoreAssert.isTrue(c.equalWithAccuracy(e[0].root.finalFrame,1),"after resizing the model, the frames should match",void 0,"RetargetSuggestion.matchGroupLayout","RetargetSuggestion.swift",287),s=i.opt(s,(function(e){return e.intersectionWith(c)})),u=i.opt(u,(function(e){return e.intersectionWith(c)}));var f=n[0].parent,m=u,S=b.TheoRect.fromSize(s.fitAspectRatioWithin(m.aspectRatio));S=S.moveToPoint(s.center,new D.TheoPoint(.5,.5));var C,F,I=Math.sqrt(m.area/S.area);if((C=S.scale(I).intersectionWith(l.insetRel(.1,.1,.1,.1)))&&(S=C),F=S.intersectionWith(m)){var T=F.area/Math.max(S.area,m.area),_=S.area/c.area;if(T>.6&&_>.5)return!1}var k=f.page.createFormaWithController(g.GroupForma.KIND,h.GroupController.KIND);k.allowUserMove=!1;var x=k.controller;k.isModel=!0,x.preferredResizeType=y.ResizeLayoutType.Proportional,f.appendChild(k),k.placement=v.Matrix2D.translationXY(m.minX,m.minY),k.bounds=b.TheoRect.fromSize(m.size);for(var L=i.iter(n);!L.done;L.next()){var A=L.value;k.appendChild(A,!0)}k.bounds=b.TheoRect.fromSize(S.size),k.move(v.Matrix2D.translation(k.finalFrame.evalXY(.5,.5).multiply(-1)).translate(S.center));for(var M=i.iter(n);!M.done;M.next())A=M.value,f.appendChild(A,!0);return k.removeFromParent(),!0},apply:function(){this.applyWithIndex(null)},applyWithIndex:function(e){void 0===e&&(e=null);var t=this,r=this.forma_;(s=new u.FormaAnimationTransactionEvent(r)).duration=0,r.beginUpdate(s),_.RetargetSuggester.cleanupRoot(r);for(var o=this.modelDoc_.beginTransaction("adjust_template"),n=i.clone(r.filterWithCallback((function(e){return e.isTypeLockup()&&e.frame.area>1}))),a=i.iter(n);!a.done;a.next()){var l=a.value;i.opt(i.as(l.controller,L.TypeLockupController),(function(e){return e.updateGroup()}))}r.page.colorLibraryController.restoreUndoState(i.as(this.modelDoc_.firstPage.colorLibrary.state.allProperties,"AnyObject"));for(var s,c=!this.disableFallback_&&this.layoutUpdate_?new F.RelayoutEvaluationScore(r):null,h=!this.disableFallback_&&this.layoutUpdate_?r.page.database.beginTransaction("try_resize",null):null,g=!0,p=!1,d=i.iter(i.range(0,2,!1));!d.done;d.next()){for(var m,v,y=d.value,S=i.iter(this.getGroupCorrespondences());!S.done;S.next()){var I=S.value,T=I.a.filter((function(e){return null!=e.controller&&e.controller.floating}),this).length>0;!this.layoutUpdate_||1==y&&T?this.matchGroupStyle(i.clone(I.a),i.clone(I.b)):1==I.a.length&&1==I.b.length?I.a[0].match(I.b[0]):(this.matchGroupStyle(i.clone(I.a),i.clone(I.b)),g=g&&this.matchGroupLayout(i.clone(I.a),i.clone(I.b)))}if(!((m=c)&&(v=h)&&(m.evaluateDocument(),m.reject()&&0==y))){i.opt(h,(function(e){return e.end()}));break}v.rollback(),p=!0,h=null}o.rollback(),i.opt(r.page.document,(function(e){return e.content.root.setTag(C.RootContentNode.THEME_ID_TAG,t.modelDoc_.uuid)})),this.cleanupForma(r),r.page.colorLibraryController.enteredPalettePicker(),(null!=e&&e>1||!g)&&r.page.colorLibraryController.shuffleColorAssignments(),r.endUpdate(s),f.Host.platform.isAndroid&&p&&((s=new u.FormaHierarchyChangedEvent(r)).duration=.1,r.beginUpdate(s),r.endUpdate(s))},cleanupForma:function(e){for(var t=i.clone(e.page.colorLibraryController.getThemeColorKeys()),r=i.iter(e.visitAsArray(s.FormaTraversal.PreOrder));!r.done;r.next())for(var o=r.value,n=[l.ColorRole.FieldPrimary,l.ColorRole.FieldSecondary,l.ColorRole.Border],a=i.iter(n);!a.done;a.next()){var u=a.value;if(null==o.style.colors.color(u))for(var h=i.iter(i.range(0,n.length,!1));!h.done;h.next()){var g,f=h.value;if(null!=(g=o.style.colors.colorID(u))){var p,d=i.replaceAll(g,"themeColor","");if(null!=(p=i.toInt(d))){for(var v=t[(p+f)%t.length],y=!1,S=i.iter(n);!S.done;S.next()){var C,F=S.value;u!=F&&null!=(C=o.style.colors.colorID(F))&&C==v&&(y=!0)}if(!y){o.style.colors.setColorId(u,v);break}}}}}for(var I=i.clone(e.filterWithCallback((function(e){return e.isTypeLockup()&&e.frame.area>1}))),T=i.clone(e.filterWithCallback((function(e){return e.hasIntent(s.Forma.INTENT_ICON)}))),_=i.iter(T);!_.done;_.next()){var k,D,b=_.value;if((k=b.style.colors.fieldPrimary)&&(D=i.opt(b.controller,(function(e){return e.getBackgroundColor()})))){for(var A=[],M=i.iter(T);!M.done;M.next()){var P,R=M.value;i.eq(s._equality_Forma_Forma,b,R)||(P=R.style.colors.fieldPrimary)&&k.distanceTo(P)<1&&A.push(R)}var E=A.length>0;if((E&&k.distanceTo(D)<1||!E&&!k.contrasts(D,!1))&&(i.opt(b.controller,(function(e){return e.shuffleColorAssignment()})),E))for(var N=i.iter(A);!N.done;N.next())N.value.style.colors.setColor(l.ColorRole.FieldPrimary,b.style.colors.fieldPrimary)}}i.sortInPlace(I,(function(e,t){var r,o,n,a;if((r=i.as(e.controller,L.TypeLockupController))&&(o=i.as(e.controller,L.TypeLockupController))&&(n=i.opt(r.lockupForma,(function(e){return e.childrenFinalFrame})))&&(a=i.opt(o.lockupForma,(function(e){return e.childrenFinalFrame})))){var l=r.lockupStyle.backing==m.LockupBacking.Knockout&&m.LockupStyle.isKnockoutLook(r.lockupStyle.textLook),s=o.lockupStyle.backing==m.LockupBacking.Knockout&&m.LockupStyle.isKnockoutLook(o.lockupStyle.textLook);return n.area+(l?1e5:0)>a.area+(s?1e5:0)}return!1}));for(var G=i.iter(I);!G.done;G.next()){var w,O=G.value;if(w=i.as(O.controller,L.TypeLockupController)){var B,W;w.snapSizeToBounds(),null!=(B=i.opt(w.lockupStyle,(function(e){return e.backingShapeID})))&&(W=x.ShapeLibraryDataStructures.init_d41d().DisplayOrderForShapesByCategory[x.ShapeLibrary.CategorySocial])&&W.includes(B)&&w.styleController.applyBacking(m.LockupBacking.None,null),m.LockupStyle.isShadowLook(w.lockupStyle.textLook)||w.lockupStyle.textBacked||w.contrastCheck(!1);var U=O.parent,V=w.lockupStyle.backing==m.LockupBacking.Knockout&&m.LockupStyle.isKnockoutLook(w.lockupStyle.textLook);if(null!=U&&V){for(var Y=O.parent.indexOfChild(O),H=Y,j=i.iter(I);!j.done;j.next()){var K=j.value;i.eq(s._equality_Forma_Forma,O,K)||O.parent!=K.parent||(H=Math.min(H,K.parent.indexOfChild(K)))}H<Y&&U.insertChildAt(O,H)}}}for(var z=i.iter(e.filterByControllerKind(c.GridController.KIND));!z.done;z.next()){var X,q=z.value;if(X=i.as(q.controller,c.GridController))for(var Z=i.iter(X.gridStyle.gridCells);!Z.done;Z.next()){var J,Q=Z.value;if(null!=(J=Q.colorID)&&null==e.page.colorLibrary.color(J)){var $=i.clone(e.page.colorLibraryController.unusedColorKeys(null,!0));$.length>0&&X.gridStyle.updateCell(Q,null,$[0],null)}}}},dummy:function(e){}}}),o)},LwcA:function(e,t,r){var o,n=t,i=r("oAGj"),a=r("gXiO"),l=r("wc1n"),s=r("WlyK"),u=r("jV/A"),c=r("sIWg"),h=r("1NAc");n.RetargetCompatibilitySuggester=(o=function(){a.CoreObject.call(this)},i.defineClass({name:"RetargetCompatibilitySuggester",ctor:o,superName:"CoreObject",statics:{sortDocuments:function(e,t){for(var r=i.clone(o.scoreDocuments(e,i.clone(t))),n=[],a=i.iter(r);!a.done;a.next()){var l=a.value;n.push(l.data)}return n},scoreDocuments:function(e,t){for(var r=o.createRetargetDocumentData(e),n=i.clone(r.lockupStrings),a=[],l=i.iter(t);!l.done;l.next()){var u=l.value,c=i.clone(u.lockupStrings),h=c.length,g=!1;if(n.length==h)for(var f=i.iter(i.range(0,h,!1));!f.done;f.next()){var p=f.value;if(c[p]!=n[p])break;p+1==h&&(g=!0)}if(!g){var d=new s.RetargetCompatibilityScore(e.frame,r,u);a.push({data:u,score:d})}}return i.sort(a,(function(e,t){return e.score.score>t.score.score}))},createRetargetDocumentData:function(e){var t=l.FeatureExtractorFactory.getFeatureExtractor(l.FeatureExtractorType.Retarget,e),r=i.clone(t.allFeatures_),o=i.as(r.Focus,"AnyObject"),n=o.length;return new u.RetargetDocumentExemplar("","","","","",h.TheoSize.decodeJson(i.as(r.Size,"AnyObject"))||h.TheoSize.Zero,2,2,"","",i.clone(r.LockupStrings),null!=o&&n>0?c.TheoRect.decodeJson(o):null,r.NumImages,i.clone(i.as(r.Edges,["Array","Double"])),r.LayoutId,r.NumGridsCells,r.NumMoveable,r.NumShapes,i.clone(r.VisualGroupInfo),i.clone(r.TextRoles),i.clone(r.ShapeRoles),r.SalientCoverage,r.GifsCount)}}}),o)},MZST:function(e,t,r){var o,n,i=t,a=r("oAGj"),l=r("FNB+"),s=r("c+uM"),u=r("8t9B"),c=r("9BFu");i.RetargetScore=(o=function e(t,r,o){this.rejectThreshold=-1e3,this.root_=t,this.model_=r,this.correspondence_=a.clone(o),c.WeightedScore.call(this,e.Features.NUM_FEAT),this.setWeight(e.Features.MIN_TEXT_SIZE,0),this.setWeight(e.Features.LENGTH_TEXT_DIFF,-30),this.setWeight(e.Features.WEIGHT_DIFF,0),this.setWeight(e.Features.RELATIVE_WEIGHT,-20),this.setWeight(e.Features.RELATIVE_LOCATION,-10),this.setWeight(e.Features.GROUP_SIZE_DIFF,-100),this.setWeight(e.Features.GROUP_COUNT_DIFF,-40),this.setWeight(e.Features.MISSING_TEXT,-5e3),this.setWeight(e.Features.TYPE_MISMATCH,-80),this.setWeight(e.Features.STYLE_MISMATCH,-80),this.setFeatureName(e.Features.MIN_TEXT_SIZE,"Min Text Size"),this.setFeatureName(e.Features.LENGTH_TEXT_DIFF,"Text Length Difference"),this.setFeatureName(e.Features.WEIGHT_DIFF,"Weight Difference"),this.setFeatureName(e.Features.RELATIVE_WEIGHT,"Relative Weight"),this.setFeatureName(e.Features.RELATIVE_LOCATION,"Relative Location"),this.setFeatureName(e.Features.GROUP_SIZE_DIFF,"Group Size Diff"),this.setFeatureName(e.Features.GROUP_COUNT_DIFF,"Group Count Diff"),this.setFeatureName(e.Features.MISSING_TEXT,"Missing Text"),this.setFeatureName(e.Features.TYPE_MISMATCH,"Type Mismatch"),this.setFeatureName(e.Features.STYLE_MISMATCH,"Style Mismatch"),this.setFeature(e.Features.MIN_TEXT_SIZE,0),this.setFeature(e.Features.LENGTH_TEXT_DIFF,0),this.setFeature(e.Features.WEIGHT_DIFF,0),this.setFeature(e.Features.RELATIVE_WEIGHT,0),this.setFeature(e.Features.RELATIVE_LOCATION,0),this.setFeature(e.Features.GROUP_SIZE_DIFF,0),this.setFeature(e.Features.GROUP_COUNT_DIFF,0),this.setFeature(e.Features.MISSING_TEXT,0),this.setFeature(e.Features.TYPE_MISMATCH,0),this.setFeature(e.Features.STYLE_MISMATCH,0),this.evaluateLayout()},n={},a.defineClass({name:"RetargetScore",ctor:o,superName:"WeightedScore",statics:{Features:{get:function(){return void 0===n.Features&&(n.Features=a.defineEnum("Features",{MIN_TEXT_SIZE:0,WEIGHT_DIFF:1,LENGTH_TEXT_DIFF:2,RELATIVE_WEIGHT:3,RELATIVE_LOCATION:4,MISSING_TEXT:5,GROUP_SIZE_DIFF:6,GROUP_COUNT_DIFF:7,TYPE_MISMATCH:8,STYLE_MISMATCH:9,ROLES_MISMATCH:10,NUM_FEAT:11})),n.Features}}},props:{evaluateLayout:function(){var e,t,r=this;this.setFeature(o.Features.MIN_TEXT_SIZE,0);for(var n=[],i={},c={},h=0,g=0,f=a.iter(this.correspondence_);!f.done;f.next()){var p=f.value;g+=a.toDouble(Math.abs(p.a.length-p.b.length));for(var d=0,m=0,v=a.iter(p.a);!v.done;v.next())d+=(S=v.value).frame.area/S.root.frame.area;for(var y=a.iter(p.b);!y.done;y.next()){var S;m+=(S=y.value).frame.area/S.root.frame.area}var C=d-m;h+=a.toDouble(C*C);for(var F=a.iter(a.range(0,Math.min(p.a.length,p.b.length),!1));!F.done;F.next()){var I=F.value,T=p.a[I],_=p.b[I];n.push({forma:T,placed:_}),i[T.formaID]={forma:T,length:0,size:(e=T.controller.currentHeightScale)||null!=e?e:T.finalFrame.height,center:T.frame.center},c[_.formaID]={forma:_,length:0,size:(t=_.controller.currentHeightScale)||null!=t?t:_.finalFrame.height,center:_.frame.center}}}this.setFeature(o.Features.GROUP_SIZE_DIFF,h),this.setFeature(o.Features.GROUP_COUNT_DIFF,g/a.toDouble(this.correspondence_.length));for(var k=0,x=0,L=0,D=0,b=0,A=this.root_.frame.area,M=a.iter(n);!M.done;M.next()){var P,R,E,N,G=M.value;if((G.forma.isTypeLockup()&&G.placed.isGraphic()||G.forma.isGraphic()&&G.placed.isTypeLockup())&&(D+=1,(P=a.as(G.placed.controller,u.TypeLockupController))&&(P.lockupStyle.backing==s.LockupBacking.None&&P.lockupStyle.textLook==s.LockupTextLook.Fill||null!=(R=P.averageLineHeight)&&(b+=R/100))),null!=(E=i[G.forma.formaID])&&null!=(N=c[G.placed.formaID])){k+=Math.abs(E.size-N.size)/A;for(var w=a.iter(n);!w.done;w.next()){var O,B,W=w.value;a.eq(l._equality_Forma_Forma,G.forma,W.forma)||a.eq(l._equality_Forma_Forma,G.placed,W.placed)||null!=(O=i[W.forma.formaID])&&null!=(B=c[W.placed.formaID])&&((E.size-O.size>5&&N.size-B.size<-5||E.size-O.size<-5&&N.size-B.size>5)&&a.opt(E.forma.controller,(function(e){return e.kind==a.opt(O.forma.controller,(function(e){return e.kind}))}))&&a.opt(N.forma.controller,(function(e){return e.kind==a.opt(B.forma.controller,(function(e){return e.kind}))}))&&(x+=1),(E.center.x-O.center.x>20&&N.center.x-B.center.x<-20||E.center.x-O.center.x<-20&&N.center.x-B.center.x>20)&&(L+=.5),(E.center.y-O.center.y>20&&N.center.y-B.center.y<-20||E.center.y-O.center.y<-20&&N.center.y-B.center.y>20)&&(L+=1))}}}for(var U=a.iter(this.correspondence_);!U.done;U.next()){p=U.value;for(var V=a.clone(p.a),Y=a.iter(a.range(0,V.length,!1));!Y.done;Y.next()){I=Y.value;for(var H=a.iter(a.range(0,V.length,!1));!H.done;H.next()){var j=H.value;I>j&&V[I].frame.center.y>V[j].frame.center.y&&(L+=1)}}}this.setFeature(o.Features.WEIGHT_DIFF,k/a.toDouble(n.length)),this.setFeature(o.Features.RELATIVE_WEIGHT,x/a.toDouble(n.length)),this.setFeature(o.Features.RELATIVE_LOCATION,.5*L/a.toDouble(n.length)),this.setFeature(o.Features.TYPE_MISMATCH,D/a.toDouble(n.length)),this.setFeature(o.Features.STYLE_MISMATCH,b/a.toDouble(n.length)),this.setFeature(o.Features.ROLES_MISMATCH,0/a.toDouble(n.length));var K=0;this.model_.visit(l.FormaTraversal.PreOrder,(function(e,t,o){var n;if(n=a.as(e.controller,u.TypeLockupController)){for(var i=!1,s=a.iter(r.correspondence_);!s.done;s.next())for(var c=s.value,h=a.iter(c.b);!h.done;h.next()){var g=h.value;a.eq(l._equality_Forma_Forma,e,g)&&(i=!0)}if(!i){var f=a.toDouble(n.text.length);K+=e.frame.area/f}}return!1})),this.setFeature(o.Features.MISSING_TEXT,K/this.root_.frame.area)},reject:function(){return this.score<this.rejectThreshold}}}),o)},OYRJ:function(e,t,r){var o,n=t,i=r("oAGj"),a=r("UGKO"),l=r("fNpk"),s=r("K0Rh");n.FormaPlacementSuggestion=(o=function(e,t,r){l.LegacyCoreAssert.isTrue(e.kind!=s.RootForma.KIND,"forma placement suggester does not support the root forma",void 0,"FormaPlacementSuggestion.init","FormaPlacementSuggestion.swift",17),this.forma_=e,this.score_=r,this.location_=t},i.defineClass({name:"FormaPlacementSuggestion",ctor:o,statics:{_implements:function(e){return"IDesignSuggestion"==e}},props:{location:{get:function(){return this.location_}},distanceTo:function(e){var t=e,r=0,o=this.forma_.page.pageSize.hypotenuse;return r+=a.distancePositionWeight*this.location_.center.distanceTo(t.location.center)/o,r+=a.distanceSizeWeight*Math.abs(this.location_.width-t.location.width)/o,r+=a.distanceSizeWeight*Math.abs(this.location_.height-t.location.height)/o},apply:function(){this.forma_.controller.fit(this.location_)},score:{get:function(){return this.score_.score}},weightedScore:{get:function(){return this.score_}},forma:{get:function(){return this.forma_}}}}),o)},Ohrj:function(e,t,r){var o,n,i,a=t,l=r("oAGj"),s=r("yhkb"),u=r("HWAX"),c=r("fNpk"),h=r("jcfx");a.ProfilingColorSelector=(o=function(e,t){var r;this.inertiaRatio=1,this.weights=[],this.weightSum=0,this.currentIndividualIndex=0,this.numIndividualChoices=5,this.isBacking=!1,this.forma=e,this.isBacking=t,(r=l.opt(this.forma,(function(e){return e.controller})))?this.colorsBehindForma=l.clone(r.getBackgroundColors()):this.colorsBehindForma=[],this.values=e.page.colorLibraryController.getThemeColorKeys().concat(e.page.colorLibraryController.getProfilingColorKeys())},l.defineClass({name:"ProfilingColorSelector",ctor:o,props:{updateBackgroundColors:function(e){this.colorsBehindForma=l.clone(e||l.opt(l.opt(this.forma,(function(e){return e.controller})),(function(e){return e.getBackgroundColors()})))},selectColorForGlobalRecolor:function(e,t,r,o){void 0===e&&(e=!0),void 0===t&&(t=null),void 0===r&&(r=!1),void 0===o&&(o=null);var n=s.ColorLibraryController.BW_KEYS[0];if(null!=this.forma){var i=u.ColorSelectorUtils.mapInferredRoleToProfilingRole(this.forma,l.clone(o)),a=l.clone(u.ColorSelectorUtils.getComparisonColors(this.forma,l.clone(e?this.colorsBehindForma:null),l.clone(t))),c=l.clone(this.getListOfColorChoicesForRoleGlobal(i));if(c.length>0){var h,g=l.clone(u.ColorSelectorUtils.getSolidColorForChoices(this.forma,i,l.clone(c)));null!=(h=u.ColorSelectorUtils.makeFinalDecisionOnColorChoice(this.forma,l.clone(a),l.clone(c),l.clone(g),r,this.isBacking,!1))&&(n=h)}}return n},selectColorForIndividualRecolor:function(e,t,r,o){void 0===e&&(e=!0),void 0===t&&(t=null),void 0===o&&(o=null);var n=s.ColorLibraryController.THEME_DERIVED_BW_KEYS[0];if(null!=this.forma){var i=u.ColorSelectorUtils.mapInferredRoleToProfilingRole(this.forma,l.clone(o)),a=l.clone(u.ColorSelectorUtils.getComparisonColors(this.forma,l.clone(e?this.colorsBehindForma:null),l.clone(t))),c=l.clone(this.getListOfColorChoicesForRoleIndividual(i));if(c.length>0){var h=l.clone(u.ColorSelectorUtils.getSolidColorForChoices(this.forma,i,l.clone(c))),g=this.currentIndividualIndex%c.length,f=c.concat();f.splice(0,0,c[g]);var p,d=h.concat();d.splice(0,0,h[g]),null!=(p=u.ColorSelectorUtils.makeFinalDecisionOnColorChoice(this.forma,l.clone(a),l.clone(f),l.clone(d),r,this.isBacking))&&(n=p)}}return this.currentIndividualIndex=(this.currentIndividualIndex+1)%this.numIndividualChoices,n},getListOfColorChoicesForRoleGlobal:function(e){return c.LegacyCoreAssert.fail("base color selector not implemented. use primary or background",void 0,"ProfilingColorSelector.getListOfColorChoicesForRoleGlobal","ColorSelector.swift",116),[]},getListOfColorChoicesForRoleIndividual:function(e){return c.LegacyCoreAssert.fail("base color selector not implemented. use primary or background",void 0,"ProfilingColorSelector.getListOfColorChoicesForRoleIndividual","ColorSelector.swift",121),[]}}}),o),a.ProfilingPrimaryColorSelector=(n=function(e,t){a.ProfilingColorSelector.call(this,e,t)},l.defineClass({name:"ProfilingPrimaryColorSelector",ctor:n,superName:"ProfilingColorSelector",props:{getListOfColorChoicesForRoleGlobal:function(e){return(new h.ProfilingColorMap).getPrimaryColorsForRoleGlobal(e,this.forma.formaID,this.forma.page)},getListOfColorChoicesForRoleIndividual:function(e){return(new h.ProfilingColorMap).getPrimaryColorsForRoleIndividual(this.forma.page,e,this.numIndividualChoices)}}}),n),a.ProfilingBackgroundColorSelector=(i=function(e,t){a.ProfilingColorSelector.call(this,e,t)},l.defineClass({name:"ProfilingBackgroundColorSelector",ctor:i,superName:"ProfilingColorSelector",props:{getListOfColorChoicesForRoleGlobal:function(e){return(new h.ProfilingColorMap).getBackgroundColorsForRoleGlobal(e,this.forma.formaID,this.forma.page)},getListOfColorChoicesForRoleIndividual:function(e){return(new h.ProfilingColorMap).getBackgroundColorsForRoleIndividual(this.forma.page,e,this.numIndividualChoices)}}}),i)},PXFs:function(e,t,r){var o,n,i,a=t,l=r("oAGj"),s=r("yGNn"),u=r("C42b"),c=r("iCxV"),h=r("xYeW"),g=r("kJ8p"),f=r("c+uM"),p=r("3DEm"),d=r("7Ta2"),m=r("EoOi"),v=r("8t9B"),y=r("3UhB"),S=r("uUew");a.PostTextStylesData=(o=function(e,t,r,o,n,i,a,l,s,u,c,h,g,f,p,d,m){this.role=e,this.msl=t,this.tracking=r,this.spacing=o,this.width=n,this.height=i,this.pageWidth=a,this.pageHeight=l,this.fontDensity=s,this.variance=u,this.backgroundVariance=c,this.contrast=h,this.numWords=g,this.numLines=f,this.fontSize=p,this.guid=d,this.limit=m},l.defineClass({name:"PostTextStylesData",ctor:o,props:{parameters:{get:function(){var e,t,r,o,n="role="+((e=this.role)||null!=e?e:d.InferredRoleType.Undefined)+"&msl="+this.msl+"&tracking="+(null!=this.tracking?p.MathUtils.roundDoubleToString(this.tracking,4):"-1.0")+"&spacing="+(null!=this.spacing?p.MathUtils.roundDoubleToString(this.spacing,4):"-1.0")+"&width="+(null!=this.width?p.MathUtils.roundDoubleToString(this.width,4):"-1.0")+"&height="+(null!=this.height?p.MathUtils.roundDoubleToString(this.height,4):"-1.0")+"&page_width="+this.pageWidth+"&page_height="+this.pageHeight+"&font_density="+(null!=this.fontDensity?p.MathUtils.roundDoubleToString(this.fontDensity,4):"-1.0")+"&variance="+(null!=this.variance?p.MathUtils.roundDoubleToString(this.variance,4):"-1.0")+"&background_variance="+(null!=this.backgroundVariance?p.MathUtils.roundDoubleToString(this.backgroundVariance,4):"-1.0")+"&contrast="+(null!=this.contrast?p.MathUtils.roundDoubleToString(this.contrast,4):"-1.0")+"&num_words="+((t=this.numWords)||null!=t?t:-1)+"&num_lines="+((r=this.numLines)||null!=r?r:-1)+"&avg_font_size="+(null!=this.fontSize?p.MathUtils.roundDoubleToString(this.fontSize,4):"-1.0")+"&guid="+((o=this.guid)||null!=o?o:"Null")+"&limit="+this.limit;return l.replaceAll(n," ","%20")}},clone:function(){return new o(this.role,this.msl,this.tracking,this.spacing,this.width,this.height,this.pageWidth,this.pageHeight,this.fontDensity,this.variance,this.backgroundVariance,this.contrast,this.numWords,this.numLines,this.fontSize,this.guid,this.limit)}}}),o),a.layoutAlignmentData=(n=function(e,t){this.layout=e,this.alignment=t},l.defineClass({name:"layoutAlignmentData",ctor:n,props:{clone:function(){return new n(this.layout,this.alignment)}}}),n),a.PostTextStylesServiceInterface=(i=function(e,t){this.serviceAPIKey="Theo2",this.stylesAPIUrl="https://posttextstylesservice.adobe.io/styles?",this.emphasisAPIUrl="https://posttextstylesservice.adobe.io/text/emphasis",this.apiCallLimit=225,this.limitToEvaluate=4,this.thresholdToCallEmphasisService=3,this._advancedFeatures=!1,this._letLayoutsDetermineWeighting=!0,this._randomizeSuggestions=!0,this.forma=e,this.readabilityInfo=t,this.stylesAPICache=[],this.tokenCache=[],this.emphasisAPICache=[],this.autoTextCache=[],this.autoTextWeightingCache=[],this.autoTextIndex=0,this.emphasisIndex=0},l.defineClass({name:"PostTextStylesServiceInterface",ctor:i,superName:"CoreObject",props:{advancedFeatures:{get:function(){return this._advancedFeatures},set:function(e){var t;!this._advancedFeatures&&e&&(t=l.as(this.forma.controller,v.TypeLockupController))&&this.resetWeightedAutoTextCache(t.text),this._advancedFeatures=e}},overrideAPIKey:function(e){this.serviceAPIKey=e},resetWeightedAutoTextCache:function(e){this.autoTextWeightingCache.splice(0),this.autoTextIndex=0,this.autoTextWeightingCache=l.clone(m.TypographyComposer.getApplicableLayoutWeightings(e,l.clone(this.tokenCache)))},resetAutoTextCache:function(e,t,r,o){this.autoTextCache.splice(0),this.autoTextIndex=0;var n=l.clone(m.TypographyComposer.buildTokenList(e,l.clone(r),o)),i=new m.TypographyParams(t,o.spacing,o.relativeFontScale);this.autoTextCache=l.clone(m.TypographyComposer.getApplicableLayouts(l.clone(n),i))},getAdvancedTextStyleSuggestion:function(e){var t,r=null;if(t=l.as(this.forma.controller,v.TypeLockupController)){if(this._letLayoutsDetermineWeighting){this._randomizeSuggestions?(this.autoTextIndex=l.toInt(l.toDouble(this.autoTextWeightingCache.length)*l.toDouble(u.CoreRandom.nextInt)/l.toDouble(u.CoreRandom.randMax)),r=this.getTextStyleSuggestion(e)):this.autoTextIndex==this.autoTextWeightingCache.length?(this.autoTextIndex=0,r=this.getTextStyleSuggestion(e)):r=t.lockupStyle;for(var o=l.iter(t.charStyleRanges);!o.done;o.next()){var n=o.value;t.applyCharStyleDirectly(n,n,v.CharStyleApplyMode.Remove)}for(var i=l.clone(this.autoTextWeightingCache[this.autoTextIndex].weighting),a=l.iter(i);!a.done;a.next())n=a.value,t.applyCharStyleDirectly(n,n,v.CharStyleApplyMode.Apply,!1);null==r&&(r=t.lockupStyle),r.alignment=this.autoTextWeightingCache[this.autoTextIndex].alignment}else this.autoTextIndex<this.autoTextCache.length?r=t.lockupStyle:this.emphasisAPICache.length>0&&this.emphasisIndex<this.emphasisAPICache.length?(this.emphasisIndex+=1,(i=this.getCurrentTextEmphasisSuggestion())&&(t.applyCharStyleFromRangeListWithoutUI(l.clone(t.charStyleRanges),v.CharStyleApplyMode.Remove),t.applyCharStyleFromRangeListWithoutUI(l.clone(i),v.CharStyleApplyMode.Toggle)),r=t.lockupStyle,this.resetAutoTextCache(t.text,t.size,l.clone(t.charStyleRanges),r)):(r=this.getTextStyleSuggestion(e),(i=this.getCurrentTextEmphasisSuggestion())&&(t.applyCharStyleFromRangeListWithoutUI(l.clone(t.charStyleRanges),v.CharStyleApplyMode.Remove),t.applyCharStyleFromRangeListWithoutUI(l.clone(i),v.CharStyleApplyMode.Toggle)),null!=r&&this.resetAutoTextCache(t.text,t.size,l.clone(t.charStyleRanges),r)),null==r&&(r=t.lockupStyle),r.alignment=this.autoTextCache[this.autoTextIndex];if(null!=r)return r.layout=f.LockupLayout.Auto,this.autoTextIndex+=1,r.backing!=f.LockupBacking.None&&(r.backing=f.LockupBacking.SVGBackground,null==r.backingArtworkID&&(r.backingArtworkID="square_001")),r}return this.getTextStyleSuggestion(e)},getTextStyleSuggestion:function(e){var t,r=null;if(this.stylesAPICache.length>0&&(t=l.as(this.forma.controller,v.TypeLockupController))){for(var o=t.styleController,n=0;null==r&&n<this.limitToEvaluate&&0!=this.stylesAPICache.length;)r=o.updateLockupStyleWithNewColors(this.decodeStyleAPIObject(l.clone(this.stylesAPICache.shift()))),null!=e&&(n+=1,r=e.lockupStyleEvaluator.styleEvaluatedWithReadability(r));null==r&&this.stylesAPICache.length>0&&(r=o.updateLockupStyleWithNewColors(this.decodeStyleAPIObject(l.clone(this.stylesAPICache.shift()))),l.opt(r,(function(e){return e.wheelUsed=!0})))}return r},getNextTextEmphasisSuggestion:function(){return this.emphasisAPICache.length>0?(this.emphasisIndex+=1,this.emphasisAPICache[this.emphasisIndex%this.emphasisAPICache.length]):null},getCurrentTextEmphasisSuggestion:function(){return this.emphasisAPICache.length>0?this.emphasisAPICache[this.emphasisIndex%this.emphasisAPICache.length]:null},getNumStylesInCache:function(){return this.stylesAPICache.length},getEmphasisCache:function(){return this.emphasisAPICache},getEmphasisTokens:function(){return this.tokenCache},resetStyleSuggestions:function(e){return void 0===e&&(e=!1),this.advancedFeatures&&(this.autoTextCache.splice(0),this.autoTextIndex=0,this.resetEmphasisSuggestions(!0)),this.stylesAPICache=[],this.stylesPromise=null,this.populateStylesCacheWithAPISuggestions(e)},resetEmphasisSuggestions:function(e){return this.emphasisAPICache=[],this.tokenCache=[],this.emphasisIndex=0,this.emphasisPromise=null,this.populateEmphasisCacheWithAPISuggestions(e)},getNLPInformtionForCurrentEmphasized:function(){var e,t=[];if(e=l.as(this.forma.controller,v.TypeLockupController))for(var r=l.clone(e.charStyleRanges),o=l.iter(r);!o.done;o.next()){for(var n=o.value,i="",a=l.iter(this.tokenCache);!a.done;a.next()){var s,u,c,h,g,f=a.value;if(null!=(s=l.as(f.offset,"Int"))&&s>=n.start&&s<n.end&&null!=(u=l.as(f.index,"Int"))&&null!=(c=l.as(f.pos,"String"))&&null!=(h=l.as(f.relation,"String"))&&null!=(g=l.as(f.tag,"String"))){var p=null,d=null,m=null;u>=0&&u<=this.tokenCache.length&&(p=l.as(this.tokenCache[u].pos,"String"),d=l.as(this.tokenCache[u].relation,"String"),m=l.as(this.tokenCache[u].tag,"String"));var y="";y+="{",y+="index:"+l.toString(u),y+="\\,pos:"+c,y+="\\,rela:"+h,y+="\\,tag:"+g,y+="\\,depPos:"+(null!=p?p:"none"),y+="\\,depRela:"+(null!=d?d:"none"),y+="\\,depTag:"+(null!=m?m:"none"),i+=y+="}"}}i.length>0&&t.push(i)}return t},getStylesPromise:function(e){var t,r,o=this,n=l.as(this.forma.controller,v.TypeLockupController),i=l.clone(new a.PostTextStylesData((new d.RoleSuggester).getRole(this.forma).role,((t=l.opt(n,(function(e){return e.charStyleRanges.length})))||null!=t?t:0)>0||e,l.opt(l.opt(n,(function(e){return e.lockupStyle})),(function(e){return e.tracking})),l.opt(l.opt(n,(function(e){return e.lockupStyle})),(function(e){return e.spacing})),l.opt(l.opt(n,(function(e){return e.size})),(function(e){return e.width})),l.opt(l.opt(n,(function(e){return e.size})),(function(e){return e.height})),this.forma.page.pageSize.width,this.forma.page.pageSize.height,l.opt(n,(function(e){return null!=e.lockupStyle?l.opt(o.readabilityInfo,(function(e){return e.getDensity(o.forma,n.lockupStyle)})):null})),l.opt(n,(function(e){return null!=e.lockupStyle?l.opt(o.readabilityInfo,(function(e){return e.getBackgroundColorVariance(o.forma,n.lockupStyle)})):null})),l.opt(n,(function(e){return null!=e.lockupStyle?l.opt(o.readabilityInfo,(function(e){return e.backgroundVariance})):null})),l.opt(n,(function(e){return null!=e.lockupStyle?l.opt(o.readabilityInfo,(function(e){return e.getLockupContrast(o.forma,n.lockupStyle)})):null})),l.opt(n,(function(e){return e.wordCount()})),l.opt(n,(function(e){return e.numLines()})),l.opt(n,(function(e){return e.getAverageFontSize()})),null,this.apiCallLimit));if(r=c.Host.network){var u=new g.HostNetworkRequest(this.stylesAPIUrl+i.parameters);return u.method=g.HostNetworkRequestMethod.get,u.headers["x-api-key"]=this.serviceAPIKey,u.headers["x-live-data"]="false",r.request(u)}return s.CorePromise.reject("Unable to create Host network request")},getEmphasisPromise:function(){var e,t,r,o=l.as(this.forma.controller,v.TypeLockupController);if((e=c.Host.network)&&(t=c.Host.dataFactory)&&null!=(r=l.opt(o,(function(e){return e.text})))){var n,i=new g.HostNetworkRequest(this.emphasisAPIUrl);return i.headers["x-api-key"]=this.serviceAPIKey,(n=this.getEmphasisHostDataProtocol(r,t))?(i.method=g.HostNetworkRequestMethod.post,i.data=t.createFromFormData(l.clone(n)),e.request(i)):s.CorePromise.resolve("No valid data object to sent")}return s.CorePromise.reject("Unable to create Host network request")},getEmphasisHostDataProtocol:function(e,t){var r,o=l.replaceAll(e,"\n"," ");return o=l.replaceAll(o,"\r"," "),o=l.replaceAll(o,"\t"," "),this.containsLetters(o)&&(r=t.createFromString(o,"text/plain"))?{text:new h.HostNetworkFormDatum(r)}:null},containsLetters:function(e){for(var t=l.iter(l.range(0,e.length,!1));!t.done;t.next()){var r=t.value,o=e.substr(r,1);if(o>="a"&&o<="z"||o>="A"&&o<="Z")return!0}return!1},populateStylesCacheWithAPISuggestions:function(e){var t,r=this;return this.stylesPromise=this.getStylesPromise(e),(t=this.stylesPromise)?t.then((function(e){var t;return(t=l.opt(l.opt(l.as(e,g.HostNetworkResponse),(function(e){return e.data})),(function(e){return e.asJSON()})))?t.then((function(e){var t,o;if((t=l.as(e,["Dictionary","String","Any"]))&&(o=l.as(t.styles,["Array",["Dictionary","String","Any"]]))){for(var n=l.iter(o);!n.done;n.next()){var i=n.value;r.stylesAPICache.push(l.clone(i))}return s.CorePromise.resolve(null)}return s.CorePromise.reject("Unable to decode object")})):s.CorePromise.reject("Unable to process response")})):s.CorePromise.reject("unable to get styles promise")},decodeStyleAPIObject:function(e){var t=this.getPrimaryStyleFromDict(l.clone(e));if(null!=e.hasMSL){var r=this.getSecondaryStyleFromDict(l.clone(e),t);t.setCharacterStyle(v.TypeLockupController.HIGHLIGHT_STYLE,r)}return t},populateEmphasisCacheWithAPISuggestions:function(e){var t,r=this;if(null!=(t=this.getBaselineEmphasisSuggestions())&&t<this.thresholdToCallEmphasisService)return s.CorePromise.resolve("No need to use emphasis service, just cycle through options");var o=this.getEmphasisPromise();return this.emphasisPromise=o,o.then((function(t){var o,n;return(o=l.as(t,g.HostNetworkResponse))&&(n=l.opt(o.data,(function(e){return e.asJSON()})))?n.then((function(t){var n;return(n=r.decodeEmphasisResponse(t))&&e&&(r.emphasisAPICache=l.clone(n)),s.CorePromise.resolve(o)})):s.CorePromise.resolve("Unable to process emphasis response")}))},getBaselineEmphasisSuggestions:function(){var e;if(this.advancedFeatures){if(e=l.as(this.forma.controller,v.TypeLockupController)){var t=[],r=m.TypographyComposer.getWordRanges(e.text,null);if(r.length>1){for(var o=l.iter(r);!o.done;o.next()){var n=o.value;t.push([n])}this.emphasisAPICache=l.clone(t)}return t.length}}else if(e=l.as(this.forma.controller,v.TypeLockupController)){var i=l.clone(e.getAllTextFormae());if(t=[],i.length<10)for(var a=l.iter(i);!a.done;a.next()){var s=a.value;t.push([s.rangeInLockup])}else for(var u=l.iter(l.range(0,l.toInt(i.length/2),!1));!u.done;u.next()){var c=2*u.value,h=c+1;t.push([i[c].rangeInLockup,i[h].rangeInLockup])}return t.length>1&&(this.emphasisAPICache=l.clone(t)),t.length}return null},decodeNLP:function(e,t,r){for(var o=l.iter(t);!o.done;o.next()){var n,i=o.value;if(n=l.as(i.categories,["Array","Int"]))for(var a=l.clone(e.getAllTextFormae()),s=l.iter(a);!s.done;s.next()){var u=s.value;if(u.text.toLowerCase().includes(i.text.toLowerCase())&&i.offset==u.rangeInLockup.start){for(var c=l.iter(n);!c.done;c.next())r[c.value].push(u.rangeInLockup);break}}}},decodeNLPAdvanced:function(e,t,r){for(var o=e.text,n=l.iter(t);!n.done;n.next()){var i,a,s,u=n.value;if((i=l.as(u.categories,["Array","Int"]))&&null!=(a=l.as(u.text,"String"))&&null!=(s=l.as(u.offset,"Int"))){l.assert(o.substr(s,a.length)==a,"Token not found.");for(var c=l.iter(i);!c.done;c.next())r[c.value].push(new S.TextRange(s,s+a.length))}}},decodeEmphasisResponse:function(e){var t,r,o,n;if((g=l.as(e,["Dictionary","String","Any"]))&&(t=l.as(g.emphasis,["Array",["Dictionary","String","Any"]]))&&(r=l.as(t[0].words,["Array",["Dictionary","String","Any"]]))&&(o=l.as(t[0].categories,["Array","Int"]))&&(n=l.as(t[0].tokens,["Array",["Dictionary","String","Any"]]))){this.tokenCache=l.clone(n);for(var i,a={},s=l.iter(o);!s.done;s.next())a[s.value]=[];(i=l.as(this.forma.controller,v.TypeLockupController))&&(this.advancedFeatures?this.decodeNLPAdvanced(i,l.clone(r),a):this.decodeNLP(i,l.clone(r),a));for(var u=[],c=l.sort(l.keys(a,"numeric")),h=l.iter(c);!h.done;h.next()){var g,f=h.value;(g=l.clone(a[f])).length>0&&u.push(l.clone(g))}return u}return null},decodeNLPResponse:function(e){var t,r,o,n;if((g=l.as(e,["Dictionary","String","Any"]))&&(t=l.as(g.emphasis,["Array",["Dictionary","String","Any"]]))&&(r=l.as(t[0].words,["Array",["Dictionary","String","Any"]]))&&(o=l.as(t[0].categories,["Array","Int"]))&&(n=l.as(t[0].tokens,["Array",["Dictionary","String","Any"]]))){this.tokenCache=l.clone(n);for(var i,a={},s=l.iter(o);!s.done;s.next())a[s.value]=[];(i=l.as(this.forma.controller,v.TypeLockupController))&&(this.advancedFeatures?this.decodeNLPAdvanced(i,l.clone(r),a):this.decodeNLP(i,l.clone(r),a));for(var u=[],c=l.sort(l.keys(a,"numeric")),h=l.iter(c);!h.done;h.next()){var g,f=h.value;(g=l.clone(a[f])).length>0&&u.push(l.clone(g))}return u}return null},getPrimaryStyleFromDict:function(e){var t,r,o,n,i,a,s,u,c,h,g,p,d=(t=l.as(e.textOpacity,"Double"))||null!=t?t:f.LockupStyle.DEFAULT_TEXTOPACITY,m=(r=l.as(e.backingOpacity,"Double"))||null!=r?r:f.LockupStyle.DEFAULT_BACKINGOPACITY,v=(o=l.as(e.spacing,"Double"))||null!=o?o:f.LockupStyle.DEFAULT_SPACING,y=(n=l.as(e.tracking,"Double"))||null!=n?n:f.LockupStyle.DEFAULT_TRACKING,S=(i=l.as(e.padding,"Double"))||null!=i?i:f.LockupStyle.DEFAULT_PADDING,C=null==l.as(e.backing,"Int")||!(a=f.LockupBacking.toCaseValue(e.backing))&&null==a?f.LockupBacking.None:a,F=(s=l.as(e.backingArtworkID,"String"))||null!=s?s:null,I=(u=l.as(e.shadowAngle,"Double"))||null!=u?u:f.LockupStyle.DEFAULT_SHADOWANGLE,T=null!=l.as(e.opacityRule,"Int")?(c=f.OpacityRule.toCaseValue(e.opacityRule))||null!=c?c:f.OpacityRule.UNSET:f.OpacityRule.Full,_=null==l.as(e.textLook,"Int")||!(h=f.LockupTextLook.toCaseValue(e.textLook))&&null==h?f.LockupTextLook.Fill:h,k=(g=l.as(e.shadowOffset,"Double"))||null!=g?g:f.LockupStyle.DEFAULT_SHADOWOFFSET,x=(p=l.as(e.strokeWeight,"Double"))||null!=p?p:f.LockupStyle.DEFAULT_STROKEWEIGHT,L=this.getTheoFont(l.clone(e),"primaryFont"),D=l.clone(this.getLayoutAlignment(l.clone(e)));return C=this.checkBackingValid(C,F),_=this.checkTextLookValid(_),f.LockupStyle.init_d158(d,m,null,L,v,y,S,C,F,I,D.layout,D.alignment,T,_,k,x)},getSecondaryStyleFromDict:function(e,t){var r,o,n,i,a,s=f.LockupStyle.createDefaultCharacterStyle(t);s.font=this.getTheoFont(l.clone(e),"mslFont"),s.textOpacity=(r=l.as(e.mslOpacity,"Double"))||null!=r?r:f.LockupStyle.OPACITY_UNSET,s.padding=(o=l.as(e.mslPadding,"Double"))||null!=o?o:f.LockupStyle.DEFAULT_PADDING;var u=null==l.as(e.mslBacking,"Int")||!(n=f.LockupBacking.toCaseValue(e.mslBacking))&&null==n?f.LockupBacking.None:n;return s.backingArtworkID=(i=l.as(e.mslBackingArtworkID,"String"))||null!=i?i:null,s.textLook=null==l.as(e.mslTextLook,"Int")||!(a=f.LockupTextLook.toCaseValue(e.mslTextLook))&&null==a?f.LockupTextLook.Fill:a,s.textLook=this.checkTextLookValid(s.textLook),s.backing=this.checkBackingValid(u,s.backingArtworkID),s},checkBackingValid:function(e,t){return e==f.LockupBacking.SVGBackground&&null==t?(l.assert(!1,"Backing set to SVG, but no backing artwork ID found"),f.LockupBacking.None):e},checkTextLookValid:function(e){return e<0?f.LockupTextLook.Fill:e},getTheoFont:function(e,t){var r,o,n=null;return null!=(r=l.as(e[t],"String"))&&(o=y.TypeLockupUtils.getFontDescriptorFromPostScriptName(this.forma,r))&&(n=y.TypeLockupUtils.createTheoFont(o,null)),n},getLayoutAlignment:function(e){var t,r,o,n,i=l.clone(new a.layoutAlignmentData(f.LockupLayout.FitJustified,f.LockupAlignment.UNSET)),s=(t=l.as(e.layout,"Int"))||null!=t?t:f.LockupLayout.UNSET;return(n=this.fixLegacyLayout(s))?(i.layout=n.layout,i.alignment=n.alignment):(i.layout=(r=f.LockupLayout.toCaseValue(s))||null!=r?r:f.LockupLayout.FitJustified,i.alignment=null==l.as(e.alignment,"Int")||!(o=f.LockupAlignment.toCaseValue(e.alignment))&&null==o?f.LockupAlignment.UNSET:o,i.layout==f.LockupLayout.FitJustified&&l.assert(i.alignment==f.LockupAlignment.UNSET,"If layout is FitJustified, alignment should be UNSET")),i},fixLegacyLayout:function(e){var t;if(null!=(t=f.LockupLayout.toCaseValue(e)))switch(t){case 3:return new a.layoutAlignmentData(f.LockupLayout.Standard,f.LockupAlignment.Center);case 1:return new a.layoutAlignmentData(f.LockupLayout.Standard,f.LockupAlignment.Left);case 2:return new a.layoutAlignmentData(f.LockupLayout.Standard,f.LockupAlignment.Right);default:return null}return null}}}),i)},TP4q:function(e,t,r){var o,n=t,i=r("oAGj"),a=r("pnSN"),l=r("cbNz"),s=r("9BFu");n.GridScore=(o=function(e,t,r,o,n,u,c,h){this.dataset="DefaultGridScore",this.rejectThreshold=-1e3,void 0===e&&(e=null),void 0===o&&(o=null),void 0===n&&(n=!1),void 0===u&&(u=null),void 0===c&&(c=null),void 0===h&&(h=null),this.currentGrid_=o,this.gridStyle_=e,this.gridFrame_=t,this.contentAware_=n,this.layoutItems_=i.clone(r);var g=i.clone(new l.GridStyleFeatureExtractor(i.as(o,a.GroupForma),i.clone(c),i.clone(h),e,t,i.clone(r)).features);s.WeightedScore.call(this,i.count(g)),this.writeFeatureDict(this.dataset,i.clone(g)),null!=u&&u.length==i.count(g)&&this.setWeights(i.clone(u))},i.defineClass({name:"GridScore",ctor:o,superName:"WeightedScore",props:{gridStyle:{get:function(){return this.gridStyle_}},reject:function(){return this.score<this.rejectThreshold}}}),o)},UGKO:function(e,t,r){var o,n,i=t,a=r("oAGj"),l=r("fNpk"),s=r("8t9B");i.distanceColorWeight=1,i.distanceSizeWeight=.25,i.distancePositionWeight=.5,i.IDesignSuggestion=a.defineProtocol("IDesignSuggestion",{apply:"() -> Void",distanceTo:"(IDesignSuggestion) -> Double",score:"Double",weightedScore:"WeightedScore",forma:"Forma"}),i.DesignTextSuggestion=(o=function(e,t){this.text_=t;var r=a.as(e.controller,s.TypeLockupController);l.LegacyCoreAssert.isTrue(null!=r,"must be type lockup controller",void 0,"DesignTextSuggestion.init","DesignSuggestion.swift",31),this.forma_=e},a.defineClass({name:"DesignTextSuggestion",ctor:o,statics:{_implements:function(e){return"IDesignSuggestion"==e}},props:{apply:function(){var e=this,t=a.as(this.forma_.controller,s.TypeLockupController);a.opt(a.opt(t,(function(e){return e.contentNode})),(function(t){return t.text=e.text_})),a.opt(t,(function(e){return e.updateGroup()})),a.opt(a.opt(this.forma_.page.document,(function(e){return e.controller})),(function(e){return e.controllerSettingsState.settings=null}))},distanceTo:function(e){return l.LegacyCoreAssert.fail("no distance",void 0,"DesignTextSuggestion.distanceTo","DesignSuggestion.swift",45),0},score:{get:function(){return null}},weightedScore:{get:function(){return null}},forma:{get:function(){return this.forma_}}}}),o),i.AddFormaSuggestion=(n=function(e,t){this.parent_=t,this.forma_=e},a.defineClass({name:"AddFormaSuggestion",ctor:n,statics:{_implements:function(e){return"IDesignSuggestion"==e}},props:{apply:function(){this.parent_.appendChild(this.forma_)},distanceTo:function(e){return l.LegacyCoreAssert.fail("no distance",void 0,"AddFormaSuggestion.distanceTo","DesignSuggestion.swift",68),0},score:{get:function(){return null}},weightedScore:{get:function(){return null}},forma:{get:function(){return this.forma_}}}}),n)},UqVc:function(e,t,r){var o,n=t,i=r("oAGj");n.SuggestionUtils=(o=function(){},i.defineClass({name:"SuggestionUtils",ctor:o,props:{normalizedWeights:function(e){var t,r,o=[];if(null!=(t=i.min(e))&&null!=(r=i.max(e)))for(var n=r-t==0,a=i.iter(e);!a.done;a.next()){var l=a.value;if(n)o.push(1);else{var s=(l-t)/(r-t);o.push(s)}}return o},weightsEqualNaNOrEmpty:function(e){if(0==e.length==1)return!0;for(var t=i.iter(e);!t.done;t.next()){var r=t.value;if(1==isNaN(r))return!0}return!1}}}),o)},WlyK:function(e,t,r){var o,n,i=t,a=r("oAGj"),l=r("SpAV"),s=r("fNpk"),u=r("3DEm"),c=r("sIWg"),h=r("9BFu");i.RetargetCompatibilityScore=(o=function e(t,r,o){this.rejectThreshold=-500,h.WeightedScore.call(this,e.Features.NUM_FEAT),this.setFeature(e.Features.NUM_GRIDCELL_DIFF,0),this.setFeature(e.Features.NUM_BG_IMAGE_DIFF,0),this.setFeature(e.Features.NUM_FLOATING_IMAGE_DIFF,0),this.setFeature(e.Features.LENGTH_TEXT_DIFF,0),this.setFeature(e.Features.IMAGE_SIMILARITY,0),this.setFeature(e.Features.DESIGN_SIZE_DIFF,0),this.setFeature(e.Features.GRID_DESIGN,0),this.setFeature(e.Features.VISUAL_GROUP_DISSIMILARITY,0),this.setFeature(e.Features.SALIENT_COVERAGE_DISSSIMILARITY,0),this.setWeight(e.Features.NUM_GRIDCELL_DIFF,-1e3),this.setWeight(e.Features.NUM_BG_IMAGE_DIFF,-500),this.setWeight(e.Features.NUM_FLOATING_IMAGE_DIFF,-50),this.setWeight(e.Features.LENGTH_TEXT_DIFF,-100),this.setWeight(e.Features.IMAGE_SIMILARITY,-50),this.setWeight(e.Features.DESIGN_SIZE_DIFF,-1e4),this.setWeight(e.Features.GRID_DESIGN,200),this.setWeight(e.Features.VISUAL_GROUP_DISSIMILARITY,-100),this.setWeight(e.Features.SALIENT_COVERAGE_DISSSIMILARITY,-100),this.setFeatureName(e.Features.LENGTH_TEXT_DIFF,"Text Length Difference"),this.setFeatureName(e.Features.NUM_BG_IMAGE_DIFF,"Background Image Difference"),this.setFeatureName(e.Features.NUM_FLOATING_IMAGE_DIFF,"Floating Image Difference"),this.setFeatureName(e.Features.IMAGE_SIMILARITY,"Image Similarity"),this.setFeatureName(e.Features.DESIGN_SIZE_DIFF,"Design Size Difference"),this.setFeatureName(e.Features.GRID_DESIGN,"Grid Design"),this.setFeatureName(e.Features.VISUAL_GROUP_DISSIMILARITY,"Visual Group Dissimilarity"),this.setFeatureName(e.Features.SALIENT_COVERAGE_DISSSIMILARITY,"Salient Coverage Dissimilarity"),this.setFeatureName(e.Features.NUM_GRIDCELL_DIFF,"Grid Cells Difference");var n=a.clone(r.edgeMap),i=a.clone(o.edgeMap);if(null!=i&&null!=n)if(n.length==i.length){for(var l=1e-5,g=a.iter(a.range(0,i.length,!1));!g.done;g.next())l+=i[d=g.value];for(var f=0,p=a.iter(a.range(0,n.length,!1));!p.done;p.next()){var d=p.value;f+=Math.abs(n[d]-i[d]/l)}s.LegacyCoreAssert.isFalse(isNaN(f),"image difference evaluated to NaN",void 0,"RetargetCompatibilityScore.init","RetargetCompatibilityScore.swift",85),this.setFeature(e.Features.IMAGE_SIMILARITY,f)}else this.setFeature(e.Features.IMAGE_SIMILARITY,0);function m(e,t){return e.length>t.length}for(var v=a.sort(r.lockupStrings.concat(),m),y=a.sort(o.lockupStrings.concat(),m),S=(f=[],[]),C=a.iter(a.range(0,Math.min(v.length,y.length),!1));!C.done;C.next()){d=C.value;var F=a.toDouble(v[d].length),I=a.toDouble(y[d].length);f.push(F-I),S.push(Math.max(F,I))}var T=this.norm(a.clone(f))/(this.norm(a.clone(S))+.001);this.setFeature(e.Features.LENGTH_TEXT_DIFF,T);var _=this.getNumberOfFloatingImages(a.clone(r.visualGroupInfo)),k=this.getNumberOfFloatingImages(a.clone(o.visualGroupInfo)),x=Math.max(r.numImages-a.toDouble(_),0),L=Math.max(o.numImages-a.toDouble(k),0),D=Math.abs(x-L),b=D;1==D&&0==x&&(b=.1),this.setFeature(e.Features.NUM_FLOATING_IMAGE_DIFF,a.toDouble(Math.abs(_-k))),this.setFeature(e.Features.NUM_BG_IMAGE_DIFF,b);var A=c.TheoRect.fromSize(o.size),M=c.TheoRect.fromSize(r.size).similarity(A);this.setFeature(e.Features.DESIGN_SIZE_DIFF,M),this.setFeature(e.Features.GRID_DESIGN,""==o.layoutID?0:1);var P=u.MathUtils.absDouble(r.salientCoverage-o.salientCoverage);this.setFeature(e.Features.SALIENT_COVERAGE_DISSSIMILARITY,P);var R=this.scoreVisualGroups(a.clone(r.visualGroupInfo),a.clone(o.visualGroupInfo));this.setFeature(e.Features.VISUAL_GROUP_DISSIMILARITY,R);var E=a.toDouble(Math.max(0,Math.abs(r.numGridCells-o.numGridCells)-1));this.setFeature(e.Features.NUM_GRIDCELL_DIFF,E)},n={},a.defineClass({name:"RetargetCompatibilityScore",ctor:o,superName:"WeightedScore",statics:{Features:{get:function(){return void 0===n.Features&&(n.Features=a.defineEnum("Features",{LENGTH_TEXT_DIFF:0,NUM_BG_IMAGE_DIFF:1,NUM_FLOATING_IMAGE_DIFF:2,IMAGE_SIMILARITY:3,DESIGN_SIZE_DIFF:4,GRID_DESIGN:5,VISUAL_GROUP_DISSIMILARITY:6,NUM_GRIDCELL_DIFF:7,SALIENT_COVERAGE_DISSSIMILARITY:8,NUM_FEAT:9})),n.Features}}},props:{norm:function(e){for(var t=0,r=a.iter(e);!r.done;r.next()){var o=r.value;t+=o*o}return Math.sqrt(t)},getNumberOfFloatingImages:function(e){for(var t=0,r=a.iter(e);!r.done;r.next()){var o=r.key,n=r.value;if("type"==o&&"frame"==n)t+=1;else if("children"==o){var i;if(i=a.as(n,["Array",["Dictionary","String","AnyObject"]]))for(var l=a.iter(i);!l.done;l.next()){var s=l.value;t+=this.getNumberOfFloatingImages(a.clone(s))}}}return t},scoreVisualGroups:function(e,t){var r,o,n=0;if(null!=e.children&&null!=t.children&&(r=e.children)&&(o=t.children)){n+=u.MathUtils.absDouble(a.toDouble(r.length-o.length)),e.layoutStrategy!=t.layoutStrategy&&(n+=1);var i=this.computeAreaofGroups(a.clone(r)),l=this.computeAreaofGroups(a.clone(o));n+=u.MathUtils.absDouble(i-l)/Math.max(i,l);for(var s=[],c=a.iter(r);!c.done;c.next()){for(var h=c.value,g=1/0,f=0,p=a.iter(a.range(0,o.length,!1));!p.done;p.next()){var d=p.value,m=a.clone(o[d]);if(!s.includes(d)){var v=this.subTreeMisMatchScore(a.clone(h),a.clone(m));v<g&&(g=v,f=d)}}g<1/0&&(n+=g/a.toDouble(r.length),s.push(f))}}return n},computeAreaofGroups:function(e){for(var t=0,r=a.iter(e);!r.done;r.next()){var o,n=r.value;(o=c.TheoRect.decodeJson(n.frame))&&(t+=o.area)}return t},subTreeMisMatchScore:function(e,t){var r=this,o=0,n=a.clone(a.as(e.children,["Array",["Dictionary","String","AnyObject"]])),i=a.clone(a.as(t.children,["Array",["Dictionary","String","AnyObject"]]));if(null!=n&&null!=i){e.layoutStrategy!=t.layoutStrategy&&(o+=1);var s=a.clone(a.opt(n,(function(e){return e.filter((function(e){return"Group"!=a.as(e.type,"String")}),r)}))),c=a.clone(a.opt(i,(function(e){return e.filter((function(e){return"Group"!=a.as(e.type,"String")}),r)}))),h=a.clone(a.opt(s,(function(e){return e.map((function(e){return e.role}),r)}))),g=a.clone(a.opt(c,(function(e){return e.map((function(e){return e.role}),r)})));o+=a.toDouble(this.roleDifference(a.clone(h),a.clone(g)));var f=a.clone(a.opt(n,(function(e){return e.filter((function(e){return"Group"==a.as(e.type,"String")}),r)}))),p=a.clone(a.opt(i,(function(e){return e.filter((function(e){return"Group"==a.as(e.type,"String")}),r)})));if(f.length>0||p.length>0){var d=this.computeAreaofGroups(a.clone(f)),m=this.computeAreaofGroups(a.clone(p));o+=u.MathUtils.absDouble(d-m)/Math.max(d,m)}}return o>1e3?(l.CoreAssertDebugOnly.fail("score sanity check failed. return 0.",void 0,"RetargetCompatibilityScore.subTreeMisMatchScore","RetargetCompatibilityScore.swift",289),0):o},roleDifference:function(e,t,r){void 0===r&&(r=!0);var o=0,n=a.clone(e),i=a.clone(t);r||(n=a.clone(t),i=a.clone(e));for(var l=a.iter(n);!l.done;l.next()){var s=l.value;i.includes(s)||(o+=1)}return o},reject:function(){return this.score<this.rejectThreshold}}}),o)},YSlt:function(e,t,r){var o,n,i=t,a=r("oAGj"),l=r("iCxV"),s=r("3DEm"),u=r("Zifs");i.ColorForComparison=(o=function(){this.role=""},a.defineClass({name:"ColorForComparison",ctor:o,props:{init_c063:function(e,t,r){void 0===r&&(r=""),this.color=e,this.weight=t,this.role=r},init_implicit:function(e,t,r){void 0===r&&(r=""),this.color=e,this.weight=t,this.role=r},clone:function(){return o.init_implicit(this.color,this.weight,this.role)}}}),o),i.ColorRankSuggester=(n=function(){},a.defineClass({name:"ColorRankSuggester",ctor:n,superName:"CoreObject",props:{weightedColorContrastRanker:function(e,t,r){var o;void 0===r&&(r=!1);var n=15*a.toDouble(e.length);r&&(n*=2);for(var i=a.repeat(0,t.length),l=a.iter(a.range(0,t.length,!1));!l.done;l.next()){for(var s=l.value,c=t[s],h=0,g=a.iter(a.range(0,e.length,!1));!g.done;g.next()){var f,p=g.value;if(f=e[p].color){var d=(o=e[p].weight)||null!=o?o:1;if(a.eq(u._equality_SolidColor_SolidColor,c,f))h+=1;else{var m=(1*f.perceptualDifference(c)+50*Math.pow(f.lightnessDifference(c)/50,2)*.7)/2;i[s]+=m*d}}}var v=a.toDouble(h)/a.toDouble(e.length);v>.4||h==e.length||i[s]<n?i[s]=0:i[s]*=1-v}return i},getVarianceOfColors:function(e){if(e.length<1)return a.opt(l.Host.logging,(function(e){return e.info("ColorRankSuggester.getVarianceOfColors() has no colors in listOfCompared")})),0;var t=[];t.push([]),t.push([]),t.push([]),t.push([]);for(var r=a.iter(e);!r.done;r.next()){var o;(o=(d=r.value).color)&&(t[0].push(o.red),t[1].push(o.green),t[2].push(o.blue),t[3].push(o.alpha))}for(var n=[],i=a.iter(t);!i.done;i.next()){var c,h=i.value;null!=(c=s.MathUtils.getMean(a.clone(h)))&&n.push(c)}if(4!=n.length)return a.opt(l.Host.logging,(function(e){return e.info("ColorRankSuggester.getVarianceOfColors(): Unable to get complete avgRGBA values. # Values = "+a.toString(n.length))})),0;for(var g=new u.SolidColor(n[0],n[1],n[2],n[3]),f=[],p=a.iter(e);!p.done;p.next()){var d;(d=p.value.color)&&f.push(d.perceptualDifference(g))}return this.getVarianceFromDifferences(a.clone(f))},getVarianceFromDifferences:function(e){for(var t=0,r=a.iter(e);!r.done;r.next()){var o=r.value;t+=o*o}return t/a.toDouble(e.length)}}}),n)},ZLO9:function(e,t,r){var o,n=t,i=r("oAGj"),a=r("gXiO");n.RetargetDocumentData=(o=function(e,t,r,o,n,l,s,u,c,h,g,f,p){this.docID=e,this.size=t,this.lockupStrings=i.clone(r),this.focus=o,this.numImages=n,this.edgeMap=i.clone(s),this.layoutID=u,this.numMoveable=l,this.numGridCells=c,this.textRoles=i.clone(h),this.shapeRoles=i.clone(g),this.salientCoverage=f,this.visualGroupInfo=i.clone(p),a.CoreObject.call(this)},i.defineClass({name:"RetargetDocumentData",ctor:o,superName:"CoreObject"}),o)},bSZx:function(e,t,r){var o,n=t,i=r("oAGj"),a=r("P83h"),l=r("9Lk3");n.GridSuggestion=(o=function(e,t,r){void 0===e&&(e=null),this.gridStyle_=t,this.forma_=e,this.score_=r},i.defineClass({name:"GridSuggestion",ctor:o,superName:"CoreObject",props:{gridStyle:{get:function(){return this.gridStyle_}},score:{get:function(){return this.score_.score}},weightedScore:{get:function(){return this.score_}},apply:function(){if(i.info("Grid score:"),i.info(this.score_.asString),null!=this.forma_){var e,t=new a.FormaTransformChangedEvent(this.forma_);this.forma_.beginUpdate(t),(e=i.as(this.forma_.controller,l.GridController))&&(this.gridStyle_.forma=this.forma_,e.applyGridStyleWithMapping(this.gridStyle_,!0)),this.forma_.endUpdate(t)}}}}),o)},eiag:function(e,t,r){var o,n=t,i=r("oAGj"),a=r("gXiO");n.FormaPlacementInput=(o=function(e,t,r,o,n,l,s){this.forma=e,this.otherRects=i.clone(t),this.floatingRects=i.clone(r),this.textRects=i.clone(o),this.imageRects=i.clone(n),this.images=i.clone(l),this.backgroundRegions=i.clone(s),a.CoreObject.call(this)},i.defineClass({name:"FormaPlacementInput",ctor:o,superName:"CoreObject"}),o)},h8Q5:function(e,t,r){var o,n=t,i=r("oAGj"),a=r("hb8m"),l=r("PXFs");n.WheelSuggestionEvaluator=(o=function(e){this.lockupStyleEvaluator=new a.LockupStyleEvaluator(e),this.postTextStylesServiceInterface=new l.PostTextStylesServiceInterface(e,this.lockupStyleEvaluator.getLockupReadabilityEvaluator())},i.defineClass({name:"WheelSuggestionEvaluator",ctor:o,superName:"CoreObject",props:{getTextStyleSuggestion:function(e){return this.postTextStylesServiceInterface.advancedFeatures?this.postTextStylesServiceInterface.getAdvancedTextStyleSuggestion(e):this.postTextStylesServiceInterface.getTextStyleSuggestion(e)}}}),o)},hb8m:function(e,t,r){var o,n=t,i=r("oAGj"),a=r("wc1n"),l=r("xRbc"),s=r("HG3C"),u=r("c+uM"),c=r("35Q0");n.LockupStyleEvaluator=(o=function e(t){this.forma_=t,this.initialStyle_=t.style,this.backgroundVariance=s.LockupReadabilityEvaluator.calculateBackgroundVariance(t),this.lockupVisualWeightEvaluator=new s.LockupReadabilityEvaluator(this.backgroundVariance,t),this.oldReadabilityInformation=i.clone(this.lockupVisualWeightEvaluator.getLockupReadabilityInformation(this.forma_,this.initialStyle_)),this.featuresNeeded=[l.LockupRoleFeatures.SurroundingAlignment];var r=a.FeatureExtractorFactory.getFeatureExtractor(a.FeatureExtractorType.LockupStyle,this.forma_,i.clone(this.featuresNeeded));this.majorityAlignment=e.getSurroundingAlignment(r)},i.defineClass({name:"LockupStyleEvaluator",ctor:o,superName:"CoreObject",statics:{getCollisionPercentage:function(e){var t,r=0;return null!=(t=e.numericFeatureForKey(l.LockupRoleFeatures.CollisionPercentage))&&(r=t),r},getSurroundingAlignment:function(e){var t,r,o=u.LockupAlignment.UNSET;return null!=(t=e.featureForKey(l.LockupRoleFeatures.SurroundingAlignment))&&null!=(r=i.as(t,u.LockupAlignment))&&(o=r),o}},props:{styleEvaluatedWithReadability:function(e){var t=e;return 1==e.wheelUsed||e.description==this.initialStyle_.description?e:(this.newReadabilityInformation=i.clone(this.lockupVisualWeightEvaluator.getLockupReadabilityInformation(this.forma_,e)),e.backing==u.LockupBacking.Knockout&&(t=null),null!=t&&this.replaceBadBackingShapes(t),e.layout!=u.LockupLayout.FitJustified&&this.majorityAlignment!=u.LockupAlignment.UNSET&&e.alignment!=this.majorityAlignment&&(t=null),null!=this.newReadabilityInformation&&null!=this.oldReadabilityInformation&&this.newReadabilityInformation.readabilityScore<=this.oldReadabilityInformation.readabilityScore/2&&(t=null),t)},replaceBadBackingShapes:function(e){if(e.backing==u.LockupBacking.SVGBackground){var t=e.backing,r=e.backingArtworkID;c.ShapeLibrary.isBackingShapeAutoLayoutCompatible(t,r)||(e.backingArtworkID="square_001")}},initializeReadabilityInformation:function(e){this.newReadabilityInformation=i.clone(this.lockupVisualWeightEvaluator.getLockupReadabilityInformation(this.forma_,e))},getOldReadabilityInformation:function(){return this.oldReadabilityInformation},getNewReadabilityInformation:function(){return this.newReadabilityInformation},getLockupReadabilityEvaluator:function(){return this.lockupVisualWeightEvaluator}}}),o)},hywZ:function(e,t,r){var o,n=t,i=r("oAGj"),a=r("UGKO"),l=r("cmoc"),s=r("xe42"),u=r("16hp"),c=r("9Lk3"),h=r("iCxV"),g=r("3DEm"),f=r("uxH+"),p=r("K0Rh"),d=r("sIWg");n.LogoPlacementSuggester=(o=function(e,t){this.CONTRAST_WEIGHT=-10,this.END_BORDER=.98,this.START_BORDER=.02,this.MID_CANONICAL=.5,this.MIN_LIGHTNESS_DIFF=20,this.SYMMETRIC_THRESHOLD=300,u.FormaPlacementSuggester.call(this,e,t)},i.defineClass({name:"LogoPlacementSuggester",ctor:o,superName:"FormaPlacementSuggester",statics:{KIND:{get:function(){return"LogoPlacementSuggester"}}},props:{createPlacementSuggestions:function(e,t){void 0===t&&(t=null);var r=this;if(null==this.group.frame)return[];var o=this.group.frame;if(this.group.kind==p.RootForma.KIND){var n=this.group.page.pageSize;o=d.TheoRect.fromSize(n);var l,h=0,m=this.group.root;if(null!=i.as(m.controller,f.RootController)){var v,y=i.clone(m.filterByControllerKind(c.GridController.KIND));y.length>0&&(v=i.as(y[0].controller,c.GridController))&&(h=v.margin)}(l=this.forma.finalFrame)&&h>0&&(h<l.height||h<l.width)&&(o=d.TheoRect.fromXYWH(h,h,n.width-2*h,n.height-2*h))}for(var S,C=u.FormaPlacementSuggester.createPlacementInputs(this.forma,this.group),F=i.clone(this.getSearchLocations(this.forma,o,C,e,t)),I=-1/0,T=this.initializeLogoPlacementScore(C),_=i.iter(F);!_.done;_.next()){for(var k=_.value,x=u.FormaPlacementSuggester.createPlacementSuggestion(this.forma,k,o,C,T),L=0,D=i.iter(C.backgroundRegions);!D.done;D.next()){var b=D.value;if(null!=k.intersectionWith(b.finalFrame)){var A=i.opt(this.forma.controller,(function(e){return e.getAverageColor(r.forma.finalFrame)})),M=i.opt(b.controller,(function(e){return e.getAverageColor(k)}));if(null!=A&&null!=M&&!i.opt(M,(function(e){return e.contrasts(A)}))){var P=g.MathUtils.absDouble(this.MIN_LIGHTNESS_DIFF-i.opt(M,(function(e){return e.lightnessDifference(A)})));L=g.MathUtils.maxDouble(L,P)}}}i.opt(x.weightedScore,(function(e){return e.setFeature(s.FormaPlacementScore.Features.CONTRAST,i.toDouble(L))})),x.weightedScore.reject()||(T=this.initializeLogoPlacementScore(C)),x.score>I&&(I=x.score,S=x,T=this.initializeLogoPlacementScore(C))}return[i.as(S,a.IDesignSuggestion)]},getSearchLocations:function(e,t,r,o,n){void 0===n&&(n=null),null!=n&&i.opt(h.Host.logging,(function(e){return e.warning("LogoPlacementSuggestor.getSearchLocations ignores requested aspect ratio")}));var a,l=[];if(a=e.finalFrame){var s=a.height,u=a.width,c=t.evalXY(this.END_BORDER,this.END_BORDER),g=new d.TheoRect(c.x-u,c.y-s,c.x,c.y),f=t.evalXY(this.END_BORDER,this.START_BORDER),p=new d.TheoRect(f.x-u,f.y,f.x,f.y+s);l.push(g),l.push(p);for(var m=i.iter(this.getContentAlignedLocations(t));!m.done;m.next()){var v=m.value;t.contains(v)&&l.push(v)}var y=t.evalXY(this.MID_CANONICAL,this.START_BORDER),S=new d.TheoRect(y.x-u/2,y.y,y.x+u/2,y.y+s),C=t.evalXY(this.START_BORDER,this.START_BORDER),F=new d.TheoRect(C.x,C.y,C.x+u,C.y+s),I=t.evalXY(this.START_BORDER,this.END_BORDER),T=new d.TheoRect(I.x,I.y-s,I.x+u,I.y),_=t.evalXY(this.MID_CANONICAL,this.END_BORDER),k=new d.TheoRect(_.x-u/2,_.y-s,_.x+u/2,_.y),x=this.getSymmetricContentLocations();x&&(l.push(k),l.push(T)),l.push(S),l.push(F),x||(l.push(T),l.push(k))}return l},initializeLogoPlacementScore:function(e){var t=new s.FormaPlacementScore(e);return t.setWeight(s.FormaPlacementScore.Features.XSYMM,0),t.setWeight(s.FormaPlacementScore.Features.YSYMM,0),t.setWeight(s.FormaPlacementScore.Features.EDGE,0),t.setWeight(s.FormaPlacementScore.Features.DISTANCE_TO_CENTER,0),t.setWeight(s.FormaPlacementScore.Features.ALIGNMENT,0),t.setWeight(s.FormaPlacementScore.Features.CONTRAST,i.toDouble(this.CONTRAST_WEIGHT)),t.setWeight(s.FormaPlacementScore.Features.TEXT_OVERLAP,-1e4),t.setWeight(s.FormaPlacementScore.Features.FLOATING_ELEMENT_OVERLAP,-5e3),t},getContentAlignedLocations:function(e){var t,r,o,n;if((t=i.as(this.forma,l.FrameForma))&&(r=t.root)&&(o=r.finalFrame)&&(n=this.forma.finalFrame)){var a=n.height,s=n.width,u=i.clone(r.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating})));if(u.length>0){var c=i.sort(u,(function(e,t){return e.finalFrame.maxY-o.minY<t.finalFrame.maxY-o.minY})),h=i.clone(c[c.length-1].finalFrame.points),g=i.clone(c[0].finalFrame.points),f=i.opt(r.finalFrame,(function(e){return e.locate(h[1].x,h[1].y)})),p=e.evalXY(i.opt(f,(function(e){return e.x})),i.opt(f,(function(e){return e.y}))+this.START_BORDER+.03),m=new d.TheoRect(p.x,p.y,p.x+s,p.y+a),v=i.opt(r.finalFrame,(function(e){return e.locate(h[3].x,h[3].y)})),y=e.evalXY(i.opt(v,(function(e){return e.x})),i.opt(v,(function(e){return e.y}))+this.START_BORDER+.03),S=new d.TheoRect(y.x-s,y.y,y.x,y.y+a),C=i.opt(r.finalFrame,(function(e){return e.locate(g[0].x,g[0].y)})),F=e.evalXY(i.opt(C,(function(e){return e.x})),i.opt(C,(function(e){return e.y}))-this.START_BORDER-.03);return[m,S,new d.TheoRect(F.x-s/2,F.y-a,F.x+s/2,F.y)]}}return[]},getSymmetricContentLocations:function(){var e,t,r,o=this;if((e=i.as(this.forma,l.FrameForma))&&(t=e.root)&&(r=t.finalFrame)){var n=i.clone(t.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating})));return!(n.filter((function(e){return g.MathUtils.absDouble(r.center.distanceTo(e.finalFrame.center))<o.SYMMETRIC_THRESHOLD}),this).length<=i.toInt(n.length/2))}return!1}}}),o)},i0RJ:function(e,t,r){r("oAGj")},iSwi:function(e,t,r){var o,n=t,i=r("oAGj"),a=r("cZuM"),l=r("CaSj"),s=r("FNB+"),u=r("cmoc"),c=r("9Lk3"),h=r("ZK0l"),g=r("/afT"),f=r("c+uM"),p=r("uxH+"),d=r("LqGn"),m=r("T6jX"),v=r("8t9B"),y=r("sIWg");n.RetargetSuggester=(o=function e(t,r,o){var n=o.beginTransaction("cleanupRoot");o.controller.setAutomaticLayoutInteractionMode(),o.firstPage.root.isModel=!0,o.firstPage.root.bounds=y.TheoRect.fromSize(o.firstPage.pageSize),this.origModelSize_=o.firstPage.pageSize,this.model_=o.firstPage.root,this.model_.controller.createGridControllerIfNone(),e.cleanupRoot(this.model_),o.firstPage.setPageSize(t.page.pageSize),n.end(),this.modelDoc_=o,this.originalRoot_=r,l.DesignSuggester.call(this,t,t)},i.defineClass({name:"RetargetSuggester",ctor:o,superName:"DesignSuggester",statics:{KIND:{get:function(){return"RetargetSuggester"}},cleanupRoot:function(e){var t;(t=i.opt(i.as(e.controller,p.RootController),(function(e){return e.getGridController()})))&&t.cleanupUnusedBackgroundCellColors();for(var r=i.clone(e.filterWithCallback((function(e){return e.isTypeLockup()}))),n=i.iter(r);!n.done;n.next()){var a,l,u=n.value;if((a=i.as(u.controller,v.TypeLockupController))&&(l=a.lockupStyle)&&(a.updateGroup(),a.snapSizeToBounds(),1==a.numLines()))for(var c=i.iter(r);!c.done;c.next()){var h=c.value;if(!i.eq(s._equality_Forma_Forma,u,h)){var g=i.as(h.controller,v.TypeLockupController);g.updateGroup();var d=g.numLines(),m=i.opt(g.lockupStyle,(function(e){return e.alignment})),y=1==d||d>1&&(m==f.LockupAlignment.Center||m==f.LockupAlignment.UNSET),S=1==d||d>1&&m==f.LockupAlignment.Left,C=1==d||d>1&&m==f.LockupAlignment.Right;a.beginBlockedUpdate(),o.frameAligned(u,h,.5,null)&&y?(l.alignment=f.LockupAlignment.Center,l.layout=f.LockupLayout.Standard):o.frameAligned(u,h,0,null)&&S?(l.alignment=f.LockupAlignment.Left,l.layout=f.LockupLayout.Standard):o.frameAligned(u,h,1,null)&&C?(l.alignment=f.LockupAlignment.Right,l.layout=f.LockupLayout.Standard):(l.alignment=f.LockupAlignment.Center,l.layout=f.LockupLayout.Standard),a.endBlockedUpdate(),a.styleChanged()}}}},frameAligned:function(e,t,r,o){var n=e.frame,l=t.frame;if(null==n||null==l||null==r&&null==o)return!1;var s,u=1;(s=i.opt(e.page.view,(function(e){return e.getViewportTransform()})))&&(u=Math.sqrt(Math.abs(s.determinant)));var c=a.AlignmentDetector.DISTANCE_THRESHOLD/u,h=!0;return null!=r&&(h=h&&Math.abs(n.evalXY(r,.5).x-l.evalXY(r,.5).x)<c),null!=o&&(h=h&&Math.abs(n.evalXY(.5,o).y-l.evalXY(.5,o).y)<c),h}},props:{model:{get:function(){return this.model_}},matchDesignGroupsToModel:function(e,t){var r=[],o=i.clone(e);t.length<o.length&&(o=i.clone(g.GroupDetector.mergeFormaGroups(i.clone(o),t.length)));for(var n=t.length-o.length,a=n>0?n+1:1,l=i.iter(i.range(0,a,!1));!l.done;l.next()){var s=l.value,u=i.clone(t);function c(e){for(var t=0,r=i.iter(e);!r.done;r.next()){var o,n=r.value;(o=i.as(n.controller,v.TypeLockupController))&&(t+=o.text.length)}return t}function h(e,t){var r=m.TheoDocumentUtils.unionFinalFrame(i.clone(e)),o=m.TheoDocumentUtils.unionFinalFrame(i.clone(t)),n=(o.center.y-r.center.y)/e[0].root.frame.height,a=(o.area-r.area)/Math.max(o.area,r.area),l=i.toDouble(c(i.clone(e))),s=i.toDouble(c(i.clone(t)));return a+n+(s-l)/(Math.max(l,s)+.001)<0}u.length>o.length&&(u=u.splice(s,o.length));for(var f=i.sort(o,h),p=[],d=i.sort(u,h).concat(),y=[],S=i.iter(i.range(0,d.length,!1));!S.done;S.next())y.push([]);for(var C=i.iter(i.range(0,f.length,!1));!C.done;C.next()){var F=C.value,I=i.clone(f[F]),T=F%d.length;i.append(y[T],I)}for(var _=i.iter(i.range(0,d.length,!1));!_.done;_.next()){var k=_.value;y[k].length>0&&p.push({a:y[k],b:d[k]})}r.push(i.clone(p))}return r},getMoveable:function(e){var t,r,o;return(!(t=i.opt(e.controller,(function(e){return e.userGroupChild})))&&null==t||!t)&&(!(!(r=i.opt(e.controller,(function(e){return e.userGroup})))&&null==r||!r)||!(!e.isTypeLockup()&&!e.hasIntent(s.Forma.INTENT_ICON))||!!(o=i.as(e,u.FrameForma))&&o.controller.moveable)},createFormaMatches:function(e,t){var r=i.clone(e.filterWithCallback(this.getMoveable)),o=i.clone(t.filterWithCallback(this.getMoveable)),n=i.clone(g.GroupDetector.detectProximityGroups(i.clone(r),null,!1)),a=i.clone(g.GroupDetector.detectProximityGroups(i.clone(o),e.bounds.height/this.origModelSize_.height*200,!1)),l=[],s=i.clone(this.getBasicMatch(e,t));s.push({a:r,b:o}),l.push(i.clone(s));for(var u=i.iter(this.matchDesignGroupsToModel(i.clone(n),i.clone(a)));!u.done;u.next()){var c=u.value,h=i.clone(this.getBasicMatch(e,t));i.append(h,c),l.push(i.clone(h))}return l},getBasicMatch:function(e,t){var r=[];r.push({a:[i.as(e,s.Forma)],b:[i.as(t,s.Forma)]});var o=i.clone(e.filterWithCallback((function(e){return i.opt(e.controller,(function(e){return e.kind==c.GridController.KIND}))}),s.FormaTraversal.JustChildren)),n=i.clone(t.filterWithCallback((function(e){return i.opt(e.controller,(function(e){return e.kind==c.GridController.KIND}))}),s.FormaTraversal.JustChildren));return r.push({a:[o[0]],b:[n[0]]}),r},createSuggestions:function(){for(var e=i.clone(this.createFormaMatches(this.originalRoot_,this.model)),t=this.model.filterWithCallback((function(e){return e.isTypeLockup()})).concat(this.originalRoot_.filterWithCallback((function(e){return e.isTypeLockup()}))),r=i.iter(t);!r.done;r.next()){var o=r.value;i.opt(i.as(o.controller,h.GroupController),(function(e){return e.beginBlockedUpdate()}))}for(var n=[],a=i.iter(i.range(0,e.length,!1));!a.done;a.next()){var l=a.value;n.push(new d.RetargetSuggestion(this.forma,this.originalRoot_,this.model,this.modelDoc_,i.clone(e[l]),l>0))}for(var s=i.iter(t);!s.done;s.next())o=s.value,i.opt(i.as(o.controller,h.GroupController),(function(e){return e.endBlockedUpdate()}));return n}}}),o)},jcfx:function(e,t,r){var o,n,i,a=t,l=r("oAGj"),s=r("C42b"),u=r("HWAX"),c=r("FNB+"),h=r("9Lk3"),g=r("NkBu"),f=r("fNpk"),p=r("c+uM"),d=r("7Ta2"),m=r("JO5d"),v=r("8t9B");a.ProfilingCategories=l.defineEnum("ProfilingCategories",{Title:0,Subtitle:1,Body:2,Action:3,GraphicContent:4,Backing:5,Background:6,Separator:7,Decoration:8,NUM_CATEGORIES:9}),a.ColorProfiles=(o=function(){this.PrimaryProfileMedians={},this.BackgroundProfileMedians={},this.PrimaryProfileMedians[a.ProfilingCategories.Title]=[.12545,.09302,.94901],this.PrimaryProfileMedians[a.ProfilingCategories.Subtitle]=[.077319,.04819,.94901],this.PrimaryProfileMedians[a.ProfilingCategories.Body]=[.044715,.12156,.94901],this.PrimaryProfileMedians[a.ProfilingCategories.Action]=[.06959,.04819,.97647],this.BackgroundProfileMedians[a.ProfilingCategories.Title]=[.12581,.20392,.94901],this.BackgroundProfileMedians[a.ProfilingCategories.Subtitle]=[.079709,.44815,.94313],this.BackgroundProfileMedians[a.ProfilingCategories.Body]=[.07142,.20129,.96274],this.BackgroundProfileMedians[a.ProfilingCategories.Action]=[.5,.46886,.89803],this.PrimaryProfileMedians[a.ProfilingCategories.GraphicContent]=[.5,.6,1],this.PrimaryProfileMedians[a.ProfilingCategories.Backing]=[.5,.3,1],this.PrimaryProfileMedians[a.ProfilingCategories.Background]=[.5,.3,1],this.PrimaryProfileMedians[a.ProfilingCategories.Separator]=[.5,.3,1],this.PrimaryProfileMedians[a.ProfilingCategories.Decoration]=[.5,.6,1]},l.defineClass({name:"ColorProfiles",ctor:o}),o),a.ProfilingColorMap=(n=function e(){this.colorSet=[];for(var t=l.iter(this.profilingCatgoriesCases());!t.done;t.next()){var r=t.value;null==e.currentPrimaryIndices[r]&&(e.currentPrimaryIndices[r]=0),null==e.currentBackgroundIndices[r]&&(e.currentBackgroundIndices[r]=0)}},i={},l.defineClass({name:"ProfilingColorMap",ctor:n,statics:{PrimaryMap:{},BackgroundMap:{},currentPrimaryIndices:{},currentBackgroundIndices:{},paletteMappingDictionary:{},paletteMappingSelection:{},currentDocumentID:"",backingColorKey:"_Backing",lockupMSLPrimaryColorKey:"_MSLPrimary",lockupMSLBackingColorKey:"_MSLBacking",noKeyFound:"noKeyFound",textCategories:{get:function(){return void 0===i.textCategories&&(i.textCategories=[a.ProfilingCategories.Title,a.ProfilingCategories.Subtitle,a.ProfilingCategories.Body,a.ProfilingCategories.Action]),i.textCategories}},shapeCategories:{get:function(){return void 0===i.shapeCategories&&(i.shapeCategories=[a.ProfilingCategories.GraphicContent,a.ProfilingCategories.Backing,a.ProfilingCategories.Background,a.ProfilingCategories.Separator,a.ProfilingCategories.Decoration]),i.shapeCategories}}},props:{reset:function(){n.PrimaryMap={},n.BackgroundMap={},n.currentPrimaryIndices={},n.currentBackgroundIndices={},n.paletteMappingDictionary={},n.paletteMappingSelection={},n.currentDocumentID=""},updateRoleProfilingColorMap:function(e){var t;(t=e.document)&&(n.currentDocumentID=t.uuid),this.colorSet=e.colorLibraryController.getThemeColorKeys().concat(e.colorLibraryController.getProfilingColorKeys()),(new n).eraseCurrentPaletteMappingSelection(),n.PrimaryMap={},n.BackgroundMap={};for(var r=new a.ColorProfiles,o=l.iter(this.profilingCatgoriesCases());!o.done;o.next()){var i=o.value;if(null!=r.PrimaryProfileMedians[i]){var s=this.colorSet.length;n.PrimaryMap[i]=l.clone(this.selectRoleProfilingColors(e,i,!1,!0,s))}}for(var u=l.iter(this.profilingCatgoriesCases());!u.done;u.next())i=u.value,null!=r.BackgroundProfileMedians[i]&&(s=this.colorSet.length,n.BackgroundMap[i]=l.clone(this.selectRoleProfilingColors(e,i,!0,!0,s)))},updateIfCurrentDocumentHasChanged:function(e){var t;(t=e.document)&&n.currentDocumentID!=t.uuid&&this.updateRoleProfilingColorMap(e)},updateCurrentColorIndices:function(){for(var e=l.iter(this.profilingCatgoriesCases());!e.done;e.next()){var t=e.value;if(i=n.PrimaryMap[t]){var r=s.CoreRandom.nextIntUniform(i.length);n.currentPrimaryIndices[t]=r}}for(var o=l.iter(this.profilingCatgoriesCases());!o.done;o.next()){var i;if(t=o.value,(i=n.BackgroundMap[t])&&i.length>0){var a=null==n.currentBackgroundIndices[t]?-1:n.currentBackgroundIndices[t];n.currentBackgroundIndices[t]=(a+1)%i.length}}},checkIfMappingIsEmpty:function(){return null==n.PrimaryMap[a.ProfilingCategories.Title]},checkIfTwoFormaAreInSamePaletteMappingGroup:function(e,t){for(var r=!1,o=l.iter(l.keys(n.paletteMappingDictionary));!o.done;o.next()){var i=o.value;n.paletteMappingDictionary[i].includes(e)&&n.paletteMappingDictionary[i].includes(t)&&(r=!0)}return r},getMappingKeyForFormaID:function(e){for(var t=n.noKeyFound,r=l.iter(l.keys(n.paletteMappingDictionary));!r.done;r.next()){var o=r.value;n.paletteMappingDictionary[o].includes(e)&&(t=o)}return t},overridePaletteMappingDueToContrast:function(e,t){var r,o=this.getMappingKeyForFormaID(t),i=e;return o!=n.noKeyFound&&(null!=(r=n.paletteMappingSelection[o])?i=r:n.paletteMappingSelection[o]=e),i},overridePaletteMappingDueToContrastAndForceDifference:function(e,t,r,o){var i=this.getMappingKeyForFormaID(t),a=e;if(i!=n.noKeyFound)if(null!=(c=n.paletteMappingSelection[i]))a=c;else{if(this.checkIfColorAlreadyAssignedToPaletteMapping(a))for(var s=l.iter(l.range(0,r.length,!1));!s.done;s.next()){var c,h=s.value;if(null!=(c=u.ColorSelectorUtils.getContrastingChoice(!1,[r[h]],[o[h]]))&&!this.checkIfColorAlreadyAssignedToPaletteMapping(c)){a=c;break}}n.paletteMappingSelection[i]=a}return a},checkIfColorAlreadyAssignedToPaletteMapping:function(e){for(var t=!1,r=l.iter(l.keys(n.paletteMappingSelection));!r.done;r.next()){var o=r.value;n.paletteMappingSelection[o]==e&&(t=!0)}return t},eraseCurrentPaletteMappingSelection:function(){n.paletteMappingSelection={}},eraseCurrentPaletteMappingDictionary:function(){n.paletteMappingDictionary={}},setPaletteMappingForFormaWithSameRGBColor:function(e){var t,r=this;if(this.eraseCurrentPaletteMappingDictionary(),t=e.root.controller){var o=l.clone(t.getCurrentColors(e.root.style));o.length>0&&this.updateMappingDictionary(o[0].rgbString,e.root.formaID)}e.root.visitAll(c.FormaTraversal.PreOrder,(function(e){var t,o,i,a,s,u,c=e.formaID;if((a=l.as(e.controller,v.TypeLockupController))&&((s=e.style.colors.fieldPrimary)&&r.updateMappingDictionary(s.rgbString,c),(u=e.style.colors.fieldSecondary)&&null!=(t=l.opt(l.as(e.style,p.LockupStyle),(function(e){return e.backing})))&&t!=p.LockupBacking.None&&r.updateMappingDictionary(u.rgbString,c+n.backingColorKey),(o=a.getCurrentMSLPrimaryColor())&&r.updateMappingDictionary(o.rgbString,c+n.lockupMSLPrimaryColorKey),(i=a.getCurrentMSLBackingColor())&&r.updateMappingDictionary(i.rgbString,c+n.lockupMSLBackingColorKey)),l.as(e.controller,m.ShapeController)&&(s=e.style.colors.fieldPrimary)&&r.updateMappingDictionary(s.rgbString,c),a=l.as(e.controller,h.GridController))for(var f=l.clone(a.getCellIdsGroupedByColor()),d=l.iter(l.keys(f));!d.done;d.next())for(var y=d.value,S=l.iter(f[y]);!S.done;S.next())c=S.value,r.updateMappingDictionary(y,c);l.as(e.controller,g.ImageController)&&null!=e.style.filter&&((s=e.style.colors.fieldPrimary)&&r.updateMappingDictionary(s.rgbString,c),(u=e.style.colors.fieldSecondary)&&r.updateMappingDictionary(u.rgbString,c+n.backingColorKey))}))},getNumPaletteMappingGroups:function(){return l.keys(n.paletteMappingDictionary).length},getCurrentPaletteMapping:function(){return l.clone(n.paletteMappingDictionary)},updateMappingDictionary:function(e,t){for(var r=!1,o=l.iter(l.keys(n.paletteMappingDictionary));!o.done;o.next()){var i=o.value;u.ColorSelectorUtils.compareTwoColorStringsWithMargin(i,e)&&(n.paletteMappingDictionary[i].includes(t)||n.paletteMappingDictionary[i].push(t),r=!0)}r||(n.paletteMappingDictionary[e]=[t])},getPrimaryColorsForRoleGlobal:function(e,t,r){var o,i,a=[];if(this.updateIfCurrentDocumentHasChanged(r),(o=n.PrimaryMap[e])&&null!=(i=n.currentPrimaryIndices[e]))if(i<o.length){for(var s=l.iter(l.range(i,o.length,!1));!s.done;s.next()){var u=s.value;a.push(o[u])}for(var c=l.iter(l.range(0,i,!1));!c.done;c.next())u=c.value,a.push(o[u])}else a=l.clone(o);return a},getBackgroundColorsForRoleGlobal:function(e,t,r){var o,i,a=[];if(this.updateIfCurrentDocumentHasChanged(r),(o=n.BackgroundMap[e])&&null!=(i=n.currentBackgroundIndices[e]))if(i<o.length){for(var s=l.iter(l.range(i,o.length,!1));!s.done;s.next()){var u=s.value;a.push(o[u])}for(var c=l.iter(l.range(0,i,!1));!c.done;c.next())u=c.value,a.push(o[u])}else a=l.clone(o);return a},getPrimaryColorsForRoleIndividual:function(e,t,r){return this.colorSet=e.colorLibraryController.getThemeColorKeys().concat(e.colorLibraryController.getProfilingColorKeys()),this.selectRoleProfilingColors(e,t,!1,!1,r)},getBackgroundColorsForRoleIndividual:function(e,t,r){return this.colorSet=e.colorLibraryController.getThemeColorKeys().concat(e.colorLibraryController.getProfilingColorKeys()),this.selectRoleProfilingColors(e,t,!0,!1,r)},getProfilingCategoryForInferredRole:function(e){var t=a.ProfilingCategories.Body;return e.role==d.InferredRoleType.Title||e.role==d.InferredRoleType.Quote?t=a.ProfilingCategories.Title:e.role==d.InferredRoleType.SubTitle?t=a.ProfilingCategories.Subtitle:e.role==d.InferredRoleType.Social||e.role==d.InferredRoleType.Action?t=a.ProfilingCategories.Action:e.role==d.InferredRoleType.Body||e.role==d.InferredRoleType.Contact?t=a.ProfilingCategories.Body:e.role==d.InferredRoleType.GraphicContent||e.role==d.InferredRoleType.Logo?t=a.ProfilingCategories.GraphicContent:e.role==d.InferredRoleType.Seperator?t=a.ProfilingCategories.Separator:e.role==d.InferredRoleType.Backing?t=a.ProfilingCategories.Backing:e.role==d.InferredRoleType.Background?t=a.ProfilingCategories.Background:e.role==d.InferredRoleType.Decoration?t=a.ProfilingCategories.Decoration:f.LegacyCoreAssert.fail("role not supported",void 0,"ProfilingColorMap.getProfilingCategoryForInferredRole","ProfilingColorMap.swift",471),t},countColorUsage:function(e,t){for(var r=0,o=[n.PrimaryMap,n.BackgroundMap],i=l.clone(this.profilingCatgoriesCases()),a=l.iter(o);!a.done;a.next())for(var s=a.value,u=l.iter(i);!u.done;u.next()){var c,h=u.value;if(this.anyCategoryOverlap(t,h)&&(c=s[h]))for(var g=l.iter(c);!g.done;g.next())g.value==e&&(r+=1)}return r},anyCategoryOverlap:function(e,t){return!(!n.textCategories.includes(e)||!n.textCategories.includes(t))||!(!n.shapeCategories.includes(e)||!n.shapeCategories.includes(t))},selectRoleProfilingColors:function(e,t,r,o,n){void 0===n&&(n=2);var i=[],s=new a.ColorProfiles,u=[];if(r&&null==s.BackgroundProfileMedians[t]||!r&&null==s.PrimaryProfileMedians[t])return f.LegacyCoreAssert.fail("category not supported in selectRoleProfilingColors",void 0,"ProfilingColorMap.selectRoleProfilingColors","ProfilingColorMap.swift",524),[];for(var c=l.iter(this.colorSet);!c.done;c.next()){var h,g=c.value;if(h=e.colorLibraryController.getSolidColorForKey(g)){var p=0,d=0;r?p=this.getColorHSBDistance(h,l.clone(s.BackgroundProfileMedians[t])):(p=this.getColorHSBDistance(h,l.clone(s.PrimaryProfileMedians[t])),d=(o?1e3:0)*l.toDouble(this.countColorUsage(g,t))),i.push(p+d)}}for(var m=l.iter(l.range(0,n,!1));!m.done;m.next()){var v=l.min(i);if(null!=v){var y=l.indexOf(i,v);u.push(this.colorSet[y]),i[y]+=1e3}}return u},profilingCatgoriesCases:function(){for(var e=[],t=a.ProfilingCategories.NUM_CATEGORIES,r=l.iter(l.range(0,t,!1));!r.done;r.next()){var o=r.value;e.push(a.ProfilingCategories.toCaseValue(o))}return e},getColorHSBDistance:function(e,t){var r=[e.asHSB.h,e.asHSB.s,e.asHSB.b],o=Math.min(Math.abs(r[0]-t[0]),360-Math.abs(r[0]-t[0]));o/=180;var n=Math.abs(r[1]-t[1]),i=Math.abs(r[2]-t[2])/255;return Math.sqrt(o*o+n*n+i*i)}}}),n)},lq1z:function(e,t,r){var o,n,i,a,l=t,s=r("oAGj"),u=r("gXiO"),c=r("iCxV"),h=r("3lr5"),g=r("fNpk"),f=r("uj1m"),p=r("txj3"),d=r("K0Rh"),m=r("nrTo"),v=r("djAF"),y=r("ThKb");l.useNNModel=!0,l.linearLearningRate=.5,l.nnLearningRate=.005,s.gvar(l,"sharedSuggester_",(function(){return new l.FontSuggester})),l.concatSecondIntoFirst=function(e,t){for(var r=s.iter(t.descriptors);!r.done;r.next()){var o=r.value;e.append(o)}},l.FontSuggester=(o=function(){u.CoreObject.call(this)},n={},s.defineClass({name:"FontSuggester",ctor:o,superName:"CoreObject",statics:{sharedSuggester:{get:function(){return l.sharedSuggester_}},cache:{get:function(){return void 0===n.cache&&(n.cache=new m.PredictionCacheDouble),n.cache},set:function(e){n.cache=e}}},props:{getFontFeatures:function(e,t){var r,n,i=s.clone(e.selectedLockup.pts),a=i[0].x,u=i[0].y,c=i[3].x,h=i[3].y,g=(a+c)/2,f=(u+h)/2,p=e.width,m=e.height,y=e.selectedLockup.wordCount,S=e.selectedLockup.width,C=e.selectedLockup.height,F=e.numImages,I="root";if(n=s.opt(t.root,(function(e){return e.filterWithCallback((function(e){return null!=e.finalFrame&&null!=e.controller&&!e.controller.moveable&&(e.isBackgroundImage()||e.kind==v.ShapeForma.KIND||e.kind==d.RootForma.KIND)}))})))for(var T=s.iter(n);!T.done;T.next()){var _=T.value;_.isBackgroundImage()&&_.finalFrame.outsetXY(20,20).contains(t.finalFrame)?I="image":_.kind==v.ShapeForma.KIND&&(I="shape")}r=[p,m,p*m,Math.atan2(m,p),s.toDouble(e.lockups.length),s.toDouble(F),a/p,u/m,g/p,f/m,c/p,h/m,s.toDouble(y),S,C,S*C/s.toDouble(y),"root"==I?1:0,"image"==I?1:0,"shape"==I?1:0];var k=e.selectedLockup.styleAttributes.backing,x=e.selectedLockup.styleAttributes.layout;return o.cache.cleanup(t.page.document.uuid),new l.FontFeatures(s.clone(r),k,x)},suggestFonts:function(e,t){if(null!=c.Host.fontProvider){var r=c.Host.fontProvider.getIncludedFonts(h.ANY_DOCUMENT),o=e.currentDocumentFonts.clone();l.concatSecondIntoFirst(o,e.recentlyUsedFonts),l.concatSecondIntoFirst(o,r),t(o)}},onlineLearning:function(e,t){var r,o;if(l.useNNModel){if(r=f.MLPModel.loadNNModel("Font")){var n=t.regularFeatures.concat(),i=s.repeat(0,58),a=s.repeat(0,4);null!=(M=s.indexOf(r.shapes,t.shape))&&(i[M]=1),null!=(P=s.indexOf(r.layouts,t.layout))&&(a[P]=1),n=n.concat(s.clone(i)).concat(s.clone(a)),g.LegacyCoreAssert.isTrue(81==n.length,"unexpected feature vector size",{count:n.length},"FontSuggester.onlineLearning","FontSuggester.swift",115);var u=s.clone(r.fonts),h=r.coefficients.length,d=s.repeat(0,r.coefficients[h-1].rows),m=new y.TheoMatrix([n]).subtract(r.featureScalingMean).divide(r.featureScalingStd);if(null!=(R=s.indexOf(u,e.postScriptName))&&R>=0&&R<d.length){d[R]=1;var v=new y.TheoMatrix([d]),S=new p.NNMLPClassifier(s.clone(r.coefficients),s.clone(r.intercepts)),C=s.clone(S.forwardPropagate(m.transpose())),F=C.AL,I=s.clone(C.caches),T=s.clone(S.backwardPropagate(F,v.transpose(),s.clone(I))),_=s.clone(T.dWs),k=s.clone(T.dbs);s.info("nn cost: "+S.computeCost(F,v.transpose())+")");for(var x=[],L=[],D=s.iter(s.range(0,h,!1));!D.done;D.next()){var b=D.value;x.push(r.coefficients[b].subtract(_[b].multiplyConstant(l.nnLearningRate))),L.push(r.intercepts[b].subtract(k[b].multiplyConstant(l.nnLearningRate)))}g.LegacyCoreAssert.isTrue(x.length==r.coefficients.length,"count mismatch: new weights and model coefficients",void 0,"FontSuggester.onlineLearning","FontSuggester.swift",138),g.LegacyCoreAssert.isTrue(L.length==r.intercepts.length,"count mismatch: new biases and model intercepts",void 0,"FontSuggester.onlineLearning","FontSuggester.swift",139);var A=new f.MLPModel(r.featureScalingMean,r.featureScalingStd,s.clone(x),s.clone(L),s.clone(r.shapes),s.clone(r.fonts),s.clone(r.layouts),s.clone(r.roles));s.opt(c.Host.learning,(function(e){return e.updateFontSuggestionNNModel(A)}))}}}else if(o=s.opt(c.Host.learning,(function(e){return e.loadFontSuggestionLinearModel()}))){var M,P,R;if(n=t.regularFeatures.concat(),i=s.repeat(0,58),a=s.repeat(0,4),null!=(M=s.indexOf(o.shapes,t.shape))&&(i[M]=1),null!=(P=s.indexOf(o.layouts,t.layout))&&(a[P]=1),n=n.concat(s.clone(i)).concat(s.clone(a)),g.LegacyCoreAssert.isTrue(81==n.length,"unexpected feature vector size",{count:n.length},"FontSuggester.onlineLearning","FontSuggester.swift",160),m=new y.TheoMatrix([n]).subtract(o.featureScalingMean).divide(o.featureScalingStd),u=s.clone(o.fonts),d=s.repeat(0,u.length),null!=(R=s.indexOf(u,e.postScriptName))&&R>=0&&R<d.length){d[R]=1,v=new y.TheoMatrix([d]);var E=m.matrixMultiply(o.coefficient.transpose()).add(o.intercept).sigmoid().subtract(v),N=o.coefficient.subtract(E.transpose().matrixMultiply(m).multiplyConstant(l.linearLearningRate)),G=o.intercept.subtract(E.multiplyConstant(l.linearLearningRate));A=new l.FontLinearModel(o.featureScalingMean,o.featureScalingStd,N,G,s.clone(o.shapes),s.clone(o.fonts),s.clone(o.layouts)),s.opt(c.Host.learning,(function(e){return e.updateFontSuggestionLinearModel(A)}))}}},clearCache:function(){o.cache.clearCache()},getScores:function(e,t){var r=t.getUniqueKey();if(null==o.cache.getCacheValue(r)){var n,i,a=[];if(l.useNNModel){if(n=f.MLPModel.loadNNModel("Font")){var u=t.regularFeatures.concat(),h=s.repeat(0,58),d=s.repeat(0,4);null!=(x=s.indexOf(n.shapes,t.shape))&&(h[x]=1),null!=(L=s.indexOf(n.layouts,t.layout))&&(d[L]=1),u=u.concat(s.clone(h)).concat(s.clone(d)),g.LegacyCoreAssert.isTrue(81==u.length,"unexpected feature vector size",{count:u.length},"FontSuggester.getScores","FontSuggester.swift",205);for(var m=new y.TheoMatrix([u]).subtract(n.featureScalingMean).divide(n.featureScalingStd),v=new p.NNMLPClassifier(s.clone(n.coefficients),s.clone(n.intercepts)).predict(m.transpose()),S=s.clone(v.transpose().asArray),C=s.clone(n.fonts),F={},I=s.iter(s.toSequence(S[0]));!I.done;I.next()){var T=I.value,_=T.offset,k=T.element;F[C[_]]=k}e.forEach((function(e){var t;null!=(t=F[e.postScriptName])?a.push(t):a.push(0)}))}}else if(i=s.opt(c.Host.learning,(function(e){return e.loadFontSuggestionLinearModel()}))){var x,L;u=t.regularFeatures.concat(),h=s.repeat(0,58),d=s.repeat(0,4),null!=(x=s.indexOf(i.shapes,t.shape))&&(h[x]=1),null!=(L=s.indexOf(i.layouts,t.layout))&&(d[L]=1),u=u.concat(s.clone(h)).concat(s.clone(d)),g.LegacyCoreAssert.isTrue(81==u.length,"unexpected feature vector size",{count:u.length},"FontSuggester.getScores","FontSuggester.swift",239),v=(m=new y.TheoMatrix([u]).subtract(i.featureScalingMean).divide(i.featureScalingStd)).matrixMultiply(i.coefficient.transpose()).add(i.intercept),S=s.clone(v.sigmoid().asArray),C=s.clone(i.fonts),F={};for(var D=s.iter(s.toSequence(S[0]));!D.done;D.next()){var b=D.value;_=b.offset,k=b.element,F[C[_]]=k}e.forEach((function(e){var t;null!=(t=F[e.postScriptName])?a.push(t):a.push(0)}))}o.cache.setCacheValue(r,s.clone(a))}return o.cache.getCacheValue(r)}}}),o),l.FontFeatures=(i=function(e,t,r){this.regularFeatures=s.clone(e),this.shape=t,this.layout=r},s.defineClass({name:"FontFeatures",ctor:i,props:{getUniqueKey:function(){for(var e="",t=s.iter(this.regularFeatures);!t.done;t.next()){var r=t.value;e=e+s.toString("%.2f",r)+"-"}return e=(e=e+this.shape+"-")+this.layout+"-"}}}),i),l.FontLinearModel=(a=function(e,t,r,o,n,i,a){this.featureScalingMean=e,this.featureScalingStd=t,this.coefficient=r,this.intercept=o,this.shapes=s.clone(n),this.fonts=s.clone(i),this.layouts=s.clone(a),this.fontMap={}},s.defineClass({name:"FontLinearModel",ctor:a,props:{data:function(){return s.clone(s.as({model:{coef:this.coefficient.asArray,intercept:this.intercept.asFlatArray,shapes:this.shapes,fonts:this.fonts,layouts:this.layouts},featureScalingMean:this.featureScalingMean.asFlatArray,featureScalingStd:this.featureScalingStd.asFlatArray},["Dictionary","String","Any"]))}}}),a)},nrTo:function(e,t,r){var o,n,i,a=t,l=r("oAGj"),s=r("iCxV");a.RolePredictionCacheProtocol=l.defineProtocol("RolePredictionCacheProtocol",{getCacheValue:"(String) -> InferredRole",setCacheValue:"(String, InferredRole) -> Void",cleanup:"(String) -> Void"}),a.RolePredictionCache=(o=function(){},l.defineClass({name:"RolePredictionCache",ctor:o,statics:{_implements:function(e){return"RolePredictionCacheProtocol"==e}},props:{getCacheValue:function(e){return l.opt(s.Host.logging,(function(e){return e.error("This method must be overridden")})),null},setCacheValue:function(e,t){l.opt(s.Host.logging,(function(e){return e.error("This method must be overridden")}))},cleanup:function(e){l.opt(s.Host.logging,(function(e){return e.error("This method must be overridden")}))}}}),o),a.PredictionCacheDouble=(n=function(){},l.defineClass({name:"PredictionCacheDouble",ctor:n,statics:{cache:{},currentDocID:""},props:{getCacheValue:function(e){return n.cache[e]},setCacheValue:function(e,t){n.cache[e]=l.clone(t)},cleanup:function(e){e!=n.currentDocID&&(n.currentDocID=e,n.cache={})},clearCache:function(){n.cache={}}}}),n),a.PredictionCacheInferredRole=(i=function(){a.RolePredictionCache.call(this)},l.defineClass({name:"PredictionCacheInferredRole",ctor:i,superName:"RolePredictionCache",statics:{cache:{},currentDocID:"",_implements:function(e){return"RolePredictionCacheProtocol"==e}},props:{getCacheValue:function(e){return i.cache[e]},setCacheValue:function(e,t){i.cache[e]=l.clone(t)},cleanup:function(e){e!=i.currentDocID&&(i.currentDocID=e,i.cache={})}}}),i)},"v/sv":function(e,t,r){var o,n=t,i=r("oAGj"),a=r("CaSj"),l=r("FNB+"),s=r("tQF8"),u=r("/afT"),c=r("pnSN"),h=r("TP4q"),g=r("bSZx"),f=r("Dq5S"),p=r("oKlP");n.GridCellContent=i.defineEnum("GridCellContent",{None:0,Image:1,Text:2,Count:3}),n.GridSuggester=(o=function(e,t,r){this.gridForma_=null,void 0===r&&(r=null),this.gridStyle_=t,this.preserveMapping_=i.clone(r),this.gridForma_=e},i.defineClass({name:"GridSuggester",ctor:o,superName:"CoreObject",statics:{KIND:{get:function(){return"GridSuggester"}},defaultWeights:[-.4869963787443057,.10451788427313968,-10,.3841333333333332,.1438482857676463,.05953378239352733,-.7134725705040772,-.7,.2460712826952826,1.7685714285714302,1.7685714285714302,-1.42857142857143,-1.42857142857143,.2857180890092063,.2915071572811428,-.2857180890092063,-.2915071572811428,-.1822757614386357,-.1502170111498276,-.13002813087151563,-.16114682148449702,.28162418627853086,.2916486562661698,.3658656280531089,.31731319724602053,-.05177320346844536,-.04974606109777501,-.03389292805397268,-.021441808254260175,.14285700582863953,.961358333706472,-2.871390476190484,2.531390476190476,-.4,-.6],styleWeightMatrix:{checkerBoard:[-4,.3,-.6,.4,.3,.2,-.7,-.7,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,0,0,0,0,0,2,-100,100,-.4,-.6],imageOnTop:[0,.3,-.4,.4,.3,.2,-.7,-.7,0,-5,5,5,-5,0,0,0,0,0,-100,0,100,1,-2,1,-2,0,0,0,0,0,.3,0,0,-.4,-.6],imageOnBottom:[0,.3,-.4,.4,.3,.2,-.7,-.7,0,-5,5,5,-5,0,0,0,0,0,100,0,-100,1,-2,1,-2,0,0,0,0,0,.3,0,0,-.4,-.6],imageLeft:[0,.3,-.4,.4,.3,.2,-.7,-.7,0,5,-5,-5,5,0,0,0,0,-100,0,100,0,-2,1,-2,1,0,0,0,0,0,.3,0,0,-.4,-.6],imageRight:[0,.3,-.4,.4,.3,.2,-.7,-.7,0,5,-5,-5,5,0,0,0,0,100,0,-100,0,-2,1,-2,1,0,0,0,0,0,.3,0,0,-.4,-.6],textTowardCenter:[0,.3,-.7,.4,.3,.2,-.7,-.7,0,5,5,-5,-5,1,1,-1,-1,0,0,0,0,5,5,-1,-1,100,100,-100,-100,1,0,0,0,-.4,-.6],imageTowardCenter:[0,.3,-.7,.4,.3,.2,-.7,-.7,0,5,5,-5,-5,1,1,-1,-1,0,0,0,0,-1,-1,5,5,-100,-100,100,100,0,5,0,0,-.4,-.6]}},props:{sortCells:function(e,t){return e.bounds.minY<t.bounds.minY||!(e.bounds.minY>t.bounds.minY)&&e.bounds.minX<t.bounds.minX},createPreservedGroupMatches:function(e,t){var r=e.concat();i.sortInPlace(r,this.sortCells);for(var o=[],n=i.iter(t);!n.done;n.next()){var l=n.value;i.containsEq(o,l,s._equality_GridCell_GridCell)||o.push(l)}i.sortInPlace(o,this.sortCells);for(var u=[],c=i.iter(o);!c.done;c.next())u.push([]);for(var h=i.iter(t);!h.done;h.next()){var g=h.key;l=h.value,u[i.indexOfEq(o,l,s._equality_GridCell_GridCell)].push(g)}for(var f=Math.max(u.length,r.length),p=i.clone(a.DesignSuggester.getPermutations(f)),d=[],m=i.iter(p);!m.done;m.next()){for(var v=m.value,y=!0,S={},C=i.iter(i.range(0,f,!1));!C.done;C.next())for(var F=C.value,I=i.clone(u[F%u.length]),T=i.iter(I);!T.done;T.next()){g=T.value;var _,k=r[v[F]%r.length];if(_=i.opt(this.gridForma_,(function(e){return e.formaByID(g)}))){if(_.isBackgroundImage()&&1!=k.opacity){y=!1;break}S[g]=k}}for(var x=!1,L=i.iter(d);!L.done;L.next()){var D=L.value;this.mappingEqual(i.clone(S),i.clone(D))&&(x=!0)}!x&&y&&d.push(i.clone(S))}return d},createFormaMatches:function(e){if(null!=this.preserveMapping_&&i.count(this.preserveMapping_)>0)return this.createPreservedGroupMatches(i.clone(e),i.clone(this.preserveMapping_));for(var t=this.gridForma_,r=i.clone(t.filterWithCallback((function(e){return e.isBackgroundImage()}))),o=[],n=[],c=i.iter(i.range(0,e.length-1,!0));!c.done;c.next()){for(var h=e[X=c.value],g=!1,f=i.iter(i.range(0,X,!0));!f.done;f.next()){var d=e[f.value];!i.eq(s._equality_GridCell_GridCell,h,d)&&h.bounds.intersects(d.bounds)&&(g=!0,n.push(d))}g||o.push(h)}for(var m=Math.max(r.length,o.length),v=Math.max(250-20*r.length,100),y=i.clone(a.DesignSuggester.getPermutations(m,v)),S=[],C=i.iter(y);!C.done;C.next()){var F=C.value,I={};if(r.length>0)for(var T=i.iter(i.range(0,m,!1));!T.done;T.next())I[r[(X=T.value)%r.length].formaID]=e[F[X]%e.length];for(var _=!1,k=i.iter(S);!k.done;k.next()){var x=k.value;this.mappingEqual(i.clone(I),i.clone(x))&&(_=!0)}_||S.push(i.clone(I))}for(var L=[],D=i.iter(t.visitAsArray(l.FormaTraversal.JustChildren));!D.done;D.next()){var b=D.value;b.controller.floating&&L.push(b)}i.sortInPlace(L,(function(e,t){return e.finalFrame.center.distanceTo(p.TheoPoint.ZERO)<t.finalFrame.center.distanceTo(p.TheoPoint.ZERO)}));var A=e.length-r.length;if(this.gridStyle_.moveableShift&&L.length>0){var M=[];if(L.length<=A)for(var P=i.iter(L);!P.done;P.next()){var R=P.value;M.push([R])}else M=i.clone(u.GroupDetector.detectProximityGroups(i.clone(L)));A>M.length&&(M=i.clone(u.GroupDetector.splitFormaGroups(i.clone(M),A)));for(var E=[],N=i.iter(S);!N.done;N.next()){x=N.value;for(var G=i.clone(n),w=i.iter(x);!w.done;w.next()){var O=w.value;G.push(O)}for(var B=[],W=i.iter(e);!W.done;W.next()){h=W.value;for(var U=!1,V=i.iter(G);!V.done;V.next()){var Y=V.value;i.eq(s._equality_GridCell_GridCell,Y,h)&&(U=!0)}U&&0!=A||B.push(h)}i.shuffleInPlace(B);for(var H=i.iter([!1,!0]);!H.done;H.next()){var j=H.value;if((1==A||1==M.length)&&j)break;for(var K=i.clone(x),z=i.iter(i.range(0,M.length,!1));!z.done;z.next()){var X=z.value,q=i.clone(M[X]);j&&(q=i.clone(M[M.length-X-1]));for(var Z=i.iter(i.range(0,q.length,!1));!Z.done;Z.next())K[q[Z.value].formaID]=B[Math.min(X,B.length-1)]}E.push(i.clone(K))}}S=i.clone(E)}return S},mappingEqual:function(e,t){for(var r=i.iter(e);!r.done;r.next()){var o=r.key,n=r.value;if(!i.eq(s._equality_GridCell_GridCell,t[o],n))return!1}return!0},createSuggestions:function(e){void 0===e&&(e=null);for(var t=[],r=i.iter(this.gridStyle_.gridCells);!r.done;r.next()){var n=r.value;t.push(n.clone())}var a=i.clone(this.createFormaMatches(i.clone(t)));if(0==a.length)return[];var l,s=[];if(l=this.gridForma_.root)for(var u=i.iter(a[0]);!u.done;u.next()){var p,d=u.key;n=u.value,(p=l.formaByID(d))&&(p.controller.floating||p.isBackgroundImage())&&s.push(f.LayoutItem.init_b14a(p))}var m=i.clone(null!=e?e:o.defaultWeights);t.length>5&&(m=i.clone(o.styleWeightMatrix.checkerBoard));for(var v=[],y=i.iter(a);!y.done;y.next()){var S=y.value,C=this.createGridStyle(i.clone(t),i.clone(S)),F=new h.GridScore(C,this.gridForma_.frame,i.clone(s),this.gridForma_,void 0,i.clone(m));v.push(new g.GridSuggestion(i.as(this.gridForma_,c.GroupForma),C,F))}return i.sort(v,(function(e,t){return e.score>t.score}))},createGridStyle:function(e,t){for(var r=this.gridStyle_.clone(),o=[],n=i.iter(e);!n.done;n.next()){var a=n.value;o.push(a.clone())}for(var l={},s=i.iter(t);!s.done;s.next())for(var u=s.key,c=(a=s.value,i.iter(o));!c.done;c.next()){var h=c.value;if(a.bounds==h.bounds){l[u]=h;break}}return r.setGridCells(o.concat()),r.setFormaMapping(i.clone(l)),r.forma=this.gridForma_,r}}}),o)},vYM0:function(e,t,r){var o,n=t,i=r("oAGj"),a=r("yhkb"),l=r("C42b"),s=r("iCxV");n.ColorLibraryMap=(o=function(){},i.defineClass({name:"ColorLibraryMap",ctor:o,statics:{remapColors:function(e,t,r,n){var a=[];e.forEachColor((function(e,l,s){var u;if(u=null==l?s:i.opt(t.color(l),(function(e){return e.rgbColor}))){var c=i.opt(n,(function(e){return e[u.hex]}));null==c&&(c=o.findACloseColor(u,r),null!=n&&(n[u.hex]=c)),a.push({key:e,value:c})}})),e.setColorIDs(i.clone(a))},findACloseColor:function(e,t,r){void 0===r&&(r=20);var o=e.lightness,n=null,u=[];if(t.forEachColor((function(e,t){if(e.startsWith("theme")){var n=Math.abs(t.rgbColor.lightness-o);n<=r&&u.push({id:e,distance:n})}})),0==u.length)i.opt(s.Host.logging,(function(e){return e.info("Unable to find closest color in ColorLibraryMap.findACloseColor")})),n=a.ColorLibraryController.BLACK_KEY;else{var c=i.sort(u,(function(e,t){return e.distance<t.distance}));n=c[l.CoreRandom.nextIntUniform(Math.min(c.length,3))].id}return n}}}),o)},xe42:function(e,t,r){var o,n,i=t,a=r("oAGj"),l=r("9BFu");i.FormaPlacementScore=(o=function e(t){this.rejectThreshold=-100,l.WeightedScore.call(this,e.Features.NUM_FEAT),this.setWeight(e.Features.XSYMM,10),this.setWeight(e.Features.YSYMM,10),this.setWeight(e.Features.CONTRAST,1),0==t.textRects.length?(this.setWeight(e.Features.EDGE,-500),this.setWeight(e.Features.FACE,-1e3)):(this.setWeight(e.Features.EDGE,-50),this.setWeight(e.Features.FACE,0)),this.setWeight(e.Features.SIZE,100),this.setWeight(e.Features.TEXT_OVERLAP,-5e3),this.setWeight(e.Features.FLOATING_ELEMENT_OVERLAP,-1e3),this.setWeight(e.Features.DISTANCE_TO_CENTER,-20),this.setWeight(e.Features.IMAGE_EDGE_OVERLAP,-500),this.setWeight(e.Features.REGION_BOUNDARY_OVERLAP,-40),this.setWeight(e.Features.ALIGNMENT,50),this.setWeight(e.Features.ASPECT_RATIO,t.forma.isImage()?0:20),this.setFeatureName(e.Features.XSYMM,"X- Symmetry"),this.setFeatureName(e.Features.YSYMM,"Y- Symmetry"),this.setFeatureName(e.Features.CONTRAST,"Contrast"),this.setFeatureName(e.Features.EDGE,"Edges"),this.setFeatureName(e.Features.FACE,"Faces"),this.setFeatureName(e.Features.SIZE,"Size"),this.setFeatureName(e.Features.TEXT_OVERLAP,"Text Overlap"),this.setFeatureName(e.Features.FLOATING_ELEMENT_OVERLAP,"Floating Element Overlap"),this.setFeatureName(e.Features.DISTANCE_TO_CENTER,"Distance To Center"),this.setFeatureName(e.Features.IMAGE_EDGE_OVERLAP,"Image Edge Overlap"),this.setFeatureName(e.Features.REGION_BOUNDARY_OVERLAP,"Region Boundary Overlap"),this.setFeatureName(e.Features.ALIGNMENT,"Alignment"),this.setFeatureName(e.Features.ASPECT_RATIO,"Aspect Ratio")},n={},a.defineClass({name:"FormaPlacementScore",ctor:o,superName:"WeightedScore",statics:{Features:{get:function(){return void 0===n.Features&&(n.Features=a.defineEnum("Features",{XSYMM:1,YSYMM:2,CONTRAST:3,EDGE:4,FACE:5,SIZE:6,TEXT_OVERLAP:7,FLOATING_ELEMENT_OVERLAP:8,IMAGE_EDGE_OVERLAP:9,REGION_BOUNDARY_OVERLAP:10,DISTANCE_TO_CENTER:11,ALIGNMENT:12,ASPECT_RATIO:13,NUM_FEAT:14})),n.Features}}},props:{reject:function(){return this.score<this.rejectThreshold}}}),o)}}]);
//# sourceMappingURL=vendors_npm_spark_b84bf841-2dc2452c.js.map