(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[99,78,89],{"/TxD":function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return z}));var i=a("4zaV"),n=a.n(i),o=a("3Jkv"),s=a.n(o),r=a("Uwho"),l=a.n(r),d=a("rjtT"),h=a.n(d),c=a("bBG2"),p=a("2ofD"),u=a.n(p),m=a("Avqh"),g=a.n(m),b=a("KFmL"),v=a.n(b),w=a("+VG/"),f=a.n(w),P=a("pEL3"),T=a.n(P),S=a("d/MO"),k=a.n(S),I=a("dO52"),C=a.n(I),D=a("rzDa"),y=a.n(D),A=a("2Fsf"),M=a.n(A),B=a("CCuV"),x=a("q6ln"),F=a("3xm6"),E=a.n(F),L=a("65r0"),R=a("K7z8"),W=a("MGCh"),O=a.n(W),N=a("HetE");function j(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const U=O.a.channel("TopBarUIModule"),G=Object(L.a)();class z{constructor({editingMode:e,coreWrapper:t,postFeatureController:a,events:i,waitForSaveToFinish:o,waitForQuietSaveToFinish:s,templateNode:r,includesPaidAdobeFonts:l,templatePublisherModalParent:d,getDocumentRendition:h}){if(j(this,"topColorStrip",void 0),j(this,"postTopBarLeft",void 0),j(this,"postTopBarMid",void 0),j(this,"postTopBarRight",void 0),j(this,"saveTemplateButton",void 0),j(this,"cancelTemplateButton",void 0),j(this,"hamburgerMenu",void 0),j(this,"homeButton",void 0),j(this,"postLogo",void 0),j(this,"navCrumbs",void 0),j(this,"backToProjects",void 0),j(this,"carrotOne",void 0),j(this,"docNameInput",void 0),j(this,"editNameButton",void 0),j(this,"savingIndicator",void 0),j(this,"undo",void 0),j(this,"redo",void 0),j(this,"debugMenu",void 0),j(this,"collabStatusButton",void 0),j(this,"downloadButton",void 0),j(this,"sharePostButton",void 0),j(this,"lmsCoachmark",void 0),j(this,"googleClassroomCoachmark",void 0),j(this,"googleDriveCoachmark",void 0),j(this,"templatePublisherModal",void 0),j(this,"sharePostButtonConfig",void 0),j(this,"editingMode",void 0),j(this,"waitForSaveToFinish",void 0),j(this,"waitForQuietSaveToFinish",void 0),j(this,"exportController",void 0),j(this,"coreWrapper",void 0),j(this,"postFeatureController",void 0),j(this,"events",void 0),j(this,"includesPaidAdobeFonts",void 0),j(this,"templatePublisherModalParent",void 0),j(this,"getDocumentRendition",void 0),this.updateCollabStatusButton=this.updateCollabStatusButton.bind(this),this.handleNameDocument=this.handleNameDocument.bind(this),this.handleDownloadImgButtonPress=this.handleDownloadImgButtonPress.bind(this),this.handleDownloadImgV2ButtonPress=this.handleDownloadImgV2ButtonPress.bind(this),this.handleDownloadMP4720pButtonPress=this.handleDownloadMP4720pButtonPress.bind(this),this.handleDownloadPDFButtonPress=this.handleDownloadPDFButtonPress.bind(this),this.handleShareMenuClick=this.handleShareMenuClick.bind(this),this.handlePublish=this.handlePublish.bind(this),this.handleInvite=this.handleInvite.bind(this),this.showTemplatePublisher=this.showTemplatePublisher.bind(this),this.resetTemplatePublisherForm=this.resetTemplatePublisherForm.bind(this),this.handleTemplatePublisherSaveButtonClicked=this.handleTemplatePublisherSaveButtonClicked.bind(this),this.handlePublishTemplate=this.handlePublishTemplate.bind(this),this.editingMode=e,this.EditingModes=N.EditingModes,this.coreWrapper=t,this.postFeatureController=a,this.events=i,this.waitForSaveToFinish=o,this.waitForQuietSaveToFinish=s,this.includesPaidAdobeFonts=l,this.getDocumentRendition=h,this.templateNode=r,this.topColorStrip=new g.a({parent:"PostTopBar",id:"colorStrip",tag:"DIV"}),this.postTopBarLeft=new M.a({parent:"PostTopBar",id:"PostTopBarLeft",class:"application-options",height:"auto",width:e===this.EditingModes.TEMPLATE?"auto":495}),this.postTopBarMid=new M.a({parent:"PostTopBar",id:"PostTopBarMid",class:"document-options",template:"",height:"auto",width:"auto"}),this.postTopBarRight=new M.a({parent:"PostTopBar",id:"PostTopBarRight",class:"editor-options",height:"auto",left:"auto",width:360}),e===this.EditingModes.TEMPLATE?(this.saveTemplateButton=new v.a({parent:"PostTopBarLeft",class:"pill pill-primary-on-light",hidden:!1,label:"i18n.common.kSave",onClick:()=>{this.events.publish("ui:saveTemplateChanges")}}),this.cancelTemplateButton=new v.a({parent:"PostTopBarLeft",class:"pill pill-secondary-on-light",hidden:!1,label:"i18n.common.kCancel",onClick:()=>{this.events.publish("ui:cancelTemplateChanges")}})):(this.hamburgerMenu=new v.a({parent:"PostTopBarLeft",class:"hamburgerButton mrvl-hamburger-menu",attributes:{"data-auto":"mrvl-hamburger-menu"},label:" ",tag:"div",onClick:()=>{window.marvel&&window.marvel.events.trigger("mrvl-show-global-nav")}}),this.homeButton=new v.a({parent:"PostTopBarLeft",class:"homeButton",id:"PostHomeButton",label:" ",tag:"div",onClick:e=>{this.events.publish("ui:returnToSpark",{skipSave:e,pathType:"home"})}}),this.postLogo=new M.a({parent:"PostTopBarLeft",id:"PostLogo",template:"i18n.app.kPost",class:"name"}),this.navCrumbs=new M.a({parent:"PostTopBarLeft",id:"PostTopBarNavCrumbs"}),this.backToProjects=new v.a({class:"post-top-bar-crumb",parent:this.navCrumbs,label:"i18n.app.kProjects",onClick:e=>{this.events.publish("ui:returnToSpark",{skipSave:e,pathType:"organizer"})}}),this.carrotOne=new g.a({class:"post-top-bar-carrot",parent:this.navCrumbs})),this.docNameInput=new y.a({parent:e===this.EditingModes.TEMPLATE?"PostTopBarLeft":this.navCrumbs,onFocusOut:()=>{let t=this.docNameInput.getText();if(t.trim().length<1){t="";const a=e===this.EditingModes.TEMPLATE?"app.kDefaultTemplateName":"app.kDefaultDocName",i=E.a.translate(a);this.docNameInput.setText(i),this.docNameInput.$el.addClass("placeholder"),this.docNameInput.$el.removeClass("named")}else{(e===this.EditingModes.TEMPLATE?R.default.getTemplateName(r):u.a.currentDoc.getProjectName())!==t?c.default.publish("renameDocument",{}):c.default.publish("renameDocumentCancelled",{}),this.docNameInput.$el.removeClass("placeholder"),this.docNameInput.$el.addClass("named")}this.handleNameDocument(t),this.editNameButton.$el.css("visibility","visible")},onFocus:()=>{c.default.publish("renameDocumentClicked",{}),this.coreWrapper.deselect(),this.editNameButton.$el.css("visibility","hidden"),this.docNameInput.$el.hasClass("placeholder")&&(this.docNameInput.setText(""),this.docNameInput.$el.removeClass("placeholder"),this.docNameInput.$el.addClass("named"))},attributes:{"data-i18n":"[aria-label]app.kPostNameInputLabel"}}),this.editNameButton=new f.a({parent:e===this.EditingModes.TEMPLATE?"PostTopBarLeft":this.navCrumbs,class:"edit-name-button",width:16,height:16,onClick:()=>{this.docNameInput.focus(),this.editNameButton.$el.css("visibility","hidden")}}),this.savingIndicator=new g.a({id:"PostSavingIndicator",parent:"PostTopBarLeft",template:"i18n.app.kSaving",hidden:!0}),this.undo=new v.a({parent:"PostTopBarMid",id:"PostUndoButton",tag:"div",hoverLabel:"i18n.app.kUndo",hoverLabelPosition:"below",label:"i18n.app.kUndo",onClick:()=>{this.events.publish("ui:handleUndo")}}),this.redo=new v.a({parent:"PostTopBarMid",id:"PostRedoButton",tag:"div",hoverLabel:"i18n.app.kRedo",hoverLabelPosition:"below",label:"i18n.app.kRedo",onClick:()=>{this.events.publish("ui:handleRedo")}}),a.featureEnabled("post-enable-debug-menu")&&(this.debugMenu=new v.a({parent:"PostTopBarMid",id:"PostDebugMenuButton",tag:"div",label:"Debug",onClick:()=>{this.events.publish("ui:handleDebugMenuButtonPress")}})),e!==this.EditingModes.TEMPLATE){this.collabStatusButton=new f.a({parent:"PostTopBarRight",class:"collabStatusButton",width:50,height:63,onClick:()=>{this.handleInvite("projectHeader")}});const e=u.a.currentDoc.attributes.collaboration&&"NONE"!==u.a.currentDoc.attributes.collaboration;this.updateCollabStatusButton(e);const{downloadOptionsList:t,selectedOption:i,isImageV2Enabled:o}=this.getDownloadOptions(),s={selectedOption:i,parent:"PostTopBarRight",id:"downloadButton",name:"filetype",label:E.a.translate("app.kDownload"),submitButtonLabel:E.a.translate("app.kStartDownload"),optionsList:t,onIMGDownload:this.handleDownloadImgButtonPress,onIMGDownloadV2:o?this.handleDownloadImgV2ButtonPress:void 0,onMP4Download720p:N.WebAnimationEnabled?this.handleDownloadMP4720pButtonPress:void 0,onPDFDownload:this.handleDownloadPDFButtonPress,onOptionsShown:()=>{this.sharePostButton.el.hideMenuDropdown()}};this.downloadButton=new k.a(s);const r=[{icon:"/marvel-core/images/share/sp-editor-publish.svg",menuItemText:E.a.translate("app.shareMenuItems.publish.kMenuItemText"),tooltipMessage:E.a.translate("app.shareMenuItems.publish.kTooltip"),id:"sharemenu-publish"},{icon:"/marvel-core/images/share/sp-editor-invite.svg",menuItemText:E.a.translate("app.shareMenuItems.invite.kMenuItemText"),tooltipMessage:E.a.translate("app.shareMenuItems.invite.kTooltip"),id:"sharemenu-invite"}];a.featureEnabled("post-create-template-contentteam")&&r.push({icon:"/marvel-core/images/share/sp-editor-publish-template.svg",menuItemText:E.a.translate("app.shareMenuItems.publishTemplate.kMenuItemText"),tooltipMessage:E.a.translate("app.shareMenuItems.publishTemplate.kTooltip"),id:"sharemenu-publish-template"}),this.sharePostButtonConfig={parent:"PostTopBarRight",id:"postShareMenu",menutitle:E.a.translate("app.kShare"),onClick:this.handleShareMenuClick,icon:"/images/sp-editor-share.svg",menuitems:r},this.sharePostButton=new C.a(this.sharePostButtonConfig),this.enableLMS(),a.featureEnabled("google-drive-ui")&&(this.sharePostButtonConfig.menuitems.push({icon:"/marvel-core/images/share/sp-editor-google-drive.svg",menuItemText:E.a.translate("app.shareMenuItems.googleDrive.kMenuItemText"),id:"sharemenu-googleDrive",menuItemTag:E.a.translate("app.shareMenuItems.lms.kMenuItemTag")}),this.sharePostButton.update({menuitems:this.sharePostButtonConfig.menuitems,menutitle:this.sharePostButtonConfig.menutitle,icon:this.sharePostButtonConfig.icon}),n.a.showSaveCTA()&&!this.googleDriveCoachmark&&(this.googleDriveCoachmark=this.createCoachmark("googleDriveCoachmark","i18n.components.coachmarks.googleDrive.kMessage",100)),setTimeout(()=>{this.googleDriveCoachmark&&this.googleDriveCoachmark.show()},0))}const p={formTitle:E.a.translate("app.templatePublisher.formModal.kFormTitle"),templateNameFieldLabel:E.a.translate("app.templatePublisher.formModal.kTemplateNameFieldLabel"),associatedCategoriesSectionLabel:E.a.translate("app.templatePublisher.formModal.kAssociatedCategoriesSectionLabel"),selectedCategoriesSectionLabel:E.a.translate("app.templatePublisher.formModal.kSelectedCategoriesSectionLabel"),useCasesSectionLabel:E.a.translate("app.templatePublisher.formModal.kUseCasesSectionLabel"),keyTermsFieldLabel:E.a.translate("app.templatePublisher.formModal.kKeyTermsFieldLabel"),languageSectionLabel:E.a.translate("app.templatePublisher.formModal.kLanguageSectionLabel"),cancelButtonTitle:E.a.translate("app.templatePublisher.formModal.kCancelButtonTitle"),resetButtonTitle:E.a.translate("app.templatePublisher.formModal.kResetButtonTitle"),saveTemplateButtonTitle:E.a.translate("app.templatePublisher.formModal.kSaveTemplateButtonTitle"),loadingViewPrimaryText:E.a.translate("app.templatePublisher.formModal.kLoadingViewPrimaryText"),loadingViewSecondaryText:E.a.translate("app.templatePublisher.formModal.kLoadingViewSecondaryText"),templatePreviewAltText:E.a.translate("app.templatePublisher.formModal.kTemplatePreviewAltText"),xButtonAltText:E.a.translate("app.templatePublisher.formModal.kXButtonAltText")};this.templatePublisherModal=new B.a({id:"TemplatePublisher",parent:d,hidden:!0,onResetButtonClicked:this.resetTemplatePublisherForm,onSaveButtonClicked:this.handleTemplatePublisherSaveButtonClicked,localizedStrings:p})}async enableLMS(){let e="account type";try{const t=await s.a.getAccountType();e="visit counts for New badge";const a=await s.a.shouldShowNewBadge();e="permission for Google Classroom CTA";const i=await s.a.isEDUAccountWithoutPublish(u.a.currentDoc.getMyApp());let n=a?E.a.translate("app.shareMenuItems.lms.kMenuItemTag"):"";"teacher"===t&&this.sharePostButtonConfig.menuitems.push({icon:"/marvel-core/images/share/sp-editor-canvas-lms.svg",menuItemText:E.a.translate("app.shareMenuItems.lms.kAttachText"),id:"sharemenu-lms-attach",menuItemTag:n}),"student"===t&&this.sharePostButtonConfig.menuitems.push({icon:"/marvel-core/images/share/sp-editor-canvas-lms.svg",menuItemText:E.a.translate("app.shareMenuItems.lms.kTurninText"),id:"sharemenu-lms-attach",menuItemTag:n}),this.sharePostButton.update({menuitems:this.sharePostButtonConfig.menuitems,menutitle:this.sharePostButtonConfig.menutitle,icon:this.sharePostButtonConfig.icon}),a&&(this.lmsCoachmark||(this.lmsCoachmark=this.createCoachmark("lmsCoachmark","i18n.components.coachmarks.lms.kMessage",10)),setTimeout(()=>{this.lmsCoachmark.show()},0)),i&&(n=a?E.a.translate("app.shareMenuItems.googleClassroom.kMenuItemTag"):"",this.sharePostButtonConfig.menuitems.push({icon:"/marvel-core/images/share/sp-editor-google-classroom.svg",menuItemText:E.a.translate("app.shareMenuItems.googleClassroom.kMenuItemText"),tooltipMessage:E.a.translate("app.shareMenuItems.googleClassroom.kTooltip"),id:"sharemenu-googleClassroom",menuItemTag:n}),this.sharePostButton.update({menuitems:this.sharePostButtonConfig.menuitems,menutitle:this.sharePostButtonConfig.menutitle,icon:this.sharePostButtonConfig.icon}),a&&(this.googleClassroomCoachmark||(this.googleClassroomCoachmark=this.createCoachmark("googleClassroomCoachmark","i18n.components.coachmarks.googleClassroom.kMessage",11)),setTimeout(()=>{this.googleClassroomCoachmark.show()},0)),this.postFeatureController.featureEnabled("share-microsoft-teams-edu-workflow")&&this.sharePostButtonConfig.menuitems.push({icon:"/marvel-core/images/share/sp-editor-ms-teams.svg",menuItemText:E.a.translate("app.shareMenuItems.msteams.kPublish"),tooltipMessage:E.a.translate("app.shareMenuItems.msteams.kTooltip"),id:"sharemenu-lms-msteams-publish",menuItemTag:n}))}catch(t){U.error("Error getting "+e,t)}}createCoachmark(e,t,a){return new T.a({id:e,message:t,priority:a,parent:"PostTopBarRight",arrowDirection:"top-right",closeButtonType:"icon",height:52,width:330,top:66,hidden:!0,left:"calc(100% - 330px)",anchorElement:this.sharePostButton})}getDownloadOptions(){const e=this.coreWrapper.hasAnimationStyle(),t=this.postFeatureController.featureEnabled("post-enable-server-rendering")&&G,a={label:E.a.translate("app.downloadOptions.mp4Video720p.kButtonLabel"),filetype:"mp4_SEVEN_TWENTY_P",betaflag:!0,tooltipMessage:E.a.translate("app.downloadOptions.mp4Video.kTooltip")},i={label:E.a.translate("app.downloadOptions.pngImgV2.kButtonLabel"),filetype:"img_png_v2",betaflag:!0,tooltipMessage:E.a.translate("app.downloadOptions.pngImgV2.kTooltip")},n={label:E.a.translate("app.downloadOptions.jpgImgV2.kButtonLabel"),filetype:"img_jpeg_v2",betaflag:!0,tooltipMessage:E.a.translate("app.downloadOptions.jpgImgV2.kTooltip")};return{downloadOptionsList:[...N.WebAnimationEnabled&&e?[a]:[],{label:E.a.translate("app.downloadOptions.pngImg.kButtonLabel"),filetype:"img_png",tooltipMessage:E.a.translate("app.downloadOptions.pngImg.kTooltip")},{label:E.a.translate("app.downloadOptions.jpgImg.kButtonLabel"),filetype:"img_jpg",tooltipMessage:E.a.translate("app.downloadOptions.jpgImg.kTooltip")},...t?[i]:[],...t?[n]:[],{label:E.a.translate("app.downloadOptions.printPdf.kButtonLabel"),filetype:"pdf",betaflag:!0,tooltipMessage:E.a.translate("app.downloadOptions.printPdf.kTooltip")}],selectedOption:N.WebAnimationEnabled&&e?"mp4_SEVEN_TWENTY_P":"img_png",isImageV2Enabled:t}}updateCollabStatusButton(e){this.collabStatusButton.$el.toggleClass("shared-document",!!e)}setExportController(e){this.exportController=e}handleNameDocument(e){this.storeDocumentName(e),this.coreWrapper.requestSave()}handleDownloadImgButtonPress(e){const{coreWrapper:t,isWatermarkEnabled:a}=this,i=e.originalEvent.detail.mediaType.split("_")[1];c.default.publish("downloadButtonPressed"),"string"==typeof i&&c.default.publish("downloadImgButtonPressed: "+i),this.exportController.downloadImg({coreWrapper:t,mediaType:i,isWatermarkEnabled:a,MarvelSettings:l(),docName:this.docNameInput.getText(),requestSaveMethod:this.coreWrapper.requestSave})}handleDownloadImgV2ButtonPress(e){const t=e.originalEvent.detail.mediaType.split("_")[1];this.waitForSaveToFinish().then(()=>{this.exportController.downloadImgV2(u.a,l.a,t).done()})}handleDownloadMP4720pButtonPress(){this.waitForSaveToFinish().then(()=>{c.default.publish("downloadMP4_720pButtonPressed"),this.exportController.downloadMP4(u.a,l.a,this.coreWrapper,1280,this.coreWrapper.requestSave)})}handleDownloadPDFButtonPress(){this.waitForSaveToFinish().then(()=>{c.default.publish("downloadPDFButtonPressed"),this.exportController.downloadPDF(u.a,l.a,this.coreWrapper.requestSave)})}handleShareMenuClick(e){this.lmsCoachmark&&!this.lmsCoachmark.isHidden()&&this.lmsCoachmark.hide(),this.googleClassroomCoachmark&&!this.googleClassroomCoachmark.isHidden()&&this.googleClassroomCoachmark.hide(),this.googleDriveCoachmark&&!this.googleDriveCoachmark.isHidden()&&this.googleDriveCoachmark.hide(),this.waitForSaveToFinish().then(()=>{if("sharemenu-publish"===e)return this.handlePublish();if("sharemenu-invite"===e)return this.handleInvite("project");if("sharemenu-publish-template"===e){const e=u.a.currentDoc.isPublished();if(c.default.publish("project:spTemplatePressed",{contextualData1:"isRepublishing:"+e}),e)return U.warn("Failed to publish template: Republishing templates is currently not supported in Adobe Spark Post Web."),h.a.showAlert(E.a.translate("app.templatePublisher.templateRepublishFailure.kHeaderText"),E.a.translate("app.templatePublisher.templateRepublishFailure.kContentText")),null;if(this.coreWrapper.containsBrandedContent())return U.warn("Cannot publish template for a branded document."),h.a.showAlert(E.a.translate("app.templatePublisher.brandedDocumentFailure.kHeaderText"),E.a.translate("app.templatePublisher.brandedDocumentFailure.kContentText")),null;const{stockImages:t}=this.coreWrapper.getConstrainedImages();return t&&(t.extended.length>0||t.standard.length>0)?(U.warn("Cannot publish template with licensed Stock images."),h.a.showAlert(E.a.translate("app.templatePublisher.licensedImagesFailure.kHeaderText"),E.a.translate("app.templatePublisher.licensedImagesFailure.kContentText")),null):(this.showTemplatePublisher(),null)}return"sharemenu-googleDrive"===e&&x.default.sendToGoogleDrive(u.a.currentDoc),"sharemenu-lms-msteams-publish"===e?(s.a.showModal({type:"adobe-theo",id:u.a.currentDoc.id,target:"ms-teams"}),null):"sharemenu-lms-turnin"===e||"sharemenu-lms-attach"===e?(s.a.showModal({type:"adobe-theo",id:u.a.currentDoc.id,target:"canvas"},{syncInProgress:!1}),null):"sharemenu-googleClassroom"===e?(s.a.showWindow({type:"adobe-theo",id:u.a.currentDoc.id,target:"google-classroom"}),null):""===e?(this.downloadButton.el.hideDownloadList(),null):(console.warn("handleShareMenuClick called with unrecognized menuItemId",e),null)})}handlePublish(){c.default.publish("shareButtonPressed"),this.exportController.publish(l.a,this.coreWrapper.requestSave)}handleInvite(e){x.default.invite(u.a.currentDoc,e,"post:editor")}showTemplatePublisher(){const e=this.templatePublisherModal;e.el.templateName=u.a.currentDoc.getProjectName(),e.el.isAnimatedTemplate=this.coreWrapper.hasAnimationStyle(),e.el.isPremiumTemplate=this.includesPaidAdobeFonts(),e.el.isPublishing=!1,this.coreWrapper.deselectAll(),e.show(),this.getDocumentRendition({width:300,asDataURL:!0}).then(t=>{e.el.templatePreviewImageURL=t})}resetTemplatePublisherForm(){const e=this.templatePublisherModal;e.el.resetForm(),e.el.templateName=u.a.currentDoc.getProjectName(),e.el.isPremiumTemplate=this.includesPaidAdobeFonts()}handleTemplatePublisherSaveButtonClicked({detail:e}){const t=e.keyTerms.split(",").filter(e=>e.length>0);t.length>0&&c.default.publish("project:contentTermsAdded",{contextualData1:"addedTerms:"+t.join(",")});const a={associatedCategories:[...e.associatedCategories],categories:[...e.selectedCategories],keyTerms:[...t],language:e.languageIdentifier,title:e.templateName,useCases:e.useCases};this.handleNameDocument(e.templateName),this.docNameInput.setText(e.templateName),this.templatePublisherModal.el.isPublishing=!0,this.handlePublishTemplate(a)}handlePublishTemplate(e){x.default.publishTemplate(e,this.coreWrapper,this.waitForQuietSaveToFinish,this.getDocumentRendition).then(e=>{c.default.publish("project:spTemplateExported",{contextualData1:"result:success"}),this.templatePublisherModal.hide();const{remixURL:t}=e;h.a.showConfirm(E.a.translate("app.templatePublisher.templatePublishSuccess.kHeaderText"),E.a.translate("app.templatePublisher.templatePublishSuccess.kContentText"),{cancelText:E.a.translate("app.templatePublisher.templatePublishSuccess.kCancelButtonLabel"),okText:E.a.translate("app.templatePublisher.templatePublishSuccess.kRemixButtonLabel")}).then(e=>{if(e)return window.navigator.clipboard.writeText(t)}).done()}).catch(e=>{const{errorMessage:t}=e;c.default.publish("project:spTemplateExported",{contextualData1:"result:failed",contextualData2:"errorMessage:"+t}),this.templatePublisherModal.hide(),t?h.a.showAlert(E.a.translate("app.templatePublisher.templatePublishFailure.kHeaderText"),t):h.a.showAlert(E.a.translate("app.templatePublisher.templatePublishFailure.kHeaderText"),E.a.translate("app.templatePublisher.templatePublishFailure.contentText.kDefaultFailure"))})}updateCoreWrapper(e){this.coreWrapper=e}storeDocumentName(e){this.editingMode===this.EditingModes.TEMPLATE?R.default.setTemplateName(this.templateNode,e):u.a.currentDoc.setProjectName(e)}}},"3cgi":function(e,t,a){"use strict";a.r(t),a.d(t,"addLogoFromBrandkit",(function(){return d}));var i=a("bBG2"),n=a("J9tZ"),o=a("MGCh"),s=a.n(o),r=a("luSs");const l=s.a.channel("add-logo-from-brandkit");async function d({component:e,logoData:t,coreWrapper:a}){i.default.publish("brandKitLogoApplied"),Object(r.a)(e,"image-loading-begin");const[o]=await Object(n.a)(a.addLogo(t));o&&l.error("Failed to add logo from brandkit.",o),i.default.publish("editor:logoAdded"),Object(r.a)(e,"image-loading-end")}t.default=d},"4AtL":function(e,t,a){"use strict";a.r(t),a.d(t,"addNewLogo",(function(){return b}));var i=a("I/Z9"),n=a("Pv/z"),o=a("qcxC"),s=a("luSs"),r=a("lulf"),l=a("MGCh"),d=a.n(l),h=a("tpS0"),c=a.n(h);function p({deferredObj:e,components:t}){const a=new c.a({headerText:"i18n.panels.addNewLogo.kSizeWarningHeader",contentText:"i18n.panels.addNewLogo.kSizeWarningContent",dismissable:!1,buttons:[{class:"pill pill-primary-on-light",label:"i18n.components.buttons.kContinue",onClick(){a.hide(),e.resolve(!0)}},{class:"pill pill-secondary-on-light",label:"i18n.common.kCancel",onClick(){Object(s.a)(t,"image-loading-end"),a.hide(),e.reject(!0)}}]});return a}var u=a("J9tZ"),m=a("rJP3");const g=d.a.channel("add-new-logo");async function b({component:e,coreWrapper:t,uiStateController:a,data:l,docSavedDfd:d,replacingForma:h,refreshCurrentBrandElements:c}){window.performance.mark("spP:add-new-logo-start"),Object(s.a)(e,"image-loading-begin");const b=l.files[0],v=new r.default,w=Object(o.b)(),f=await Object(i.renderBlobToCanvas)(b),{width:P,height:T}=f;if(f&&(P<180||T<180)){p({deferredObj:w,components:e});const[t]=await Object(u.a)(w.promise);if(t)return d.resolve()}const S=f.getContext("2d"),k=Object(i.checkCanvasForAlpha)(S,P,T);let I=b;if(f&&k&&(Object(i.trimTransparentEdges)(f),I=await Object(i.canvasToBlob)(f)),v.featureEnabled("entitle-brand-kit")||"brandkit"!==l.source){const[e,t]=await Object(u.a)(async function({imageData:e,refreshCurrentBrandElements:t}){const a=m.default&&m.default.getCurrentBrandElements(),i=!a||!a.logos||a.logos.length<1,n=await m.default.addLogoToCurrentBrand(e,i);if(!n)return;return t(!0),{sparkElementId:n.getValue("id"),sparkRoles:n.getValue("ac#roles")}}({refreshCurrentBrandElements:c,imageData:I}));e&&g.error("Failed to add logo to current brand.",e),l.sparkElementId=null==t?void 0:t.sparkElementId,l.sparkRoles=null==t?void 0:t.sparkRoles}l.processedImgData=I,l.isLogo=!0,l.hasAlpha=k,await Object(n.addNewImage)({coreWrapper:t,uiStateController:a,data:l,replacingForma:h,docSavedDfd:d,component:e}),window.performance.measure("spP:add-new-logo-complete","spP:add-new-logo-start")}t.default=b},"4hMT":function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return u}));var i=a("UzQk"),n=a("UFvF"),o=a.n(n),s=a("bBG2"),r=a("QX4k"),l=a("MGCh"),d=a.n(l),h=a("UNP3");function c(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const p=d.a.channel("export-analytics-manager");class u{constructor(){c(this,"document",void 0),c(this,"remixParentMetadataPromise",void 0),c(this,"remixParentAnalyticsMetadata",{})}static getCpAssetMetadata(e,t){if(!e||!t)return o()(null);const a=new r.default({cpServiceDomain:t});return o()(a.getAssetMetadataWithRetry(e))}static getRemixParentMetadataForAnalytics(e,t,a){return a?o()({tags:null,templateType:"brand",id:e}):e?u.getCpAssetMetadata(e,t):o()({})}static extractTemplateAnalyticsFromCpAssetMetadata(e){const t=e||{};let a;return a=t.tags?t.tags.includes("remixpaid")?"paid":"free":t.templateType||"none",{templateType:a,tagNames:t.tags?`[${t.tags.join(", ")}]`:"[]",templateId:t.id?t.id:"none",alias:t.alias}}static getDesignMetadataForExport(e){if(!e)return{originalSize:"unknown",exportSize:"unknown",hasResized:"unknown",designIngredientId:"unknown",color:"unknown",layout:"unknown",includesPaidAdobeFonts:"unknown",contentCountsString:"unknown",extendedContentCountsString:"unknown",designFilter:"unknown",hasVariationTemplate:"unknown",hasAnimation:"unknown",animationStyle:"unknown",fontSizeString:"unknown",textLayoutsString:"unknown"};const t=e.firstPage.originalSizeID.toLowerCase(),a=e.firstPage.sizeID.toLowerCase(),n=t===i.FormaPage.DEFAULT_ORIGINAL_SIZE_ID.toLowerCase()?"unknown":t!==a,o=i.TheoDocumentUtils.getAllDesignIngredientIDsAndTypes(e),s=o.length?o[0].id:void 0,r=e.firstPage.colorLibrary.paletteID||void 0,l=i.TheoDocumentUtils.getAppliedLayoutId(e)||void 0,d=i.TheoDocumentUtils.getFontSourceUsage(e).indexOf(Object(i.describeFontSource)(i.FontSource.TYPEKIT_PREMIUM))>-1,h=i.TheoDocumentUtils.getContentCountsString(e),c=i.TheoDocumentUtils.getExtendedContentCountsString(e),p=i.TheoDocumentUtils.getAppliedVariationTemplateId(e),m=i.TheoDocumentUtils.getTextLayoutsString(e),g=i.MotionUtils.getCurrentAnimationStyle(e);let b="false",v="unknown";g&&!g.isNoStyle()&&(v=i.AnimationLibrary.determineAnalyticName(g),b="true");return{originalSize:t,exportSize:a,hasResized:n,designIngredientId:s,color:r,layout:l,includesPaidAdobeFonts:d,contentCountsString:h,extendedContentCountsString:c,fontSizeString:u.getFontSizeString(e),hasAnimation:b,animationStyle:v,textLayoutsString:m,designFilter:p||void 0,hasVariationTemplate:!!p}}static getFontSizeString(e){const t=i.TypeLockupUtils.sizesInDocument(e,void 0,!0).map(t=>i.TextFacade.toUserFontSize(t,e.firstPage));let a;if(t&&t.length){a=`fontSizeMin:${Math.min(...t).toFixed(1)};fontSizeMax:${Math.max(...t).toFixed(1)}`}return a}static sendExportAnalyticsAndMetadata(e,t,a){const n=i.TheoDocumentUtils.getFontSourceUsage(e);s.default.publish("exportFontUsage",{contextualData1:`fontSource:[${n.join(", ")}]`}),Object(h.reportNounProjectIds)(e,t,a);const o=i.TheoDocumentUtils.getMetadataEvents(e,!1);for(let e=0;e<o.length;e++){const t=o[e];s.default.publish("shareMetadata",{"document:metadata":t[0],"document:metadata2":t[1],"document:metadata3":t[2],"document:metadata4":t[3]})}}static finalizeAnalyticsForExportCompleted(e,t){const a=u.getDesignMetadataForExport(t);return Object.assign({},e,a)}setDocument(e){this.document=e}getRemixParentCPMetadata(e,t,a){return this.remixParentMetadataPromise?this.remixParentMetadataPromise:this.remixParentMetadataPromise=u.getRemixParentMetadataForAnalytics(e,t,a).then(e=>{const t=u.extractTemplateAnalyticsFromCpAssetMetadata(e);return this.remixParentAnalyticsMetadata=t,t}).catch(e=>(p.warn("Failed to get parent CP metadata",e),this.remixParentAnalyticsMetadata=u.extractTemplateAnalyticsFromCpAssetMetadata(null),o.a.reject(e)))}getMetadataForExportAnalytics(e,t){return this.getRemixParentCPMetadata(e,"cc-api-cp.adobe.io",t).then(e=>{const t=u.extractTemplateAnalyticsFromCpAssetMetadata(e);return u.finalizeAnalyticsForExportCompleted(t,this.document)}).catch(e=>(p.error("getMetadataForExportAnalytics: error while fetching metadata from CP",e),o()(!1)))}sendExportMetadataForDownload(e,t,a){u.sendExportAnalyticsAndMetadata(e,t,a);const i=u.finalizeAnalyticsForExportCompleted(this.remixParentAnalyticsMetadata,e);window.marvel.events.trigger("send-theo-editor-download-button-export-analytics",i)}}},BQ0V:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return T}));var i=a("UzQk"),n=a("OI2j"),o=a.n(n),s=a("FpXA"),r=a.n(s),l=a("ynbG"),d=a("+VG/"),h=a.n(d),c=a("C8IR"),p=a.n(c),u=a("0VUy"),m=a.n(u),g=a("tQ0N"),b=a.n(g),v=a("L4yB"),w=a("65r0");function f(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function P(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class T{constructor(e,t,a,n,s){this.coreWrapper=e,this.isWatermarkEnabled=t,this.isWebAnimationEnabled=a,this.postFeatureController=n,this.dismissedWatermarkCoachmark=s,P(this,"poster",void 0),P(this,"canvasInteractionLayer",void 0),P(this,"imageWrapper",void 0),P(this,"posterAdornments",void 0),P(this,"watermarkUI",void 0),P(this,"isAdobeInternalUser",void 0),P(this,"requestSaveMethod",void 0),P(this,"animationPlayButton",void 0),P(this,"feedbackButton",void 0),this.handleAnimationStart=this.handleAnimationStart.bind(this),this.handleAnimationPause=this.handleAnimationPause.bind(this),this.handleAnimationLoadingBegin=this.handleAnimationLoadingBegin.bind(this),this.handleAnimationLoadingEnd=this.handleAnimationLoadingEnd.bind(this),this.handleRightSidebarOpen=this.handleRightSidebarOpen.bind(this),this.handleRightSidebarClose=this.handleRightSidebarClose.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.handleZendeskWidgetClick=this.handleZendeskWidgetClick.bind(this),this.isAdobeInternalUser=Object(w.a)(),this.requestSaveMethod=this.coreWrapper.requestSave,this.canvasInteractionLayer=new m.a({id:"canvasInteractionLayer",parent:"PostCanvasSection",onPointerDown:this.onPointerDown,onPointerUp:this.onPointerUp,onPointerMove:this.onPointerMove}),this.imageWrapper=new p.a({id:"PosterImageWrapper",parent:this.canvasInteractionLayer}),this.poster=new o.a({parent:this.imageWrapper,watermarkEnabled:this.isWatermarkEnabled}),i.Host.setPosterView(this.poster),this.posterAdornments=new r.a({poster:this.poster,designSurface:this}),this.postFeatureController.featureEnabled("post-enable-zendesk-widget")&&(v.default.loadZendeskWidget(),this.feedbackButton=new h.a({parent:this.canvasInteractionLayer,class:"feedback-button",width:40,height:40,onClick:this.handleZendeskWidgetClick})),this.isWebAnimationEnabled&&(this.animationPlayButton=new b.a({id:"PostPlaybackButton",parent:this.imageWrapper,class:"animation-playback-button",hidden:!this.coreWrapper.hasAnimationStyle(),poster:this.poster,playAnimation:this.handleAnimationStart,pauseAnimation:this.handleAnimationPause})),this.watermarkUI=new l.a(this.isWatermarkEnabled,this.dismissedWatermarkCoachmark,this.imageWrapper,this.poster,this.coreWrapper,this.requestSaveMethod)}initializeComponents(e,t){e&&(this.coreWrapper=e),this.poster.update({core:this.coreWrapper}),this.imageWrapper.update({core:this.coreWrapper}),this.requestSaveMethod=this.coreWrapper.requestSave,this.watermarkUI.requestSaveMethod=this.requestSaveMethod,"boolean"==typeof t&&(this.isWatermarkEnabled=t,this.watermarkUI.updateWatermarkStatus(this.isWatermarkEnabled)),this.posterAdornments.setCoreWrapper(this.coreWrapper),this.posterAdornments.enable(),this.watermarkUI.coreWrapper=this.coreWrapper}enable(){this.poster.enable()}disable(){this.poster.disable(),this.posterAdornments.hideSelectionBox()}beginImageLoading(){this.poster.events.publish("image-loading-begin")}endImageLoading(){this.poster.events.publish("image-loading-end")}beginBadgeLoading(){this.poster.events.publish("badge-loading-begin")}endBadgeLoading(){this.poster.events.publish("badge-loading-end")}handleZendeskWidgetClick(){window.zE&&window.zE.activate({hideOnClose:!0})}updatePlaybackButton(e){if(!this.animationPlayButton)return;const t=e.atShowEditor,a=e.changeType,i=this.coreWrapper.hasAnimationStyle();if(this.animationPlayButton.update({hidden:!i}),i)if(t)this.animationPlayButton.reset(),this.posterAdornments.events.subscribe("first-full-render",this.handleAnimationStart);else{const e=this.coreWrapper.getCurrentTimelineState();!e||e.action&&"k_apply_animation_style"===e.action.description?"state-changed"===a&&this.handleAnimationStart():this.handleAnimationPause()}else this.handleAnimationPause()}handleAnimationLoadingBegin(){this.posterAdornments.showLoadingSkrim()}handleAnimationLoadingEnd(){this.posterAdornments.hideLoadingSkrim()}handleRightSidebarOpen(){this.animationPlayButton&&(this.animationPlayButton.el.style.right="300px")}handleRightSidebarClose(){this.animationPlayButton&&(this.animationPlayButton.el.style.right="20px")}onPointerDown(e){this.onPointerChanged("pointerDown",e)}onPointerUp(e){this.onPointerChanged("pointerUp",e)}onPointerMove(e){this.onPointerChanged("pointerMove",e)}onPointerChanged(e,t){const a=this.getDocumentRelativePoint(t.x,t.y);t.x=a.x,t.y=a.y,this.coreWrapper.handlePointerChanged(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?f(Object(a),!0).forEach((function(t){P(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({updateType:e},t))}handleAnimationStart(e=!0){this.stopAnimation(e),this.startAnimation(e)}handleAnimationPause(e=!0){this.stopAnimation(e)}startAnimation(e=!0){this.coreWrapper.hasAnimationStyle()&&"function"==typeof this.poster.playAnimation&&(this.coreWrapper.generateKeyFrames(),e&&this.animationPlayButton&&this.animationPlayButton.startProgress(),this.poster.playAnimation())}stopAnimation(e=!0){"function"==typeof this.poster.stopAnimation&&this.poster.stopAnimation(),e&&this.animationPlayButton&&this.animationPlayButton.reset()}getDocumentRelativePoint(e,t){const a=this.poster.$el.offset(),i={x:e-a.left,y:t-a.top};return this.coreWrapper.getViewToDocMatrix().transformPoint(i)}}},CSmQ:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return c}));var i=a("bBG2"),n=a("tpS0"),o=a.n(n),s=a("3xm6"),r=a.n(s),l=a("rJP3"),d=a("9KYx");async function h(e,t,a){const{fontMissingNoticeModal:n}=e.errorDialogs;n&&n.hide();const[s]=await Promise.all([a,t]),l=s.missingFontListInDoc();return!(l.length>0)||function(e,t){return new Promise(a=>{const n=t.join(", "),s=`${r.a.translate("dialogs.fontMissingNotice.kNoticeText")}<br><br>${r.a.translate("dialogs.fontMissingNotice.kActionText",{missingFontNames:n})}`,l=new o.a({contentText:s,headerText:"i18n.dialogs.fontMissingNotice.kHeaderText",buttons:[{class:"pill pill-primary-on-light ",label:"i18n.dialogs.fontMissingNotice.kCancelButtonLabel",onClick(){l.hide(),i.default.publish("missingFontsWhenOpenCancelButtonPressed"),a(!1)}},{class:"pill pill-secondary-on-light",label:"i18n.dialogs.fontMissingNotice.kEditButtonLabel",onClick(){l.hide(),i.default.publish("missingFontsWhenOpenReplaceButtonPressed"),a(!0)}}]});l.show(),e.errorDialogs.fontMissingNoticeModal=l})}(e,l)}function c(e,t){const a=async function(){d.default.resetLoadingTimes(),await d.default.load({loadForEditor:!0,authoringContext:l.default.currentBrandKit()}),d.default.logLoadingTimes()}();return[a,h(e,a,t)]}},CXs4:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return N}));var i=a("2ofD"),n=a.n(i),o=a("z4rR"),s=a.n(o),r=a("bBG2"),l=(a("jo99"),a("efk3")),d=a.n(l),h=a("FIWz"),c=a.n(h),p=a("HPKp"),u=a.n(p),m=a("7VrH"),g=a.n(m),b=a("mYMA"),v=a.n(b),w=a("GN+k"),f=a.n(w),P=a("W3p6"),T=a.n(P),S=a("mTyn"),k=a.n(S),I=a("wRAw"),C=a.n(I),D=a("vdJz"),y=a.n(D),A=a("UXma"),M=a.n(A),B=a("e8qH"),x=a.n(B),F=a("W1Jy"),E=a.n(F),L=a("NgGw"),R=a.n(L),W=a("HetE");function O(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class N{constructor({editingMode:e,previousSelectedFormaId:t,events:a,postFeatureController:i,coreWrapper:o,waitForSaveToFinish:r,waitForQuietSaveToFinish:l,colorPicker:h,designSurface:p}){O(this,"postControlStrip",void 0),O(this,"brandIndicator",void 0),O(this,"sidebarGlobal",void 0),O(this,"sidebarTheme",void 0),O(this,"sidebarPalette",void 0),O(this,"sidebarResize",void 0),O(this,"sidebarAnimation",void 0),O(this,"sidebarLayout",void 0),O(this,"sidebarText",void 0),O(this,"sidebarBackground",void 0),O(this,"sidebarLogo",void 0),O(this,"sidebarIcon",void 0),O(this,"sidebarMultiselect",void 0),O(this,"sidebarGroup",void 0),O(this,"addTextSidebar",void 0),O(this,"sidebarCrop",void 0),O(this,"changeImageModalPanel",void 0),O(this,"changeIconModalPanel",void 0),O(this,"changeImageModalPanelInserted",!1),O(this,"changeIconModalPanelInserted",!1),O(this,"selectedTabComponent",null),O(this,"selectedComponentName",""),O(this,"events",void 0),O(this,"coreWrapper",void 0),O(this,"waitForQuietSaveToFinish",void 0),O(this,"previousSelectedFormaId",void 0),O(this,"designSurface",void 0),this.events=a,this.previousSelectedFormaId=t,this.coreWrapper=o,this.waitForQuietSaveToFinish=l,this.designSurface=p,this.deletingCurrentDoc=this.deletingCurrentDoc.bind(this),this.getFormaSizeData=this.getFormaSizeData.bind(this),this.handleNavTabSelected=this.handleNavTabSelected.bind(this),this.handleImageModalInsert=this.handleImageModalInsert.bind(this),this.handleImageModalRemove=this.handleImageModalRemove.bind(this),this.handleSelectForma=this.handleSelectForma.bind(this),this.handleIconModalInsert=this.handleIconModalInsert.bind(this),this.handleIconModalRemove=this.handleIconModalRemove.bind(this),this.handleSelectThemeTab=this.handleSelectThemeTab.bind(this),this.handleSelectPaletteTab=this.handleSelectPaletteTab.bind(this),this.handleSelectLayoutTab=this.handleSelectLayoutTab.bind(this),this.handleSelectResizeTab=this.handleSelectResizeTab.bind(this),this.handleSelectAnimationTab=this.handleSelectAnimationTab.bind(this),this.handleSelectTextTab=this.handleSelectTextTab.bind(this),this.handleSelectBackgroundTab=this.handleSelectBackgroundTab.bind(this),this.handleSelectLogoTab=this.handleSelectLogoTab.bind(this),this.handleSelectIconTab=this.handleSelectIconTab.bind(this),this.handleSelectMultiselectTab=this.handleSelectMultiselectTab.bind(this),this.handleSelectGroupTab=this.handleSelectGroupTab.bind(this),this.updateCurrentPalette=this.updateCurrentPalette.bind(this),this.updateListOfDesigns=this.updateListOfDesigns.bind(this),this.updateSidebarAnimation=this.updateSidebarAnimation.bind(this),this.events.subscribe("ui:handleSelectThemeTab",this.handleSelectThemeTab),this.events.subscribe("ui:handleSelectPaletteTab",this.handleSelectPaletteTab),this.events.subscribe("ui:handleSelectLayoutTab",this.handleSelectLayoutTab),this.events.subscribe("ui:handleSelectResizeTab",this.handleSelectResizeTab),this.events.subscribe("ui:handleSelectAnimationTab",this.handleSelectAnimationTab),this.events.subscribe("ui:handleSelectTextTab",this.handleSelectTextTab),this.events.subscribe("ui:handleSelectBackgroundTab",this.handleSelectBackgroundTab),this.events.subscribe("ui:handleSelectIconTab",this.handleSelectIconTab),this.events.subscribe("ui:handleSelectMultiselectTab",this.handleSelectMultiselectTab),this.events.subscribe("ui:handleSelectGroupTab",this.handleSelectGroupTab),this.events.subscribe("ui:handleNavTabSelected",this.handleNavTabSelected),this.events.subscribe("ui:updateCurrentPalette",this.updateCurrentPalette),this.events.subscribe("ui:updateListOfDesigns",this.updateListOfDesigns),this.events.subscribe("ui:updateSidebarAnimation",this.updateSidebarAnimation),this.events.subscribe("ui:previousSelectedFormaId",e=>{this.previousSelectedFormaId=e}),this.events.subscribe("ui:showHideComponent",({componentName:e,display:t})=>{this[e]&&(t?this[e].show():this[e].hide())}),e!==W.EditingModes.TEMPLATE?(this.postControlStrip=new E.a({layout:"rows",panels:[{id:"PostBrandIndicatorContainer",size:"54px"},{id:"PostSidebar",size:"auto"}],parent:"PostLegacySidebarContents"}),this.brandIndicator=new s.a({collaborationStatus:n.a.currentDoc.getCollaboration(),height:54,id:"PostBrandIndicator",isEntitled:i.featureEnabled("entitle-brand-kit"),parent:"PostBrandIndicatorContainer",navigateToCreateBrandMethod:e=>{this.events.publish("ui:returnToSpark",{skipSave:e,pathType:"create_brand"})},width:280})):this.postControlStrip=new E.a({layout:"rows",panels:[{id:"PostBrandIndicatorContainer",size:"0px"},{id:"PostSidebar",size:"auto"}],parent:"PostLegacySidebarContents"}),this.sidebarGlobal=new R.a({parent:"PostSidebar",hidden:!1}),this.sidebarTheme=new x.a({parent:this.sidebarGlobal,hidden:!1,visibilityGroup:"main-sidebar",showMerchPopup:!i.featureEnabled("entitle-brand-kit")}),this.sidebarPalette=new C.a({parent:this.sidebarGlobal,hidden:!0,visibilityGroup:"main-sidebar",colorPicker:h}),this.sidebarResize=new y.a({parent:this.sidebarGlobal,hidden:!0,visibilityGroup:"main-sidebar"}),W.WebAnimationEnabled&&(this.sidebarAnimation=new d.a({parent:this.sidebarGlobal,hidden:!0,visibilityGroup:"main-sidebar",class:"post-panel-scrollable"})),this.sidebarLayout=new v.a({parent:this.sidebarGlobal,hidden:!0,visibilityGroup:"main-sidebar"}),this.sidebarGlobal.registerSidebarTabWithId(this.sidebarTheme,"theme"),this.sidebarGlobal.registerSidebarTabWithId(this.sidebarPalette,"palette"),this.sidebarGlobal.registerSidebarTabWithId(this.sidebarLayout,"layout"),this.sidebarGlobal.registerSidebarTabWithId(this.sidebarResize,"resize"),this.sidebarAnimation&&this.sidebarGlobal.registerSidebarTabWithId(this.sidebarAnimation,"animation"),this.sidebarText=new M.a({parent:"PostSidebar",hidden:!0,entitleBrandKit:i.featureEnabled("entitle-brand-kit"),advancedTextLayoutEnabled:i.featureEnabled("post-enable-advanced-text-layout"),advancedTextLayoutWebEnabled:i.featureEnabled("post-enable-advanced-text-layout-web"),colorPicker:h}),this.sidebarBackground=new c.a({parent:"PostSidebar",hidden:!0,enablePixiRenderer:i.featureEnabled("post-pgm-poster"),colorPicker:h,disableImageFrames:!i.featureEnabled("post-pgm-poster"),cutoutEnabled:i.featureEnabled("post-enable-remove-background")}),this.sidebarLogo=new f.a({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar"}),this.sidebarIcon=new T.a({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar",colorPicker:h}),this.sidebarMultiselect=new k.a({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar",alignmentTypes:this.coreWrapper.getAlignmentTypes(),distributeTypes:this.coreWrapper.getDistributeTypes()}),this.sidebarGroup=new g.a({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar"}),this.sidebarCrop=new u.a({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar"}),this.changeImageModalPanel=new E.a({layout:"rows",parent:"PostSidebar",hidden:!0,panels:[{id:"PostImagePicker",size:"auto"}]}),this.changeImageModalPanel.remove=this.handleImageModalRemove,this.changeImageModalPanel.insert=this.handleImageModalInsert,this.changeIconModalPanel=new E.a({layout:"rows",parent:"PostSidebar",hidden:!0,panels:[{id:"PostIconPicker",size:"auto"}]}),this.changeIconModalPanel.remove=this.handleIconModalRemove,this.changeIconModalPanel.insert=this.handleIconModalInsert,this.libImageModalPanel=new E.a({id:"ChangeImageModalPanel",layout:"rows",parent:"PostSidebar",hidden:!0,panels:[{id:"PostLibImagePicker",size:"auto"}]}),this.libImageModalPanel.remove=()=>{this.libImageModalPanel.$el.hide()},this.libImageModalPanel.insert=()=>{this.libImageModalPanelInserted?this.libImageModalPanel.$el.show():(this.libImageModalPanel.parent.$el.append(this.libImageModalPanel.$el),this.libImageModalPanelInserted=!0)}}deletingCurrentDoc(){return this.coreWrapper&&(this.coreWrapper.cancelPendingSaves(),this.coreWrapper.requestSave(!0)),this.events.publish("ui:closeIsFromReturnToSpark",!0),this.waitForQuietSaveToFinish()}getFormaSizeData(){const e=this.coreWrapper.getRootForma().page;return{sizeID:e.sizeID,pageSize:e.pageSize,exportData:e.exportData}}handleSelectForma(){!this.coreWrapper.getSelectedForma()&&this.previousSelectedFormaId.length?(this.coreWrapper.selectFormaById({formaId:this.previousSelectedFormaId}),this.events.publish("ui:previousSelectedFormaId","")):(this.coreWrapper.deselect(),this.events.publish("ui:returnToGlobalSidebarState"))}handleIconModalInsert(){this.changeIconModalPanelInserted?this.changeIconModalPanel.$el.show():(this.changeIconModalPanel.parent.$el.append(this.changeIconModalPanel.$el),this.changeIconModalPanelInserted=!0)}handleIconModalRemove(){this.changeIconModalPanel.$el.hide()}handleImageModalInsert(){this.changeImageModalPanelInserted?this.changeImageModalPanel.$el.show():(this.changeImageModalPanel.parent.$el.append(this.changeImageModalPanel.$el),this.changeImageModalPanelInserted=!0)}handleImageModalRemove(){this.changeImageModalPanel.$el.hide()}handleNavTabSelected(e){"tabButtonLibraries"===this.selectedComponentName&&this.libImageModalPanel.hide(),this.sidebarLayout.isHidden()&&this.coreWrapper.disableAutomaticLayoutMode(),e&&(this.selectedComponentName=e,this.selectedTabComponent=this[e],this.brandIndicator&&(this.brandIndicator.show(),this.postControlStrip.update({panels:[{id:"PostBrandIndicatorContainer",size:"54px"},{id:"PostSidebar",size:"auto"}]})))}handleSelectThemeTab(){this.events.publish("ui:handleNavTabSelected","sidebarTheme"),"theme"!==this.sidebarGlobal.activeSidebarId()&&(this.sidebarGlobal.showSidebarWithId("theme"),this.sidebarTheme.setDefaultSelection(),this.updateListOfDesigns(),r.default.publish("editor:designFilterPressed"))}handleSelectPaletteTab(){this.events.publish("ui:handleNavTabSelected","sidebarPalette"),"palette"!==this.sidebarGlobal.activeSidebarId()&&(this.sidebarGlobal.showSidebarWithId("palette"),this.updateCurrentPalette({updateSelection:!0}),r.default.publish("editor:colorPressed"),this.coreWrapper.triggerEnteredPalette())}handleSelectLayoutTab(){this.events.publish("ui:handleNavTabSelected","sidebarLayout"),"layout"!==this.sidebarGlobal.activeSidebarId()&&(this.sidebarGlobal.showSidebarWithId("layout"),r.default.publish("editor:layoutPressed"))}handleSelectResizeTab(){this.events.publish("ui:handleNavTabSelected","sidebarResize"),"resize"!==this.sidebarGlobal.activeSidebarId()&&(this.sidebarGlobal.showSidebarWithId("resize"),r.default.publish("editor:resizePressed"))}handleSelectAnimationTab(){this.sidebarAnimation&&(this.events.publish("ui:handleNavTabSelected","sidebarAnimation"),"animation"!==this.sidebarGlobal.activeSidebarId()&&(this.updateSidebarAnimation(),this.sidebarGlobal.showSidebarWithId("animation"),r.default.publish("editor:animationPressed")))}handleSelectTextTab(e){const t=(e=e||{}).tabId||"type";this.sidebarText.showSidebarWithId(t),this.events.publish("ui:handleNavTabSelected","sidebarText"),this.designSurface.posterAdornments.handleTextTabSelected()}handleSelectBackgroundTab(e){e=e||{},this.sidebarBackground.isHiding()&&null==e.reselectWhenHiding?_.delay(()=>{e.reselectWhenHiding=!0,this.handleSelectBackgroundTab(e)},200):this.events.publish("ui:handleNavTabSelected","sidebarBackground")}handleSelectLogoTab(){r.default.publish("editor:logoSelected"),this.sidebarLogo.show()}handleSelectIconTab(e){e=e||{},r.default.publish("editor:iconSelected")}handleSelectMultiselectTab(e){const t=(e=e||{}).tabId||"multiple";this.sidebarMultiselect.showSidebarWithId(e.tabId),this.events.publish("ui:handleNavTabSelected","sidebarMultiselect"),"multiple"===t&&r.default.publish("editor:multiselectSelected")}handleSelectGroupTab(e){const t=(e=e||{}).tabId||"group";this.sidebarGroup.showSidebarWithId(e.tabId),this.events.publish("ui:handleNavTabSelected","sidebarGroup"),"group"===t&&r.default.publish("editor:groupSelected")}updateCurrentPalette(e){const t=this.coreWrapper.getColorPalette();this.sidebarPalette.setCurrentPalette(t,e)}updateListOfDesigns(e){this.sidebarTheme.setDesigns({aspectRatio:this.coreWrapper.getPageAspectRatio(),wordCount:this.coreWrapper.getLockupWordCount(),iconCount:this.coreWrapper.getIconCount(),imageCount:this.coreWrapper.getBackgroundImageCount(),isInitialLoad:e||!1,metadata:this.coreWrapper.getDesignVariationsMetadata(),docId:this.coreWrapper.getDocumentCCID()})}updateSidebarAnimation(){this.sidebarAnimation&&this.sidebarAnimation.update()}updateCoreWrapper(e){this.coreWrapper=e}}},GKed:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return x}));var i=a("Uwho"),n=a.n(i),o=a("7N+y"),s=a.n(o),r=a("EiZY"),l=a.n(r),d=a("nhA5"),h=a.n(d),c=a("mpVL"),p=a("2ofD"),u=a.n(p),m=a("bBG2"),g=a("ZXGz"),b=a.n(g),v=a("jo99"),w=a.n(v),f=a("uZvm"),P=a.n(f),T=a("rJP3"),S=a("MGCh"),k=a.n(S),I=a("HetE"),C=a("tpS0"),D=a.n(C),y=a("3xm6"),A=a.n(y);function M(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const B=k.a.channel("AssetRailUIModule");class x{constructor({events:e,coreWrapper:t,controller:a,postFeatureController:i,entitlementController:o,ExperimentEngine:r,editingMode:d,postEditorView:p,waitForSaveToFinish:u,waitForQuietSaveToFinish:m,previousSelectedFormaId:g,designSurface:v,premiumBadgeVariant:f,userIsPremium:T,dragAndDropEnabled:S}){M(this,"assetRailNav",void 0),M(this,"sidebarTemplates",void 0),M(this,"imagePicker",void 0),M(this,"iconPicker",void 0),M(this,"libImagePicker",void 0),M(this,"addTextSidebar",void 0),M(this,"logoPicker",void 0),M(this,"designAssetsControllers",void 0),M(this,"designAssetsPicker",void 0),M(this,"backgroundsPicker",void 0),M(this,"previousSelectedFormaId",void 0),M(this,"controller",void 0),M(this,"coreWrapper",void 0),M(this,"waitForQuietSaveToFinish",void 0),M(this,"postEditorView",void 0),M(this,"postFeatureController",void 0),M(this,"entitlementController",void 0),M(this,"ExperimentEngine",void 0),M(this,"designSurface",void 0),this.events=e,this.navWidth=80,this.panelLeft=this.navWidth,this.imagePickerPanelLeft=this.navWidth+1,this.panelWidth=312,this.coreWrapper=t,this.controller=a,this.postFeatureController=i,this.entitlementController=o,this.ExperimentEngine=r,this.postEditorView=p,this.waitForQuietSaveToFinish=m,this.designSurface=v,this.userIsPremium=T,this.premiumBadgeVariant=f,this.librariesLabel=A.a.translate("app.assetRailNav.libraries"),this.deletingCurrentDoc=this.deletingCurrentDoc.bind(this),this.getFormaSizeData=this.getFormaSizeData.bind(this),this.designAssetsDataControllerLoaded=this.designAssetsDataControllerLoaded.bind(this),this.handleAddTextContentButtonPress=this.handleAddTextContentButtonPress.bind(this),this.handleSelectLogoTab=this.handleSelectLogoTab.bind(this),this.showImageWarningPopUp=this.showImageWarningPopUp.bind(this),this.handleSelectLibrariesTab=this.handleSelectLibrariesTab.bind(this),this.clickCallback=this.clickCallback.bind(this),this.showADesignAssetsPicker=this.showADesignAssetsPicker.bind(this),this.showDesignAssetsPicker=this.showDesignAssetsPicker.bind(this),this.showBackgroundAssetsPicker=this.showBackgroundAssetsPicker.bind(this),this.showImagePicker=this.showImagePicker.bind(this),this.showIconPicker=this.showIconPicker.bind(this),this.showLibImagePicker=this.showLibImagePicker.bind(this),this.handleSelectTemplatesTab=this.handleSelectTemplatesTab.bind(this),this.events.subscribe("ui:handleSelectTemplatesTab",this.handleSelectTemplatesTab),this.events.subscribe("ui:handleSelectLibrariesTab",this.handleSelectLibrariesTab),this.events.subscribe("ui:showLibImagePickerLibraries",()=>{this.libImagePicker.showLibraries()}),this.events.subscribe("ui:showADesignAssetsPicker",this.showADesignAssetsPicker),this.events.subscribe("ui:showDesignAssetsPicker",this.showDesignAssetsPicker),this.events.subscribe("ui:showBackgroundAssetsPicker",this.showBackgroundAssetsPicker),this.events.subscribe("ui:showImagePicker",this.showImagePicker),this.events.subscribe("ui:showIconPicker",this.showIconPicker),this.events.subscribe("ui:showLibImagePicker",this.showLibImagePicker),this.events.subscribe("ui:handleSelectLogoTab",this.handleSelectLogoTab),this.events.subscribe("ui:showHideComponent",({componentName:e,display:t})=>{this[e]&&(t?this[e].show():this[e].hide())}),this.designAssetsControllers={designAssets:new c.a("designAssets",n.a.sparkContentAssetSearchHost,T,f,S,this.designAssetsDataControllerLoaded),backgrounds:new c.a("backgrounds",n.a.sparkContentAssetSearchHost,T,f,S,this.designAssetsDataControllerLoaded)},this.designAssetsPicker=new h.a({parent:"PostAssetRailNavStrip",id:"PostDesignAssetsPanelDesignAssets",panelId:"designAssets",dataController:this.designAssetsControllers.designAssets,premiumBadgeVariant:this.premiumBadgeVariant,userIsPremium:this.userIsPremium,left:this.panelLeft,width:this.panelWidth,hidden:!0,onClose:()=>{this.designAssetsPicker.hide(),this.panelClosed("designAssets")}}),this.backgroundAssetsPicker=new h.a({parent:"PostAssetRailNavStrip",id:"PostDesignAssetsPanelBackgrounds",panelId:"backgrounds",dataController:this.designAssetsControllers.backgrounds,premiumBadgeVariant:this.premiumBadgeVariant,userIsPremium:this.userIsPremium,left:this.panelLeft,width:this.panelWidth,hidden:!0,onClose:()=>{this.backgroundAssetsPicker.hide(),this.panelClosed("backgrounds")}}),this.itemsList=["text","photos","icons","designAssets","backgrounds","logos","libraries"],d!==I.EditingModes.TEMPLATE&&this.itemsList.unshift("templates"),this.assetRailNav=new s.a({parent:"PostAssetRailNavStrip",id:"PostAssetRailNavUI",list:this.itemsList,height:"100%",width:this.navWidth,clickCb:this.clickCallback}),-1!==this.itemsList.indexOf("templates")&&(this.sidebarTemplates=new P.a({waitForSaveMethod:u,waitForQuietSaveMethod:m,deletingCurrentDoc:this.deletingCurrentDoc,imageWrapper:v.imageWrapper,parent:"PostAssetRailNavStrip",poster:v.poster,hidden:!0,width:this.panelWidth+1,left:this.panelLeft,showResizeOption:i.featureEnabled("post-templates-show-resize"),getDocSize:this.getFormaSizeData,onClose:()=>{this.panelClosed("templates")}})),this.imagePicker=new b.a({parent:"PostAssetRailNavStrip",waitForSaveMethod:u,hidden:!0,width:this.panelWidth,left:this.imagePickerPanelLeft,onClose:()=>{this.imagePicker.$el.detach(),this.panelClosed("photos")}}),this.iconPicker=new b.a({parent:"PostAssetRailNavStrip",waitForSaveMethod:u,hidden:!0,sources:[],assetType:"vector",image_filter:[".svg","image/svg+xml"],label:"Choose icon",width:this.panelWidth,left:this.imagePickerPanelLeft,onClose:()=>{this.iconPicker.$el.detach(),this.panelClosed("icons")}}),this.logoPicker=new l.a({parent:"PostAssetRailNavStrip",id:"PostAssetRailLogoPicker",width:this.panelWidth,left:this.panelLeft,hidden:!0,addLogoToCanvasCb:e=>{const{detail:t}=e.originalEvent;this.controller.addExistingLogo(t.id)},addLogoToPanelCb:()=>{this.controller.addNewLogo()},closeCb:()=>{this.logoPicker.hide(),this.panelClosed("logos")}}),this.addTextSidebar=new w.a({parent:"PostAssetRailNavStrip",hidden:!0,width:this.panelWidth+1,left:this.panelLeft,onAddText:()=>{this.events.publish("ui:handleAddTextButtonPress")},advancedTextLayoutEnabled:i.featureEnabled("post-enable-advanced-text-layout"),advancedTextLayoutWebEnabled:i.featureEnabled("post-enable-advanced-text-layout-web"),onClose:()=>{this.panelClosed("text")}}),this.libImagePicker=new b.a({parent:"PostAssetRailNavStrip",id:"PostAssetRailLibrariesPicker",waitForSaveMethod:u,width:this.panelWidth,left:this.imagePickerPanelLeft,hidden:!0,label:this.librariesLabel,homeLabel:this.librariesLabel,standAlonePicker:!0,onClose:()=>{this.libImagePicker.$el.detach(),this.panelClosed("libraries")}})}designAssetsDataControllerLoaded(e){let t;"designAssets"===e.id?t=this.designAssetsPicker:"backgrounds"===e.id&&(t=this.backgroundAssetsPicker),t&&t.controllerLoaded()}getNavButtonFromItem(e){if(e){const t=this.assetRailNav.el.shadowRoot.querySelectorAll("theo-light-button");return Array.from(t).find(t=>t.iconName===e.iconName)}}panelAutoShown(e){this.panelId&&this.panelId!==e&&this.closePanel(this.panelId),this.panelOpened(e),this.assetRailNav.update({attributes:{selectedId:e}})}showPanelOnEditorStartIfValidPanelId(e,t){return-1===this.itemsList.indexOf(e)?(this.panelId&&(this.closePanel(this.panelId),this.panelId=void 0,this.assetRailNav.update({attributes:{selectedId:""}})),!1):(this.openPanel({appConfig:t,id:e}),this.assetRailNav.update({attributes:{selectedId:e}}),this.assetRailNav.bind(),!0)}panelClosed(e){this.panelId===e&&(this.assetRailNav.update({attributes:{selectedId:""}}),this.panelId=void 0,this.events.publish("ui:handleAssetRailPanelClosed",e),this.events.publish("ui:exitReplaceMode"))}panelOpened(e){this.panelId=e,this.events.publish("ui:handleAssetRailPanelOpened",e)}closePanel(e){switch(e){case"photos":this.imagePicker.hide(),this.imagePicker.$el.detach();break;case"icons":this.iconPicker.hide(),this.iconPicker.$el.detach();break;case"libraries":this.libImagePicker.hide(),this.libImagePicker.$el.detach();break;case"text":this.addTextSidebar.hide();break;case"templates":this.sidebarTemplates.hide();break;case"logos":this.logoPicker.hide();break;case"designAssets":this.designAssetsPicker.hide();break;case"backgrounds":this.backgroundAssetsPicker.hide()}}triggerUpgradePopoverIfNeededByItem(e){let t=!1;if(this.userIsPremium||"logos"!==e.id||(t=!0),t){const t=this.getNavButtonFromItem(e);return this.events.publish("ui:handleAssetRailShowUpgradePopover",e.id,t),!0}return!1}clickCallback(e){if(e.id===this.panelId)return this.closePanel(e.id),void this.panelClosed(e.id);this.openPanel(e)}openPanel(e){if(this.triggerUpgradePopoverIfNeededByItem(e))return void this.assetRailNav.update({attributes:{selectedId:this.panelId||""}});const t=this.panelId;e.id!==t&&t&&this.closePanel(t),m.default.publish(`editor:${e.id}Pressed`,{sparkFormat:"post"});let a=!0;switch(e.id){case"photos":this.showImagePicker();break;case"icons":this.showIconPicker();break;case"libraries":a=!1,this.handleSelectLibrariesTab();break;case"text":this.handleAddTextContentButtonPress();break;case"logos":a=!1,this.handleSelectLogoTab();break;case"templates":a=!1,this.handleSelectTemplatesTab();break;case"designAssets":this.showDesignAssetsPicker(e.appConfig,t);break;case"backgrounds":this.showBackgroundAssetsPicker(e.appConfig,t);break;default:a=!1}a&&this.panelOpened(e.id)}showADesignAssetsPicker(e){if(e&&e.context&&e.context.search_props)try{const t=JSON.parse(e.context.search_props);e.context.search_props=t;if("backgrounds"===(t.path&&t.path.split("/")[1]||"Design Assets").toLowerCase())return void this.showBackgroundAssetsPicker(e)}catch(t){B.warn("_showADesignAssetsPicker error parsing searchProps",{error:t,searchProps:e.context.search_props})}this.showDesignAssetsPicker(e)}showDesignAssetsPicker(e,t){e&&this.panelAutoShown("designAssets"),e=e||{keepPreviousState:!!t},this.designAssetsPicker.show(e)}showBackgroundAssetsPicker(e,t){e&&this.panelAutoShown("backgrounds"),e=e||{keepPreviousState:!!t},this.backgroundAssetsPicker.show(e)}_getRandomIconSearchTerm(){let e=["badge","fun","spark","circle","singer","arrow","heart","star","flower","rectangle","love","party","triangle","square","oval","phone","food","sun"];this.postFeatureController.featureEnabled("use-translation-service-for-icon-search")&&(e=["iconSearch.kBadge","iconSearch.kFun","iconSearch.kSpark","iconSearch.kCircle","iconSearch.kSinger","iconSearch.kArrow","iconSearch.kHeart","iconSearch.kStar","iconSearch.kFlower","iconSearch.kRectangle","iconSearch.kLove","iconSearch.kParty","iconSearch.kTriangle","iconSearch.kSquare","iconSearch.kOval","iconSearch.kPhone","iconSearch.kFood","iconSearch.kSun"]);var t=Math.floor(Math.random()*(e.length+1));return A.a.translate(e[t])}showIconPicker(e){e&&this.panelAutoShown("icons"),e=e||{},this.iconPicker.haveDoneDefaultSearch||(e.context=e.context||{class_name:"DooploImagePickerContext"},e.context.search_string||(e.context.search_string=this._getRandomIconSearchTerm(),this.iconPicker.haveDoneDefaultSearch=!0)),this.iconPicker.show(e),this.iconPicker.removeSelection(),e.label&&this.iconPicker.setTitle(e.label),e.setHome&&this.iconPicker.home(),this.iconPicker.setCloseButtonVisibility(!e.disallowClose)}showImagePicker(e){e&&this.panelAutoShown("photos"),"boolean"!=typeof(e=e||{}).disallowClose&&(e.disallowClose=!1),this.imagePicker.show(e),this.imagePicker.removeSelection(),e.label&&this.imagePicker.setTitle(e.label),e.setHome&&this.imagePicker.home(),this.imagePicker.setCloseButtonVisibility(!e.disallowClose)}showLibImagePicker(e){e&&this.panelAutoShown("libraries"),"boolean"!=typeof(e=e||{}).disallowClose&&(e.disallowClose=!1),this.libImagePicker.show(e),this.libImagePicker.removeSelection(),e.label&&this.libImagePicker.setTitle(e.label),e.setHome&&this.libImagePicker.home(),this.libImagePicker.setCloseButtonVisibility(!e.disallowClose)}deletingCurrentDoc(){return this.coreWrapper&&(this.coreWrapper.cancelPendingSaves(),this.coreWrapper.requestSave(!0)),this.events.publish("ui:closeIsFromReturnToSpark",!0),this.waitForQuietSaveToFinish()}getFormaSizeData(){const e=this.coreWrapper.getRootForma().page;return{sizeID:e.sizeID,pageSize:e.pageSize,exportData:e.exportData}}handleSelectTemplatesTab(){this.panelOpened("templates"),this.sidebarTemplates.handleParentResize({left:this.panelLeft,width:this.panelWidth+1}),this.sidebarTemplates.show()}handleSelectLogoTab(){this.panelOpened("logos"),this.logoPicker.show(),m.default.publish("logoSidebarDisplayed")}handleAddTextContentButtonPress(){this.coreWrapper.triggerTextSidebarDisplayed(),this.events.publish("ui:showHideComponent",{componentName:"addTextSidebar",display:!0}),m.default.publish("addTextSidebarDisplayed")}handleSelectLibrariesTab(){const e={};this.coreWrapper.canAddMoreImages(1)?(this.panelOpened("libraries"),window.marvel.features.setUserFlag("post-user-has-used-libraries",!0),e.setHome=!1,e.label=this.librariesLabel,this.events.publish("ui:showLibImagePicker",e),this.events.publish("ui:showLibImagePickerLibraries")):this.showImageWarningPopUp()}showImageWarningPopUp(){const e=new D.a({headerText:"i18n.dialogs.tooManyImages.kHeaderText",contentText:"i18n.dialogs.tooManyImages.kContentText",dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"OK",onClick:()=>{e.hide()}}]});e.show()}updateAddContentLogoButtonEnabledState(){let e=!0;if(!u.a.currentDoc.belongsToUser()){const t=T.default.currentBrandKit();t&&!1!==T.default.getCurrentBrandElements().showBrandInUI&&t.getLogosSync().length||(e=!1)}e?this.addContentLogoButton.enable():this.addContentLogoButton.disable()}}},GiJK:function(e,t,a){"use strict";a.r(t),a.d(t,"initBrandKit",(function(){return l}));var i=a("UzQk"),n=a.n(i),o=a("2ofD"),s=a.n(o),r=a("rJP3");async function l(e,t,a){const i=e.contextId||s.a.currentDoc.getDCXRoot().getValue("authctx#ctxid"),o={skipReload:!0,belongsToUser:"INCOMING"!==s.a.currentDoc.getCollaboration(),isEntitledUser:t.featureEnabled("entitle-brand-kit")};await async function(e,t,a,i){const o=a.featureEnabled("entitle-brand-kit")?e:null,s=await r.default.loadBrandKit(o,t);i();const l=!!(t.belongsToUser||s&&!s.belongsToUser()),d=s&&l?s.getId():null;n.a.Host.brandkitManager&&n.a.Host.brandkitManager.activateBrand(d)}(i,o,t,a)}},HetE:function(e,t,a){"use strict";a.r(t),a.d(t,"RejectReason",(function(){return i})),a.d(t,"EditingModes",(function(){return n})),a.d(t,"EditorOperations",(function(){return o})),a.d(t,"WebAnimationEnabled",(function(){return s}));const i={STALE_SESSION:"Stale Session"};let n,o;!function(e){e[e.DOCUMENT=1]="DOCUMENT",e[e.TEMPLATE=2]="TEMPLATE"}(n||(n={})),function(e){e.NEW="new",e.EDIT="edit",e.REMIX="remix",e.EDIT_TEMPLATE="edit-template",e.NEW_FROM_TEMPLATE="new-from-template",e.NEW_TEMPLATE_FROM_TEMPLATE="new-template-from-template"}(o||(o={}));const s=!0},Mvsy:function(e,t,a){"use strict";a.r(t),a.d(t,"validateRemix",(function(){return r})),a.d(t,"validatePremiumRemix",(function(){return l}));var i=a("Na8G"),n=a.n(i),o=a("tpS0"),s=a.n(o);async function r(e,t,a){if("remix"!==t.operation&&"new-from-template"!==t.operation)return;0===a.getRootForma().childCount?await function(e){return new Promise((t,a)=>{e.errorDialogs.notRemixableOverlay=new s.a({headerText:"i18n.dialogs.remixFailed.kHeaderText",contentText:"i18n.dialogs.remixFailed.kContentText",dismissable:!1,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.remixFailed.kButtonLabel",onClick(){e.errorDialogs.notRemixableOverlay.hide(),a()}}]}),window.marvel.events.trigger("hide-interstitial"),e.windowPanel.show(),e.errorDialogs.notRemixableOverlay.show()})}(e):a.requestSave()}async function l(e,t,a,i,o){const{operation:s,cpAssetId:r,cpServiceDomain:l,routeFragment:d}=t;if(a||"remix"!==s)return;const{tagNames:h,templateId:c,templateType:p,alias:u}=await i.getRemixParentCPMetadata(r,l||"cc-api-cp.adobe.io",!1);if(o(),p&&"paid"===p){const t=h&&h.includes("remixanimation");window.marvel.events.trigger("hide-interstitial"),e.windowPanel.show(),n.a.showMerchMessagingModal({workflow:"remixPremiumTemplate",destinationUrl:d,asset:{alias:u,animated:t,id:c,tags:h,isPremiumTemplate:!0,remixable:!0,remixpaid:!0,app:"post"},analyticsPage:"editor:post",analyticsFullTagNames:h}),o(!0)}}},OMxe:function(e,t,a){"use strict";a.r(t),a.d(t,"StartupPerformance",(function(){return d})),a.d(t,"publishProjectCreated",(function(){return h})),a.d(t,"publishEditorDisplayed",(function(){return c})),a.d(t,"publishPaidBranding",(function(){return p})),a.d(t,"publishProjectCreatedFromTemplate",(function(){return u}));var i=a("E+oP"),n=a.n(i),o=a("2ofD"),s=a.n(o),r=a("bBG2"),l=a("rJP3");class d{constructor(){var e,t,a;a=0,(t="begin")in(e=this)?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a}start(){this.begin=window.performance.now()}end(e,t,a){let i=window.performance.now()-this.begin;t&&(i-=t);const n=l.default&&l.default.getCurrentBrandElements()||{id:""};r.default.publish("post:editorStartupEnd",{contextualData1:"timeElapsedMs:"+i,contextualData2:"editorOperation:"+e.operation,contextualData3:"isFreshLoad:"+!a,contextualData4:"hasActivatedBrand:"+(!!n&&n.activated),contextualData5:"timeSpentInNpw:"+t})}}function h(e,t,a){r.default.publish("projectCreated",{projectId:s.a.currentDoc.id,aspectRatio:e.shapeData.aspectRatio,targetId:e.shapeData.id,id:e.id,textLength:e.text.length,workflow:t.workflow}),a&&r.default.publish("createdBrandedProject",{projectId:s.a.currentDoc.id})}function c(e,t,a){const i=["new","new-from-theme","new-from-template","remix"].includes(e.operation),o=l.default&&l.default.getCurrentBrandElements()||{id:""},d=t.remixParentAnalyticsMetadata;r.default.publish("project:editorDisplayed",{isBranded:!n()(s.a.currentDoc.getDCXRoot().getValue("authctx#ctxid")),contextualData23:o.isDefault?"":o.id,isNewProject:i,sparkFormat:"post",contextData:["projectId"],includesUploadedFonts:!!a&&a.includesUploadedFonts(),contextualData5:"tagNames:"+d.tagNames,contextualData6:"templateType:"+d.templateType,contextualData24:"collabStatus:"+s.a.currentDoc.getCollaborationForAnalytics(),templateId:d.templateId})}function p(e){if(!("new"===e.operation))return;const t=l.default&&l.default.getCurrentBrandElements();if(!(t&&t.activated))return;"true"===e.branded?r.default.publish("paidProjectStartBranded"):r.default.publish("paidProjectStartUnbranded")}function u(e,t){r.default.publish("projectCreated",{projectId:s.a.currentDoc.id}),r.default.publish("createdBrandedProject",{projectId:s.a.currentDoc.id,templateName:t.getValue("theme#data").name,themeletId:e.templateId}),r.default.publish("createdProjectFromTemplate")}},"Pv/z":function(e,t,a){"use strict";a.r(t),a.d(t,"addNewImage",(function(){return I}));var i=a("tY4j"),n=a.n(i),o=a("bBG2"),s=a("J9tZ"),r=a("I/Z9"),l=a("qcxC"),d=a("2PxR"),h=a("l+ZV"),c=a("MGCh"),p=a.n(c),u=a("Mbmg"),m=a("a8ov"),g=a("luSs"),b=a("tpS0"),v=a.n(b),w=a("m5wp");function f(e,t){if(e)return;const a=new v.a({headerText:"i18n.dialogs.addOrReplaceImageFailed.kHeaderText",contentText:t,dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.addOrReplaceImageFailed.kOK",onClick(){a.hide()}}]})}function P({components:e,contentNodeId:t,coreWrapper:a,data:i,docSavedDfd:n,error:o,failSilent:s,formaId:r,log:l,readyForRenderDfd:d,saveIsSuspended:h}){if(h&&a.resumeSave(),o instanceof a.ActionError&&!o.isAllowedError&&a.shouldReloadOnActionFailure())return l.error("doAction",o.message),void Object(w.a)();!function({contentNodeId:e,coreWrapper:t,data:a,error:i,failSilent:n,formaId:o,log:s}){if(!a.replacementForma&&!a.replacementFrame)return s.error("failed to add image",i),t.cleanupInvalidImageSync(o,e),void f(n,"i18n.dialogs.addOrReplaceImageFailed.kContentText");s.error("failed to replace image",i),t.cleanupInvalidImageWithColorSync(o,e,[]),f(n,"i18n.dialogs.addOrReplaceImageFailed.kContentTextReplace")}({data:i,log:l,error:o,coreWrapper:a,formaId:r,contentNodeId:t,failSilent:s}),Object(g.a)(e,"image-loading-end"),a.updateConstrainedImages(),a.validateDoc("addImageFail"),n.reject(),d.reject()}const T=p.a.channel("add-new-image");const S=p.a.channel("add-new-image");let k=0;async function I({allowSelection:e=!0,component:t,coreWrapper:a,uiStateController:i,data:c,docSavedDfd:p=Object(l.b)(),failSilent:b=!1,isNewPostImage:v=!1,readyForRenderDfd:w=Object(l.b)(),replacingForma:f}){a.validateDoc("addImageBegin"),window.performance.mark("spP:add-new-image-start"),u.a.beginTrackingPendingXhrRequests(),u.a.pageUnloadBlockingBegin();const I=c.processedImgData||c.files[0],C=c.isLogo;let D=I.type||I.mimeType||"image/jpeg";const y="dooplo"===I.source,A=y&&I.preview.link.includes(".png")&&"image/png"!==D;y&&A&&(D="image/png");const M=Object(d.getImageMediaMetadata)(c.info),B=M&&"Adobe Stock"===M.sourceName,x="google drive"===I.source,F=I instanceof Blob,E=F||B||x,L=function(e){if(e.info){if(e.info.id)return e.info.id;if(e.info.image_id)return""+e.info.image_id;if(e.info.assetID)return e.info.assetID}return k+=1,"unknown_image:"+k}(c);let R,W,O,N,j,U=null,G=null,z=null,_=!1;if(i&&i.model._state.listOfLoadingAssets.includes(L))return w.resolve(),w.promise;Object(g.a)(t,"image-loading-begin");try{i&&i.addLoadingAssetId(L);const l=await async function(){if(E)return null;const i=I.thumbnail||I.small||I.preview;let n;n=i.blobPromise?await i.blobPromise:["dropbox","cc","lightroom","ccl","cclight"].includes(I.source)?i.link:"/api/post/v1/proxy?url="+encodeURIComponent(i.link);const[o,l]=await Object(s.a)(h.default.load(n));if(!l&&o)throw new Error("Failed to load low-res image. error detail: "+o);const d=Object(r.createCanvas)(l),p=d&&d.getContext("2d");if(U=p&&Object(r.checkCanvasForAlpha)(p,d.width,d.height)||null,U){if(f)return null;Object(r.trimTransparentEdges)(d)}z=d&&d.toDataURL();const u=await a.addOrReplaceImage({isNewPostImage:v,mimeType:D,hasAlpha:U,allowSelection:e,id:null,imageId:null,metadata:M,isLowResImage:!0,url:z,width:d.width,height:d.height,replacementForma:c.replacementForma,replacementFrame:c.replacementFrame,sparkRoles:c.sparkRoles,sparkElementId:c.sparkElementId,forceReplacement:f,floatingImageStrategy:c.floatingImageStrategy});return N=u.formaId,j=u.contentNodeId,function(e){return E||f&&U||!t.poster||(w.resolve(),window.setTimeout(()=>Object(g.a)(t,"image-loading-end"),350)),e}(u)}();S.info("step1: low-res image loaded",l);const d=await async function(e){const t=(e||{contentNodeId:null}).contentNodeId,i=t;if(F){const{width:e,height:t}=await h.default.loadImageFromBlob(I);return W=e,O=t,await a.saveImageComponent(I,D)}const{width:o,height:s,source:r,assetId:l}=function({imgData:e,imgInfo:t}){if(e instanceof Blob)return e;const a=e.source,{width:i,height:n,link:o}=e.original;a||T.error("getBestRenditionForImageSaving source is falsy. imgData is:",e);let s=null;return"dooplo"===a&&i&&n&&(s=function(e,t,a){if(!(e*t>256e4))return null;const i=a._links.rendition.filter(e=>{const{href:t,width:a,height:i}=e;return!!(t&&a&&i)&&a*i<256e4}).sort((e,t)=>e.width-t.width).pop();if(!i)return null;const{width:n,height:o,href:s}=i;return{assetId:s,width:n,height:o,source:"dooplocdn"}}(i,n,t)),s||{source:a,assetId:o,width:i,height:n}}({imgData:I,imgInfo:c.info});W=o,O=s;const d=n()(a.saveImageComponent,{maxAttempts:3});return await d({source:r,assetId:l},D,null,t,i)}(l);S.info("step2: save image",d);const b=await function(e){if(R=e,G=m.default.decodeUrl(R.encodedUrl),!G)throw Error("Invalid hi-res image URL");return h.default.load(G)}(d);S.info("step3: get hi-res image",b);const P=await function(e){let t;if(W=e.width,O=e.height,null===U){t=Object(r.createCanvas)(e);const a=t.getContext("2d");U=Object(r.checkCanvasForAlpha)(a,t.width,t.height)||null}if(U&&!C)return t||(t=Object(r.createCanvas)(e)),Object(r.trimTransparentEdges)(t),W=t.width,O=t.height,Object(r.canvasToBlob)(t);return e}(b);S.info("step4: check for transparent image",P);const k=await async function(e){if(!U||C)return e;if(R=await a.saveImageComponent(e,D),G=m.default.decodeUrl(R.encodedUrl),!G)throw Error("Invalid hi-res image URL");return h.default.load(G)}(P);S.info("step5: load hi-res image",k);const y=C?await async function(e){const t={mimeType:D,acRoles:c.sparkRoles,componentId:R.component.id,id:c.sparkElementId,pixelHeight:e.height,pixelWidth:e.width,url:R.encodedUrl};return o.default.publish("editor:logoAdded"),a.addLogo(t)}(k):await async function(t){const i={isNewPostImage:v,mimeType:D,lowResImageUrl:z,hasAlpha:U,contentNodeId:j,allowSelection:e,id:R.component.id,imageId:null,metadata:M,isLowResImage:!1,url:R.encodedUrl,width:W||t.width,height:O||t.height,replacementForma:c.replacementForma,replacementFrame:c.replacementFrame,forceReplacement:f,floatingImageStrategy:c.floatingImageStrategy};if(z){const[e,t]=await Object(s.a)(a.replaceImageWithHighRes(i));if(e&&!t)throw Error("Failed coreWrapper.replaceImageWithHighRes promise. error detail: "+e);return _=!1,t}const[n,o]=await Object(s.a)(a.addOrReplaceImage(i));if(n&&!o)throw Error("Failed coreWrapper.addOrReplaceImage promise. error detail: "+n);return o}(k);S.info("step6: add image to document",y),function(e){e&&e.formaId&&(N=e.formaId);a.updateConstrainedImages(),window.performance.measure("spP:add-new-image-complete","spP:add-new-image-start"),_=!0,w.resolve(),u.a.endTrackingPendingXhrRequests(),a.validateDoc("addImageSuccess"),p.resolve(),(F||f&&U)&&window.setTimeout(()=>Object(g.a)(t,"image-loading-end"),350)}(y),i&&i.removeLoadingAssetId(L),S.info("step7:finalized add or replace image")}catch(e){P({coreWrapper:a,log:S,data:c,formaId:N,contentNodeId:j,failSilent:b,components:t,docSavedDfd:p,readyForRenderDfd:w,saveIsSuspended:_,error:e})}return w.promise}t.default=I},XR60:function(e,t,a){"use strict";a.r(t);var i=a("+Ltv"),n=a.n(i),o=a("bBG2"),s=a("5d+0");function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const l={selectAll:0,deselectAll:0,undo:0,redo:0},d={handleUndo(){},handleRedo(){},handleSelectAll(){},handleDeselectAll(){},handlePanOn(e){},handlePanOff(e){},handleZoomIn(){},handleZoomOut(){},handleZoomFit(){},handleZoomFill(){},handleZoomActualSize(){},handlePanView(e,t){}};t.default=new class{constructor(){r(this,"methods",d),r(this,"spaceBarDown",!1),r(this,"handleKeyDown",e=>{if(n.a.disableCustomKeyboardShortcuts)return;const t=window.navigator.platform.includes("Mac"),a=e.ctrlKey&&!t||e.metaKey&&t,i=" "===e.key,r="PageUp"===e.key||"PageDown"===e.key||"ArrowLeft"===e.key||"ArrowRight"===e.key||"ArrowUp"===e.key||"ArrowDown"===e.key;if(!a&&!(i||r||this.spaceBarDown))return;let d=!1;const h=e.target.matches("input, textarea"),c=void 0!==e.composedPath().find(e=>e instanceof Element&&e.matches("input, textarea")),p=h||c,u=null!==e.target.closest("#PostLeftSidebar"),m=e.shiftKey,g=e.altKey;let b=String(e.key).toUpperCase();const v=String(e.code).toUpperCase(),{handleRedo:w,handleUndo:f,handleDeselectAll:P,handleSelectAll:T,handlePanOn:S,handleZoomIn:k,handleZoomOut:I,handleZoomFit:C,handleZoomFill:D,handleZoomActualSize:y,handlePanView:A}=this.methods;if("DIGIT0"===v&&(b="0"),this.spaceBarDown&&("Meta"===e.key&&t||"Control"===e.key&&!t||"Alt"===e.key))S(e);else{switch(b){case"A":p||(m?(P(),l.deselectAll+=1,o.default.publish("keyboardShortcut",{contextualData1:`actionCountInSession: ${s.ShortcutConstants.kDeselectAll}_${l.deselectAll}`,contextualData2:"actionDescription: "+s.ShortcutConstants.kDeselectAll})):(T(),l.selectAll+=1,o.default.publish("keyboardShortcut",{contextualData1:`actionCountInSession: ${s.ShortcutConstants.kSelectAll}_${l.selectAll}`,contextualData2:"actionDescription: "+s.ShortcutConstants.kSelectAll})),d=!0);break;case"S":d=!0;break;case"Z":p||(m?(w(),l.redo+=1,o.default.publish("keyboardShortcut",{contextualData1:`actionCountInSession: ${s.ShortcutConstants.kRedo}_${l.redo}`,contextualData2:"actionDescription: "+s.ShortcutConstants.kRedo})):(f(),l.undo+=1,o.default.publish("keyboardShortcut",{contextualData1:`actionCountInSession: ${s.ShortcutConstants.kUndo}_${l.undo}`,contextualData2:"actionDescription: "+s.ShortcutConstants.kUndo})),d=!0);break;case"Y":p||(w(),d=!0);break;case" ":p||(this.spaceBarDown=!0,S(e),d=!0);break;case"=":case"+":d=!0,p||k();break;case"-":d=!0,p||I();break;case"0":d=!0,p||(g?y():m?D():C());break;case"PAGEDOWN":case"PAGEUP":case"ARROWLEFT":case"ARROWRIGHT":case"ARROWUP":case"ARROWDOWN":p||u||(A(e.key,e.repeat),d=!0)}d&&e.preventDefault()}}),r(this,"handleKeyUp",e=>{if(n.a.disableCustomKeyboardShortcuts)return;let t=!1;const a=e.target.matches("input, textarea"),i=void 0!==e.composedPath().find(e=>e instanceof Element&&e.matches("input, textarea")),o=a||i,s=String(e.key).toUpperCase(),{handlePanOff:r}=this.methods,l=window.navigator.platform.includes("Mac");if(this.spaceBarDown&&("Meta"===e.key&&l||"Control"===e.key&&!l||"Alt"===e.key))return void r(e);if(" "===e.key){switch(s){case" ":o||(this.spaceBarDown=!1,r(e),t=!0)}t&&e.preventDefault()}})}startListening(e){this.stopListening(),this.methods=e,this.spaceBarDown=!1,document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp)}stopListening(){this.methods=d,document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)}}},YC27:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return T}));var i=a("2ofD"),n=a.n(i),o=a("bBG2"),s=a("3xdQ"),r=a.n(s),l=a("qnb0"),d=a.n(l),h=a("mwMu"),c=a.n(h),p=a("8VGm"),u=a("K7z8"),m=a("rJP3"),g=a("QX4k"),b=a("a8ov"),v=a("OMxe"),w=a("MGCh");const f=a.n(w).a.channel("init-core-wrapper");function P(e){const t="design/post/"+e;window.marvel.navigate(t,{trigger:!1,replace:!0})}async function T({appConfig:e,templateNode:t,validateSession:a}){let i=t,s={persistSource:null,persistSave:null};const l=m.default.currentBrandKit(),{operation:h,templateId:w,cpAssetId:T,cpServiceDomain:S}=e,{currentDoc:k}=n.a,I=k.id;function C(){i=l.getThemeById(w),s.persistSource=c.a.fromTemplate(l,i)}switch(h){case"new":Object(v.publishPaidBranding)(e);break;case"new-template-from-template":{C(),o.default.publish("createdTemplateFromTemplate");const t=await u.default.createEmptyPostTemplate(l);a(),s.persistSave=d.a.toTemplateLocal(l,i,d.a.CommitChanges.AUTO),e.newTemplateId=t.id;break}case"edit-template":C(),o.default.publish("editedTemplate"),s.persistSave=d.a.toTemplateLocal(l,i,d.a.CommitChanges.AUTO);break;case"new-from-template":C(),Object(v.publishProjectCreatedFromTemplate)(e,i),P(I),s.persistSave=d.a.toDocument(k);break;case"remix":b.default.setCPServiceDomain(S),P(I);new g.default({cpServiceDomain:S}).trackRepeatableActivity(T,"remix_count").catch(e=>{f.error("failed to update remix count",e)}),s={persistSource:new p.default({cpServiceDomain:S,assetId:T}),persistSave:d.a.toDocument(k)};break;default:b.default.setCPServiceDomain(""),s={persistSource:c.a.fromDocument(k),persistSave:d.a.toDocument(k)}}const D=new r.a(s);return await D.whenInitialized(),a(),{coreWrapper:D,templateNode:i}}},bDzb:function(e,t,a){"use strict";a.r(t),a.d(t,"initDesign",(function(){return g})),a.d(t,"repairDesign",(function(){return b}));var i=a("UzQk"),n=a("qcxC"),o=a("MGCh"),s=a.n(o),r=a("tpS0"),l=a.n(r),d=a("OMxe");function h(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?h(Object(a),!0).forEach((function(t){p(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):h(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function p(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const u=s.a.channel("controller");async function m({image:e,replacingForma:t,coreWrapper:a,component:i,addNewImage:o,validateSession:s}){if(!e)return!1;let r=[];const d=[],h={coreWrapper:a,component:i,replacingForma:t,isNewPostImage:!0,allowSelection:!1};return r=Array.isArray(e)?e.map(e=>{const t=Object(n.a)();return d.push(t.promise),o(c(c({},h),{},{data:e,docSavedDfd:t,failSilent:!0}))}):[o(c(c({},h),{},{data:e}))],Promise.all(d).catch(()=>{u.error("Add image errors in document during open"),function(e){const t=new l.a({headerText:"i18n.dialogs.addImageError.kHeaderText",contentText:"i18n.dialogs.addImageError.kContentText",dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.addImageError.kButtonLabel",onClick(){t.hide()}}]});e.errorDialogs.addImageErrorOverlay=t}(i)}),await Promise.allSettled(r),s(),!0}async function g({appConfig:e,newPostParams:t,queryParams:a,replacingForma:n,coreWrapper:o,component:s,addNewImage:r,brandDocument:l,validateSession:h}){switch(e.operation){case"remix":return await async function(e,t,a){const{aspectId:n,customSize:o}=e;let s;if(n||o)if(o){const e=o.split(":");if(4===e.length){const[t,a,n,o]=e.map(Number);s=i.DesignSizeLibrary.getCustomSize(t,a,n,o)}}else s=i.DesignSizeLibrary.getById(n);s&&(await t.setPageSizeFromDesignSize(s),a()),await t.recordOriginalSize(),a()}(e,o,h),!1;case"new":return async function({appConfig:e,newPostParams:t,queryParams:a,replacingForma:i,coreWrapper:n,component:o,addNewImage:s,brandDocument:r,validateSession:l}){const{shapeData:h,image:c}=t;await n.setPageSizeFromDesignSize(h),l(),await n.recordOriginalSize(),l();const p=await m({image:c,replacingForma:i,coreWrapper:n,component:o,addNewImage:s,validateSession:l});l(),await n.initializeNewPost(t),l();const u="true"===e.branded;return u&&(await r(!0),l()),Object(d.publishProjectCreated)(t,a,u),p}({appConfig:e,newPostParams:t,queryParams:a,replacingForma:n,coreWrapper:o,component:s,addNewImage:r,brandDocument:l,validateSession:h});default:return!1}}function b(e,t,a){if("new"!==e.operation){a.replaceCorruptImageFrames()&&(u.error("Replacing corrupt images in document during open"),function(e){let{replacedLowResImagesModal:t}=e.errorDialogs;t||(t=new l.a({headerText:'\n                <span class="error-modal-header">\n                <span>i18n.dialogs.corruptImageReplacement.kHeaderText</span>\n                <i class="error-modal-header__icon"></i>\n                </span>\n            ',contentText:'<div class="error-modal-content">\n                <span>i18n.dialogs.corruptImageReplacement.kContentText</span>\n                <span class="error-modal-content_placeholder-indicator" style="background-color: #FF0000;"></span>\n            </div>',dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.corruptImageReplacement.kButtonLabel",onClick(){t.hide()}}]}),e.errorDialogs.replacedLowResImagesModal=t),t.show()}(t))}}},el3O:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return b}));a("2ofD"),a("bBG2");var i=a("Avqh"),n=a.n(i),o=(a("+VG/"),a("WPh2")),s=a.n(o),r=a("sggK"),l=a.n(r),d=a("hSNs"),h=a.n(d),c=(a("2Fsf"),a("M1RA"),a("rJP3"),a("MGCh")),p=a.n(c),u=a("HetE");function m(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const g=p.a.channel("NavStripUIModule");class b{constructor({events:e,coreWrapper:t,postFeatureController:a,entitlementController:i,ExperimentEngine:o,editingMode:r,postEditorView:d}){m(this,"navStripTabsWrapper",void 0),m(this,"globalTabsWrapper",void 0),m(this,"tabButtonTheme",void 0),m(this,"tabButtonPalette",void 0),m(this,"tabButtonLayout",void 0),m(this,"tabButtonResize",void 0),m(this,"tabButtonAnimation",void 0),m(this,"backgroundTabsWrapper",void 0),m(this,"tabButtonBackgroundImage",void 0),m(this,"logoTabsWrapper",void 0),m(this,"tabButtonLogo",void 0),m(this,"languageSwitcher",void 0),m(this,"iconTabsWrapper",void 0),m(this,"tabButtonIcon",void 0),m(this,"coreWrapper",void 0),m(this,"postEditorView",void 0),m(this,"postFeatureController",void 0),m(this,"entitlementController",void 0),m(this,"ExperimentEngine",void 0),this.events=e,this.coreWrapper=t,this.postFeatureController=a,this.entitlementController=i,this.ExperimentEngine=o,this.postEditorView=d,this.handleTrySelectResizeTab=this.handleTrySelectResizeTab.bind(this),this.navStripTabsWrapper=new n.a({parent:"PostNavStrip",id:"PostNavStripTabsWrapper"}),this.globalTabsWrapper=new l.a({parent:"PostNavStripTabsWrapper",id:"PostGlobalTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"global-tabs",defaultActive:!0,rememberLastTab:!0,onShown:()=>{this.coreWrapper.deselect()}}),this.tabButtonPalette=new s.a({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kColors",id:"sectionTabPalette",group:"global-sidebar-tabs",onSelect:()=>{this.events.publish("ui:handleSelectPaletteTab")},handleClickOnSelected:()=>{this.events.publish("ui:handleNavTabClosed")}}),this.globalTabsWrapper.registerTab(this.tabButtonPalette),u.WebAnimationEnabled&&(this.tabButtonAnimation=new s.a({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kAnimation",id:"sectionTabAnimation",group:"global-sidebar-tabs",defaultSelected:!1,onSelect:()=>{this.events.publish("ui:handleSelectAnimationTab")},handleClickOnSelected:()=>{this.events.publish("ui:handleNavTabClosed")}}),this.globalTabsWrapper.registerTab(this.tabButtonAnimation)),this.tabButtonLayout=new s.a({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kBackground",id:"sectionTabLayout",group:"global-sidebar-tabs",defaultSelected:!1,onSelect:()=>{this.events.publish("ui:handleSelectLayoutTab")},handleClickOnSelected:()=>{this.events.publish("ui:handleNavTabClosed")}}),this.globalTabsWrapper.registerTab(this.tabButtonLayout),this.tabButtonResize=new s.a({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kResize",id:"sectionTabResize",group:"global-sidebar-tabs",defaultSelected:!1,isPremium:this.postFeatureController.featureEnabled("post-resize-is-paid-feature")&&r!==u.EditingModes.TEMPLATE,isEntitled:this.entitlementController.isEntitledToFeature("postResizeButton"),onTrySelect:this.handleTrySelectResizeTab,onSelect:()=>{this.events.publish("ui:handleSelectResizeTab")},handleClickOnSelected:()=>{this.events.publish("ui:handleNavTabClosed")}}),this.globalTabsWrapper.registerTab(this.tabButtonResize),r!==u.EditingModes.TEMPLATE&&(this.tabButtonTheme=new s.a({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kDesign",id:"sectionTabTheme",group:"global-sidebar-tabs",defaultSelected:!0,onSelect:()=>{this.events.publish("ui:handleSelectThemeTab")},handleClickOnSelected:()=>{this.events.publish("ui:handleNavTabClosed")}}),this.globalTabsWrapper.registerTab(this.tabButtonTheme)),this.backgroundTabsWrapper=new l.a({parent:"PostNavStripTabsWrapper",id:"PostBackgroundTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"background-tabs",defaultActive:!1,onHidden:()=>{this.events.publish("ui:showHideComponent",{componentName:"sidebarBackground",display:!1})},onShown:()=>{this.events.publish("ui:onSwitchToAnyLocalTabSet")}}),this.tabButtonBackgroundImage=new s.a({parent:"PostBackgroundTabsWrapper",label:"i18n.components.buttons.kImage",id:"sectionTabBackground",group:"local-sidebar-tabs",onSelect:()=>{this.events.publish("ui:handleSelectBackgroundTab",{tabId:"image"});const e=this.coreWrapper.getSelectedForma();e&&!e.isImage()&&this.events.publish("ui:showImagePicker",{disallowClose:!0,setHome:!0})}}),this.backgroundTabsWrapper.registerTab(this.tabButtonBackgroundImage),this.logoTabsWrapper=new l.a({parent:"PostNavStripTabsWrapper",id:"PostLogoTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"logo-tabs",defaultActive:!1,onHidden:()=>{this.events.publish("ui:showHideComponent",{componentName:"sidebarLogo",display:!1})},onShown:()=>{this.events.publish("ui:onSwitchToAnyLocalTabSet")}}),this.tabButtonLogo=new s.a({parent:"PostLogoTabsWrapper",label:"i18n.components.buttons.kLogo",id:"sectionTabLogo",group:"local-sidebar-tabs",onSelect:()=>{this.events.publish("ui:handleSelectLogoTab")}}),this.logoTabsWrapper.registerTab(this.tabButtonLogo),this.iconTabsWrapper=new l.a({parent:"PostNavStripTabsWrapper",id:"PostIconTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"icon-tabs",defaultActive:!1,onHidden:()=>{this.events.publish("ui:showHideComponent",{componentName:"sidebarIcon",display:!1})},onShown:()=>{this.events.publish("ui:onSwitchToAnyLocalTabSet")}}),this.postFeatureController.featureEnabled("post-language-switcher")&&(this.languageSwitcher=new h.a({parent:"PostNavStrip",id:"PostLanguageSwitcher"}));let c="i18n.components.buttons.kIcon";this.ExperimentEngine.run("IconShapeExperiment",{shape_for_icon_label:()=>{c="i18n.components.buttons.kShape"},control:()=>{}}).then(()=>{this.tabButtonIcon=new s.a({parent:"PostIconTabsWrapper",label:c,id:"sectionTabIcon",group:"local-sidebar-tabs",onSelect:()=>{this.events.publish("ui:handleSelectIconTab",{tabId:"icon"})}}),this.iconTabsWrapper.registerTab(this.tabButtonIcon)}).done()}handleTrySelectResizeTab(){return this.events.publish("editor:resizePressed"),this.ExperimentEngine.run("PostResize").catch(e=>{g.error("Ran into error with PostResize experiment",e)}).done(),!this.postFeatureController.featureEnabled("post-resize-is-paid-feature")||this.entitlementController.tryPremiumFeature({$element:this.tabButtonResize.$el,position:"left",touchpointName:"postResizeButton"})}updateCoreWrapper(e){this.coreWrapper=e}deselectSelectedTabs(){this.globalTabsWrapper.deselectSelected()}}},iXON:function(e,t,a){"use strict";a.r(t),a.d(t,"checkWebGLSupport",(function(){return d}));var i=a("bBG2"),n=a("tpS0"),o=a.n(n),s=a("3xm6"),r=a.n(s),l=a("GnB6");async function d(e){const t=document.createElement("canvas").getContext("webgl");null!==t&&"undefined"!=typeof WebGLRenderingContext&&t instanceof WebGLRenderingContext?i.default.publish("webGLAvailable"):await new Promise((t,a)=>{const n=l.default.getWebGLSystemInfo();i.default.publish("webGLUnavailable",n),e.errorDialogs.webglWarningModal=function(e,t){const{vendor:a,renderer:i,platform:n,userAgent:s}=e,l=new o.a({headerText:"i18n.dialogs.webGLDisabled.kHeaderText",contentText:`${r.a.translate("dialogs.webGLDisabled.kContentText")}<br/>\n            <br/>\n            Vendor: ${a}<br/>\n            Renderer: ${i}<br/>\n            Platform: ${n}<br/>\n            UserAgent: ${s}`,dismissable:!1,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.webGLDisabled.kOK",onClick(){l.hide(),t({isWebGLUnavailable:!0})}}]});return l}(n,a),window.marvel.events.trigger("hide-interstitial"),e.windowPanel.show(),e.errorDialogs.webglWarningModal.show()})}},luSs:function(e,t,a){"use strict";function i(e,t){var a,i,n,o;null==e||null===(a=e.designSurface)||void 0===a||null===(i=a.poster)||void 0===i||null===(n=i.events)||void 0===n||null===(o=n.publish)||void 0===o||o.call(n,t)}a.d(t,"a",(function(){return i}))},m5wp:function(e,t,a){"use strict";a.d(t,"b",(function(){return s}));var i=a("tpS0"),n=a.n(i),o=a("yiIM");function s(e,t,a,i,s){const r=[{id:"MustReloadEditorRefreshButton",class:"pill pill-primary-on-light",label:"i18n.dialogs.mustReloadEditor.kRefresh",onClick(){l.hide(),(a||o.a.reload)()}}];t&&(r.push({id:"MustReloadEditorIgnoreAllButton",class:"pill pill-secondary-on-light",label:"i18n.dialogs.mustReloadEditor.kIgnoreAllLabel",onClick(){l.hide(),s&&s()}}),r.push({id:"MustReloadEditorIgnoreOnceButton",class:"pill pill-secondary-on-light",label:"i18n.dialogs.mustReloadEditor.kIgnoreOnceLabel",onClick(){l.hide(),i&&i()}}));const l=new n.a({buttons:r,id:"MustReloadEditorDialog",headerText:"i18n.dialogs.mustReloadEditor.kHeaderText",contentText:e||"i18n.dialogs.mustReloadEditor.kContentText",dismissable:!1});l.show()}t.a=s},ooew:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return o}));var i=a("tpS0"),n=a.n(i);function o(e,t){const a=e.getRootForma();function i(e){return a.filterWithCallback(e).length>0}(i(e=>e.isSticker())||i(e=>e.isVideo())||!t&&i(e=>!!e.animation))&&function(){const e=new n.a({headerText:"i18n.dialogs.minisFeatureNotice.kHeaderText",contentText:"i18n.dialogs.minisFeatureNotice.kContentText",buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.minisFeatureNotice.kButtonLabel",onClick(){e.hide()}}]});e.show()}()}},q6ln:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return P}));var i=a("UzQk"),n=a("wHG3"),o=a("4zaV"),s=a.n(o),r=a("UFvF"),l=a.n(r),d=a("bBG2"),h=a("xX9p"),c=a("aOoP"),p=a("WPm+"),u=a("tpS0"),m=a.n(u),g=a("I/Z9"),b=a("EUgP"),v=a("MGCh");function w(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const f=a.n(v).a.channel("export-controller");Math.ceil(1945.6);class P{static invite(e,t,a){window.marvel.events.trigger("spark-invite-collaborators-to-current-doc",{source:t,page:a,composite:e})}static publishTemplate(e,t,a,i){return new b.a({coreWrapper:t,waitForQuietSaveToFinish:a,getDocumentRendition:i}).publishDoc(e)}static uploadToFacebook(){window.marvel.events.trigger("upload-to-facebook-current-doc")}static uploadToTwitter(){window.marvel.events.trigger("upload-to-twitter-current-doc")}static downloadImageBlob(e,t="png",a){return new Promise(t=>{if(window.navigator.msSaveBlob)return window.navigator.msSaveBlob(e,a),t();const i=window.URL.createObjectURL(e),n=document.createElement("a");n.href=i,n.download=a,document.body.appendChild(n),n.onclick=()=>{document.body.removeChild(n),window.setTimeout(()=>(window.URL.revokeObjectURL(i),t()),0)},n.click()})}static getExportData(e){const t=e.firstPage.getExportData(null,null).pixelDimensions,a={width:t.width,height:t.height,imageQuality:1};return a}static getRenditionParams(e,t){const a=P.getExportData(e);return{width:a.width,height:a.height,imageQuality:a.imageQuality,outputFormat:t||P.MIME_TYPES.jpg,renderType:n.PixiJSApp.TargetRenderTypeHint.ForFinalForm}}static sendToGoogleDrive(e){s.a.saveToDrive(e).then(e=>{f.debug("GoogleApiController saved success with Google Drive File ID",e)},e=>{f.error("Error with handleSaveToGoogleDrive",e)})}static handleExportImageBlob(e,t,a){d.default.publish("Sharing Action",{contextData:["projectId"],eventAction:"BeginDownload",slide:"publish"}),P.downloadImageBlob(e,t,a),d.default.publish("Sharing Action",{contextData:["projectId"],eventAction:"Download"})}constructor({doc:e,am:t,poster:a}){w(this,"document",void 0),w(this,"poster",void 0),w(this,"analyticsManager",void 0),this.document=e,this.poster=a,this.analyticsManager=t}generateImageBlob(e,t){return this.getDownloadImageBlobPromiseFromPoster(this.poster,e).then(e=>{const t=e.rendition;return e.params.resampleTo?this.resampleImage(t,e.params.resampleTo):t}).then(e=>{if(!e)return l.a.reject(new Error("failed to get image"));if(t){const a=window.URL.createObjectURL(e),i=document.createElement("canvas"),n=P.getExportData(this.document);return i.width=n.width,i.height=n.height,Object(g.setFullCanvasToTransparent)(i,a,t).finally(()=>{window.URL.revokeObjectURL(a)})}return l.a.resolve(e)})}downloadImg({coreWrapper:e,mediaType:t,isWatermarkEnabled:a,docName:i,MarvelSettings:n,requestSaveMethod:o}){return this.getSetTransparencySelection(t).then(s=>{if("boolean"==typeof s){const r=e.getFullCanvasColor(),d=!!r;let h;return!d&&s&&(h=e.setBackgroundTransparency(0),a&&this.poster.setWatermark(!1)),(h||l.a.resolve()).then(()=>new Promise(e=>setTimeout(()=>e(),0))).then(()=>{const e=!(s||t&&"jpg"!==t);return this.generateAndDownloadImage(e?"jpg":"png",d&&s?r:null,i)}).then(()=>{s&&(e.setBackgroundTransparency(1).done(),this.poster.setWatermark(a)),this.analyticsManager.sendExportMetadataForDownload(this.document,n,o)})}})}downloadImgV2(e,t,a){return this.getSetTransparencySelection(a).then(i=>{"boolean"==typeof i&&Object(p.a)(e,t,a,i)})}downloadPDF(e,t,a){this.analyticsManager.sendExportMetadataForDownload(this.document,t,a),Object(c.a)(e,t)}downloadMP4(e,t,a,i,n){this.analyticsManager.sendExportMetadataForDownload(this.document,t,n),Object(h.a)(e,t,a,i)}publish(e,t){this.analyticsManager.sendExportMetadataForDownload(this.document,e,t),window.marvel.events.trigger("share-workflow-current-doc")}getSetTransparencySelection(e){let t;const a=this.document.firstPage.root.controller;if(a){const i=a.suggestTransparentBackground();t="png"===e&&i?this.transparentBackgroundOptionsModal("png"===e):t=l()(!1)}else t=l()(null),f.error("unable to getSetTransparencySelection: document has no root controller");return t}getDownloadImageBlobPromiseFromPoster(e,t){const a=P.getRenditionParams(this.document,t),n=Math.max(a.width,a.height);return n<1024&&(a.resampleTo=new i.TheoSize(a.width,a.height),a.width*=2,a.height*=2),l()(e.getRendition(a).then(e=>({params:a,rendition:e})))}transparentBackgroundOptionsModal(e){const t=l.a.defer(),a=new m.a({headerText:"i18n.dialogs.transparentBackground.kHeaderText",id:"transparentBGAlertModal",contentText:"",dismissable:!1,buttons:[{id:"transparentBGAlertTransparent",class:"pill pill-primary-on-light",label:"i18n.dialogs.transparentBackground.kPNGButtonLabel",onClick:()=>{d.default.publish("transparentBackgroundButtonPressed"),a.hide(),t.resolve(!0)}},{id:"transparentBGAlertSolid",class:"pill pill-primary-on-light",label:e?"i18n.dialogs.transparentBackground.kPNGSolidButtonLabel":"i18n.dialogs.transparentBackground.kJPEGButtonlabel",onClick:()=>{d.default.publish("solidBackgroundButtonPressed"),a.hide(),t.resolve(!1)}},{id:"transparentBGAlertCancel",class:"pill pill-secondary-on-light",label:"i18n.common.kCancel",onClick:()=>{d.default.publish("backgroundCancelButtonPressed"),a.hide(),t.resolve(null)}}]});return t.promise}generateAndDownloadImage(e,t,a){return this.generateImageBlob("jpg"===e?P.MIME_TYPES.jpg:P.MIME_TYPES.png,t).then(t=>{const i=`${a}.${e}`;if(!t)throw new Error("failed to get image");P.handleExportImageBlob(t,e,i)}).catch(e=>{f.error("downloadImg error",e)}).done()}resampleImage(e,t){const a=l.a.defer(),i=window.URL.createObjectURL(e),n=new Image;return n.onload=()=>{const i=document.createElement("canvas");i.width=t.width,i.height=t.height;const o=i.getContext("2d");if(o){o.scale(i.width/n.width,i.height/n.height),o.drawImage(n,0,0);const t=i.toDataURL(e.type),[s,r]=t.split(","),l=s.indexOf("base64")>=0?atob(r):unescape(r),d=new Uint8Array(l.length);for(let e=0;e<l.length;e+=1)d[e]=l.charCodeAt(e);const h=new Blob([d],{type:e.type});a.resolve(h)}else a.reject(new Error("Hm"))},n.onerror=e=>{a.reject(e)},n.src=i,a.promise.finally(()=>{window.URL.revokeObjectURL(i)})}}w(P,"MIME_TYPES",{jpg:"image/jpeg",png:"image/png"})},rquo:function(e,t,a){"use strict";a.r(t),a.d(t,"initWatermark",(function(){return h})),a.d(t,"checkWatermarkRemovalGrandfatherStatus",(function(){return c}));var i=a("GSfz"),n=a.n(i),o=a("MGCh"),s=a.n(o),r=a("8DU0"),l=a("HetE");const d=s.a.channel("controller");async function h(e,t,a,i,o){let s=!0,h=!1;const c=await e;o();const p=a.featureEnabled("entitle-brand-kit");s=!(a.featureEnabled("post-create-template-contentteam")||c||p)&&("remix"===t.operation||i.getWatermarkEnabledForDoc()),i.setWatermarkEnabledForDoc(s);try{h=await r.default.getSetting(n.a.keys.POST_WATERMARK_COACHMARK_DISMISSED),o()}catch(e){const t=e?e.message:"";if(t===l.RejectReason.STALE_SESSION)throw e;d.warn("Error fetching user settings for watermark coachmark.",t),h=!1}return{isWatermarkEnabled:s,dismissedWatermarkCoachmark:h}}function c(e){const t=r.default.getSetting(n.a.keys.POST_WATERMARK_UNLOCKED).catch(e=>{const t=e?e.message:"";return d.warn("Error fetching user settings for watermark status. Error: "+t,e),Promise.resolve(!1)}),a=e.loadFeatures();return Promise.all([t,a]).then(([t])=>{const a=e.featureEnabled("show-remove-branding-flow"),i=e.featureEnabled("remove-branding-enabled");return!t&&a&&i?(r.default.setSetting(n.a.keys.POST_WATERMARK_UNLOCKED,!0),!0):t})}},rx2z:function(e,t,a){"use strict";a.r(t);var i=a("2ofD"),n=a.n(i),o=a("3xm6"),s=a.n(o),r=a("Mbmg"),l=a("m5wp"),d=a("bBG2"),h=a("tpS0"),c=a.n(h),p=a("K7z8"),u=a("rJP3"),m=a("MGCh"),g=a.n(m),b=a("qcxC"),v=a("yiIM");const w=g.a.channel("save-utils");var f=new class{verifyAndSetCurrentDocumentExportedState(e,t){const a=e.getDataFromRoot("cp#isExported"),i=t.getIsExported();"boolean"==typeof i&&i!==a&&t.setIsExported(a)}checkImageFormaeForNull(e){for(const t of e)null==t.contentNode?w.error("saving image with no contentNode"):null==t.contentNode.url&&w.error("saving image with no url")}reloadIfNavigatedAway(){v.a.getLocationPathname().includes("/design/post/")||v.a.reload()}reload(e,t,a){a&&t&&t.cancelPendingSaves(),Object(b.a)().resolve(),v.a.reload()}waitForSaveDocumentToFinish(e,t,a=!0,i){const n="string"==typeof i?i:"i18n.app.kSavingPost";let o;a&&(o=new c.a({id:"WaitForSaveOverlay",headerText:n,contentText:'<div class="postspinner postspinner-large"></div>',dismissable:!1}),o.show());const s=setTimeout(()=>{t.triggerAssert("Save timed out, manually resolving save promise to unblock user"),e.resolve()},12e3);return e.promise.finally(()=>{clearTimeout(s),o&&o.hide()}),e.promise}},P=a("HetE");function T(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}let S;!function(e){e.UPDATE_CONFLICT="UPDATE_CONFLICT",e.VALIDATION_FAILED="VALIDATION_FAILED"}(S||(S={}));const k=g.a.channel("save-document");var I=new class{constructor(){T(this,"isSaving",!1),T(this,"hasPending",!1)}async save({currentDoc:e,stateID:t,coreWrapper:a,saveDocumentDeferred:i,saveCorePromise:n,postFeatureController:o,operation:s,editingMode:l,topBarUI:h,poster:m,templateNode:g}){let b,v,w,T;function I(e){e&&e.hide(),f.reload(i,a)}function C(){I(v)}function D(){I(w)}function y(){I(T)}function A(){T&&T.hide(),a.requestSave(!0),f.waitForSaveDocumentToFinish(i,a).then(f.reloadIfNavigatedAway)}function M(e){"code"in e&&e.code===S.UPDATE_CONFLICT?v=new c.a({id:"UpdateConflictDialog",headerText:"i18n.dialogs.saveFailedMergeConflict.kHeaderText",contentText:"i18n.dialogs.saveFailedMergeConflict.kContentText",dismissable:!1,buttons:[{id:"UpdateConflictRefreshButton",class:"pill pill-primary-on-light",label:"i18n.dialogs.saveFailedMergeConflict.kRefresh",onClick:C}]}):"code"in e&&e.code===S.VALIDATION_FAILED?w=new c.a({id:"ValidationFailedDialog",headerText:"i18n.dialogs.saveFailed.kHeaderText",contentText:"i18n.dialogs.saveFailed.kContentText",dismissable:!0,buttons:[{id:"ValidationFailedRefreshButton",class:"pill pill-primary-on-light",label:"i18n.dialogs.saveFailed.kRefresh",onClick:D}]}):T=new c.a({id:"GenericSaveFailedDialog",headerText:"i18n.dialogs.saveFailed.kHeaderText",contentText:"i18n.dialogs.saveFailed.kContentText",dismissable:!0,buttons:[{id:"GenericSaveFailedRefreshButton",class:"pill pill-primary-on-light",label:"i18n.dialogs.saveFailed.kRefresh",onClick:y},{id:"GenericSaveFailedRetryButton",class:"pill pill-secondary-on-light",label:"i18n.dialogs.saveFailed.kTryAgain",onClick:A}]})}if(a.validateDoc("saveBegin"),f.verifyAndSetCurrentDocumentExportedState(e,a),!a.validateDBSaveState(t))return this.isSaving=!1,(null==h?void 0:h.savingIndicator)&&(null==h||h.savingIndicator.hide()),n.reject(null),void M({code:S.VALIDATION_FAILED});const B=t;null==h||h.savingIndicator.show(),this.isSaving&&(this.hasPending=!0),this.isSaving=!0,window.performance.mark("spP:save-document-start"),b=window.performance.now(),d.default.publish("saveDocumentBegin"),e&&window.marvel.logger.beginTrackingFlow("saveProjectFromEditor",{sparkFormat:"post",projectId:e.id,projectUrn:e.getDCXComposite().assetId}),f.checkImageFormaeForNull(a.imageFormas()),r.b.pageUnloadBlockingBegin();let x,F;try{if(m&&(s===P.EditorOperations.EDIT_TEMPLATE||s===P.EditorOperations.NEW_TEMPLATE_FROM_TEMPLATE||o.featureEnabled("post-preview-image-disabled2")||(x=await m.getRendition({imageQuality:.94,width:1200})),F=await m.getRendition({imageQuality:.94,width:500})),l===P.EditingModes.TEMPLATE&&u.default.currentBrandKit()&&g&&await p.default.setUsedBrandElementsData(u.default.currentBrandKit(),g,a,!1),await a.saveWithRenditions(x,F,B),null==h?void 0:h.docNameInput){const e=null==h?void 0:h.docNameInput.getText();null==h||h.storeDocumentName(e)}const r=window.performance.now()-b;window.performance.measure("spP:save-document-complete","spP:save-document-start");const c={saveTimeElapsedMs:r,docId:e.id,previewImageSize:x instanceof Blob?x.size:null};x||delete c.previewImageSize,d.default.publish("saveDocumentEnd",c),this.isSaving=!1,e&&window.marvel.logger.endTrackingFlow("saveProjectFromEditor"),a.validateDoc("saveSuccess"),this.hasPending&&a.canSave()?(this.hasPending=!1,await this.save({currentDoc:e,stateID:t,coreWrapper:a,saveDocumentDeferred:i,saveCorePromise:n,poster:m,topBarUI:h,postFeatureController:o,operation:s,editingMode:l,templateNode:g})):((null==h?void 0:h.savingIndicator)&&(null==h||h.savingIndicator.hide()),n.resolve(null))}catch(e){this.isSaving=!1,E=e,(null==h?void 0:h.savingIndicator)&&(null==h||h.savingIndicator.hide()),k.error("Failed to save Post project",E),a.validateDoc("saveFail"),n.reject(E),M(E)}var E}};function C(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}t.default=class{constructor(e,t,a,i,n){this.coreWrapper=e,this.editingMode=t,this.operation=a,this.postFeatureController=i,this.templateNode=n,C(this,"saveDocumentDeferred",Object(b.a)()),C(this,"saveCorePromise",void 0),C(this,"topBarUI",void 0),C(this,"honorForceReload",!0),C(this,"poster",void 0),this.saveDocumentDeferred.resolve(),this.handleForceReloadRequest=this.handleForceReloadRequest.bind(this),this.handleUpdateSaveRequest=this.handleUpdateSaveRequest.bind(this),this.handlePlatformSaveTriggered=this.handlePlatformSaveTriggered.bind(this),this.cleanUpAfterSave=this.cleanUpAfterSave.bind(this),this.requestSave=this.requestSave.bind(this),this.waitForSaveToFinish=this.waitForSaveToFinish.bind(this),this.waitForQuietSaveToFinish=this.waitForQuietSaveToFinish.bind(this),this.resolveSaveDeferred=this.resolveSaveDeferred.bind(this),this.cancelPendingCoreSaves=this.cancelPendingCoreSaves.bind(this)}setComponents(e){this.poster=e.poster,this.topBarUI=e.topBarUI}handleForceReloadRequest(e){if(!this.honorForceReload)return;let t;this.honorForceReload=!1;const a=s.a.translate("dialogs.mustReloadEditor.kContentText");if(e){t=`<div class="error-modal-content">\n                <div><p><span>${a}</span></p>\n                <p><span>${s.a.translate("dialogs.mustReloadEditor.kFollowUpWithMessageText")}</span></p></div>\n                <div style="margin-top:1em"><span>${e}<span></div>\n                </div>`}else{t=`<div class="error-modal-content">\n                <p><span>${a}</span></p>\n                <p><span>${s.a.translate("dialogs.mustReloadEditor.kFollowUpGenericText")}</span></p></div>`}Object(l.b)(t,this.postFeatureController.featureEnabled("post-can-ignore-force-reload"),(()=>{r.b.pageUnloadBlockingEnd(),f.reload(this.saveDocumentDeferred,this.coreWrapper,!0)}).bind(this),(()=>{this.honorForceReload=!0}).bind(this))}handleUpdateSaveRequest(e){r.b.pageUnloadBlockingBegin();const t=Object(b.a)();e.finalized?t.resolve():e.then(t.resolve).fail(t.reject),this.saveDocumentDeferred=t}cleanUpAfterSave(){r.b.pageUnloadBlockingEnd()}handlePlatformSaveTriggered(e){this.saveCorePromise=e.coreDeferred;const{coreWrapper:t,saveDocumentDeferred:a,saveCorePromise:i,poster:o,topBarUI:s,postFeatureController:r,operation:l,editingMode:d,templateNode:h}=this;I.save({coreWrapper:t,saveDocumentDeferred:a,saveCorePromise:i,poster:o,postFeatureController:r,operation:l,editingMode:d,templateNode:h,topBarUI:s,currentDoc:n.a.currentDoc,stateID:e.stateID})}requestSave(e,t){this.coreWrapper.requestSave(e,t)}suspendSave(){this.coreWrapper.suspendSave()}resumeSave(){this.coreWrapper.resumeSave()}waitForSaveToFinish(e,t){return f.waitForSaveDocumentToFinish(this.saveDocumentDeferred,this.coreWrapper,e,t)}waitForQuietSaveToFinish(){const e=Object(b.a)();return this.saveDocumentDeferred.promise.finally(()=>{n.a.waitForQuiet().then(()=>e.resolve())}),e.promise}resolveSaveDeferred(){this.saveDocumentDeferred.resolve()}cancelPendingCoreSaves(){this.coreWrapper.cancelPendingSaves()}executePendingCoreSaves(){this.coreWrapper.executePendingSaves()}}},sjIh:function(e,t,a){"use strict";a.r(t);var i=a("2ofD"),n=a.n(i),o=a("pEL3"),s=a.n(o),r=a("+Ltv"),l=a.n(r);t.default=new class{constructor(){var e,t,a;a=void 0,(t="handlers")in(e=this)?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a}listenToMarvelEvents(e,t,a,i){this.unlistenToMarvelEvents(),this.createMarvelHandlers(e,t,i);const{events:n}=window.marvel,{onSaveTemplateRedirect:o,onTemplateRemoveEnterOnboarding:s,onCollabChangeUpdateStatus:r}=this.handlers;n.on("saved-composite-doc",o),n.on("document-collaboration-changed",r),a&&n.on("onboarding-premium-template-remove",s)}unlistenToMarvelEvents(){if(!this.handlers)return;const{events:e}=window.marvel,{onSaveTemplateRedirect:t,onTemplateRemoveEnterOnboarding:a,onCollabChangeUpdateStatus:i}=this.handlers;e.off("saved-composite-doc",t),e.off("onboarding-premium-template-remove",a),e.off("document-collaboration-changed",i),e.off("upgrade-view-closed")}createMarvelHandlers(e,t,a){this.handlers={onSaveTemplateRedirect(){if(e&&e.newTemplateId){const t=`design-edit-template/post/${e.contextId}/${e.newTemplateId}`;window.marvel.navigate(t,{trigger:!1,replace:!0})}},onTemplateRemoveEnterOnboarding:()=>{l.a.inPremiumTemplateOnboardingFlow=!0,function(e){e.premiumTemplateTextTooltip=new s.a({parent:"PostApp",id:"textTooltip",message:"i18n.components.coachmarks.premiumText.kMessage",arrowDirection:"left",showCloseButton:!1,anchorElement:e.designSurface.imageWrapper,height:"auto",width:130,offsetY:250,offsetX:5,priority:1,hidden:!0}),e.premiumTemplateTextTooltip.show()}(t)},onCollabChangeUpdateStatus(e){if(n.a.currentDoc===e.composite){const{collaborators:i,invitations:o}=e.collab,s=i.length+o.length>0;a(s),t.brandIndicator&&t.brandIndicator.update({collaborationStatus:n.a.currentDoc.getCollaboration()||"NONE"})}}}}}}}]);
//# sourceMappingURL=theo-web-view_9afe0381-3672f58f.js.map