(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[73],{"1geK":function(e,t,r){"use strict";r.r(t);var o=r("wHG3"),n=r("ApVh"),s=r.n(n),i=r("Uwho"),a=r.n(i),c=r("UFvF"),l=r.n(c),u=r("lulf"),d=r("MGCh"),p=r.n(d),h=r("65r0");function g(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const{GraphTransportUtils:m}=o.PixiJSApp,f=new u.default,b=p.a.channel("web-animation-snapi");class y extends Error{constructor(...e){super(...e),g(this,"response",void 0)}}const v=new class{constructor(){g(this,"endpoint","https://"+a.a.postsnapi),g(this,"invocationMode","async"),f.loadFeatures().then(()=>{(f.featureEnabled("post-use-new-postsnapi-server")||Object(h.b)())&&(this.endpoint="https://"+a.a.postsnapi2,this.invocationMode="sync")})}getEtag(e){const t=`https://${a.a.ss}/assets/adobe-theo/${e}/manifest`,r=l.a.defer();return s.a.ajax({url:t,type:"GET",headers:{"x-api-key":a.a.key},success:(t,o,n)=>(b.debug(`snapi: get etag succeeded [projectId: ${e}]`),r.resolve(n.getResponseHeader("ETag"))),error:(t,o,n)=>(b.error(`snapi: error - fail to get etag, [projectId: ${e}], [message: ${o}], [error: ${n}], [response: ${JSON.stringify(t,null,2)}]`),r.reject(t))}),r.promise}pollUntilReady(e,t,r,o,n,i,c){if(!r){const t=new Error("called without full xhr");return b.error(`snapi: error - polling 1 [requestId: ${i}], [error:${t}]`),e.reject(t)}if(200===r.status){let s;if("object"==typeof t)s=t;else try{s=JSON.parse(t.replace(/^[^{]*/,""))}catch(t){return b.error(`snapi: error - polling 2 [requestId: ${i}], [error:${t}]`),e.reject(t)}if(s["error-response"]){const t=new y("poll returned error from server: "+JSON.stringify(s));return b.error(`snapi: error - polling 3 [requestId: ${i}], [error: ${t}]`),t.response=s,e.reject(t)}return o&&"function"==typeof c&&c("progress",100,n),s.xRequestId=r.getResponseHeader("x-request-id"),e.resolve(s)}if(202!==r.status){const t=new Error("unexpected status in poll "+r.status);return b.error(`snapi: error - polling 4 [requestId: ${i}], [status: ${r.status}], [error: ${t}]`),e.reject(t)}let u;if(t.href)u=t;else try{u=JSON.parse(t)}catch(t){return b.error(`snapi: error - polling 5 [requestId: ${i}], [error: ${t}]`),e.reject(t)}if(!u||!u.href){const t=new Error("publish failed: "+r.response);return b.error(`snapi: error - polling 6 [requestId: ${i}], [error: ${t}]`),e.reject(t)}const d=u.progress;let p;try{p=r.getResponseHeader("retry-after"),isNaN(p)&&(p=5)}catch(e){p=5}p=1,o&&"function"==typeof c&&c("progress",d,n);const h=u.href,g=this;return l.a.delay(1e3*p).then(()=>{s.a.ajax({url:`${this.endpoint}/${h}`,type:"GET",headers:{"x-api-key":a.a.cid,"x-request-id":i},success(t,r,s){i!==s.getResponseHeader("x-request-id")&&b.warn(`snapi: warn - polling 7 [message: x-request-id mismatch] [expected:${i}, got:${s.getResponseHeader("x-request-id")}]`),b.debug(`snapi: polling... [requestId:${i}], [response: ${JSON.stringify(t,null,2)}]`),g.pollUntilReady(e,t,s,o,n,i,c)},error:(t,r,o)=>(b.error(`snapi: error - polling 8 [href: ${h}], [requestId: ${i}], [message: ${r}], [error: ${o}], [response:${JSON.stringify(t,null,2)}]`),e.reject(t))})}),e.promise}sendPgmPublishRequestImpl(e,t,r,o,n){const i=this;return this.getEtag(t).then(c=>{const u=l.a.defer();return s.a.ajax({type:"POST",url:e,dataType:"json",headers:{"Content-Type":"application/json","x-project-etag":c,"x-api-key":a.a.cid},data:JSON.stringify(r),success(e,r,s){const a=s.getResponseHeader("x-request-id");b.debug(`snapi: about to poll [requestId:${a}], ${JSON.stringify(e,null,2)}`),n&&(n.value=a),i.pollUntilReady(u,e,s,!0,t,a,o)},error:(t,r,o)=>(b.error(`snapi: error - send pgm publish failed, response: ${JSON.stringify(t,null,2)}, message: ${r}, error: ${o}, snapiUrl: ${e}`),u.reject(t))}),u.promise})}getPgmGraphForPublish(e){if(!e)return null;e.generateKeyFrames();const t=e.getGraph(!0);if(t.duration<=0)return b.warn("Zero PGM duration"),null;return m.convertAllLocalCompositeToExternalCC(t,e.documentId())||null}sendPgmPublishRequestForUpload(e,t,r,o,n){const s=`${this.endpoint}/project/${e}/pgmpublish?invocation_mode=${this.invocationMode}&partial=1&pubType=1&cpDest=${t}`;return this.sendPgmPublishRequestImpl(s,e,r,n,o)}sendPgmPublishRequestForDownload(e,t,r){const o=`${this.endpoint}/project/${e}/pgmpublish?invocation_mode=${this.invocationMode}&partial=3&pubType=1`;return this.sendPgmPublishRequestImpl(o,e,t,r,null)}getPublishRequestBody(e){const t=e.publishTitle||"",r=e.authorFull||"",o=!e.isPublic;return{metadata:{title:t,custom:{author:r,sub_title:"",removeBranding:!!e.removeBranding},sub_category_ids:["other"],category_id:"theos",undiscoverable:o},update:!1,options:{withoutBranding:!!e.removeBranding}}}};t.default=v},"2PxR":function(e,t,r){"use strict";r.r(t),r.d(t,"IMAGE_SOURCES",(function(){return c})),r.d(t,"getImageMediaMetadata",(function(){return l}));var o=r("UzQk"),n=r.n(o);function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}let c;function l(e,t=!1){let r={};if(e){let t="unknown",o="unknown";const n={};e.source&&e.source.name&&(e.source.name===c.STOCK?t="adobestock":e.source.name===c.UNSPLASH||e.source.name===c.PIXABAY||e.source.name===c.NOUN?t="dooplo":e.source.name===c.CCL?t="ccl":e.source.name===c.CCLIGHTDESIGNASSETS&&(t="cclight"),e.source.name===c.NOUN?o=e.id:e.source.name===c.CCL?o=e.assetID:e.image_id?o=e.image_id.toString():e.id&&(o=e.id),e.source.name===c.CCL?n.ccl={created_date:e.created_date,modified_date:e.modified_date,library_id:e.albumId,library_name:e.albumName}:e.source.name===c.CCLIGHTDESIGNASSETS&&(n.cclight={search_props:e.searchProps,created_date:e.created_date,modified_date:e.modified_date,design_intent:e.design_intent})),r={source:t,search:e.searchText,rootProperties:i({license:{asset_id:o,owner:e.owner?e.owner.name:"unknown",photo_name:e.title,source_name:e.source?e.source.name:"unknown",source_url:e.context?e.context.href:"unknown",tags:e.tags instanceof Array?e.tags.join(","):"",type:e.license?e.license.short_name:"unknown"}},n)}}const o=n.a.MediaMetadata.fromProperties(r);return o&&t&&(o.designIntent=n.a.MediaMetadata.DESIGNINTENT_LOGO),o}!function(e){e.STOCK="Adobe Stock",e.UNSPLASH="Unsplash",e.PIXABAY="pixabay",e.NOUN="The Noun Project",e.CCL="Creative Cloud Libraries",e.CCLIGHTDESIGNASSETS="CC Light Design Assets"}(c||(c={}))},"5d+0":function(e,t,r){"use strict";r.r(t),r.d(t,"ShortcutConstants",(function(){return o}));const o={kConfirmText:"confirmText",kRotation:"rotation",kSendForward:"sendForward",kSendToFront:"sendToFront",kSendBackward:"sendBackward",kSendToBack:"sendToBack",kDuplication:"duplication",kGroup:"group",kUngroup:"ungroup",kNudge:"nudge",kMarqueeSelect:"marqueeSelect",kMultiselect:"multiselect",kDeselectAll:"deselectAll",kSelectAll:"selectAll",kRedo:"redo",kUndo:"undo",kExitSpecialSelectionMode:"exitSpecialSelectionMode",kSelectSibling:"selectSibling",kSelectParent:"selectParent",kSelectChild:"selectChild",kActualSize:"actualSize",kFitToView:"fitToView",kFillToView:"fillToView",kZoomOut:"zoomOut",kZoomIn:"zoomIn",kPanView:"panView",kPanKey:"panKey",kZoomInKey:"zoomInKey",kZoomOutKey:"zoomOutKey"}},"8DU0":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return i}));var o=r("ApVh"),n=r.n(o);function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class i{static getSetting(e){return new Promise((t,r)=>{i.hasSetting(e)?t(i.settings[e]):i.getSettings().then(r=>{i.settings=r,t(i.settings[e])}).catch(e=>{r(e)})})}static setSetting(e,t){return e?void 0===t?Promise.reject(new Error("UserSettings: cannot set setting to an undefined value")):(i.settings[e]=t,new Promise((r,o)=>{n.a.getAccessToken().then(n=>{const s=i.apiEndPoint+encodeURIComponent(e),a={headers:{Authorization:"Bearer "+n,"Content-Type":"application/json;charset=UTF-8"},method:"PUT",body:JSON.stringify({value:t})};fetch(s,a).then(t=>{t.ok?r(t):o(new Error(`UserSettings: Error trying to set key=${e}: [${t.status}] ${t.statusText}`))}).catch(o)})})):Promise.reject(new Error("UserSettings: cannot set an undefined key"))}static hasSetting(e){return void 0!==i.settings[e]}static getSettings(){return i.getSettingsPromise&&i.promiseResolved||(i.getSettingsPromise=new Promise((e,t)=>{n.a.getAccessToken().then(r=>{const o={headers:{Authorization:"Bearer "+r}};fetch(i.apiEndPoint,o).then(r=>{if(r.ok)e(r.json()),i.promiseResolved=!0;else{const e=new Error(`UserSettings: Error trying to get settings: [${r.status}] ${r.statusText}`);t(e)}}).catch(e=>{t(e)})})})),i.getSettingsPromise}}s(i,"apiEndPoint","/api/post/v1/usersettings/"),s(i,"getSettingsPromise",void 0),s(i,"settings",{}),s(i,"promiseResolved",!1)},"8Jtx":function(e,t,r){"use strict";async function o(e,t){let r=null;const o=new Promise((e,o)=>{r=setTimeout(()=>{o(new Error(`Request timed out after ${t} ms.`))},t)});try{return await Promise.race([e,o])}finally{r&&clearTimeout(r)}}r.r(t),r.d(t,"resolvePromiseOrTimeout",(function(){return o})),t.default=o},"9SnX":function(e,t,r){var o,n;o=[r("ApVh"),r("xeH2"),r("UFvF"),r("Uwho"),r("MGCh"),r("Pbp+"),r("lulf"),r("bBG2")],void 0===(n=function(e,t,r,o,n,s,i,a){const c=a.default;var l={},u=n.channel("design-variations");return l.getVariations=function(n,s){return function(n){const s=r.defer(),i=performance.now();return e.getAccessToken().then(e=>{t.ajax({type:"POST",url:o.designVariationsServiceV2Endpoint+"/suggestions",contentType:"application/json",data:JSON.stringify(n.metadata),dataType:"json",headers:{Authorization:"Bearer "+e,"x-api-key":o.cid}}).fail((function(e,t){u.error("Failed to fetch response from Design Variations Service V2"),s.reject(t)})).done((function(e){const t=performance.now()-i;u.info("Design Variations Service V2 response in: "+t),c.publish("designVariationsServiceV2Used",{contextualData1:t}),s.resolve(e)}))}),s.promise}(n)},l}.apply(t,o))||(e.exports=n)},Dcjk:function(e,t,r){var o;void 0===(o=function(){var e=window.navigator.userAgent;return e.indexOf("Trident/")>0?11:e.indexOf("MSIE ")>0?10:e.indexOf("Edge/")>0&&12}.apply(t,[]))||(e.exports=o)},Dvuo:function(e,t,r){var o,n;o=[r("3xm6"),r("UzQk")],void 0===(n=function(e,t){var r={numberStringForValue:function(e,r){const o=t.PageFacade.getNumDecimalPlacesForUnits(r);return t.Host.locale.formatNumber(e,o)},getUnitsOptionString:function(){for(var e=[],o=t.PageExportFormat.PIXELS;o<=t.PageExportFormat.INCHES;o++)e.push(r.getUnitsStringForFormat(o));var n="";return e.forEach((function(e){n+="<option>"+e+"</option>"})),n},getUnitsStringForFormat:function(r){var o;switch(r){case t.PageExportFormat.PIXELS:o=e.translate("forms.custom-size.kPixelsAbbr");break;case t.PageExportFormat.MILLIMETERS:o=e.translate("forms.custom-size.kMillimetersAbbr");break;case t.PageExportFormat.INCHES:o=e.translate("forms.custom-size.kInchesAbbr");break;default:log.assert(!1,"invalid units format: "+r),o="px"}return o},currentUnitToPixels:function(e,r,o,n){var s=t.PageFacade.unitsToPixelsFactor(o,n);return new t.TheoSize(e*s,r*s)},pixelsToCurrentUnit:function(e,r,o,n){var s=t.PageFacade.unitsToPixelsFactor(o,n);return new t.TheoSize(e/s,r/s)}};return r}.apply(t,o))||(e.exports=n)},EUgP:function(e,t,r){"use strict";r.d(t,"a",(function(){return j}));var o=r("KpqY"),n=r("qcxC"),s=r("MOGj"),i=r.n(s);async function a(e,t,r,o){const s=Object(n.a)();return i.a.AdobeDCXCompositeXfer.uploadComponent(e,t,r,o,async(t,o)=>{if(t)throw t;r.current.updateComponentWithUploadResults(e,o),s.resolve(r)}),s.promise}async function c(e,t,r,o,s,a,c,l){const u=Object(n.a)();return i.a.AdobeDCXCompositeXfer.uploadNewComponent(t,r,c,e,l,async(e,t)=>{if(e)throw e;c.current.addComponentWithUploadResults(o,s,a,c.current.rootNode,t),u.resolve(c)}),u.promise}var l=r("j5+N"),u=r.n(l),d=r("UzQk"),p=r.n(d),h=r("uTW7"),g=r("14LO"),m=r("3xm6"),f=r.n(m),b=r("MGCh"),y=r.n(b),v=r("ApVh"),P=r.n(v),w=r("Uwho"),C=r.n(w),S=r("tY4j"),k=r.n(S),x=r("1geK"),F=r("2ofD"),T=r.n(F);let E;!function(e){e[e.FAILED=0]="FAILED",e[e.IN_PROGRESS=1]="IN_PROGRESS",e[e.PASSED=2]="PASSED"}(E||(E={}));const D=["Other"],A=window.location.protocol,I=window.location.host.includes("local.adobeprojectm.com")?A+"//dev.adobeprojectm.com":`${A}//${window.location.host}`;function R(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const U=y.a.channel("modules:util:cp-publisher");class j{constructor(e){R(this,"apiKey",void 0),R(this,"communitySession",void 0),R(this,"coreWrapper",void 0),R(this,"currentJob",void 0),R(this,"waitForQuietSaveToFinish",void 0),R(this,"getDocumentRendition",void 0),R(this,"storageSession",void 0),this.currentJob={progress:{localCompositeCreated:!1,localCompositeBound:!1,localCompositeTransformed:!1,compositeCopyPushed:!1,compositePublished:!1,sourceDocumentUpdatedWithPublishData:!1,remixURLCreated:!1,publishedCompositeUpdated:!1}},this.apiKey=C.a.key,this.coreWrapper=e.coreWrapper,this.waitForQuietSaveToFinish=e.waitForQuietSaveToFinish,this.getDocumentRendition=e.getDocumentRendition,this.storageSession=i.a.dcxSession,this.communitySession=i.a.dcx.createCommunitySession(i.a.dcxService,`${A}//${C.a.cps}`)}async publishDoc(e){const{associatedCategories:t,categories:r,keyTerms:o,language:n,title:s,useCases:a}=e;if(this.currentJob.status=E.IN_PROGRESS,T.a.currentDoc.isPublished()){U.error("[publishDoc] Republishing currently not supported.");const e=E.FAILED;return this.currentJob.status=e,this.resetPublisher(),Promise.reject({status:e,errorMessage:f.a.translate("app.templatePublisher.templateRepublishFailure.kContentText")})}const c="/pubs/"+i.a.AdobeDCXUtil.generateUuid();this.currentJob.compositeCopy=await this.copyAndTransformComposite(T.a.currentDoc.getDCXComposite(),c),this.currentJob.alias=await this.reserveAliasWithRetry();const l=this.getRemixData(),u=this.getPublicationRecord(t,r,this.currentJob.compositeCopy,o,n,c,s,a),d=this.getMachineTags(t),p=await this.publishComposite(u,l,d);return this.resetPublisher(),p}async copyAndTransformComposite(e,t){const r=this.copyComposite(e);this.currentJob.progress.localCompositeCreated=!0;const o=await this.createCompositeCopy(r,t);this.currentJob.progress.localCompositeBound=!0;const n=await this.transformCompositeBeforePublish(o);this.currentJob.progress.localCompositeTransformed=!0;const s=await this.pushCompositeCopy(n);return this.currentJob.progress.compositeCopyPushed=!0,s}copyComposite(e){return i.a.AdobeDCXComposite.newCompositeAsCopyOf(e,e.current.name,e.current.type)}async createCompositeCopy(e,t){try{return await async function(e,t,r,o){const s=Object(n.a)();return i.a.AdobeDCXCompositeXfer.createComposite(e,t,r,o,async(t,r)=>{if(t)throw t;s.resolve(e)}),s.promise}(e,t,!1,this.storageSession)}catch(e){U.error("[createCompositeCopy] Unable to create composite copy.",e);const t=E.FAILED;return this.currentJob.status=t,await this.handleFailure(),Promise.reject({status:t,errorMessage:f.a.translate("app.templatePublisher.templatePublishFailure.contentText.kCreateCompositeCopyFailure")})}}async transformCompositeBeforePublish(e){const t=await this.setUsageReportedFlagsToFalse(e),r=this.getComponentIdForPreview(t)?t:await this.addPreviewImageToComposite(t),o=this.coreWrapper.hasAnimationStyle()?await this.addVideoRenditionToComposite(r):r;return await this.clearCompositeCopyPublishData(o)}async setUsageReportedFlagsToFalse(e){const t=new g.DCXDocumentComposite({composite:e}),r=t.current;if(r&&p.a.DocumentPersistenceFactory.usesJsonDocumentEncoding(r)){const t=p.a.JSONDocumentDecoder.getRequiredSynchronousComponents(r);await Promise.all(t.map(async t=>{const o=await i.a.getComponent(t,e),n=JSON.parse(o);r.registerContentForComponent(t,n)}))}const n=p.a.TheoDocument.decodeDocument(t,e=>{throw r.releaseRegisteredContent(),e});try{r&&r.releaseRegisteredContent(),n.history.postEntry("open,src=CC,was-vers="+n.versionDecoded.rawValue);const e=o.default.beginTransaction(n,"updatePublishData");n.content.root.visitAll(e=>{e instanceof p.a.VectorContentNode&&e.isUsageReported()&&e.setUsageReported(!1)}),o.default.endTransaction(e,!0);const s=new h.DCXDocumentBranch({branch:t.dcxComposite.current}),i=p.a.DocumentPersistenceFactory.encoderFor(s);n.encode(i),i.finish();const c=s.getDeferredComponents().find(e=>"dom"===e.relationship);if(!c)throw new Error("[setUsageReportedFlagsToFalse] Failed to find deferred DOM Component.");const l=c.content,u=t.dcxComposite,d=u.current.getComponentWithId(c.componentId);if(!d)throw new Error(`[setUsageReportedFlagsToFalse] Failed to find DOM Component with id: ${c.componentId}.`);return await a(d,JSON.stringify(l),u,this.storageSession)}catch(e){U.error("[setUsageReportedFlagsToFalse] Failed to update usage reported to no where applicable.",e);const t=E.FAILED;return this.currentJob.status=t,await this.handleFailure(),Promise.reject({status:t,errorMessage:f.a.translate("app.templatePublisher.templatePublishFailure.contentText.kUpdateUsageReportedFailure")})}}getComponentIdForPreview(e){let t;const r=this.getPreviewComponent(e);return r?t=r.id:e.current.getComponentWithId("preview")&&(t="preview"),t}getPreviewComponent(e){var t,r;const o=null!==(t=e.current)&&void 0!==t?t:{},n=(null!==(r=o.rootNode)&&void 0!==r?r:{}).absolutePath,s=n&&"/"!==n?n+"/preview.jpg":"/preview.jpg";return o.getComponentWithAbsolutePath(s)}async addPreviewImageToComposite(e){try{const t=1200,r=.94,o=await this.getDocumentRendition({imageQuality:r,width:t});if(!o)throw new Error("[addPreviewImageToComposite] Failed to generate preview rendition.");const n=i.a.AdobeDCXUtil.generateUuid();return await c(n,o,"image/jpeg","preview.jpg","rendition","preview.jpg",e,this.storageSession)}catch(e){U.error("[addPreviewImageToComposite] Failed to upload preview rendition component.",e);const t=E.FAILED;return this.currentJob.status=t,await this.handleFailure(),Promise.reject({status:t,errorMessage:f.a.translate("app.templatePublisher.templatePublishFailure.contentText.kAddPreviewRenditionFailure")})}}async addVideoRenditionToComposite(e){const t=await this.downloadVideoRendition(),r=await this.addOrUpdateVideoRendition(e,t.fileBlob),o=r.current.getComponentWithId("videoRendition");return await this.setVideoRenditionMetadata(r,o,t)}async downloadVideoRendition(){const e=this.coreWrapper.getDocument().id,t=x.default.getPgmGraphForPublish(this.coreWrapper);if(!t){U.error("[downloadVideoRendition] PGM Graph for document is undefined. documentId:"+e);const t=E.FAILED;return this.currentJob.status=t,await this.handleFailure(),Promise.reject({status:t,errorMessage:f.a.translate("app.templatePublisher.templatePublishFailure.contentText.kDownloadVideoRenditionFailure")})}const r=x.default.getPublishRequestBody({publishTitle:"",authorFull:"",isPublic:!0,removeBranding:!1});r.pgmGraph=t.encode();const o=t.bounds.aspectRatio,n=o<1?1280:Math.round(1280/o),s=o<1?Math.round(1280*o):1280;r.renderOptions={videoHeight:n,videoWidth:s,scaleType:0};const i=(await x.default.sendPgmPublishRequestForDownload(e,r,(e,t,r)=>{"progress"===e&&100===t&&U.info("Video rendition download completed.")})).downloadUrl,a=await P.a.getAccessToken(),c={headers:{"X-Api-Key":this.apiKey,Authorization:"Bearer "+a}};return fetch(i,c).then(e=>{if(!e.ok)throw new Error(`[downloadVideoRendition] Failed to download video at URL:${i}. [${e.status}] ${e.statusText}`);return e.blob()}).then(e=>Promise.resolve({fileBlob:e,videoHeight:n,videoWidth:s})).catch(async e=>{U.error(`[downloadVideoRendition] Failed to download video at URL:${i}. Error: ${e.message}`);const t=E.FAILED;return this.currentJob.status=t,await this.handleFailure(),Promise.reject({status:t,errorMessage:f.a.translate("app.templatePublisher.templatePublishFailure.contentText.kDownloadVideoRenditionFailure")})})}async addOrUpdateVideoRendition(e,t){const r=e.current.getComponentWithId("videoRendition");try{let o;return o=r?await a(r,t,e,this.storageSession):await c("videoRendition",t,"video/mp4","videoRendition","rendition","videoRendition.mp4",e,this.storageSession),o}catch(e){U.error("[addOrUpdateVideoRendition] Failed to add or update video rendition component.",e);const t=r?"app.templatePublisher.templatePublishFailure.contentText.kUpdateVideoRenditionFailure":"app.templatePublisher.templatePublishFailure.contentText.kCreateVideoRenditionFailure",o=E.FAILED;return this.currentJob.status=o,await this.handleFailure(),Promise.reject({status:o,errorMessage:f.a.translate(t)})}}async setVideoRenditionMetadata(e,t,r){try{const{fileBlob:o,videoHeight:n,videoWidth:s}=r;t.width=s,t.height=n,t.name="videoRendition";return await a(t,o,e,this.storageSession)}catch(e){U.error("[setVideoRenditionMetadata] Failed to update video rendition component with video metadata.",e);const t=E.FAILED;return this.currentJob.status=t,await this.handleFailure(),Promise.reject({status:t,errorMessage:f.a.translate("app.templatePublisher.templatePublishFailure.contentText.kAddVideoRenditionMetadataFailure")})}}async clearCompositeCopyPublishData(e){return e.current.rootNode.removeValue("cp#projectId"),e.current.rootNode.removeValue("cp#shortId"),e.current.rootNode.removeValue("cp#assetId"),e.current.rootNode.removeValue("cp#publishedEtag"),e.current.rootNode.removeValue("theo#cp-discoverable"),e}async pushCompositeCopy(e){try{return await async function(e,t,r){const o=Object(n.a)();return i.a.AdobeDCXCompositeXfer.pushComposite(e,t,r,async(t,r)=>{if(t)throw t;o.resolve(e)}),o.promise}(e,!1,this.storageSession)}catch(e){U.error("[pushCompositeCopy] Unable to push composite copy.",e);const t=E.FAILED;return this.currentJob.status=t,await this.handleFailure(),Promise.reject({status:t,errorMessage:f.a.translate("app.templatePublisher.templatePublishFailure.contentText.kPushCompositeCopyFailure")})}}async reserveAliasWithRetry(){const e=k()(this.reserveAlias.bind(this),{maxAttempts:3});try{return await e()}catch(e){const t=E.FAILED;return this.currentJob.status=t,await this.handleFailure(),Promise.reject({status:t,errorMessage:f.a.translate("app.templatePublisher.templatePublishFailure.contentText.kReserveAliasFailure")})}}async reserveAlias(){const e=`${A}//${C.a.cps}/api/v2/theo/alias/`,t=await P.a.getAccessToken(),r={headers:{"X-Api-Key":this.apiKey,Authorization:"Bearer "+t},method:"POST"};return fetch(e,r).then(e=>{if(!e.ok)throw new Error(`[reserveAlias] Error reserving alias: [${e.status}] ${e.statusText}`);return e.json()}).then(e=>e.alias).catch(e=>{U.error("[reserveAlias] Unable to fetch published template to perform updates. Error: "+e.message,e);const t=new Error("[reserveAlias] "+e.message);return Promise.reject(t)})}getRemixData(){const e=i.a.dcx.createRemixData();return e.originURL=`${A}//${C.a.cps}/api/v2/theo/assets/${this.currentJob.alias}`,e.licenseType="by-nc",e}getPublicationRecord(e,t,r,o,n,s,a,c){var l;const u=this.getMetadata(r),d=this.getTags(e,t,o,n,c),p=null!==(l=this.coreWrapper.getCurrentDocumentDescription())&&void 0!==l?l:"",h=i.a.dcx.createCommunityPublicationRecord();return h.communityId="theo",h.title=a,h.description=p,h.alias=this.currentJob.alias,h.discoverable=!0,h.tags=d,h.categoryId="Theos",h.subCategoryIds=D,h.custom=u,h.resourcePath=s,h.artworkComponentId=this.getComponentIdForPreview(r),h}getMetadata(e){var t,r;const o={remixable:!0,creator:"theo",documentFormatVersion:p.a.TheoDocument.CURRENT_VERSION,sparkTemplate:!0,publishOrigin:"web"},n=(null!==(t=this.getPreviewComponent(e))&&void 0!==t?t:{}).etag;n&&(o.contentEtag=n);const s=null!==(r=window.adobeIMS.getUserProfile().displayName)&&void 0!==r?r:f.a.translate("app.templatePublisher.kAccountUnknownLabel");return o.author=s,o}getTags(e,t,r,o,n){const s=[];return e.forEach(e=>{"remixpaid"!==e&&"remixanimation"!==e&&"remixpending"!==e||s.push(e)}),t.forEach(e=>{s.push("explore-"+e)}),r.forEach(e=>{s.push("spterm-"+e)}),s.push("sploc-"+o),n.forEach(e=>{s.push("spcase-"+e)}),s}getMachineTags(e){const t=["remixable"];return e.includes("remixpending")&&t.push("remixpending"),t}async publishComposite(e,t,r){const o=Object(n.b)();try{return i.a.AdobeCommunityPlatform.publishCompositeAlreadyPushedToPubs(this.currentJob.compositeCopy,e,t,"theo",this.communitySession,async(t,n)=>{if(t)throw t;{this.currentJob.progress.compositePublished=!0;const t=await this.publishSuccessHandler(r,e.tags);o.resolve(t)}}),o.promise}catch(e){return this.publishFailureHandler(e)}}async publishSuccessHandler(e,t){let r;if(!this.currentJob.alias||!this.currentJob.compositeCopy)return U.error("[publishSuccessHandler] alias and/or compositeCopy is undefined"),r=E.FAILED,this.currentJob.status=r,await this.handleFailure(),Promise.reject({status:r,errorMessage:f.a.translate("app.templatePublisher.templatePublishFailure.contentText.kPublishFailure")});const o=await this.fetchAssetWithRetry(this.currentJob.alias),n=await this.generateBranchURLString(o),s=n&&""!==n?n:this.getURLforPost(this.currentJob.alias,!0);return this.currentJob.progress.remixURLCreated=!0,await this.updateAssetWithRetry(o,n,e,t),this.currentJob.progress.publishedCompositeUpdated=!0,await this.updateCompositeWithPublishData(this.currentJob.compositeCopy,o),this.currentJob.progress.sourceDocumentUpdatedWithPublishData=!0,r=E.PASSED,this.currentJob.status=r,Promise.resolve({status:r,remixURL:s})}async fetchAssetWithRetry(e){const t=k()(this.fetchAsset.bind(this),{maxAttempts:3});try{return await t(e)}catch(e){const t=E.FAILED;return this.currentJob.status=t,await this.handleFailure(),Promise.reject({status:t,errorMessage:f.a.translate("app.templatePublisher.templatePublishFailure.contentText.kFetchAssetFailure")})}}async fetchAsset(e){const t=`${A}//${C.a.cps}/api/v2/theo/assets/${e}`,r=await P.a.getAccessToken(),o={headers:{"X-Api-Key":this.apiKey,Authorization:"Bearer "+r},method:"GET"};return fetch(t,o).then(e=>{if(!e.ok)throw new Error(`[fetchAsset] Error fetching published template: [${e.status}] ${e.statusText}`);return e.json()}).catch(t=>{U.error("[fetchAsset] Unable to fetch published template to perform updates. Error: "+t.message,t);const r=new Error(`[fetchAsset] ${t.message} for ${e}`);return Promise.reject(r)})}async generateBranchURLString(e){const t=`${I}/sp/design-remix/post/${e.alias}`,r=e._links.rendition.href.replace("{format}","jpg").replace("{dimension}","width").replace("{size}","1200"),o={campaign:"seodefaulttask",channel:"seolandingpagetemplates",feature:"userGeneratedRemixablePostFeature",data:{$marketing_title:"seoautogenerated",$desktop_url:t,remixable_post_cpid:e.alias,$og_title:f.a.translate("app.templatePublisher.branchIOData.kBranchIODescription"),$og_description:f.a.translate("app.templatePublisher.branchIOData.kBranchIOTitle"),$canonical_url:t,$canonical_identifier:t}};return r&&(o.data.$og_image_url=r),u.a.link(o).catch(t=>(U.error(`[generateBranchURLString] Failed to generate branchURL for ${e.alias}. Error: ${t.message}`,t),Promise.resolve("")))}getURLforPost(e,t){let r="";if(t){const e=new Date("2001-01-01T00:00:00.000Z");r="?w="+10*((new Date).getTime()-e.getTime())}return`${I}/post/${e}${r}`}async updateAssetWithRetry(e,t,r,o){const n=k()(this.updateAsset.bind(this),{maxAttempts:3});try{return await n(e,t,r,o)}catch(e){const t=E.FAILED;return this.currentJob.status=t,await this.handleFailure(),Promise.reject({status:t,errorMessage:f.a.translate("app.templatePublisher.templatePublishFailure.contentText.kUpdateAssetFailure")})}}async updateAsset(e,t,r,o){const{alias:n,custom:s}=e,i=`${A}//${C.a.cps}/api/v2/theo/assets/${n}`,a=await P.a.getAccessToken();t&&""!==t&&(s.branchURL=t);const c={custom:s,tags:o,machine_tags:r,sub_category_ids:D},l={body:JSON.stringify(c),headers:{"X-Api-Key":this.apiKey,"Content-Type":"application/json",Authorization:"Bearer "+a},method:"PUT"};return fetch(i,l).then(e=>{if(!e.ok)throw new Error(`[updateAsset] Error updating published template: [${e.status}] ${e.statusText}`)}).catch(e=>{U.error("[updateAsset] Unable to update published template with branch URL and other metadata. Error: "+e.message,e);const t=new Error(`[updateAsset] ${e.message} for ${n}`);return Promise.reject(t)})}async updateCompositeWithPublishData(e,t){var r;const o=t.resource_path,n=t.id,s=t.alias,i=(null!==(r=this.getPreviewComponent(e))&&void 0!==r?r:{}).etag||"";this.coreWrapper.updatePublishData({cPProjectID:o,cPAlias:s,cPAssetID:n,cPublishedEtag:i}),T.a.currentDoc.saveChanges(e=>{e.setValue("cp#projectId",o),e.setValue("cp#shortId",s),e.setValue("cp#assetId",n),e.setValue("cp#publishedEtag",i)}),await this.waitForQuietSaveToFinish()}async publishFailureHandler(e){U.error("[publishFailureHandler] Unable to publish template to the Community Platform.",e);const t=E.FAILED;return this.currentJob.status=t,await this.handleFailure(),Promise.reject({status:t,errorMessage:f.a.translate("app.templatePublisher.templatePublishFailure.contentText.kPublishFailure")})}async deleteAssetWithRetry(){if(!this.currentJob.alias){U.error("[deleteAssetWithRetry] Failed to delete published asset after error was thrown copy - alias is undefined");const e=new Error("[deleteAssetWithRetry] Failed to delete published asset after error was thrown copy - alias is undefined");return Promise.reject(e)}const e=k()(this.deleteAsset.bind(this),{maxAttempts:3});return await e(this.currentJob.alias)}async deleteAsset(e){const t=`${A}//${C.a.cps}/api/v2/theo/assets/${e}`,r=await P.a.getAccessToken(),o={headers:{"X-Api-Key":this.apiKey,Authorization:"Bearer "+r},method:"DELETE"};return fetch(t,o).then(e=>{if(!e.ok)throw new Error(`[deleteAsset] Error deleting published template: [${e.status}] ${e.statusText}`)}).catch(t=>{U.error(`[deleteAsset] Failed to delete published template.Please delete manually remove template with ${e}. Error: ${t.message}`,t);const r=new Error(`[deleteAsset] ${t.message} for ${e}`);return Promise.reject(r)})}async handleFailure(){var e;const{progress:t}=null!==(e=this.currentJob)&&void 0!==e?e:{};if(t)try{const{compositeCopyPushed:e,compositePublished:r}=t;e&&await this.deletePushedCompositeCopy(),r&&await this.deleteAssetWithRetry()}catch(e){U.error("[handleFailure] Cleanup task failed.",e)}this.resetPublisher()}async deletePushedCompositeCopy(){if(!this.currentJob.compositeCopy)throw U.error("[deletePushedCompositeCopy] Failed to delete composite copy. `this.currentJob.compositeCopy` is undefined"),new Error("[deletePushedCompositeCopy] Failed to delete composite copy. `this.currentJob.compositeCopy` is undefined");const e=Object(n.b)();this.storageSession.deleteComposite(this.currentJob.compositeCopy,t=>{t?(U.error("[deletePushedCompositeCopy] Unable to delete composite copy.",t),e.reject(t)):e.resolve()}),await e.promise}resetPublisher(){this.currentJob={alias:void 0,compositeCopy:void 0,progress:{localCompositeCreated:!1,localCompositeBound:!1,localCompositeTransformed:!1,compositeCopyPushed:!1,compositePublished:!1,remixURLCreated:!1,publishedCompositeUpdated:!1,sourceDocumentUpdatedWithPublishData:!1}}}}},Gklz:function(e,t,r){"use strict";r.r(t);var o=r("TdwW"),n=r.n(o);function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}t.default=class{constructor(e,t,r){s(this,"colorPicker",void 0),s(this,"postEditorContent",void 0),s(this,"handleEyeDropperEventCallback",void 0),s(this,"colorPickerEventListeners",[]),s(this,"pickerVisible",!1),s(this,"coreWrapper",void 0),s(this,"clickOutsideHandler",void 0),this.colorPicker=e,this.postEditorContent=t,this.handleEyeDropperEventCallback=r,this.clickOutsideHandler=this.handleClickOutsideColorPicker.bind(this)}handleShown(){setTimeout(()=>{window.addEventListener("click",this.clickOutsideHandler)},0)}handleHidden(){window.removeEventListener("click",this.clickOutsideHandler),this.unbindListeners()}unbindListeners(){this.colorPickerEventListeners.forEach(e=>{e.remove()}),this.colorPickerEventListeners=[]}handleClickOutsideColorPicker(e){const t=e.target,r="colorPicker"===t.id,o=t.closest(".post-color-eyedropper-target"),n=t.closest("#colorPicker");r||n||o||this.colorPicker.hide()}colorChangeModal(e){"begin"===e.type?this.pickerVisible=!0:"confirm"!==e.type&&"cancel"!==e.type||(this.pickerVisible=!1)}colorChanged(e,t){const r=this.coreWrapper.getSelectedForma();if(this.pickerVisible)if(r&&r.isTypeLockup())this.coreWrapper.setColorForSelection(this.getNewColorsForLockup(e,t));else{const t=n.a.hex2rgb(e.color);this.coreWrapper.setColorForSelection([{red:t.r,green:t.g,blue:t.b,id:e.id,roles:e.roles}])}}getNewColorsForLockup(e,t){const r=n.a.hex2rgb(e.color),o=this.coreWrapper.getLockupFormaColors(),s=2===o.length,i="text"===t,a=[{red:r.r,green:r.g,blue:r.b,id:e.id,roles:e.roles}];return s&&(i?a.push(o[1]):a.splice(0,0,o[0])),a}handleEyeDropperChanged(e){this.handleEyeDropperEventCallback(e,this.colorPicker),"click"===e.type&&(this.postEditorContent.removeClass("eye-dropper-scrim"),this.postEditorContent.find(".full-scrim").remove())}handleEnterEyeDropperMode(){this.postEditorContent.addClass("eye-dropper-scrim").append('<div class="full-scrim"></div>')}getSuggestedColors(e,t){const r="effects"===t?1:0;let o;if(o=e.isTypeLockup()?this.coreWrapper.getSuggestedColorsForLockup(e):this.coreWrapper.getSuggestedColors(e),!o)return null;return o.map(e=>e[r]?e[r]:null).filter(e=>e)}getCurrentPalette(){return this.coreWrapper.getColorPalette().map(e=>n.a.hex2rgb(e.color))}show(e){if(!e.color||!e.anchor)return;this.colorPickerEventListeners.length&&this.unbindListeners(),this.coreWrapper=e.coreWrapper,this.colorPicker.setAnchorElement($(e.anchor)),this.colorPicker.setContainingElement($(e.containingElement));const t=e.color.length>6?e.color.substring(0,6):e.color;this.colorPicker.setCurrentColor(t);const r=this.coreWrapper.getSelectedForma(),o=this.getCurrentPalette(),n=this.getSuggestedColors(r,e.colorToEdit);this.colorPicker.update({currentColors:o,suggestedColors:n,compact:e.compact,label:e.label}),this.pickerVisible=!1,this.colorPickerEventListeners=this.colorPicker.bindToEventsWithHandlers({shown:this.handleShown.bind(this),hidden:this.handleHidden.bind(this),colorChangeModal:this.colorChangeModal.bind(this),colorChanged:t=>{this.colorChanged(t,e.colorToEdit)},"eyedropper-changed":this.handleEyeDropperChanged.bind(this),"eye-dropper-mode":this.handleEnterEyeDropperMode.bind(this)}),this.colorPicker.show()}hide(){this.colorPicker.hide()}}},"I/Z9":function(e,t,r){"use strict";r.r(t),r.d(t,"createCanvas",(function(){return s})),r.d(t,"checkCanvasForAlpha",(function(){return i})),r.d(t,"trimTransparentEdges",(function(){return a})),r.d(t,"canvasToBlob",(function(){return c})),r.d(t,"renderBlobToCanvas",(function(){return l})),r.d(t,"setFullCanvasToTransparent",(function(){return u}));var o=r("qcxC"),n=r("l+ZV");function s(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");return r&&r.drawImage(e,0,0),t}function i(e,t,r){const o=e.getImageData(0,0,t,r).data;for(let e=3,t=o.length;e<t;e+=4)if(0===o[e])return!0;return!1}function a(e){const t=e.width,r=e.height;let o=t,n=r,s=0,i=0;const a=e.getContext("2d");if(a){const c=a.getImageData(0,0,t,r);let l;for(let e=0;e<r;e++)for(let r=0;r<t;r++)l=4*(e*t+r),c.data[l+3]>0&&(r<o?o=r:r>s&&(s=r),e<n?n=e:e>i&&(i=e));const u=s-o+1,d=i-n+1,p=a.getImageData(o,n,u,d);e.width=u,e.height=d,a.putImageData(p,0,0)}return e}function c(e,t){const r=Object(o.b)();return e.toBlob?e.toBlob(e=>{r.resolve(e)},t):r.resolve(e.msToBlob()),r.promise}function l(e){const t=URL.createObjectURL(e);return n.default.load(t).then(s)}function u(e,t,r){const n=Object(o.b)(),s=new Image;return s.onload=()=>{const t=e.getContext("2d");if(!t)return void n.resolve();t.drawImage(s,0,0);const o=e.width,i=e.height,a=t.getImageData(0,0,o,i),l=255*r.red,u=255*r.green,d=255*r.blue,p=0===l?0:l-1,h=0===u?0:u-1,g=0===d?0:d-1;let m;for(let e=0;e<i;e++)for(let t=0;t<o;t++)m=4*(e*o+t),a.data[m+0]>=p&&a.data[m+0]<=l+1&&a.data[m+1]>=h&&a.data[m+1]<=u+1&&a.data[m+2]>=g&&a.data[m+2]<=d+1&&255===a.data[m+3]&&(a.data[m+0]=0,a.data[m+1]=0,a.data[m+2]=0,a.data[m+3]=0);t.putImageData(a,0,0),c(e).then(e=>n.resolve(e))},s.src=t,n.promise}},INJi:function(e,t,r){"use strict";r.r(t);var o=r("YLtl"),n=r("UzQk"),s=r.n(n),i=r("MGCh"),a=r.n(i),c=r("WpJZ"),l=r("bBG2");const u=r("92tI"),d=a.a.channel("text-style-module");let p,h;let g=[],m=0,f=null,b=null,y=!1,v=!1,P=null,w=null,C=0;function S(e,t){d.info("Resetting spinner."),m=0;return u.resetStyleSuggestions(!0,!0,h,e,t).finally(()=>{d.info(`Styles: ${e} Emphasis: ${t}`)})}function k(){const e=p.getSelectedForma();u.eraseTextStyleCache(),e&&(u.updateTextStyleSuggestionAtIndex(0,e.style.clone(),"current style"),h=new s.a.WheelSuggestionEvaluator(e),w=p.getStyleServiceMetaDataString(e),f!==e.formaID&&(C=0),f=e.formaID,b=e.placement),P=null}function x(e,t){y&&e&&function(){const e=p.getFormaById(f);let t=Object(c.getLockupStyleStringWithRole)(e,p.getDocument()),r=null,o=null;if(h){const e=h.lockupStyleEvaluator.getOldReadabilityInformation();e&&(o=e.readabilityString);const t=h.lockupStyleEvaluator.getNewReadabilityInformation();t&&(r=t.readabilityString)}if(t.length>0){P&&(t+=`{sugID:${P}}`);const e="location:WheelSuggestion";l.default.publish("lockupStyleCaptured",{contextualData1:"styleString:"+t,contextualData2:e,contextualData3:"oldRead:"+o,contextualData4:"newRead:"+r,contextualData5:"meta:"+w,contextualData6:"emphasisUsed:"+v}),y=!1}}(),v&&t&&function(){const e=u.getEmphasisLoggingInfo(h),t=[];e.forEach(e=>{t.push(e)});const r=JSON.stringify(t);if(r.length>0){const e="location:WheelSuggestion";l.default.publish("lockupEmphasisCaptured",{contextualData1:"emphasisString:"+r,contextualData2:e}),v=!1}}()}function F(e,t){x(e,t),k(),S(e,t)}function T(){x(!0,!0),h=null,w=null,y=!1,v=!1,u.eraseTextStyleCache()}function E(){const e=p.getSelectedForma();e&&e.isTypeLockup()||(f=null,g.forEach(e=>{e.remove()}),g=[],T())}const D=Object(o.throttle)(()=>{d.info("Forma updated. Clearing styles/emphasis promises, then resetting spinner."),F(!0,!0)},400);function A(){const e=p.getSelectedForma();e.formaID!==f&&(g.push(p.events.subscribe("forma-selected",E)),g.push(p.events.subscribe("forma-text-updated",D)),k(),S(!0,!0)),e&&e.isTypeLockup()&&(e.formaID!==f||b!==e.placement)&&(e.formaID!==f&&F(!0,!0),b!==e.placement&&F(!0,!1))}const I=new class{setCoreWrapper(e){p=e,u.setCoreWrapper(e)}handleStyleSliderValueChange(){A(),C+=1;m=(C+5e3)%50,y=0!==m,u.applyTextStyleSuggestion(m,h).then(()=>{const{id:e}=u.getTextStyleSuggestionAtIndex(m);P=e||null}).done()}};t.default=I},Mbmg:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var o=r("xeH2"),n=r.n(o),s=r("3xm6"),i=r.n(s);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class c{static pageUnloadBlockingBegin(){window.addEventListener("beforeunload",c.pendingSavePageUnloadPrompt)}static pageUnloadBlockingEnd(){window.removeEventListener("beforeunload",c.pendingSavePageUnloadPrompt)}static beginTrackingPendingXhrRequests(){c.isTrackingXHRs||(c.isTrackingXHRs=!0,n()(document).on("ajaxSend",c.registerJqxhr),n()(document).on("ajaxComplete",c.unregisterJqxhr))}static endTrackingPendingXhrRequests(){c.isTrackingXHRs=!1,n()(document).off("ajaxSend",c.registerJqxhr),n()(document).off("ajaxComplete",c.unregisterJqxhr),c.xhrRequestsToAbortOnUnload=[]}static pendingSavePageUnloadPrompt(e){c.xhrRequestsToAbortOnUnload.forEach(e=>{e&&e.abort()});const t=i.a.translate("dialogs.savePageUnloadPrompt");return e&&(e.preventDefault(),e.returnValue=!!t),t}static registerJqxhr(e,t,r){c.xhrRequestsToAbortOnUnload.push(t)}static unregisterJqxhr(e,t,r){const o=c.xhrRequestsToAbortOnUnload.indexOf(t);c.xhrRequestsToAbortOnUnload.splice(o,1)}}a(c,"xhrRequestsToAbortOnUnload",[]),a(c,"isTrackingXHRs",!1),t.b=c},PsNr:function(e,t,r){var o,n;o=[r("xeH2"),r("YLtl"),r("UFvF"),r("eZ+Q")],void 0===(n=function(e,t,r,o){var n={cleanUpFiles:function(e){e=e.map((function(e){return e.source=o.getServiceSource(e),e}));for(var t=["original","preview","thumbnail","small"],r=0;r<e.length;r++)for(var n=e[r],s=0;s<t.length;s++){var i=t[s];!n[i]||n[i].link||n[i].blobPromise||delete n[i]}return e}};return n}.apply(t,o))||(e.exports=n)},UNP3:function(e,t,r){"use strict";r.r(t),r.d(t,"reportNounProjectIds",(function(){return l}));var o=r("ApVh"),n=r.n(o),s=r("MGCh"),i=r.n(s),a=r("WpJZ");const c=i.a.channel("noun-project-reporter");function l(e,t,r){const o=Object(a.getUnreportedNounProjectIds)(e);if(!o.length)return Promise.resolve();const s=`https://${t.dooplo}/api/v1/report/usage?api_key=MarvelCP1`;return n.a.getAccessToken().then(n=>{const i={method:"POST",headers:{Authorization:"Bearer "+n,"X-Api-Key":t.key,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({ids:o})};return fetch(s,i).then(t=>{if(t.status>=400){const e=new Error("reportNounProjectIds returned an HTTP error");c.error(`Requested ${s}. Got back ${t.statusText}`,e)}else Object(a.setNounProjectIdsReported)(o,e),r()}).catch(e=>{c.error("error reporting Noun Project icon Ids",`Requested ${s}. Got back ${e}`)})})}},Wqmg:function(e,t,r){"use strict";async function o(e,t=""){const r="/api/post/v1/proxy?url="+encodeURIComponent(e);let o;try{o=await fetch(r)}catch(e){throw new Error("image blob failed to load through proxy. error details: "+e)}if(!o.ok)throw new Error("image blob failed to load through proxy. status: "+o.status);try{const e=await o.arrayBuffer(),r=new Uint8Array(e),n=t||o.headers.get("Content-Type")||"image/jpeg";return new Blob([r],{type:n})}catch(e){throw new Error("image blob failed to get created. error details: "+e)}}r.d(t,"a",(function(){return o}))},Wxmc:function(e,t,r){var o,n;o=[r("3xm6"),r("UzQk"),r("Dvuo")],void 0===(n=function(e,t,r){var o={},n="px",s=0,i=300;return o.isValidParsedInput=function(e){var r="number"==typeof e?e:t.Host.locale.convertStringToNumber(e);if(isNaN(r))return NaN;var o=t.PageFacade.convertPixelsToUnitsString(r,s,i);return!!t.PageFacade.pageDimensionIsInRange(o,s,i)&&r},o.updateRangeAndUnits=function(e,t){n=r.getUnitsStringForFormat(e),s=e,i=t},o.validateAndReturnValueForInput=function(r){var a=o.isValidParsedInput(r);if(a||0===r.length)return 0===r.length&&(a=2560),{isValid:!0,errorMsg:"",value:a};if(isNaN(a))return{isValid:!1,errorMsg:e.translate("forms.custom-size.kInvalidInput"),value:r};{const o=t.PageFacade.getMinPageDimensionForUnits(s,i),a=t.PageFacade.getMaxPageDimensionForUnits(s,i),c=t.PageFacade.getNumDecimalPlacesForUnits(s),l=t.Host.locale.formatNumber(o,c),u=t.Host.locale.formatNumber(a,c);return{isValid:!1,errorMsg:e.translate("forms.custom-size.kInvalidSizeWithUnit",{minimum:l,maximum:u,units:n}),value:r}}},o.validateInputsAndCheckAspectRatio=function(r,n){var s=o.validateAndReturnValueForInput(r),i=o.validateAndReturnValueForInput(n),a="";return s.isValid&&i.isValid&&t.PageFacade.aspectRatioIsVeryTallOrWide({width:s.value,height:i.value})&&(a=e.translate("forms.custom-size.kAspectRatioTip")),{width:s,height:i,tip:a}},o}.apply(t,o))||(e.exports=n)},Yzgm:function(e,t,r){var o,n;o=[r("YLtl"),r("UFvF"),r("hcqx"),r("7mGH"),r("4pbt"),r("1geK"),r("MGCh"),r("bBG2")],void 0===(n=function(e,t,r,o,n,s,i,a){const c=i.channel("theo-publish-impl"),l=a.default,u=s.default;return new function(){this.community=window.marvel.settings.theoc,this.communityCategory="theos",this.previewPath="preview.jpg",this.doPublish=function(e,r,o){return t(n.getDownloadImageBlobPromise(e,"image/jpeg")).then(e=>"function"==typeof e.arrayBuffer?e.arrayBuffer():new t.Promise((t,r)=>{const o=new FileReader;o.addEventListener("load",()=>{t(o.result)}),o.addEventListener("error",()=>{r(o.error)}),o.readAsArrayBuffer(e)})).then(t=>{const r={};r["preview.jpg"]={content:new Uint8Array(t),contentType:"image/jpeg"};const o=e.getDCXComposite(),n={"manifest-format-version":6,name:o.name,type:o.type,state:"unmodified",id:o.id,components:[{id:"preview",type:"image/jpeg",rel:"rendition",name:"preview.jpg",path:"preview.jpg",state:"unmodified",length:t.length}]};return r.manifest={raw:n,content:JSON.stringify(n),contentType:"application/vnd.adobe.dcx-manifest+json"},r})},this.resourceUploadReport=function(e,t,r){if(c.info(`uploaded ${t} version ${r.version}`),"preview.jpg"===t){const t=e.manifest.raw;t.components[0].etag=r.etag,t.components[0].version=r.version,e.manifest.content=JSON.stringify(t)}else"manifest"===t||c.error("got unexpected upload report for "+t)},this.reviseDoPublishAfterFilesUpdate=function(r,o){const s=r.manifest.raw,i={};return e.each(o,(function(e){e.track_version&&""!==e.version&&(i[e.destination]=e.version)})),e.each(s.components,(function(t){e.isUndefined(i[t.path])||(t.version=i[t.path])})),n.hasAnimationStyle()&&this.videoPubInfo&&s.components.push({id:"videoRendition",type:"video/mp4",rel:"rendition",name:"videoRendition",path:"videoRendition.mp4",state:"unmodified",height:this.videoPubInfo.height,width:this.videoPubInfo.width,length:this.videoPubInfo.videoLength,etag:this.videoPubInfo.video_resource_data.etag,version:this.videoPubInfo.video_resource_data.version}),r.manifest.content=JSON.stringify(s),t.resolve(r)},this.getUseProgressEvents=function(){return n.hasAnimationStyle()},this.trigger=function(e,t){"progress"===e&&this.videoProgress?(this.videoProgress.copyPct=t,this.sendVideoAndCopyProgress(this.videoProgress)):r.Model.prototype.trigger.apply(this,arguments)},this.updateSnapiProgress=function(e,t,r){"progress"===e&&this.videoProgress&&r===this.videoProgress.progressId&&(this.videoProgress.videoPct=t,this.sendVideoAndCopyProgress(this.videoProgress))},this.sendVideoAndCopyProgress=function(e){var t=Math.ceil((e.videoPct+e.copyPct)/2);r.Model.prototype.trigger.apply(this,["progress",t])},this.getFilesDataToCopyFromServerData=function(e,r,o){const s=r.getDCXComposite().current,i=[],a=e.id;if(this.videoProgress=null,o.showAvatar&&""!==o.authorAvatarUrl){const e=s.getComponentWithAbsolutePath(r.getMyApp().getStorageImpl().avatarComponentPath);e&&i.push({source:a+"/"+e.id,content_type:e.type,destination:e.path})}if(n.webAnimationEnabled()&&n.hasAnimationStyle()){const e=r.getMyApp().getStorageImpl().currentDoc.id,s=r.getMyApp().getCPProjectId(r),a=n.getPgmGraphForPublish();if(null==a)return c.error("PGM graph is null"),t.resolve(i);var d=u.getPublishRequestBody(o);d.pgmGraph=a.encode();var p=a.bounds.aspectRatio,h=p<1?1280:Math.round(1280/p),g=p<1?Math.round(1280*p):1280;d.renderOptions={videoHeight:h,videoWidth:g,scaleType:0};var m={},f={files:i,additionalCopyDefer:t.defer()};this.videoProgress={videoPct:0,copyPct:0,progressId:e};var b=new Date;return l.publish("publish:mp4:started",{projectId:e}),u.sendPgmPublishRequestForUpload(e,s,d,m,this.updateSnapiProgress.bind(this)).then(function(t){l.publish("publish:mp4:succeeded",{projectId:e,requestId:m.value,timeSpent:new Date-b+"ms"}),this.videoPubInfo=t,this.updateSnapiProgress("progress",100,e),f.additionalCopyDefer.resolve(t)}.bind(this)).catch((function(t){l.publish("publish:mp4:failed",{projectId:e,requestId:m.value,timeSpent:new Date-b+"ms",error:JSON.stringify(t,null,2)}),f.additionalCopyDefer.reject(t)})),t.resolve(f)}return this.videoPubInfo=null,t.resolve(i)},this.getData=function(e,t){if(!t)return void console.error("no doc for getData");let r=t.getMyApp().getStorageImpl().getData(e,t,"shareData");return void 0===r&&("publishTitle"===e?r=n.getCurrentDocumentSynthesizedName():"description"===e&&(r=n.getCurrentDocumentDescription())),r},this.setData=function(e,t,r){if(!r)return void console.error("no doc for setData");return r.getMyApp().getStorageImpl().setData(e,t,r,"shareData")},this.getDocumentCredits=function(e){return""},this.getDocumentDefaultCredits=function(e){return""},this.getDownloadUrl=function(e){const r=t.defer(),s=o.hasFeature("post-download-zip-of-pngs")?"application/zip":"image/jpeg",i=this.getDownloadFileName(e);return n.getDownloadImageBlobPromise(e,s).then((function(e){r.resolve((function(){if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(e,i);else{const t=window.URL.createObjectURL(e),r=document.createElement("a");document.body.appendChild(r),r.setAttribute("href",t),r.setAttribute("download",i),r.click(),window.URL.revokeObjectURL(t),document.body.removeChild(r)}}))})),r.promise},this.getDownloadFileName=function(e){return e.getProjectName()+(o.hasFeature("post-download-zip-of-pngs")?".zip":".jpg")},this.augmentMetaData=function(t){t.custom=e.merge(t.custom||{},n.getDocumentSize()),e.assign(t,{description:n.getCurrentDocumentDescription()}),e.assign(t,{machine_tags:n.getRemixAncestorsIntoMachineTags(t.machine_tags)})},this.getPublishingSetup=function(){return{supportsDownload:!1,publishingSavesData:!1,assetType:"application/vnd.adobe.theo.document+dcx",supportedFields:["publishTitle","authorFull","showAuthor","authorAvatarUrl","isPublic","category"]}}}}.apply(t,o))||(e.exports=n)},dcsN:function(e,t,r){"use strict";r.r(t);var o=r("Na8G"),n=r.n(o);t.default=class{constructor(e){this.postFeatureController=e}isEntitledToFeature(e){return this.postFeatureController.featureEnabled("entitle-brand-kit")}tryPremiumFeature(e){return!!this.isEntitledToFeature(String(e.touchpointName))||(n.a.showMerchPopover(e),!1)}}},dlJo:function(e,t,r){"use strict";t.a=class{static promiseFetch(e,t={}){return new Promise((r,o)=>{fetch(e,t).then(e=>{if(e.ok)r(e.json());else{const t=new Error(e.statusText);o(t)}}).catch(e=>{o(e)})})}}},ibPQ:function(e,t,r){"use strict";r.r(t),r.d(t,"KeyboardShortcuts",(function(){return d}));var o=r("MGCh"),n=r.n(o),s=r("bBG2"),i=r("3xm6"),a=r.n(i),c=r("5d+0"),l=n.a.channel("keyboard-shorcuts"),u={confirmText:0,rotation:0,sendForward:0,sendToFront:0,sendBackward:0,sendToBack:0,duplication:0,group:0,ungroup:0,nudge:0,marqueeSelect:0,multiselect:0,selectSibling:0,selectParent:0,selectChild:0,exitSpecialSelectionMode:0,actualSize:0,fitToView:0,fillToView:0,zoomOut:0,zoomIn:0,panView:0,panKey:0,zoomInKey:0,zoomOutKey:0};class d{static get callbackKeys(){return{ENTER:"ENTER",SHIFT_ENTER:"SHIFT_ENTER",ESCAPE:"ESCAPE"}}constructor(){this.callCallbacksForKey=this.callCallbacksForKey.bind(this),this.addCallback=this.addCallback.bind(this),this.handleKeyEvent=this.handleKeyEvent.bind(this),this.getShortcutDescription=this.getShortcutDescription.bind(this),this.logShortcut=this.logShortcut.bind(this),this.callbacks={}}callCallbacksForKey(e,t){d.callbackKeys[e]?this.callbacks[e]&&(e===d.callbackKeys.SHIFT_ENTER&&this.logShortcut(c.ShortcutConstants.kConfirmText),this.callbacks[e].forEach((function(e){e(t)}))):l.error("can not call callback for unsupported key with value: "+e)}addCallback(e,t){d.callbackKeys[e]&&(this.callbacks[e]?this.callbacks[e].push(t):this.callbacks[e]=[t])}bindListeners(e,t,r){e.addEventListener(t,this.handleKeyEvent),r.forEach(e=>{this.addCallback(e.key,e.method)})}unbindListeners(e,t){e.removeEventListener(t,this.handleKeyEvent),this.callbacks={}}handleKeyEvent(e){if(0===e.type.indexOf("key")){var t=e.shiftKey;switch(e.which){case 13:if(t){this.callCallbacksForKey(d.callbackKeys.SHIFT_ENTER,e);break}this.callCallbacksForKey(d.callbackKeys.ENTER,e);break;case 27:this.callCallbacksForKey(d.callbackKeys.ESCAPE,e)}}else l.error("tried to process event of type : "+e.type+". should not try to process non-key events")}getShortcutDescription(e,t){var r="",o=navigator.appVersion.indexOf("Mac");return e.command&&(r+=o?a.a.translate("keyboard.kMacCommandKey"):a.a.translate("keyboard.kWinCtrlKey")),e.control&&o&&(r+=r.length>0?"+":"",r+=a.a.translate("keyboard.kMacControlKey")),e.option&&(r+=r.length>0?"+":"",r+=o?a.a.translate("keyboard.kMacOptionKey"):a.a.translate("keyboard.kWinAltKey")),e.shift&&(r+=r.length>0?"+":"",r+=a.a.translate("keyboard.kShiftKey")),r+=r.length<=1?t:"+"+t}logShortcut(e){u[e]+=1,s.default.publish("keyboardShortcut",{contextualData1:`actionCountInSession: ${e}_${u[e]}`,contextualData2:"actionDescription: "+e})}}},qcxC:function(e,t,r){"use strict";function o(){let e,t;return{promise:new Promise((r,o)=>(e=r,t=o)),resolve:e,reject:t}}r.d(t,"b",(function(){return o})),t.a=o},yiIM:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));class o{static reload(){window.location.reload()}static getLocationPathname(){return window.location.pathname}}},ywYV:function(e,t,r){var o;void 0===(o=function(){var e={};function t(e){return e*Math.PI/180}return e.radians=t,e.degrees=function(e){return 180*e/Math.PI},e.degreesBetweenPoints=function(e,t){return 180*Math.atan2(t.y-e.y,t.x-e.x)/Math.PI},e.radiansBetweenPoints=function(r,o){return t(e.degreesBetweenPoints(r,o))},e.distanceSquared=function(e,t){return Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)},e.distanceBetweenPoints=function(t,r){return Math.sqrt(e.distanceSquared(t,r))},e.rotatePoint=function(e,r,o){var n=t(o);return{x:Math.cos(n)*(e.x-r.x)-Math.sin(n)*(e.y-r.y)+r.x,y:Math.sin(n)*(e.x-r.x)+Math.cos(n)*(e.y-r.y)+r.y}},e.rotatePoints=function(t,r,o){for(var n=[],s=0;s<t.length;s++)n.push(e.rotatePoint(t[s],r,o));return n},e.closestPointOfLineToAPoint=function(t,r,o){var n=((t.x-r.x)*(o.x-r.x)+(t.y-r.y)*(o.y-r.y))/e.distanceSquared(r,o);return{x:r.x+n*(o.x-r.x),y:r.y+n*(o.y-r.y)}},e.midpointOfTwoPoints=function(e,t){return{x:e.x+(t.x-e.x)/2,y:e.y+(t.y-e.y)/2}},e.closestPointOnLineSegment=function(e,t,r){var o=e.x-t.x,n=e.y-t.y,s=r.x-t.x,i=r.y-t.y,a=(o*s+n*i)/(s*s+i*i);return a<0||t.x==r.x&&t.y==r.y?t:a>1?r:{x:t.x+a*s,y:t.y+a*i}},e.pointDistanceToLineSegment=function(t,r,o){var n=e.closestPointOnLineSegment(t,r,o),s=t.x-n.x,i=t.y-n.y;return Math.sqrt(s*s+i*i)},e.closestPointOnEdgeOfShape=function(t,r){var o=r.length;if(0===o)return t;if(1===o)return r[0];for(var n=0,s=t,i=0;i<o;i++){var a=i===o-1?0:i+1,c=r[i],l=r[a],u=e.pointDistanceToLineSegment(t,c,l);(0===i||u<n)&&(n=u,s=e.closestPointOnLineSegment(t,c,l))}return s},e.pointSomeDistanceTowardsPoint=function(e,t,r){var o=r.x-e.x,n=r.y-e.y,s=Math.sqrt(o*o+n*n),i=t/(s/o),a=t/(s/n);return{x:e.x+i,y:e.y+a}},e.isPointInsideShape=function(e,t){for(var r=!1,o=-1,n=t.length,s=n-1;++o<n;s=o)(t[o].y<=e.y&&e.y<t[s].y||t[s].y<=e.y&&e.y<t[o].y)&&e.x<(t[s].x-t[o].x)*(e.y-t[o].y)/(t[s].y-t[o].y)+t[o].x&&(r=!r);return r},e.getScaledShapeVertices=function(t,r,o){for(var n,s,i=[],a=o.length,c=0;c<a;c++)n=o[c],s=e.distanceBetweenPoints(t,n)*r,i.push(e.pointSomeDistanceTowardsPoint(t,s,n));return i},e.pointJustAboveShape=function(e){for(var t,r=e[0].x,o=r,n=e[0].y,s=0,i=e.length;s<i;s++)(t=e[s]).x<r&&(r=t.x),t.x>o&&(o=t.x),t.y>n&&(n=t.y);return{x:Math.round(r+(o-r)/2),y:n}},e.decomposeMatrix2d=function(e){var t=Math.atan2(e[1],e[0]),r=Math.pow(e[0],2)+Math.pow(e[1],2),o=Math.sqrt(r),n=(e[0]*e[3]-e[2]*e[1])/o,s=Math.atan2(e[0]*e[2]+e[1]*e[3],r);return{angle:t/(Math.PI/180),scaleX:o,scaleY:n,skewX:s/(Math.PI/180),skewY:0,translateX:e[4],translateY:e[5],translate:{x:e[4],y:e[5]}}},e.transformMatrix=function(e,t){var r=e[0],o=e[1],n=e[2],s=e[3],i=e[4],a=e[5],c=t[0],l=t[1],u=t[2],d=t[3],p=t[4],h=t[5];return e[0]=r*c+n*l,e[1]=o*c+s*l,e[2]=r*u+n*d,e[3]=o*u+s*d,e[4]=r*p+n*h+i,e[5]=o*p+s*h+a,e},e}.apply(t,[]))||(e.exports=o)}}]);
//# sourceMappingURL=theo-publish-impl_5a11b65b-5fa04fd1.js.map