(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[16],{"01gE":function(e,t,n){var a,o=t,i=n("oAGj"),r=n("Nk+Q"),s=n("CMNw"),l=n("UUXZ"),c=n("PSFa"),u=n("elwG"),d=n("qUXk"),f=n("u+mS"),h=n("eLsM"),p=n("hsXA"),m=n("JU+l"),g=n("9X7Y"),v=n("aKgf");o.GroupSelectionDesignController=(a=function(e,t){d.DesignController.call(this),this.handles=new p.StandardHandlesHandler(e,t,this),this.drag=new f.MultiObjectDragHandler(e,t,this),this.click=new u.StandardClickHandler(e),this.resize=new m.MultiObjectResizeHandler(e,t,i.clone(e.selection.asFormaArray()),this),this.actions=new s.StandardActionHandler(e),this.rotate=new g.StandardRotateHandler(e,t,this),this.attributes=new c.StandardAttributesHandler(e),this.featureSets=new h.StandardFeatureSetHandler(e),this.actionFeedback=new r.StandardActionFeedbackHandler(t),this.annotations=new l.StandardAnnotationsHandler(t),this.view=new v.StandardViewHandler(e,t)},i.defineClass({name:"GroupSelectionDesignController",ctor:a,superName:"DesignController"}),a)},"25Jq":function(e,t,n){var a,o=t,i=n("oAGj"),r=n("Nk+Q"),s=n("CMNw"),l=n("UUXZ"),c=n("PSFa"),u=n("elwG"),d=n("qUXk"),f=n("u+mS"),h=n("eLsM"),p=n("hsXA"),m=n("G9CY"),g=n("JU+l"),v=n("9X7Y"),S=n("aKgf");o.SingleSelectionDesignController=(a=function(e,t){d.DesignController.call(this),this.handles=new p.StandardHandlesHandler(e,t,this),this.drag=new f.DragFacadeBasedDragHandler(e,t,this),this.click=new u.StandardClickHandler(e),this.resize=new g.SingleItemResizeHandler(e,t,e.selection.formaAt(0),this),this.move=new m.StandardMoveHandler(e,t,this),this.rotate=new v.StandardRotateHandler(e,t,this),this.actions=new s.StandardActionHandler(e),this.attributes=new c.StandardAttributesHandler(e),this.featureSets=new h.StandardFeatureSetHandler(e),this.actionFeedback=new r.StandardActionFeedbackHandler(t),this.annotations=new l.StandardAnnotationsHandler(t),this.view=new S.StandardViewHandler(e,t)},i.defineClass({name:"SingleSelectionDesignController",ctor:a,superName:"DesignController"}),a)},"36r7":function(e,t,n){var a,o,i=t,r=n("oAGj"),s=n("7siz"),l=n("iCxV"),c=n("Q+4n"),u=n("oKlP"),d=n("1NAc");i.View=(a=function(e,t,n,a,o){void 0===e&&(e=!0),void 0===t&&(t=!1),void 0===n&&(n=1),void 0===a&&(a=u.TheoPoint.ZERO),void 0===o&&(o=d.TheoSize.Zero),this.fit=e,this.fill=t,this.scale=n,this.offset=a,this.viewSize=o},r.defineClass({name:"View",ctor:a,superName:"CoreObject"}),a),i.IViewModel=r.defineProtocol("IViewModel",{getFit:"() -> Boolean",getFill:"() -> Boolean",getScale:"() -> Double",getOffset:"() -> TheoPoint",getViewSize:"() -> TheoSize",getMargin:"() -> Double",getPanInsets:"() -> TheoInsets"}),i.IMutableViewModel=r.defineProtocol("IMutableViewModel",{setFit:"(Boolean) -> Void",setFill:"(Boolean) -> Void",setScale:"(Double) -> Void",setOffset:"(TheoPoint) -> Void",setViewSize:"(TheoSize) -> Void"}),i.ViewState=(o=function(e){void 0===e&&(e=null),this.view=null!=e?new i.View(e.fit,e.fill,e.scale,e.offset,e.viewSize):new i.View},r.defineClass({name:"ViewState",ctor:o,superName:"EditorStateMember",statics:{_implements:function(e){return"IMutableViewModel"==e||"IViewModel"==e}},props:{clone:function(){return new o(this.view)},diff:function(e){return this.view.fit==e.view.fit&&this.view.fill==e.view.fill&&this.view.scale==e.view.scale&&this.view.offset==e.view.offset&&this.view.viewSize==e.view.viewSize?[]:[s.EditorModelChangedMessage.CHG_VIEW_STATE]},getFit:function(){return this.view.fit},getFill:function(){return this.view.fill},getScale:function(){return this.view.scale},getOffset:function(){return this.view.offset},getViewSize:function(){return this.view.viewSize},getMargin:function(){var e;return((e=r.opt(l.Host.platform,(function(e){return e.isMobile})))||null!=e)&&e?0:80},getPanInsets:function(){var e;return((e=r.opt(l.Host.platform,(function(e){return e.isMobile})))||null!=e)&&e?c.TheoInsets.Zero:new c.TheoInsets(0,313,0,280)},setFit:function(e){this.beforeChange(),this.view.fit=e,this.view.fill=!1,this.afterChange()},setFill:function(e){this.beforeChange(),this.view.fill=e,this.view.fit=!1,this.afterChange()},setScale:function(e){this.beforeChange(),this.view.scale=e,this.afterChange()},setOffset:function(e){this.beforeChange(),this.view.offset=e,this.afterChange()},setViewSize:function(e){this.beforeChange(),this.view.viewSize=e,this.afterChange()}}}),o)},"3nOH":function(e,t,n){var a,o=t,i=n("oAGj"),r=n("Nk+Q"),s=n("CMNw"),l=n("UUXZ"),c=n("PSFa"),u=n("elwG"),d=n("qUXk"),f=n("u+mS"),h=n("eLsM"),p=n("hsXA"),m=n("JU+l"),g=n("aKgf");o.MultiSelectionDesignController=(a=function(e,t){d.DesignController.call(this),this.handles=new p.StandardHandlesHandler(e,t,this),this.drag=new f.MultiObjectDragHandler(e,t,this),this.click=new u.StandardClickHandler(e),this.resize=new m.MultiObjectResizeHandler(e,t,i.clone(e.selection.asFormaArray()),this),this.actions=new s.StandardActionHandler(e),this.attributes=new c.StandardAttributesHandler(e),this.featureSets=new h.StandardFeatureSetHandler(e),this.actionFeedback=new r.StandardActionFeedbackHandler(t),this.annotations=new l.StandardAnnotationsHandler(t),this.view=new g.StandardViewHandler(e,t)},i.defineClass({name:"MultiSelectionDesignController",ctor:a,superName:"DesignController"}),a)},"5+WR":function(e,t,n){var a,o,i,r=t,s=n("oAGj"),l=n("KgU+"),c=n("PSFa"),u=n("KSe6"),d=n("AnBp");r.AnimationStyleAttribute=(a=function(e,t,n,a){this.selected=s.clone(n),this.page=t,this.options=s.clone(a),d.EditorAttributeBase.call(this,e)},s.defineClass({name:"AnimationStyleAttribute",ctor:a,superName:"EditorAttributeBase",statics:{PAGE_LEVEL_KEY:"animationStyle-page",sameArray:function(e,t){if(e.length==t.length){for(var n=s.iter(s.range(0,e.length,!1));!n.done;n.next()){var a=n.value;if(!e[a].equals(t[a]))return!1}return!0}return!1},_implements:function(e){return"IEditorAttribute"==e}},props:{isEqualTo:function(e){var t;return!!(t=s.as(e,a))&&this.key==t.key&&a.sameArray(s.clone(this.selected),s.clone(t.selected))&&a.sameArray(s.clone(this.options),s.clone(t.options))},createAction:function(e){if(1==this.selected.length&&e.name==this.selected[0].name){var t=this.page.animationLibrary.getNextAnimationStyleOfSameType(this.selected[0]);return new l.ApplyAnimationStyleAction(t,this.page)}return new l.ApplyAnimationStyleAction(e,this.page)}}}),a),r.AnimationAttributesHandler=(o=function(){c.AttributeHandlerBase.call(this)},i={},s.defineClass({name:"AnimationAttributesHandler",ctor:o,superName:"AttributeHandlerBase",statics:{instance:{get:function(){return void 0===i.instance&&(i.instance=new o),i.instance}},_implements:function(e){return"IAttributeHandler"==e}},props:{calculate:function(e){var t;if(t=s.opt(s.opt(e,(function(e){return e.document})),(function(e){return e.firstPage}))){var n=s.clone(u.AnimationLibrary.getDisplayableAnimationStyles(t.root)),a=t.animationController.animationStyle||t.animationLibrary.getNoneStyle();return[new r.AnimationStyleAttribute(r.AnimationStyleAttribute.PAGE_LEVEL_KEY,t,[a],s.clone(n))]}return[]}}}),o)},"7S/6":function(e,t,n){var a,o=t,i=n("oAGj"),r=n("H3ZP"),s=n("nQ/X"),l=n("qUXk"),c=n("01gE"),u=n("fNpk"),d=n("3nOH"),f=n("QLFD"),h=n("25Jq");o.DesignControllerFactory=(a=function(){},i.defineClass({name:"DesignControllerFactory",ctor:a,props:{getNewDesignController:function(e){var t,n,a,o;return(o=this.owner)?a=0==o.selection.selectedCount?new f.NoSelectionDesignController(o,e):o.selection.inCharStyleMode?new s.CharStyleModeDesignController(o,e):1==o.selection.selectedCountInDocument?o.selection.inCropMode?new r.CropModeDesignController(o,e):!(t=i.opt(i.opt(o.selection.formaAt(0),(function(e){return e.controller})),(function(e){return e.userGroupMember})))&&null==t||!t||o.enableMoveableChildren&&(!(n=i.opt(i.opt(o.selection.formaAt(0),(function(e){return e.controller})),(function(e){return e.userGroup})))&&null==n||!n)?new h.SingleSelectionDesignController(o,e):new c.GroupSelectionDesignController(o,e):new d.MultiSelectionDesignController(o,e):(u.LegacyCoreAssert.fail("owner has gone out of scope, yet we are still asking to create design controllers",void 0,"DesignControllerFactory.getNewDesignController","DesignControllerFactory.swift",44),a=new l.DesignController),a}}}),a)},"7siz":function(e,t,n){var a,o,i=t,r=n("oAGj"),s=n("McK+"),l=n("90dd"),c=n("ZoS2");i.IEditorModel=r.defineProtocol("IEditorModel",{attributes:"IAttributesModel",handles:"IHandlesModel",activeSwap:"IActiveSwapModel",snapLines:"ISnapLinesModel",featureSets:"IFeatureSetsModel",actionFeedback:"IActionFeedbackModel",annotations:"IAnnotationsModel",view:"IViewModel"}),i.IMutableEditorModel=r.defineProtocol("IMutableEditorModel",{attributes:"AttributesState",handles:"HandlesState",activeSwap:"ActiveSwapState",snapLines:"SnapLinesState",featureSets:"FeatureSetsState",actionFeedback:"ActionFeedbackState",annotations:"AnnotationState",view:"ViewState"}),i.EditorModel=(a=function(){this.updateDepth_=0,this.state_=new s.EditorModelState,this.startingState_=new s.EditorModelState,c.TheoPublishingObject.call(this)},r.defineClass({name:"EditorModel",ctor:a,superName:"TheoPublishingObject",statics:{_implements:function(e){return"IEditorModel"==e||"TheoMessagePublisher"==e}},props:{attributes:{get:function(){return this.state_.attributes}},handles:{get:function(){return this.state_.handles}},activeSwap:{get:function(){return this.state_.activeSwap}},snapLines:{get:function(){return this.state_.snapLines}},featureSets:{get:function(){return this.state_.featureSets}},actionFeedback:{get:function(){return this.state_.actionFeedback}},annotations:{get:function(){return this.state_.annotations}},view:{get:function(){return this.state_.view}},mutable:{get:function(){return this.state_}},beginUpdates:function(){this.updateDepth_+=1,1==this.updateDepth_&&(this.startingState_=this.state_.clone()),this.state_.mutable=!0},updatesComplete:function(){if(this.updateDepth_-=1,0==this.updateDepth_){this.state_.mutable=!1;var e=r.clone(this.state_.calculateChanges(this.startingState_));e.length>0&&this.publish(new i.EditorModelChangedMessage(this,r.clone(e)))}}}}),a),i.EditorModelChangedMessage=(o=function e(t,n){this.changes=r.clone(n),l.TheoMessage.call(this,e.TYPE,t)},r.defineClass({name:"EditorModelChangedMessage",ctor:o,superName:"TheoMessage",statics:{CHG_ATTRIBUTE_PREFIX:"attribute:",CHG_HANDLES:"handles",CHG_SWAP_STATE:"swap-state",CHG_SNAPLINES:"snaplines",CHG_FEATURE_SET_PREFIX:"feature-set:",CHG_ACTION_FEEDBACK_STATE:"action-feedback",CHG_ANNOTATIONS:"annotations",CHG_VIEW_STATE:"view-state",TYPE:"EditorModelChangedMessage"}}),o)},"9X7Y":function(e,t,n){var a,o,i,r=t,s=n("oAGj"),l=n("Tq01"),c=n("H1Z2"),u=n("lmwz");r.IRotateHandler=s.defineProtocol("IRotateHandler",{beginRotate:"(BoxReference) -> Void",updateRotate:"(BoxReference, Double, Boolean) -> Void",endRotate:"(BoxReference) -> Void"}),r.NullRotateHandler=(a=function(){},o={},s.defineClass({name:"NullRotateHandler",ctor:a,statics:{instance:{get:function(){return void 0===o.instance&&(o.instance=new a),o.instance}},_implements:function(e){return"IRotateHandler"==e}},props:{beginRotate:function(e){},updateRotate:function(e,t,n){void 0===n&&(n=!0)},endRotate:function(e){}}}),a),r.StandardRotateHandler=(i=function(e,t,n){this.formaUnderRotation=null,this.initialImagePlacement=null,this.lastAppliedTotalDeltaRadians=0,this.dc=e,this.model=t,this.delegate=n,this.actionScope=null},s.defineClass({name:"StandardRotateHandler",ctor:i,statics:{_implements:function(e){return"IRotateHandler"==e}},props:{beginRotate:function(e){this.lastAppliedTotalDeltaRadians=0},updateRotate:function(e,t,n){var a;if(void 0===n&&(n=!0),null==this.actionScope){if(Math.abs(t)>0){var o,i;s.opt(this.dc,(function(e){return e.undoRedoMgr.beginGesture()})),this.actionScope=s.opt(this.dc,(function(e){return e.undoRedoMgr.gestureScope})),this.formaUnderRotation=s.opt(this.dc,(function(e){return e.selection.formaAt(0)})),((a=s.opt(this.dc,(function(e){return e.selection.inCropMode})))||null!=a)&&a&&(o=u.ImageFacade.getImageFormaForForma(this.formaUnderRotation))&&(this.formaUnderRotation=o,this.initialImagePlacement=s.opt(this.formaUnderRotation,(function(e){return e.placement}))),(i=s.opt(this.formaUnderRotation,(function(e){return e.controller})))&&i.userGroupChild&&!i.enableChildMove&&(this.formaUnderRotation=i.userGroupRoot,this.initialImagePlacement=s.opt(this.formaUnderRotation,(function(e){return e.placement}))),this.applyRotation(e,t,n)}}else this.applyRotation(e,t,n)},endRotate:function(e){var t;(t=this.model)&&(t.beginUpdates(),t.mutable.snapLines.clear(),t.updatesComplete()),null!=this.actionScope&&(s.opt(this.dc,(function(e){return e.undoRedoMgr.endGesture(!0)})),this.actionScope=null)},applyRotation:function(e,t,n){void 0===n&&(n=!0);var a=this,o=this.lastAppliedTotalDeltaRadians;if(t!=this.lastAppliedTotalDeltaRadians){var i,r=t-this.lastAppliedTotalDeltaRadians;if(this.lastAppliedTotalDeltaRadians=t,i=this.formaUnderRotation){var u=e.placement.transformPoint(e.bounds.center);s.opt(this.dc,(function(e){return e.doActionWithCompletion(new c.RotateHandleAction(i,r,u,a.initialImagePlacement,n),(function(e,t){var n,i,r=[];if((n=s.as(e,l.PlacementActionResult))&&(i=n.snapResult)){var c,u,d;if((c=i.snapLines)&&(r=s.clone(c)),u=i.movement){var f=u.transformValues;a.lastAppliedTotalDeltaRadians+=Math.atan2(f.rotSine,f.rotCosine)}(d=a.model)&&(d.beginUpdates(),d.mutable.snapLines.setAll(s.clone(r)),o!=a.lastAppliedTotalDeltaRadians&&s.opt(a.delegate,(function(e){return e.handles.updateHandles(d.mutable.handles)})),d.updatesComplete())}}))}))}}}}}),i)},CMNw:function(e,t,n){var a,o,i,r,s=t,l=n("oAGj"),c=n("Tq01"),u=n("Dz6V"),d=n("yvDn"),f=n("yGNn"),h=n("fNpk");s.IActionHandler=l.defineProtocol("IActionHandler",{canDoAction:"(Action) -> Boolean",doActionWithCallback:"(Action, (ActionResult, Any) -> Void) -> Void",doAction:"(Action) -> CorePromise"}),s.ActionQueue=(a=function(){},l.defineClass({name:"ActionQueue",ctor:a,statics:{queue:[],executingAction:null,append:function(e,t,n){var o=[[e,t],n];a.queue.push(o)},startAction:function(e){h.LegacyCoreAssert.isTrue(null==a.executingAction,"Starting a new action when another is still executing",void 0,"ActionQueue.startAction","ActionHandler.swift",34),a.executingAction=e},finishAction:function(){var e;if(a.executingAction=null,null!=(e=l.first(a.queue))){var t=e[0],n=t[0],o=t[1],i=e[1];a.queue.shift(),i.doActionWithCallback(n,o)}}}}),a),s.NullActionHandler=(o=function(){},i={},l.defineClass({name:"NullActionHandler",ctor:o,statics:{instance:{get:function(){return void 0===i.instance&&(i.instance=new o),i.instance}},_implements:function(e){return"IActionHandler"==e}},props:{canDoAction:function(e){return!1},doActionWithCallback:function(e,t){t(null,null)},doAction:function(e){return f.CorePromise.resolve(null)}}}),o),s.StandardActionHandler=(r=function(e){this.dc=e},l.defineClass({name:"StandardActionHandler",ctor:r,statics:{_implements:function(e){return"IActionHandler"==e}},props:{canDoAction:function(e){var t;return(t=this.dc)?e.canDo(t):(h.LegacyCoreAssert.fail("Still calling actions when the controller has been destroyed",void 0,"StandardActionHandler.canDoAction","ActionHandler.swift",86),!1)},finishAction:function(){var e,t;(e=s.ActionQueue.executingAction)&&e.executionOptions.enableActionFeedback&&l.opt(this.dc,(function(e){return e.designController.actionFeedback.reportActionFeedback(u.ActionFeedback.NONE)})),s.ActionQueue.finishAction(),(t=this.dc)&&t.undoRedoMgr.establishSelectionStates()},doActionWithCallback:function(e,t){var n,a=this;null!=s.ActionQueue.executingAction?s.ActionQueue.append(e,t,this):(n=this.dc)?(s.ActionQueue.startAction(e),l.opt(n.document,(function(o){return o.firstPage.animationController.stopWithCallback((function(){var o=null,i=e.getUserAction(n);if(e.executionOptions.showWaitingFeedback!=u.ActionFeedbackWaitingType.None&&n.designController.actionFeedback.reportActionFeedback(new u.ActionFeedback(e.type,e.executionOptions.showWaitingFeedback)),i.undoable)n.undoRedoMgr.beginUserActionAsync(i).then((function(t){return e.execute(n)})).finished((function(r,s){o=r;var l=a.processResult(e,r);n.undoRedoMgr.endUserActionAsync().then((function(t){return e.updateSelection(n)})).then((function(e){return s?t(c.ActionResult.fromPromiseAny(o),null):t(null,o),null})).finished((function(e,t){a.finishAction(),l||t||h.LegacyCoreAssert.fail("Failed in complete callback for action that's not expected to fail",{action:i.description},"StandardActionHandler.doActionWithCallback","ActionHandler.swift",151)})),l||s||h.LegacyCoreAssert.fail("Failed to execute undoable action that's not expected to fail",{action:i.description},"StandardActionHandler.doActionWithCallback","ActionHandler.swift",155)}));else{var r=l.opt(n.document,(function(e){return e.beginTransaction(i.description)}));e.execute(n).then((function(t){return o=t,a.processResult(e,t),l.opt(r,(function(e){return e.end()})),r=null,t})).then((function(t){return e.updateSelection(n)})).then((function(e){return t(c.ActionResult.fromPromiseAny(o),null)})).fail((function(n){return a.processResult(e,n)||h.LegacyCoreAssert.fail("Failed to execute non-undoable action that's not expected to fail",{action:i.description},"StandardActionHandler.doActionWithCallback","ActionHandler.swift",189),l.opt(r,(function(e){return e.rollback()})),t(null,n),null})).finished((function(e,t){return a.finishAction()}))}}))}))):h.LegacyCoreAssert.fail("Still calling actions when the controller has been destroyed",void 0,"StandardActionHandler.doActionWithCallback","ActionHandler.swift",205)},doAction:function(e){var t=this;return new f.CorePromise((function(n,a){return t.doActionWithCallback(e,(function(e,t){var o;null!=(o=t)?a(o):n(e)}))}))},processResult:function(e,t){var n,a=e.executionOptions,o=!1,i=null;return(n=l.as(t,d.CoreErrorObject))&&(o=n.isAllowedError,a.showMessageFeedback!=u.ActionFeedbackMessageType.None&&(i=n)),e.executionOptions.enableActionFeedback&&l.opt(this.dc,(function(t){return t.designController.actionFeedback.reportActionFeedback(new u.ActionFeedback(e.type,u.ActionFeedbackWaitingType.None,a.showMessageFeedback,i))})),o}}}),r)},Cl7N:function(e,t,n){var a,o=t,i=n("oAGj"),r=n("7siz");o.ISnapLinesModel=i.defineProtocol("ISnapLinesModel",{getAll:"() -> Array<AlignmentLine>"}),o.SnapLinesState=(a=function(e){void 0===e&&(e=null),this.snaplines=i.clone(e||[])},i.defineClass({name:"SnapLinesState",ctor:a,superName:"EditorStateMember",statics:{_implements:function(e){return"ISnapLinesModel"==e}},props:{clone:function(){return new a(i.clone(this.snaplines))},getAll:function(){return this.snaplines},clear:function(){this.setAll([])},setAll:function(e){this.beforeChange(),this.snaplines=i.clone(e),this.afterChange()},diff:function(e){if(e.snaplines.length!=this.snaplines.length)return[r.EditorModelChangedMessage.CHG_SNAPLINES];for(var t=i.iter(i.range(0,this.snaplines.length,!1));!t.done;t.next()){var n=t.value;if(!e.snaplines.includes(this.snaplines[n]))return[r.EditorModelChangedMessage.CHG_SNAPLINES]}return[]}}}),a)},D89E:function(e,t,n){var a,o=t,i=n("oAGj"),r=n("1HsO"),s=n("tGKA");o.SwapModeHandleGenerator=(a=function(){this.swapTarget=null},i.defineClass({name:"SwapModeHandleGenerator",ctor:a,statics:{_implements:function(e){return"IHandleGenerator"==e}},props:{setSwapTargetForma:function(e){this.swapTarget=e},clearSwapTargetForma:function(){this.swapTarget=null},addHandles:function(e){var t=null;return null!=this.swapTarget&&(t=this.swapTarget.finalFrame),null==t?[]:[new r.BoxTransformHandles(new r.BoxReference(s.Matrix2D.Identity,t),[r.TransformType.Translate],[],r.TransformType.None,"")]}}}),a)},Dz6V:function(e,t,n){var a,o,i,r=t,s=n("oAGj"),l=n("7siz");r.IActionFeedbackModel=s.defineProtocol("IActionFeedbackModel",{getActionFeedback:"() -> ActionFeedback"}),r.ActionFeedbackWaitingType=s.defineEnum("ActionFeedbackWaitingType",{None:0,Loading:1}),r.ActionFeedbackMessageType=s.defineEnum("ActionFeedbackMessageType",{None:0,Error:1,Info:2}),r.ActionFeedback=(a=function(e,t,n,a){void 0===t&&(t=r.ActionFeedbackWaitingType.None),void 0===n&&(n=r.ActionFeedbackMessageType.None),void 0===a&&(a=null),this.actionType=e,this.showWaiting=t,this.messageType=n,this.message=a},o={},s.defineClass({name:"ActionFeedback",ctor:a,superName:"CoreObject",statics:{NONE:{get:function(){return void 0===o.NONE&&(o.NONE=new a(null,r.ActionFeedbackWaitingType.None,r.ActionFeedbackMessageType.None,null)),o.NONE}}},props:{equals:function(e){var t;return!!(t=e)&&this.actionType==t.actionType&&this.showWaiting==t.showWaiting&&this.messageType==t.messageType&&(null==this.message&&null==t.message||null!=this.message&&this.message.equals(t.message))}}}),a),r.ActionFeedbackState=(i=function(e){void 0===e&&(e=r.ActionFeedback.NONE),this.feedback=e},s.defineClass({name:"ActionFeedbackState",ctor:i,superName:"EditorStateMember",statics:{_implements:function(e){return"IActionFeedbackModel"==e}},props:{clone:function(){return new i(this.feedback)},getActionFeedback:function(){return this.feedback},setActionFeedback:function(e){this.beforeChange(),this.feedback=e,this.afterChange()},diff:function(e){return this.feedback.equals(e.feedback)?[]:[l.EditorModelChangedMessage.CHG_ACTION_FEEDBACK_STATE]}}}),i)},EGPT:function(e,t,n){var a,o,i=t,r=n("oAGj"),s=n("7siz");i.Annotation=(a=function(e,t,n){void 0===t&&(t=i.AnnotationPriority.Normal),void 0===n&&(n=null),this.priority=t,this.id=e,this.customData=r.clone(n)},r.defineClass({name:"Annotation",ctor:a,superName:"CoreObject"}),a),i.AnnotationID=r.defineEnum("AnnotationID",{TextTruncated:0,TooMuchCurvedText:1,TooMuchGridText:2,ImageTooBig:10}),i.AnnotationPriority=r.defineEnum("AnnotationPriority",{High:0,Normal:1}),i.IAnnotationsModel=r.defineProtocol("IAnnotationsModel",{getAll:"() -> Array<Annotation>",getFirst:"() -> Annotation"}),i.IMutableAnnotationsModel=r.defineProtocol("IMutableAnnotationsModel",{clear:"() -> Void",setAll:"(Array<Annotation>) -> Void"}),i.AnnotationState=(o=function(e){void 0===e&&(e=null),this.annotations=r.clone(e||[])},r.defineClass({name:"AnnotationState",ctor:o,superName:"EditorStateMember",statics:{equal:function(e,t){if(e.length!=t.length)return!1;for(var n=r.clone(o.sort(r.clone(e))),a=r.clone(o.sort(r.clone(t))),i=r.iter(r.toSequence(n));!i.done;i.next()){var s=i.value,l=s.offset,c=s.element,u=a[l];if(c.priority!=u.priority||c.id!=u.id)return!1}return!0},sort:function(e){return r.sort(e,(function(e,t){return e.priority>t.priority||e.priority==t.priority&&e.id>t.id}))},_implements:function(e){return"IMutableAnnotationsModel"==e||"IAnnotationsModel"==e}},props:{clone:function(){return new o(r.clone(this.annotations))},getAll:function(){return this.annotations},getFirst:function(){return r.first(this.annotations)},clear:function(){this.setAll([])},setAll:function(e){this.beforeChange(),this.annotations=r.clone(o.sort(r.clone(e))),this.afterChange()},diff:function(e){return o.equal(r.clone(this.annotations),r.clone(e.annotations))?[]:[s.EditorModelChangedMessage.CHG_ANNOTATIONS]}}}),o)},G9CY:function(e,t,n){var a,o,i,r=t,s=n("oAGj"),l=n("Tq01"),c=n("H1Z2"),u=n("oKlP");r.IMoveHandler=s.defineProtocol("IMoveHandler",{beginMove:"(BoxReference) -> Void",updateMove:"(BoxReference, TheoPoint, Double) -> Void",endMove:"(BoxReference) -> Void"}),r.NullMoveHandler=(a=function(){},o={},s.defineClass({name:"NullMoveHandler",ctor:a,statics:{instance:{get:function(){return void 0===o.instance&&(o.instance=new a),o.instance}},_implements:function(e){return"IMoveHandler"==e}},props:{beginMove:function(e){},updateMove:function(e,t,n){},endMove:function(e){}}}),a),r.StandardMoveHandler=(i=function(e,t,n){this.formaUnderMove=null,this.lastAppliedTotalDelta=u.TheoPoint.ZERO,this.dc=e,this.model=t,this.delegate=n,this.actionScope=null},s.defineClass({name:"StandardMoveHandler",ctor:i,statics:{_implements:function(e){return"IMoveHandler"==e}},props:{beginMove:function(e){this.lastAppliedTotalDelta=u.TheoPoint.ZERO},updateMove:function(e,t,n){var a;null==this.actionScope?t.isEqual(u.TheoPoint.ZERO)||(s.opt(this.dc,(function(e){return e.undoRedoMgr.beginGesture()})),this.actionScope=s.opt(this.dc,(function(e){return e.undoRedoMgr.gestureScope})),this.formaUnderMove=s.opt(this.dc,(function(e){return e.selection.formaAt(0)})),(a=s.opt(this.formaUnderMove,(function(e){return e.controller})))&&a.userGroupChild&&!this.dc.enableMoveableChildren&&(this.formaUnderMove=s.opt(this.formaUnderMove,(function(e){return e.parent}))),this.applyMove(e,t,n)):this.applyMove(e,t,n)},endMove:function(e){var t;(t=this.model)&&(t.beginUpdates(),t.mutable.snapLines.clear(),t.updatesComplete(),null!=this.actionScope&&(s.opt(this.dc,(function(e){return e.undoRedoMgr.endGesture(!0)})),this.actionScope=null))},applyMove:function(e,t,n){var a=this,o=this.lastAppliedTotalDelta;if(!t.isEqual(this.lastAppliedTotalDelta)){var i,r=u._minus_TheoPoint_TheoPoint(t,this.lastAppliedTotalDelta);if(this.lastAppliedTotalDelta=t,i=this.formaUnderMove){var d=e.placement.transformPoint(e.bounds.center);s.opt(this.dc,(function(e){return e.doActionWithCompletion(new c.MoveHandleAction(i,r,d,n),(function(e,t){var n,i,r=[];if((n=s.as(e,l.PlacementActionResult))&&(i=n.snapResult)){var c,d,f;if((c=i.snapLines)&&(r=s.clone(c)),d=i.movement){var h=d.transformValues;a.lastAppliedTotalDelta=a.lastAppliedTotalDelta.add(new u.TheoPoint(h.tx,h.ty))}(f=a.model)&&(f.beginUpdates(),f.mutable.snapLines.setAll(s.clone(r)),o!=a.lastAppliedTotalDelta&&s.opt(a.delegate,(function(e){return e.handles.updateHandles(f.mutable.handles)})),f.updatesComplete())}}))}))}}}}}),i)},H3ZP:function(e,t,n){var a,o=t,i=n("oAGj"),r=n("Nk+Q"),s=n("UUXZ"),l=n("elwG"),c=n("u+mS"),u=n("25Jq"),d=n("aKgf");o.CropModeDesignController=(a=function(e,t){u.SingleSelectionDesignController.call(this,e,t),this.drag=new c.CroppingDragFacadeBasedDragHandler(e,t,this),this.click=new l.CropModeClickHandler(e),this.actionFeedback=new r.StandardActionFeedbackHandler(t),this.annotations=new s.StandardAnnotationsHandler(t),this.view=new d.StandardViewHandler(e,t)},i.defineClass({name:"CropModeDesignController",ctor:a,superName:"SingleSelectionDesignController"}),a)},"JU+l":function(e,t,n){var a,o,i,r,s=t,l=n("oAGj"),c=n("wNKJ"),u=n("FNB+"),d=n("Pil/"),f=n("P83h"),h=n("ZK0l"),p=n("pnSN"),m=n("H1Z2"),g=n("NkBu"),v=n("fNpk"),S=n("MYNe"),w=n("tGKA"),b=n("JFv5"),A=n("voLh"),T=n("T6jX"),H=n("oKlP"),C=n("sIWg");s.IResizeHandler=l.defineProtocol("IResizeHandler",{handleBeginSelectionBoxResize:"(BoxReference, TheoPoint) -> Void",handleSelectionBoxResize:"(BoxReference, TheoPoint, TheoPoint, Double) -> Void",handleEndSelectionBoxResize:"(BoxReference, TheoPoint) -> Void"}),s.NullResizeHandler=(a=function(){},o={},l.defineClass({name:"NullResizeHandler",ctor:a,statics:{instance:{get:function(){return void 0===o.instance&&(o.instance=new a),o.instance}},_implements:function(e){return"IResizeHandler"==e}},props:{handleBeginSelectionBoxResize:function(e,t){},handleSelectionBoxResize:function(e,t,n,a){},handleEndSelectionBoxResize:function(e,t){}}}),a),s.locate=function(e,t,n){return new H.TheoPoint((e.x-t.x)/(n.x-t.x),(e.y-t.y)/(n.y-t.y))},s.eval=function(e,t,n){return new H.TheoPoint((1-e.x)*t.x+e.x*n.x,(1-e.y)*t.y+e.y*n.y)},s.SingleItemResizeHandler=(i=function(e,t,n,a){this.dc=e,this.model=t,this.forma=n,this.delegate=a},l.defineClass({name:"SingleItemResizeHandler",ctor:i,statics:{_implements:function(e){return"IResizeHandler"==e}},props:{handleBeginSelectionBoxResize:function(e,t){var n=this;l.opt(this.dc,(function(e){return e.undoRedoMgr.beginGesture()})),l.opt(this.forma.controller,(function(e){return e.onEvent(new d.BeginFormaResizeEvent(n.forma,t))}))},handleSelectionBoxResize:function(e,t,n,a){var o,i,r,c=this,u=Math.sqrt(Math.abs(e.placement.determinant))*Math.abs(a),d=new H.TheoPoint(1-t.x,1-t.y),f=e.bounds,h=e.placement.inverse.transformPoint(n),p=!(o=l.opt(this.forma.controller,(function(e){return e.maintainAspectRatio})))&&null==o||o,v=s.locate(h,e.bounds.eval(d),e.bounds.eval(t));if(isFinite(v.x)&&v.x<0||isFinite(v.y)&&v.y<0){if(0!=p)return;if(isFinite(v.x)&&v.x<0&&v.x>-1&&(v=new H.TheoPoint(1,v.y)),isFinite(v.y)&&v.y<0&&v.y>-1&&(v=new H.TheoPoint(v.x,1)),isFinite(v.x)&&v.x<0||isFinite(v.y)&&v.y<0)return;h=e.bounds.eval(v)}r=.5==t.x?C.TheoRect.fromPoints(f.evalXY(0,d.y),new H.TheoPoint(f.maxX,h.y)):.5==t.y?C.TheoRect.fromPoints(f.evalXY(d.x,0),new H.TheoPoint(h.x,f.maxY)):C.TheoRect.fromPoints(f.eval(d),h);var S=this.forma.placement.extractedScale;r=r.scaleXY(S.scale.x,S.scale.y);var w=50/u,b=10/u;if(this.forma.controller instanceof g.ImageController&&(w=100/u,b=100/u),r.width<b){var A=b/r.width;r=r.scaleXY(A,1,d)}r.height<b&&(A=b/r.height,r=r.scaleXY(1,A,d));var T=f.width+f.height,F=r.width+r.height;r.width<f.width&&r.width<b||r.height<f.height&&r.height<b||F<T&&F<w||l.opt(this.dc,(function(e){return e.doActionWithCompletion(new m.ResizeHandleAction(c.forma,t,d,r,!(!(i=l.opt(c.dc,(function(e){return e.selection.inSpacingMode})))&&null==i)&&i),(function(e,t){var n,a;(n=c.model)&&(a=c.delegate)&&(n.beginUpdates(),a.handles.updateHandles(n.mutable.handles),n.updatesComplete())}))}))},handleEndSelectionBoxResize:function(e,t){var n,a=this;l.opt(this.dc,(function(e){return e.undoRedoMgr.endGesture(!0)}));var o=l.opt(l.opt(this.dc,(function(e){return e.document})),(function(e){return e.beginTransaction("finish_resize")}));l.opt(this.forma.controller,(function(e){return e.onEvent(new d.EndFormaResizeEvent(a.forma))}));var i=new H.TheoPoint(1-t.x,1-t.y);0==(!(n=l.opt(this.forma.controller,(function(e){return e.maintainAspectRatio})))&&null==n||n)&&(0!=i.x&&1!=i.x||(i=new H.TheoPoint(i.x,.5))),c.DragFacade.rescueFormaToPageBounds(this.forma,void 0,void 0,i),l.opt(o,(function(e){return e.mergeWithPrevious()}))}}}),i),s.MultiObjectResizeHandler=(r=function(e,t,n,a){this.group_=null,this.passedARThreshold_=!1,this.dc=e,this.model=t,this.formae_=S.LayerFacade.sortInZOrder(l.clone(n)).filter((function(e){return null!=e.controller}),this),this.delegate=a},l.defineClass({name:"MultiObjectResizeHandler",ctor:r,statics:{_implements:function(e){return"IResizeHandler"==e}},props:{handleBeginSelectionBoxResize:function(e,t){var n,a;if(0!=this.formae_.length){var o=l.opt(l.opt(this.dc,(function(e){return e.document})),(function(e){return e.beginTransaction("create_resize_group")}));this.passedARThreshold_=!1;for(var i,r,s,c,f,m,g=!0,S=null,H=l.iter(this.formae_);!H.done;H.next()){var F=H.value;((n=l.opt(F.controller,(function(e){return e.userGroupMember})))||null!=n)&&n?null==S?S=F.controller.enableChildMove?F.controller.userGroup?l.as(F,p.GroupForma):F.parent:F.controller.userGroupRoot||l.as(F,p.GroupForma):S!=F.parent&&(g=!1):g=!1}if(g&&(i=S)&&(r=i.finalFrame))return this.group_=i,this.startSize_=r.size,(f=i.controller).preferredResizeType=b.ResizeLayoutType.Proportional,f.preserveResizeController=!0,l.opt(o,(function(e){return e.end()})),void l.opt(this.dc,(function(e){return e.undoRedoMgr.beginGesture()}));if(this.group_=l.as(l.opt(this.formae_[0].parent,(function(e){return e.page.createFormaWithController(p.GroupForma.KIND,h.GroupController.KIND)})),p.GroupForma),(s=this.formae_[0].parent)&&(c=this.group_)&&(f=l.as(c.controller,h.GroupController))&&(m=T.TheoDocumentUtils.unionFinalFrame(l.clone(this.formae_)))){var M=(a=s.indexOfChild(this.formae_[0]))||null!=a?a:s.childCount;s.insertChildAt(c,M),f.preferredResizeType=b.ResizeLayoutType.Proportional,f.preserveResizeController=!0,c.placement=w.Matrix2D.translationXY(m.minX,m.minY),c.bounds=C.TheoRect.fromSize(m.size),c.intent=u.Forma.INTENT_INFERRED_TEMP_GROUP;for(var y=l.iter(this.formae_);!y.done;y.next())F=y.value,c.appendChild(F,!0);l.opt(l.as(f.resizeLayoutController,A.ProportionalLayoutController),(function(e){return e.setInitBounds()})),this.startSize_=m.size,f.onEvent(new d.BeginFormaResizeEvent(c,t)),l.opt(this.dc,(function(e){return e.selection.selectForma(c,!1)}))}l.opt(o,(function(e){return e.end()})),l.opt(this.dc,(function(e){return e.undoRedoMgr.beginGesture()}))}else v.LegacyCoreAssert.fail("no children to multi-select resize",void 0,"MultiObjectResizeHandler.handleBeginSelectionBoxResize","ResizeHandler.swift",212)},handleSelectionBoxResize:function(e,t,n,a){var o=this;if(null!=this.group_){var i=Math.sqrt(Math.abs(e.placement.determinant))*Math.abs(a),r=new H.TheoPoint(1-t.x,1-t.y),c=e.bounds,u=e.placement.inverse.transformPoint(n),d=s.locate(u,e.bounds.eval(r),e.bounds.eval(t));if(!(isFinite(d.x)&&d.x<0||isFinite(d.y)&&d.y<0)){var h,p=50/i,g=10/i;if(!((h=.5==t.x?C.TheoRect.fromPoints(c.evalXY(0,r.y),new H.TheoPoint(c.maxX,u.y)):.5==t.y?C.TheoRect.fromPoints(c.evalXY(r.x,0),new H.TheoPoint(u.x,c.maxY)):C.TheoRect.fromPoints(c.eval(r),u)).width<g||h.height<g||h.width+h.height<p)){var v=h.size;if(null!=this.startSize_){var S=this.startSize_.similarity(v);S<.04?(S<.01&&(this.passedARThreshold_=!1),this.passedARThreshold_||(v=this.startSize_.myAspectRatioClosestCorner(v))):this.passedARThreshold_=!0}var w=new f.FormaAnimationTransactionEvent(this.group_);w.duration=0,this.group_.beginUpdate(w),l.opt(this.dc,(function(e){return e.doActionWithCompletion(new m.ResizeHandleAction(o.group_,t,r,C.TheoRect.fromSize(v)),(function(e,t){var n,a,i;(n=o.group_)&&n.endUpdate(w),(a=o.model)&&(i=o.delegate)&&(a.beginUpdates(),i.handles.updateHandles(a.mutable.handles),a.updatesComplete())}))}))}}}},handleEndSelectionBoxResize:function(e,t){var n,a,o=this;l.opt(this.dc,(function(e){return e.undoRedoMgr.endGesture(!0)}));var i=l.opt(l.opt(this.dc,(function(e){return e.document})),(function(e){return e.beginTransaction("create_resize_group")}));if(l.opt(l.opt(this.group_,(function(e){return e.controller})),(function(e){return e.onEvent(new d.EndFormaResizeEvent(o.group_))})),!(n=l.opt(l.opt(this.group_,(function(e){return e.controller})),(function(e){return e.userGroup})))&&null==n||!n){l.opt(this.dc,(function(e){return e.selection.deselectForma(o.group_,!1)}));for(var r=l.iter(this.formae_);!r.done;r.next()){var s=r.value,c=(a=this.group_.parent.indexOfChild(this.group_))||null!=a?a:this.group_.childCount;this.group_.parent.insertChildAt(s,c,!0)}l.opt(this.group_,(function(e){return e.removeFromParent()})),this.group_=null}l.opt(i,(function(e){return e.mergeWithPrevious()}))}}}),r)},"McK+":function(e,t,n){var a,o,i=t,r=n("oAGj"),s=n("Dz6V"),l=n("EGPT"),c=n("bccX"),u=n("mD2h"),d=n("gXiO"),f=n("QLmq"),h=n("d820"),p=n("fNpk"),m=n("Cl7N"),g=n("36r7");i.EditorModelState=(a=function(e,t,n,a,o,i,r,d){this.mutable_=!1,void 0===e&&(e=new c.AttributesState),void 0===t&&(t=new f.FeatureSetsState),void 0===n&&(n=new h.HandlesState),void 0===a&&(a=new u.ActiveSwapState),void 0===o&&(o=new m.SnapLinesState),void 0===i&&(i=new s.ActionFeedbackState),void 0===r&&(r=new l.AnnotationState),void 0===d&&(d=new g.ViewState),this.attributes=e,this.featureSets=t,this.handles=n,this.activeSwap=a,this.snapLines=o,this.actionFeedback=i,this.annotations=r,this.view=d},r.defineClass({name:"EditorModelState",ctor:a,statics:{_implements:function(e){return"IMutableEditorModel"==e}},props:{clone:function(){return new a(this.attributes.clone(),this.featureSets.clone(),this.handles.clone(),this.activeSwap.clone(),this.snapLines.clone(),this.actionFeedback.clone(),this.annotations.clone(),this.view.clone())},calculateChanges:function(e){var t=[];return r.append(t,this.attributes.diff(e.attributes)),r.append(t,this.featureSets.diff(e.featureSets)),r.append(t,this.handles.diff(e.handles)),r.append(t,this.activeSwap.diff(e.activeSwap)),r.append(t,this.snapLines.diff(e.snapLines)),r.append(t,this.actionFeedback.diff(e.actionFeedback)),r.append(t,this.annotations.diff(e.annotations)),r.append(t,this.view.diff(e.view)),t},mutable:{get:function(){return this.mutable_},set:function(e){e!=this.mutable_&&(this.mutable_=e,this.attributes.mutable=e,this.featureSets.mutable=e,this.handles.mutable=e,this.activeSwap.mutable=e,this.snapLines.mutable=e,this.actionFeedback.mutable=e,this.annotations.mutable=e,this.view.mutable=e)}}}}),a),i.EditorStateMember=(o=function(){this.mutable=!1,d.CoreObject.call(this)},r.defineClass({name:"EditorStateMember",ctor:o,superName:"CoreObject",props:{beforeChange:function(){p.LegacyCoreAssert.isTrue(this.mutable,"editor state is read-only",void 0,"EditorStateMember.beforeChange","EditorModelState.swift",111)},afterChange:function(){}}}),o)},Mr7n:function(e,t,n){var a,o=t,i=n("oAGj"),r=n("Pil/"),s=n("1HsO"),l=n("oKlP");o.StandardHandleProcessor=(a=function(e){this.model=e},i.defineClass({name:"StandardHandleProcessor",ctor:a,statics:{_implements:function(e){return"IHandleProcessor"==e}},props:{updateHandles:function(e){this.model.beginUpdates(),e.updateHandles(this.model.mutable.handles),this.model.updatesComplete()},handleTransformEvent:function(e,t){var n,a,o,r,l;if(n=i.as(t.handle,s.BoxTransformHandles))if(a=i.as(t,s.MoveTransformEvent))switch(a.stage){case 0:e.activeTransform=s.TransformType.Translate,i.opt(e.delegate,(function(e){return e.move.beginMove(n.reference)})),this.updateHandles(e);break;case 1:i.opt(e.delegate,(function(e){return e.move.updateMove(n.reference,a.totalDelta,a.viewportScale)}));break;case 2:e.activeTransform=s.TransformType.None,i.opt(e.delegate,(function(e){return e.move.endMove(n.reference)})),this.updateHandles(e)}else if(o=i.as(t,s.RotateAboutCenterTransformEvent))switch(o.stage){case 0:e.activeTransform=s.TransformType.RotateAboutCenter,i.opt(e.delegate,(function(e){return e.rotate.beginRotate(n.reference)})),this.updateHandles(e);break;case 1:i.opt(e.delegate,(function(e){return e.rotate.updateRotate(n.reference,o.totalDeltaRadians,o.doSnapping)}));break;case 2:e.activeTransform=s.TransformType.None,i.opt(e.delegate,(function(e){return e.rotate.endRotate(n.reference)})),this.updateHandles(e)}else if(r=i.as(t,s.CornerTranslateTransformEvent)){var c=this.canonicalPointForTransformType(r.transformType);switch(r.stage){case 0:e.activeTransform=r.transformType,i.opt(e.delegate,(function(e){return e.resize.handleBeginSelectionBoxResize(n.reference,c)})),this.updateHandles(e);break;case 1:i.opt(e.delegate,(function(e){return e.resize.handleSelectionBoxResize(n.reference,c,r.position,r.viewportScale)}));break;case 2:e.activeTransform=s.TransformType.None,i.opt(e.delegate,(function(e){return e.resize.handleEndSelectionBoxResize(n.reference,c)})),this.updateHandles(e)}}else if(l=i.as(t,s.SideTranslateTransformEvent))switch(c=this.canonicalPointForTransformType(l.transformType),l.stage){case 0:e.activeTransform=l.transformType,i.opt(e.delegate,(function(e){return e.resize.handleBeginSelectionBoxResize(n.reference,c)})),this.updateHandles(e);break;case 1:i.opt(e.delegate,(function(e){return e.resize.handleSelectionBoxResize(n.reference,c,l.position,l.viewportScale)}));break;case 2:e.activeTransform=s.TransformType.None,i.opt(e.delegate,(function(e){return e.resize.handleEndSelectionBoxResize(n.reference,c)})),this.updateHandles(e)}return!0},handleFormaDragEvents:function(e,t){return t instanceof r.BeginFormaDragEvent&&(e.activeTransform=s.TransformType.Translate,this.updateHandles(e)),i.opt(e.delegate,(function(e){return e.drag.handleFormaDragEvents(t)})),t instanceof r.EndFormaDragEvent&&(e.activeTransform=s.TransformType.None,this.updateHandles(e)),!0},canonicalPointForTransformType:function(e){switch(e){case 4:return new l.TheoPoint(0,0);case 5:return new l.TheoPoint(1,0);case 6:return new l.TheoPoint(0,1);case 7:return new l.TheoPoint(1,1);case 10:return new l.TheoPoint(.5,0);case 11:return new l.TheoPoint(.5,1);case 8:return new l.TheoPoint(0,.5);case 9:case 12:return new l.TheoPoint(1,.5);case 13:return new l.TheoPoint(.5,1);default:return l.TheoPoint.ZERO}}}}),a)},"Nk+Q":function(e,t,n){var a,o,i,r=t,s=n("oAGj");r.IActionFeedbackHandler=s.defineProtocol("IActionFeedbackHandler",{reportActionFeedback:"(ActionFeedback) -> Void"}),r.NullActionFeedbackHandler=(a=function(){},o={},s.defineClass({name:"NullActionFeedbackHandler",ctor:a,statics:{instance:{get:function(){return void 0===o.instance&&(o.instance=new a),o.instance}},_implements:function(e){return"IActionFeedbackHandler"==e}},props:{reportActionFeedback:function(e){}}}),a),r.StandardActionFeedbackHandler=(i=function(e){this.model=e},s.defineClass({name:"StandardActionFeedbackHandler",ctor:i,statics:{_implements:function(e){return"IActionFeedbackHandler"==e}},props:{reportActionFeedback:function(e){s.opt(this.model,(function(e){return e.beginUpdates()})),s.opt(this.model,(function(t){return t.mutable.actionFeedback.setActionFeedback(e)})),s.opt(this.model,(function(e){return e.updatesComplete()}))}}}),i)},PSFa:function(e,t,n){var a,o,i,r=t,s=n("oAGj"),l=n("5+WR"),c=n("ascj"),u=n("AnBp"),d=n("FNB+"),f=n("lmwz"),h=n("37nf"),p=n("T8w7"),m=n("umUn");r.IAttributesHandler=s.defineProtocol("IAttributesHandler",{updateAttributes:"(AttributesState) -> Void"}),r.NullAttributesHandler=(a=function(){},o={},s.defineClass({name:"NullAttributesHandler",ctor:a,statics:{instance:{get:function(){return void 0===o.instance&&(o.instance=new a),o.instance}},_implements:function(e){return"IAttributesHandler"==e}},props:{updateAttributes:function(e){}}}),a),r.IAttributeHandler=s.defineProtocol("IAttributeHandler",{calculate:"(DocumentController) -> Array<IEditorAttribute>"}),r.AttributeHandlerBase=(i=function(){},s.defineClass({name:"AttributeHandlerBase",ctor:i}),i),r.ImageAttributeHandler=function(){var e=function(){r.AttributeHandlerBase.call(this)},t={};return s.defineClass({name:"ImageAttributeHandler",ctor:e,superName:"AttributeHandlerBase",statics:{instance:{get:function(){return void 0===t.instance&&(t.instance=new e),t.instance}},_implements:function(e){return"IAttributeHandler"==e}},props:{calculate:function(e){var t=[];return s.opt(e,(function(e){return e.selection.forEachSelected((function(e){var n=f.ImageFacade.getImageStyleForForma(e);if(null!=n){for(var a=!1,o=s.iter(t);!o.done;o.next()){var i=o.value;if(n.equals(i)){a=!0;break}}a||t.push(n)}}))})),[new u.ImageAttribute(s.clone(t))]}}}),e}(),r.OpacityAttributeHandler=function(){var e=function(){r.AttributeHandlerBase.call(this)},t={};return s.defineClass({name:"OpacityAttributeHandler",ctor:e,superName:"AttributeHandlerBase",statics:{instance:{get:function(){return void 0===t.instance&&(t.instance=new e),t.instance}},_implements:function(e){return"IAttributeHandler"==e}},props:{calculate:function(e){var t=[];return s.opt(e,(function(e){return e.selection.forEachSelected((function(e){var n=p.OpacityFacade.getOpacityForForma(e);t.includes(n)||t.push(n)}))})),[new u.OpacityAttribute(s.clone(t))]}}}),e}(),r.ControllerSettingAttributeHandler=function(){var e=function(){r.AttributeHandlerBase.call(this)},t={};return s.defineClass({name:"ControllerSettingAttributeHandler",ctor:e,superName:"AttributeHandlerBase",statics:{instance:{get:function(){return void 0===t.instance&&(t.instance=new e),t.instance}},_implements:function(e){return"IAttributeHandler"==e}},props:{calculate:function(e){var t=[];return s.opt(e,(function(e){return e.selection.forEachSelected((function(e){var n=s.opt(e.controller,(function(e){return e.settings}));null!=n&&t.push(n)}))})),[new u.ControllerSettingAttribute(s.clone(t))]}}}),e}(),r.MediaMetadataAttributeHandler=function(){var e=function(){r.AttributeHandlerBase.call(this)},t={};return s.defineClass({name:"MediaMetadataAttributeHandler",ctor:e,superName:"AttributeHandlerBase",statics:{instance:{get:function(){return void 0===t.instance&&(t.instance=new e),t.instance}},_implements:function(e){return"IAttributeHandler"==e}},props:{calculate:function(e){var t=[];return s.opt(e,(function(e){return e.selection.forEachSelected((function(e){var n=h.ImageUtils.getMediaMetadataForForma(e);null!=n&&t.push(n)}))})),[new u.MediaMetadataAttribute(s.clone(t))]}}}),e}(),r.ColorAttributeHandler=function(){var e=function(){r.AttributeHandlerBase.call(this)},t={};return s.defineClass({name:"ColorAttributeHandler",ctor:e,superName:"AttributeHandlerBase",statics:{instance:{get:function(){return void 0===t.instance&&(t.instance=new e),t.instance}},_implements:function(e){return"IAttributeHandler"==e}},props:{calculate:function(e){var t=s.clone(s.opt(e,(function(e){return e.selection.IDs}))||[]),n=[];if(0==t.length);else if(1==t.length){var a,o,i;if(a=s.opt(s.opt(e,(function(e){return e.document})),(function(e){return e.firstPage.formaByID(t[0])})))if(null!=(o=a.style.colors.colorID(c.ColorRole.FieldPrimary)))(i=a.page.colorLibraryController.getTheoColorForKey(o))?n.push(i):n.push(null);else n.push(null)}else{var r=!0;if(s.opt(e,(function(e){return e.selection.forEachSelected((function(e){e.hasIntent(d.Forma.INTENT_GRID_CELL)||"Root"==e.kind||(r=!1)}))})),r){n=[];var l=[];s.opt(e,(function(e){return e.selection.forEachSelected((function(e){var t,a;null!=(t=e.style.colors.colorID(c.ColorRole.FieldPrimary))?(a=e.page.colorLibraryController.getTheoColorForKey(t))?n.push(a):n.push(null):n.push(null)}))})),n.length>0&&l.push(n[0]);for(var f=s.iter(s.range(0,n.length-1,!0));!f.done;f.next()){var h=f.value;if(!s.eq(m._equality_TheoColor_TheoColor,l[0],n[h])){l[0]=null;break}}n=s.clone(l)}}return[new u.ColorAttribute(s.clone(n))]}}}),e}(),r.StandardAttributesHandler=function(){var e=function(e){this.dc=e},t={};return s.defineClass({name:"StandardAttributesHandler",ctor:e,statics:{handlers:{get:function(){return void 0===t.handlers&&(t.handlers=e.allHandlers()),t.handlers}},allHandlers:function(){var e=[];return e.push(r.OpacityAttributeHandler.instance),e.push(r.MediaMetadataAttributeHandler.instance),e.push(r.ImageAttributeHandler.instance),e.push(r.ColorAttributeHandler.instance),e.push(r.ControllerSettingAttributeHandler.instance),e.push(l.AnimationAttributesHandler.instance),e},_implements:function(e){return"IAttributesHandler"==e}},props:{updateAttributes:function(t){this.updateFrom(t,s.clone(e.handlers))},updateFrom:function(e,t){e.clear();for(var n=s.iter(t);!n.done;n.next())for(var a=n.value,o=s.clone(a.calculate(this.dc)),i=s.iter(o);!i.done;i.next()){var r=i.value;e.add(r)}}}}),e}()},QLFD:function(e,t,n){var a,o=t,i=n("oAGj"),r=n("Nk+Q"),s=n("CMNw"),l=n("UUXZ"),c=n("PSFa"),u=n("elwG"),d=n("qUXk"),f=n("u+mS"),h=n("eLsM"),p=n("hsXA"),m=n("JU+l"),g=n("aKgf");o.NoSelectionDesignController=(a=function(e,t){d.DesignController.call(this),this.handles=new p.StandardHandlesHandler(e,t,this),this.drag=new f.DragFacadeBasedDragHandler(e,t,this),this.click=new u.StandardClickHandler(e),this.resize=m.NullResizeHandler.instance,this.actions=new s.StandardActionHandler(e),this.attributes=new c.StandardAttributesHandler(e),this.featureSets=new h.StandardFeatureSetHandler(e),this.actionFeedback=new r.StandardActionFeedbackHandler(t),this.annotations=new l.StandardAnnotationsHandler(t),this.view=new g.StandardViewHandler(e,t)},i.defineClass({name:"NoSelectionDesignController",ctor:a,superName:"DesignController"}),a)},QLmq:function(e,t,n){var a,o=t,i=n("oAGj"),r=n("7siz");o.IFeatureSetsModel=i.defineProtocol("IFeatureSetsModel",{find:"(String) -> IFeatureSet"}),o.FeatureSetsState=(a=function(e){void 0===e&&(e=null),this.featureSets=i.clone(e||{})},i.defineClass({name:"FeatureSetsState",ctor:a,superName:"EditorStateMember",statics:{_implements:function(e){return"IFeatureSetsModel"==e}},props:{clone:function(){return new a(i.clone(this.featureSets))},find:function(e){return this.featureSets[e]},clear:function(){this.beforeChange(),i.removeAll(this.featureSets),this.afterChange()},add:function(e){this.beforeChange(),this.featureSets[e.key]=e,this.afterChange()},remove:function(e){this.beforeChange(),i.removeKey(this.featureSets,e),this.afterChange()},diff:function(e){for(var t=[],n=i.iter(this.featureSets);!n.done;n.next()){var a,o=n.key,s=n.value;(a=e.featureSets[o])&&s.isEqualTo(a)||t.push(r.EditorModelChangedMessage.CHG_FEATURE_SET_PREFIX+o)}for(var l=i.iter(e.featureSets);!l.done;l.next())o=l.key,null==this.featureSets[o]&&t.push(r.EditorModelChangedMessage.CHG_FEATURE_SET_PREFIX+o);return t}}}),a)},UUXZ:function(e,t,n){var a,o,i,r=t,s=n("oAGj");r.IAnnotationsHandler=s.defineProtocol("IAnnotationsHandler",{updateAnnotations:"(IMutableAnnotationsModel) -> Void"}),r.NullAnnotationsHandler=(a=function(){},o={},s.defineClass({name:"NullAnnotationsHandler",ctor:a,statics:{instance:{get:function(){return void 0===o.instance&&(o.instance=new a),o.instance}},_implements:function(e){return"IAnnotationsHandler"==e}},props:{updateAnnotations:function(e){}}}),a),r.StandardAnnotationsHandler=(i=function(e){this.model=e},s.defineClass({name:"StandardAnnotationsHandler",ctor:i,statics:{_implements:function(e){return"IAnnotationsHandler"==e}},props:{updateAnnotations:function(e){var t,n=[];if(t=s.opt(s.opt(this.model,(function(e){return e.owner})),(function(e){return e.selection}))){var a,o,i=s.clone(t.asFormaArray());1==i.length&&(a=i[0].controller)&&(o=a.annotations)&&s.append(n,o)}e.setAll(s.clone(n))}}}),i)},aKgf:function(e,t,n){var a,o,i,r=t,s=n("oAGj"),l=n("tGKA"),c=n("Ird5"),u=n("jfma"),d=n("sq5L"),f=n("yjxF"),h=n("Aj79"),p=n("Ucb9"),m=n("g6aL"),g=n("kwVJ"),v=n("Zifs"),S=n("Q+4n"),w=n("hgLm"),b=n("oKlP"),A=n("sIWg"),T=n("1NAc");r.IViewHandler=s.defineProtocol("IViewHandler",{fitToView:"() -> Void",fillToView:"() -> Void",zoomTo:"(Double) -> Void",zoomToPoint:"(Double, TheoPoint, Boolean) -> Void",zoomByMatrix:"(Matrix2D) -> Void",panBy:"(TheoPoint) -> Void",panTo:"(TheoPoint) -> Void",canPan:"() -> Boolean",setViewSize:"(TheoSize) -> Void",pageSizeChanged:"() -> Void",getViewToDocMatrix:"() -> Matrix2D",getFitScale:"() -> Double",getFillScale:"() -> Double",getFullCanvasGraph:"(PGMExportSettings, Boolean) -> PGMGraph"}),r.NullViewHandler=(a=function(){},o={},s.defineClass({name:"NullViewHandler",ctor:a,statics:{instance:{get:function(){return void 0===o.instance&&(o.instance=new a),o.instance}},_implements:function(e){return"IViewHandler"==e}},props:{fitToView:function(){},fillToView:function(){},zoomTo:function(e){},zoomToPoint:function(e,t,n){},zoomByMatrix:function(e){},panBy:function(e){},panTo:function(e){},canPan:function(){return!1},setViewSize:function(e){},pageSizeChanged:function(){},getViewToDocMatrix:function(){return l.Matrix2D.Identity},getFitScale:function(){return 1},getFillScale:function(){return 1},getFullCanvasGraph:function(e,t){return null}}}),a),r.StandardViewHandler=(i=function(e,t){this.dc=e,this.model=t},s.defineClass({name:"StandardViewHandler",ctor:i,statics:{PASTEBOARD_ENTITY:"pasteboard",PASTEBOARD_GROUP_ENTITY:"pasteboard-group",_implements:function(e){return"IViewHandler"==e}},props:{fitToView:function(){var e;if(e=this.model){var t=this.getFitScale();e.beginUpdates(),e.mutable.view.setFit(!0),e.mutable.view.setScale(t),s.opt(this.dc,(function(e){return e.viewScale=t})),e.mutable.view.setOffset(b.TheoPoint.ZERO),e.updatesComplete()}},fillToView:function(){var e;if(e=this.model){var t=this.getFillScale();e.beginUpdates(),e.mutable.view.setFill(!0),e.mutable.view.setScale(t),s.opt(this.dc,(function(e){return e.viewScale=t}));var n=e.mutable.view.getOffset(),a=this.validateOffset(new b.TheoPoint(0,n.y));e.mutable.view.setOffset(a),e.updatesComplete()}},zoomTo:function(e){var t;if(t=this.model){t.beginUpdates();var n=t.mutable.view.getScale(),a=t.mutable.view.getOffset();t.mutable.view.setFit(!1),t.mutable.view.setFill(!1),t.mutable.view.setScale(e),s.opt(this.dc,(function(t){return t.viewScale=e}));var o=a.multiply(e/n);this.panTo(o),t.updatesComplete()}},zoomToPoint:function(e,t,n){var a;if(a=this.model){var o=this.getViewToDocMatrix().transformPoint(t);a.beginUpdates(),this.zoomTo(e);var i=s.opt(this.getViewToDocMatrix().inverse,(function(e){return e.transformPoint(o)}))||b.TheoPoint.ZERO;if(n)this.panBy(b._minus_TheoPoint_TheoPoint(i,t));else{var r=A.TheoRect.fromSize(a.mutable.view.getViewSize());this.panBy(b._minus_TheoPoint_TheoPoint(i,r.center))}a.updatesComplete()}},zoomByMatrix:function(e){var t;if(t=this.model){var n=e.transformValues,a=t.mutable.view.getScale()*n.xscale,o=new b.TheoPoint(n.tx,n.ty);t.beginUpdates(),this.panBy(o),this.zoomTo(a),t.updatesComplete()}},canPan:function(){var e;if(e=this.model){var t=this.getFitScale();if(e.view.getScale()>t)return!0;var n,a=e.view.getPanInsets();if(!a.equal(S.TheoInsets.Zero)&&(n=s.opt(s.opt(this.dc,(function(e){return e.document})),(function(e){return e.firstPage.pageSize})))){var o=e.view.getScale(),i=A.TheoRect.fromSize(n.multiply(o)),r=A.TheoRect.fromSize(e.view.getViewSize()).withInsets(a);if(i.width>r.width||i.height>r.height)return!0}}return!1},panBy:function(e){var t;if(t=this.model){t.beginUpdates();var n=t.mutable.view.getOffset(),a=b._plus_TheoPoint_TheoPoint(n,e),o=this.validateOffset(a);t.mutable.view.setOffset(o),t.updatesComplete()}},panTo:function(e){var t;if(t=this.model){t.beginUpdates();var n=this.validateOffset(e);t.mutable.view.setOffset(n),t.updatesComplete()}},setViewSize:function(e){var t;if(t=this.model){if(t.beginUpdates(),t.mutable.view.setViewSize(e),t.mutable.view.getFit())this.fitToView();else if(t.mutable.view.getFill())this.fillToView();else{var n=t.mutable.view.getOffset(),a=this.validateOffset(n);this.panTo(a)}t.updatesComplete()}},pageSizeChanged:function(){var e;(e=this.model)&&(e.view.getViewSize().equal(T.TheoSize.Zero)||this.fitToView())},getViewToDocMatrix:function(){var e,t,n=l.Matrix2D.Identity;if((e=this.model)&&(t=s.opt(s.opt(this.dc,(function(e){return e.document})),(function(e){return e.firstPage.pageSize})))){var a=e.view.getScale(),o=e.view.getViewSize(),i=A.TheoRect.fromSize(o).center,r=t.multiply(a).multiply(.5);n=n.translateXY(r.width-i.x,r.height-i.y);var c=e.view.getOffset();n=(n=n.translate(c)).scaleXY(1/a,1/a)}return n},getFitScale:function(){var e,t;if((e=this.model)&&(t=s.opt(s.opt(this.dc,(function(e){return e.document})),(function(e){return e.firstPage.pageSize})))){var n=e.mutable.view.getViewSize(),a=e.mutable.view.getMargin(),o=new T.TheoSize(n.width-2*a,n.height-2*a);return t.myAspectRatioFitWithin(o).width/t.width}return 1},getFillScale:function(){var e,t;if((e=this.model)&&(t=s.opt(s.opt(this.dc,(function(e){return e.document})),(function(e){return e.firstPage.pageSize})))){var n=e.mutable.view.getViewSize(),a=e.mutable.view.getMargin(),o=new T.TheoSize(n.width-2*a,n.height);return t.myAspectRatioFillWithin(o).width/t.width}return 1},validateOffset:function(e){if(!this.canPan())return b.TheoPoint.ZERO;var t,n;if((t=this.model)&&(n=s.opt(s.opt(this.dc,(function(e){return e.document})),(function(e){return e.firstPage.pageSize})))){var a=t.view.getViewSize(),o=t.view.getScale(),i=n.multiply(o),r=e,l=t.view.getMargin(),c=A.TheoRect.fromSize(i),u=A.TheoRect.fromSize(a),d=c.moveToPoint(u.center.add(e),new b.TheoPoint(.5,.5));d.minX>u.center.x?d=d.moveToPoint(new b.TheoPoint(u.center.x,d.minY),new b.TheoPoint(0,0)):d.maxX<u.center.x&&(d=d.moveToPoint(new b.TheoPoint(u.center.x,d.minY),new b.TheoPoint(1,0)),r=new b.TheoPoint(-i.width/2+a.width/2-l,r.y)),r=b._minus_TheoPoint_TheoPoint(d.center,u.center),d.minY>u.center.y?d=d.moveToPoint(new b.TheoPoint(d.minX,u.center.y),new b.TheoPoint(0,0)):d.maxY<u.center.y&&(d=d.moveToPoint(new b.TheoPoint(d.minX,u.center.y),new b.TheoPoint(0,1))),r=b._minus_TheoPoint_TheoPoint(d.center,u.center);var f=this.getFitScale();return(t.mutable.view.getFit()||o<f)&&(r=new b.TheoPoint(r.x,0)),r}return e},getFullCanvasGraph:function(e,t){var n,a,o;if((n=this.model)&&(a=s.opt(s.opt(this.dc,(function(e){return e.document})),(function(e){return e.firstPage})))&&(o=a.pgm.getGraph(e))){t&&(o=g.PGMWatermarkingUtils.addWatermark(o));var r=A.TheoRect.fromSize(n.mutable.view.getViewSize()),S=n.view.getScale(),T=s.opt(this.getViewToDocMatrix().inverse,(function(e){return e.transformPoint(b.TheoPoint.ZERO)}))||b.TheoPoint.ZERO,H=new v.SolidColor(245/255,245/255,245/255,1),C=A.TheoRect.fromSize(n.mutable.view.getViewSize()),F=new w.TheoRectanglePath(C),M=new p.PGMShape(i.PASTEBOARD_ENTITY,f.PGMNodeMetadata.EMPTY,c.PGMAnimationList.EMPTY,r,[F],H),y=new h.PGMReference(M,new u.PGMCompositingParams(l.Matrix2D.Identity)),D=new h.PGMReference(o.root,new u.PGMCompositingParams(l.Matrix2D.scalingXY(S,S).translate(T))),P=new m.PGMSimpleGroup(i.PASTEBOARD_GROUP_ENTITY,f.PGMNodeMetadata.EMPTY,c.PGMAnimationList.EMPTY,[y,D]);return new d.PGMGraph(P,r,o.duration,o.resources)}return null}}}),i)},bccX:function(e,t,n){var a,o=t,i=n("oAGj"),r=n("7siz");o.IAttributesModel=i.defineProtocol("IAttributesModel",{find:"(String) -> IEditorAttribute"}),o.AttributesState=(a=function(e){void 0===e&&(e=null),this.attributes=i.clone(e||{})},i.defineClass({name:"AttributesState",ctor:a,superName:"EditorStateMember",statics:{_implements:function(e){return"IAttributesModel"==e}},props:{clone:function(){return new a(i.clone(this.attributes))},find:function(e){return this.attributes[e]},add:function(e){this.beforeChange(),this.attributes[e.key]=e,this.afterChange()},remove:function(e){this.beforeChange(),i.removeKey(this.attributes,e),this.afterChange()},clear:function(){this.beforeChange(),i.removeAll(this.attributes),this.afterChange()},diff:function(e){for(var t=[],n=i.iter(this.attributes);!n.done;n.next()){var a,o=n.key,s=n.value;(a=e.attributes[o])&&s.isEqualTo(a)||t.push(r.EditorModelChangedMessage.CHG_ATTRIBUTE_PREFIX+o)}for(var l=i.iter(e.attributes);!l.done;l.next())o=l.key,null==this.attributes[o]&&t.push(r.EditorModelChangedMessage.CHG_ATTRIBUTE_PREFIX+o);return t}}}),a)},d820:function(e,t,n){var a,o=t,i=n("oAGj"),r=n("7siz");o.IHandlesModel=i.defineProtocol("IHandlesModel",{getAll:"() -> Array<BaseHandle>"}),o.IMutableHandlesModel=i.defineProtocol("IMutableHandlesModel",{clear:"() -> Void",setAll:"(Array<BaseHandle>) -> Void"}),o.HandlesState=(a=function(e){void 0===e&&(e=null),this.handles=i.clone(e||[])},i.defineClass({name:"HandlesState",ctor:a,superName:"EditorStateMember",statics:{_implements:function(e){return"IMutableHandlesModel"==e||"IHandlesModel"==e}},props:{clone:function(){return new a(i.clone(this.handles))},getAll:function(){return this.handles},clear:function(){this.setAll([])},setAll:function(e){this.beforeChange(),this.handles=i.clone(e),this.afterChange()},diff:function(e){return[r.EditorModelChangedMessage.CHG_HANDLES]}}}),a)},eLsM:function(e,t,n){var a,o,i,r=t,s=n("oAGj"),l=n("cmoc"),c=n("G/OM"),u=n("fdtz"),d=n("lmwz"),f=n("37nf"),h=n("djAF"),p=n("8t9B"),m=n("zjod");r.IFeatureSetHandler=s.defineProtocol("IFeatureSetHandler",{updateFeatureSets:"(FeatureSetsState) -> Void"}),r.NullFeatureSetHandler=(a=function(){},o={},s.defineClass({name:"NullFeatureSetHandler",ctor:a,statics:{instance:{get:function(){return void 0===o.instance&&(o.instance=new a),o.instance}},_implements:function(e){return"IFeatureSetHandler"==e}},props:{updateFeatureSets:function(e){}}}),a),r.StandardFeatureSetHandler=(i=function(e){this.dc=e},s.defineClass({name:"StandardFeatureSetHandler",ctor:i,statics:{_implements:function(e){return"IFeatureSetHandler"==e}},props:{updateFeatureSets:function(e){var t,n,a,o,i,r,f,g,v,S,w=this,b=0,A=0,T=0,H=0,C=0,F=0,M=!1,y=!1,D=!1,P=!1,E=0,R=!1,k=!1,_=!1,I=!1,N=!1,x=!1,G=0,B=0,z=0,L=(t=s.opt(this.dc,(function(e){return e.selection.selectedCount})))||null!=t?t:0,V=!1;if((S=s.opt(this.dc,(function(e){return e.document})))&&(z=S.firstPage.root.filterWithCallback((function(e){return!(!(n=s.opt(e.controller,(function(e){return e.canMultiSelect})))&&null==n)&&n})).length),s.opt(this.dc,(function(e){return e.selection.forEachSelected((function(e){var t;e.isTypeLockup()&&(b+=1),(e instanceof u.ImageForma||e instanceof l.FrameForma)&&(T+=1),(e instanceof m.VideoForma||(t=s.as(e,l.FrameForma))&&t.childAt(0)instanceof m.VideoForma)&&(H+=1),e instanceof h.ShapeForma&&(C+=1),((a=s.opt(e.controller,(function(e){return e.moveable})))||null!=a)&&a&&(A+=1),((o=s.opt(e.controller,(function(e){return e.opacityChangeable})))||null!=o)&&o&&(B+=1),((i=s.opt(e.controller,(function(e){return e.canGroup})))||null!=i)&&i&&(F+=1),((r=s.opt(e.controller,(function(e){return e.userGroupMember})))||null!=r)&&r&&(e.controller.userGroup&&!e.controller.userGroupChild?M=!0:e.controller.userGroup||(M=!e.controller.enableChildMove)),((f=s.opt(e.controller,(function(e){return e.deleteable})))||null!=f)&&f&&(E+=1),((g=s.opt(e.controller,(function(e){return e.duplicatable})))||null!=g)&&g&&(G+=1),V=V||e.isShape()||e.isTypeLockup(),1==L&&(w.hasLicenseInfo(e)&&(y=!0),s.opt(e.controller,(function(e){return null!=e.settings}))&&(D=!0),((v=s.opt(e.controller,(function(e){return e.replaceable})))||null!=v)&&v&&(R=!0),e.controller instanceof p.TypeLockupController&&(P=!0),k=d.ImageFacade.canCropImage(e),_=d.ImageFacade.canSetBackgroundImage(e),I=d.ImageFacade.canSetFloatingImage(e),N=d.ImageFacade.canApplyBackgroundColor(e),x=d.ImageFacade.canApplyCutout(e))}))})),T>0&&(V=!1),e.clear(),1==b&&1==L&&e.add(new c.TextFrameAttributesFeature),A==L&&A>1&&e.add(new c.AlignSpacingAttributesFeature(!0,A>2,!0,!0)),B==L&&B>0&&e.add(new c.OpacityAttributesFeature),L>0&&e.add(new c.FormaEditFeature(z>1,G==L,F==L&&F>1,M,V,E==L,D,P)),T+C==L){var O=new c.ImageFeature(T==L&&T>0,R,y,k,_,I,N,x);e.add(O)}H==L&&e.add(new c.VideoAttributesFeature)},hasLicenseInfo:function(e){var t=f.ImageUtils.getMediaMetadataForForma(e);return!(null==t||!t.sourceHasLicense())}}}),i)},elwG:function(e,t,n){var a,o,i,r,s=t,l=n("oAGj"),c=n("0wFF"),u=n("FNB+"),d=n("iCxV"),f=n("lmwz"),h=n("6Tzw");s.IClickHandler=l.defineProtocol("IClickHandler",{handleClick:"(FormaClickEvent) -> Void",handleDoubleClick:"(FormaDoubleClickEvent) -> Void"}),s.NullClickHandler=(a=function(){},o={},l.defineClass({name:"NullClickHandler",ctor:a,statics:{instance:{get:function(){return void 0===o.instance&&(o.instance=new a),o.instance}},_implements:function(e){return"IClickHandler"==e}},props:{handleClick:function(e){},handleDoubleClick:function(e){}}}),a),s.StandardClickHandler=(i=function(e){this.dc=e},l.defineClass({name:"StandardClickHandler",ctor:i,statics:{_implements:function(e){return"IClickHandler"==e}},props:{nearestSelectable:function(e,t){var n,a,o=null;if(o=((n=l.opt(l.opt(e,(function(e){return e.controller})),(function(e){return e.selectable})))||null!=n)&&n?e:l.opt(e,(function(e){return e.visit(u.FormaTraversal.NearestAncestor,(function(e,t,n){return!(!(a=l.opt(e.controller,(function(e){return e.selectable})))&&null==a)&&a}))})),this.dc.selection.inCharStyleMode)return o;var i,r,s=1==t.modifierKeys.shift||1==t.modifierKeys.command||1==t.modifierKeys.control;if((i=l.opt(o,(function(e){return e.controller})))&&(r=i.userGroupRoot)){if(s&&this.dc.selection.isSelected(r))return o=r;for(var c=[r],d=l.clone(r.filterWithCallback((function(e){return null!=e.controller}))),f=[],h=l.iter(d);!h.done;h.next()){var p,m,g,v=h.value;if((p=v.totalPlacement.inverse)&&(m=v.bounds)&&(g=t.clickLocation)){var S=p.transformPoint(g);!m.containsPoint(S)||!v.controller.selectable||v.controller.userGroup&&!this.dc.enableMoveableChildren||l.containsEq(c,v,u._equality_Forma_Forma)||(v.controller.userGroup?c.push(v):f.splice(0,0,v))}}c=c.concat(f);var w=!1;if(o=l.first(c),c.length>1)for(var b=l.iter(l.range(0,c.length,!1));!b.done;b.next()){var A=b.value;this.dc.selection.isSelected(c[A])&&(o=c[C=A==c.length-1?0:A+1],w=!0)}if(!w)for(var T=l.iter(this.dc.selection.asFormaArray());!T.done;T.next()){var H=T.value;if(H.isDescendent(r))if(this.dc.enableMoveableChildren){for(var C=0,F=l.iter(l.range(0,c.length,!1));!F.done;F.next())A=F.value,H.isDescendent(c[A])&&(C=Math.min(A+1,c.length-1));o=c[C]}else o=l.last(c)}}return o},handleClick:function(e){var t,n=this;if(t=this.nearestSelectable(e.forma,e)){var a,o=1==e.modifierKeys.shift||1==e.modifierKeys.command||1==e.modifierKeys.control;a=d.Host.platform.isWeb?"Web":d.Host.platform.isIOS?"iOS":d.Host.platform.isAndroid?"Android":"Unknown",o&&!this.dc.selection.inCharStyleMode?this.dc.selection.isSelected(t)?(this.dc.selection.deselectForma(t),l.opt(d.Host.logging,(function(e){return e.logToAnalytics(c.AnalyticsConstants.kAnalyticsEventClickOccured,{contextualData2:"New selected count: "+l.toString(n.dc.selection.selectedCount),contextualData3:"Did deselect: yes",contextualData4:"Platform: "+a})}))):this.canAddToSelection(t)&&(h.SelectionFacade.selectFormae([t]),l.opt(d.Host.logging,(function(e){return e.logToAnalytics(c.AnalyticsConstants.kAnalyticsEventClickOccured,{contextualData2:"New selected count: "+l.toString(n.dc.selection.selectedCount),contextualData3:"Did deselect: no",contextualData4:"Platform: "+a})}))):this.dc.selection.isSelected(t)?d.Host.platform.isWeb||this.dc.selection.inCropMode||this.dc.selection.deselectForma(t):l.opt(d.Host.platform,(function(e){return 1==e.isWeb||n.dc.selection.selectedCount<2||t.controller.canMultiSelect}))&&!this.dc.selection.inCropMode&&(this.dc.selection.inCharStyleMode=!1,this.dc.selection.replaceSelection(t),this.dc.controllerSettingsState.settings=null)}l.opt(this.dc,(function(t){return t.notifyClick(e)}))},canAddToSelection:function(e){var t,n,a;if(l.opt(this.dc,(function(e){return 0==e.selection.selectedCount})))return!0;if(a=l.opt(this.dc,(function(e){return e.selection.formaAt(0)}))){var o=e;return o.isImage()&&(o=f.ImageFacade.getFrameFormaForForma(o)||e),!(!(t=l.opt(o.controller,(function(e){return e.moveable})))&&null==t)&&t&&!(!(n=l.opt(a.controller,(function(e){return e.moveable})))&&null==n)&&n}return!0},handleDoubleClick:function(e){l.opt(e.forma.controller,(function(t){return t.onEvent(e)})),l.opt(this.dc,(function(t){return t.notifyDoubleClick(e)}))}}}),i),s.CropModeClickHandler=(r=function(e){s.StandardClickHandler.call(this,e)},l.defineClass({name:"CropModeClickHandler",ctor:r,superName:"StandardClickHandler",statics:{_implements:function(e){return"IClickHandler"==e}},props:{handleDoubleClick:function(e){}}}),r)},hsXA:function(e,t,n){var a,o,i,r,s=t,l=n("oAGj"),c=n("1HsO"),u=n("t1qz"),d=n("Mr7n");s.IHandlesHandler=l.defineProtocol("IHandlesHandler",{handleTransformEvent:"(HandleTransformEvent) -> Void",handleFormaDragEvents:"(PSMFormaDragControllerEvent) -> Void",updateHandles:"(IMutableHandlesModel) -> Void"}),s.NullHandlesHandler=(a=function(){},o={},l.defineClass({name:"NullHandlesHandler",ctor:a,statics:{instance:{get:function(){return void 0===o.instance&&(o.instance=new a),o.instance}},_implements:function(e){return"IHandlesHandler"==e}},props:{handleTransformEvent:function(e){},handleFormaDragEvents:function(e){},updateHandles:function(e){}}}),a),s.IHandleGenerator=l.defineProtocol("IHandleGenerator",{addHandles:"(BaseHandlesHandler) -> Array<BaseHandle>"}),s.IHandleProcessor=l.defineProtocol("IHandleProcessor",{handleTransformEvent:"(BaseHandlesHandler, HandleTransformEvent) -> Boolean",handleFormaDragEvents:"(BaseHandlesHandler, PSMFormaDragControllerEvent) -> Boolean"}),s.BaseHandlesHandler=(i=function(e,t){this.dc=null,this.model=null,this.delegate=null,this.activeTransform=c.TransformType.None,this.handleGenerators=[],this.handleProcessors=[],this.dc=e,this.delegate=t},l.defineClass({name:"BaseHandlesHandler",ctor:i,superName:"CoreObject",statics:{_implements:function(e){return"IHandlesHandler"==e}},props:{handleTransformEvent:function(e){for(var t=l.iter(this.handleProcessors);!t.done&&!t.value.handleTransformEvent(this,e);t.next());},handleFormaDragEvents:function(e){for(var t=l.iter(this.handleProcessors);!t.done&&!t.value.handleFormaDragEvents(this,e);t.next());},updateHandles:function(e){for(var t=[],n=l.iter(this.handleGenerators);!n.done;n.next()){var a=n.value;l.append(t,a.addHandles(this))}e.setAll(l.clone(t))},addHandleGenerator:function(e){this.handleGenerators.push(e)},removeHandleGenerator:function(e){this.handleGenerators=this.handleGenerators.filter((function(t){return t!==e}),this)},clearHandleGenerators:function(){this.handleGenerators=[]},addHandleProcessor:function(e){this.handleProcessors.push(e)},removeHandleProcessor:function(e){this.handleProcessors=this.handleProcessors.filter((function(t){return t!==e}),this)},clearHandleProcessors:function(){this.handleProcessors=[]}}}),i),s.StandardHandlesHandler=(r=function(e,t,n){s.BaseHandlesHandler.call(this,e,n),this.addHandleGenerator(u.StandardHandleGenerator.instance),this.addHandleProcessor(new d.StandardHandleProcessor(t))},l.defineClass({name:"StandardHandlesHandler",ctor:r,superName:"BaseHandlesHandler",statics:{_implements:function(e){return"IHandlesHandler"==e}}}),r)},mD2h:function(e,t,n){var a,o,i,r=t,s=n("oAGj"),l=n("7siz"),c=n("FNB+");r.IActiveSwapModel=s.defineProtocol("IActiveSwapModel",{getActive:"() -> ActiveSwap"}),r.ActiveSwap=(a=function(e,t){this.swapThumbnailForma=e,this.swapThumbnailLocation=t},o={},s.defineClass({name:"ActiveSwap",ctor:a,superName:"CoreObject",statics:{NONE:{get:function(){return void 0===o.NONE&&(o.NONE=new a(null,null)),o.NONE}}}}),a),r.ActiveSwapState=(i=function(e){void 0===e&&(e=null),this.activeSwap=e||r.ActiveSwap.NONE},s.defineClass({name:"ActiveSwapState",ctor:i,superName:"EditorStateMember",statics:{_implements:function(e){return"IActiveSwapModel"==e}},props:{clone:function(){return new i(this.activeSwap)},getActive:function(){return this.activeSwap},setActive:function(e){this.beforeChange(),this.activeSwap=e,this.afterChange()},diff:function(e){return s.eq(c._equality_Forma_Forma,this.activeSwap.swapThumbnailForma,e.activeSwap.swapThumbnailForma)&&this.activeSwap.swapThumbnailLocation==e.activeSwap.swapThumbnailLocation?[]:[l.EditorModelChangedMessage.CHG_SWAP_STATE]}}}),i)},"nQ/X":function(e,t,n){var a,o=t,i=n("oAGj"),r=n("Nk+Q"),s=n("CMNw"),l=n("UUXZ"),c=n("PSFa"),u=n("elwG"),d=n("qUXk"),f=n("u+mS"),h=n("eLsM"),p=n("hsXA"),m=n("aKgf");o.CharStyleModeDesignController=(a=function(e,t){this.dc=e,d.DesignController.call(this),this.handles=new p.BaseHandlesHandler(e,this),this.drag=new f.DragFacadeBasedDragHandler(e,t,this),this.click=new u.StandardClickHandler(e),this.actions=new s.StandardActionHandler(e),this.attributes=new c.StandardAttributesHandler(e),this.featureSets=new h.StandardFeatureSetHandler(e),this.actionFeedback=new r.StandardActionFeedbackHandler(t),this.annotations=new l.StandardAnnotationsHandler(t),this.view=new m.StandardViewHandler(e,t)},i.defineClass({name:"CharStyleModeDesignController",ctor:a,superName:"DesignController"}),a)},qUXk:function(e,t,n){var a,o,i,r=t,s=n("oAGj"),l=n("Nk+Q"),c=n("CMNw"),u=n("UUXZ"),d=n("PSFa"),f=n("elwG"),h=n("gXiO"),p=n("u+mS"),m=n("eLsM"),g=n("hsXA"),v=n("G9CY"),S=n("JU+l"),w=n("9X7Y"),b=n("aKgf");r.HandlerFactory=(a=function(){},s.defineClass({name:"HandlerFactory",ctor:a,props:{drag:{get:function(){return p.NullDragHandler.instance}},click:{get:function(){return f.NullClickHandler.instance}},resize:{get:function(){return S.NullResizeHandler.instance}},rotate:{get:function(){return w.NullRotateHandler.instance}},actions:{get:function(){return c.NullActionHandler.instance}},handles:{get:function(){return g.NullHandlesHandler.instance}},attributes:{get:function(){return d.NullAttributesHandler.instance}},featureSets:{get:function(){return m.NullFeatureSetHandler.instance}},view:{get:function(){return b.NullViewHandler.instance}}}}),a),r.DesignController=(o=function(){this.click=f.NullClickHandler.instance,this.drag=p.NullDragHandler.instance,this.resize=S.NullResizeHandler.instance,this.move=v.NullMoveHandler.instance,this.rotate=w.NullRotateHandler.instance,this.actions=c.NullActionHandler.instance,this.handles=g.NullHandlesHandler.instance,this.attributes=d.NullAttributesHandler.instance,this.featureSets=m.NullFeatureSetHandler.instance,this.actionFeedback=l.NullActionFeedbackHandler.instance,this.annotations=u.NullAnnotationsHandler.instance,this.view=b.NullViewHandler.instance,h.CoreObject.call(this)},i={},s.defineClass({name:"DesignController",ctor:o,superName:"CoreObject",statics:{NullController:{get:function(){return void 0===i.NullController&&(i.NullController=new o),i.NullController}}},props:{configureEditorModel:function(e){this.handles.updateHandles(e.mutable.handles),this.attributes.updateAttributes(e.mutable.attributes),this.featureSets.updateFeatureSets(e.mutable.featureSets),this.annotations.updateAnnotations(e.mutable.annotations)}}}),o)},t1qz:function(e,t,n){var a,o,i=t,r=n("oAGj"),s=n("FNB+"),l=n("cmoc"),c=n("iCxV"),u=n("1HsO"),d=n("fNpk"),f=n("c+uM"),h=n("tGKA"),p=n("8t9B");i.StandardHandleGenerator=(a=function(){},o={},r.defineClass({name:"StandardHandleGenerator",ctor:a,statics:{instance:{get:function(){return void 0===o.instance&&(o.instance=new a),o.instance}},_implements:function(e){return"IHandleGenerator"==e}},props:{addHandles:function(e){var t,n;if(n=r.opt(e.dc,(function(e){return e.selection}))){var a=r.clone(n.asFormaArray());return 0==a.length?this.handleNoSelectionCase(e):n.inCharStyleMode?this.handleCharStyleSelectionCase(e,r.clone(a)):1==a.length?n.inCropMode||!(t=r.opt(a[0].controller,(function(e){return e.userGroupMember})))&&null==t||!t?this.handleSingleSelectionCase(e,a[0]):this.handleGroupSelectionCase(e,a[0]):this.handleMultiSelectionCase(e,r.clone(a))}return[]},handleNoSelectionCase:function(e){return[]},handleSingleSelectionCase:function(e,t){var n,a,o,i,c,d,h,m=[];if((d=t.controller)&&(h=t.bounds)){var g=[],v=[];d.moveable&&(g.push(u.TransformType.Translate),t.isShape()&&!t.hasIntent(s.Forma.INTENT_ICON)||v.push(u.BoxHandleDisplayHint.ThinOutline));var S,w=!(!(n=r.opt(d.owner,(function(e){return e.selection.inSpacingMode})))&&null==n)&&n;t.isTypeLockup()&&(v.push(u.BoxHandleDisplayHint.TextFrame),(S=r.as(d,p.TypeLockupController))&&(S.text.length>300&&v.push(u.BoxHandleDisplayHint.SuppressResizeAnimation),f.LockupStyle.isKnockoutLook(S.lockupStyle.textLook)&&v.push(u.BoxHandleDisplayHint.SuppressResizeAnimation)));var b=!(!(a=r.opt(d.owner,(function(e){return e.selection.inCropMode})))&&null==a)&&a;if(b&&v.push(u.BoxHandleDisplayHint.CropMode),!d.rotateable||w||b||(g.push(u.TransformType.RotateAboutCenter),t instanceof l.FrameForma&&!d.moveable&&v.push(u.BoxHandleDisplayHint.SuppressRotationHandle)),!d.userGroupChild||((o=r.opt(d.owner,(function(e){return e.enableMoveableChildren})))||null!=o)&&o){if(d.floating&&!t.isGridCell()){g.push(u.TransformType.TopLeftCornerTranslate);var A=r.as(t.style,f.LockupStyle),T=(i=r.opt(A,(function(e){return e.layout})))||null!=i?i:f.LockupLayout.Standard;null==A||!w||f.LockupStyle.isPath(T)||f.LockupStyle.isAutoLayout(T)?(g.push(u.TransformType.TopRightCornerTranslate),g.push(u.TransformType.BottomLeftCornerTranslate),g.push(u.TransformType.BottomRightCornerTranslate),((c=r.opt(r.as(d,p.TypeLockupController),(function(e){return e.canResizeHorizontally})))||null!=c)&&c&&(g.push(u.TransformType.LeftSideTranslate),g.push(u.TransformType.RightSideTranslate),r.opt(A,(function(e){return e.alignment==f.LockupAlignment.Right}))&&v.push(u.BoxHandleDisplayHint.PreferLeftSideHandle))):(g.push(u.TransformType.LetterSpacing),g.push(u.TransformType.LineSpacing))}for(var H=r.iter(d.visibleSelectionHandlePositions);!H.done;H.next()){var C=H.value;.5==C.x?0==C.y?g.push(u.TransformType.TopSideTranslate):g.push(u.TransformType.BottomSideTranslate):.5==C.y&&(0==C.x?g.push(u.TransformType.LeftSideTranslate):g.push(u.TransformType.RightSideTranslate))}}m.push(new u.BoxTransformHandles(new u.BoxReference(t.totalPlacement,h),r.clone(g),r.clone(v),e.activeTransform,t.formaID))}return m},handleGroupSelectionCase:function(e,t){var n,a,o,i,s=[];if((o=t.controller)&&(i=t.bounds)){var l=[u.TransformType.RotateAboutCenter,u.TransformType.TopLeftCornerTranslate,u.TransformType.TopRightCornerTranslate,u.TransformType.BottomLeftCornerTranslate,u.TransformType.BottomRightCornerTranslate];if(d.LegacyCoreAssert.isTrue(o.userGroupMember,"asked for group handles when selected forma is not a group member",void 0,"StandardHandleGenerator.handleGroupSelectionCase","StandardHandleGenerator.swift",172),o.userGroupChild){var h=!(!(n=r.opt(e.dc,(function(e){return e.enableMoveableChildren})))&&null==n)&&n,m=[];h?(m.push(u.BoxHandleDisplayHint.ThinOutline),o.userGroup&&m.push(u.BoxHandleDisplayHint.GroupOutlineColor)):(m.push(u.BoxHandleDisplayHint.SuppressTranslationHandle),m.push(u.BoxHandleDisplayHint.WideOutline));var g,v,S,w=r.clone(h?l:[u.TransformType.Translate]);if(g=r.as(o,p.TypeLockupController)){m.push(u.BoxHandleDisplayHint.TextFrame);var b=!(!(a=r.opt(o.owner,(function(e){return e.selection.inSpacingMode})))&&null==a)&&a;h&&!b&&g.canResizeHorizontally&&(w.push(u.TransformType.LeftSideTranslate),w.push(u.TransformType.RightSideTranslate),r.opt(r.as(t.style,f.LockupStyle),(function(e){return e.alignment==f.LockupAlignment.Right}))&&m.push(u.BoxHandleDisplayHint.PreferLeftSideHandle))}if(s.push(new u.BoxTransformHandles(new u.BoxReference(t.totalPlacement,i),r.clone(w),r.clone(m),e.activeTransform,t.formaID)),(v=h?t.parent:o.userGroupRoot)&&(S=v.bounds)){var A=[u.BoxHandleDisplayHint.GroupOutlineColor];h?A.push(u.BoxHandleDisplayHint.WideOutline):(A.push(u.BoxHandleDisplayHint.SuppressTranslationHandle),A.push(u.BoxHandleDisplayHint.ThinOutline),S=S.outsetXY(8,8)),s.splice(0,0,new u.BoxTransformMultipleFormae(new u.BoxReference(v.totalPlacement,S),r.clone(h?[]:l),r.clone(A),e.activeTransform,c.Host.platform.isIOS?t.formaID:v.formaID,[v.formaID]))}}else s.push(new u.BoxTransformMultipleFormae(new u.BoxReference(t.totalPlacement,i),r.clone(l),[u.BoxHandleDisplayHint.ThinOutline,u.BoxHandleDisplayHint.GroupOutlineColor],e.activeTransform,t.formaID,[t.formaID]))}return s},handleMultiSelectionCase:function(e,t){var n=[],a=[];a.push(u.BoxHandleDisplayHint.ThinOutline);for(var o=[],i=null,l=r.iter(t);!l.done;l.next()){var c=l.value,d=c.finalFrame,f=c.formaID;if(i=null==i?d:i.unionWith(d),c.hasIntent(s.Forma.INTENT_INFERRED_TEMP_GROUP)){i=c.finalFrame;break}o.includes(f)||o.push(f)}if(r.sortInPlace(o),null==i)return[];var p=[u.TransformType.Translate,u.TransformType.TopLeftCornerTranslate,u.TransformType.TopRightCornerTranslate,u.TransformType.BottomLeftCornerTranslate,u.TransformType.BottomRightCornerTranslate];return n.push(new u.BoxTransformMultipleFormae(new u.BoxReference(h.Matrix2D.Identity,i),r.clone(p),r.clone(a),e.activeTransform,o.reduce((function(e,t){return e+"/"+t}),""),r.clone(o))),n},handleCharStyleSelectionCase:function(e,t){return[]}}}),a)},"u+mS":function(e,t,n){var a,o,i,r,s,l=t,c=n("oAGj"),u=n("Tq01"),d=n("0wFF"),f=n("mD2h"),h=n("pjjd"),p=n("wNKJ"),m=n("FNB+"),g=n("Pil/"),v=n("cmoc"),S=n("iCxV"),w=n("H1Z2"),b=n("hsXA"),A=n("lmwz"),T=n("D89E");l.IDragHandler=c.defineProtocol("IDragHandler",{handleFormaDragEvents:"(PSMFormaDragControllerEvent) -> Void"}),l.NullDragHandler=(a=function(){},o={},c.defineClass({name:"NullDragHandler",ctor:a,statics:{instance:{get:function(){return void 0===o.instance&&(o.instance=new a),o.instance}},_implements:function(e){return"IDragHandler"==e}},props:{handleFormaDragEvents:function(e){},isDragging:function(){return!1}}}),a),l.DragFacadeBasedDragHandler=(i=function(e,t,n){this.dragging=!1,this.swappableFormae=[],this.swapTargetForma=null,this.inSwapMode=!1,this.originalPlacement=null,this.swapModeHandleGenerator=new T.SwapModeHandleGenerator,this.originalHandleGenerators=[],this.dc=e,this.model=t,this.delegate=n},c.defineClass({name:"DragFacadeBasedDragHandler",ctor:i,statics:{_implements:function(e){return"IDragHandler"==e}},props:{updateHandles:function(){var e,t;(e=this.model)&&(t=this.delegate)&&(e.beginUpdates(),t.handles.updateHandles(e.mutable.handles),e.updatesComplete())},handleFormaDragEvents:function(e){var t,n,a,o,i,r,s=this;if((t=this.dc)&&(n=this.model)&&(a=this.delegate))if(o=c.as(e,g.BeginFormaDragEvent)){(y=c.as(a.handles,b.BaseHandlesHandler))&&(this.originalHandleGenerators=c.clone(y.handleGenerators)),this.swappableFormae=c.clone(p.DragFacade.getSwappableFormae(o)),null!=c.first(e.dragDelegate.draggedFormae)&&(this.originalPlacement=c.opt(c.first(e.dragDelegate.draggedFormae),(function(e){return e.placement}))),t.undoRedoMgr.beginBranch();var l=c.clone(e.dragDelegate.draggedFormae),v=l.filter((function(e){return c.opt(e.controller,(function(e){return 1==e.duplicatable}))}),this).length>0;1==e.dragDelegate.modifierKeys.alt&&1==v&&t.doAction(new h.DuplicateAction(c.clone(l),!1,!1,!0)),t.undoRedoMgr.beginGesture();var A=c.opt(t.document,(function(e){return e.beginTransaction("begin_forma_drag")}));p.DragFacade.processBeginFormaDrag(o),c.opt(A,(function(e){return e.end()})),this.updateHandles()}else if(i=c.as(e,g.FormaDragEvent)){var T=this.swapTargetForma;if(t.designControllerHandlesSwap){var H=c.opt(t.document,(function(e){return e.beginTransaction("enter_swap_mode")})),C=p.DragFacade.getSwapState(i,c.clone(this.swappableFormae),T,this.inSwapMode,this.originalPlacement),F=C[0],M=C[1];this.inSwapMode=F,this.swapTargetForma=M,c.opt(H,(function(e){return e.end()}))}if(null==(D=this.getDraggedFormaForEvent(e)))return;if(!c.eq(m._equality_Forma_Forma,this.swapTargetForma,T)){var y=c.as(a.handles,b.BaseHandlesHandler);c.opt(y,(function(e){return e.clearHandleGenerators()})),null==this.swapTargetForma||c.eq(m._equality_Forma_Forma,this.swapTargetForma,D)?(c.opt(y,(function(e){return e.removeHandleGenerator(s.swapModeHandleGenerator)})),this.swapModeHandleGenerator.clearSwapTargetForma()):(c.opt(y,(function(e){return e.addHandleGenerator(s.swapModeHandleGenerator)})),this.swapModeHandleGenerator.setSwapTargetForma(this.swapTargetForma))}this.inSwapMode||t.doActionWithCompletion(new w.DragAction(i,null),(function(e,t){var a,o;(a=c.as(e,u.DragActionResult))&&(o=a.snapLines)&&(n.beginUpdates(),n.mutable.snapLines.setAll(c.clone(o)),n.updatesComplete())})),this.inSwapMode&&(n.beginUpdates(),n.mutable.activeSwap.setActive(new f.ActiveSwap(D,i.drag.pointers[0].currentLocation)),n.updatesComplete()),this.updateHandles()}else if(r=c.as(e,g.EndFormaDragEvent)){c.opt(S.Host.logging,(function(n){return n.logToAnalytics(d.AnalyticsConstants.kAnalyticsFormaeDragged,{contextualData1:"Selected count: "+t.selection.selectedCount,contextualData2:"Dragged count: "+e.dragDelegate.draggedFormae.length})})),n.beginUpdates(),n.mutable.snapLines.clear(),n.updatesComplete();var D=this.getDraggedFormaForEvent(e);if(this.inSwapMode){if(y=c.as(a.handles,b.BaseHandlesHandler)){y.clearHandleGenerators();for(var P=c.iter(this.originalHandleGenerators);!P.done;P.next()){var E=P.value;y.addHandleGenerator(E)}}if(n.beginUpdates(),n.mutable.activeSwap.setActive(new f.ActiveSwap(null,null)),n.updatesComplete(),null==D)return t.selection.clearSelection(),this.updateHandles(),this.swapTargetForma=null,this.inSwapMode=!1,this.originalPlacement=null,t.undoRedoMgr.endGesture(!1),void t.undoRedoMgr.endBranch(!1);null==this.swapTargetForma||c.eq(m._equality_Forma_Forma,this.swapTargetForma,D)?(t.selection.replaceSelection(D),this.updateHandles(),this.swapTargetForma=null,this.inSwapMode=!1,this.originalPlacement=null,t.undoRedoMgr.endGesture(!1),t.undoRedoMgr.endBranch(!1)):t.doActionWithCompletion(new w.DragAction(r,this.swapTargetForma),(function(e,n){t.selection.replaceSelection(D),s.updateHandles(),s.swapTargetForma=null,s.inSwapMode=!1,s.originalPlacement=null,t.undoRedoMgr.endGesture(!0),t.undoRedoMgr.endBranch(!0)}))}else t.doActionWithCompletion(new w.DragAction(r,null),(function(e,n){s.updateHandles(),s.swapTargetForma=null,s.inSwapMode=!1,s.originalPlacement=null,t.undoRedoMgr.endGesture(!0),t.undoRedoMgr.endBranch(!0)}))}},getDraggedFormaForEvent:function(e){var t,n;return 0==!e.dragDelegate.draggedFormae.length&&(n=c.first(e.dragDelegate.draggedFormae),((t=c.opt(n,(function(e){return e.isImage()})))||null!=t)&&t&&(n=c.opt(n,(function(e){return e.parent})))),n}}}),i),l.CroppingDragFacadeBasedDragHandler=(r=function(e,t,n){l.DragFacadeBasedDragHandler.call(this,e,t,n)},c.defineClass({name:"CroppingDragFacadeBasedDragHandler",ctor:r,superName:"DragFacadeBasedDragHandler",statics:{_implements:function(e){return"IDragHandler"==e}},props:{getDraggedFormaForEvent:function(e){var t,n=l.DragFacadeBasedDragHandler.prototype.getDraggedFormaForEvent.call(this,e);return c.opt(n,(function(e){return e.kind==v.FrameForma.KIND}))&&(t=A.ImageFacade.getImageFormaForForma(n))&&(n=t),n}}}),r),l.MultiObjectDragHandler=(s=function(e,t,n){this.startPlacements={},this.basePlacements={},this.dragging=!1,this.dc=e,this.model=t,this.delegate=n},c.defineClass({name:"MultiObjectDragHandler",ctor:s,statics:{_implements:function(e){return"IDragHandler"==e}},props:{updateHandles:function(){var e,t;(e=this.model)&&(t=this.delegate)&&(e.beginUpdates(),t.handles.updateHandles(e.mutable.handles),e.updatesComplete())},handleFormaDragEvents:function(e){var t,n,a,o,i,r=this;if((t=this.dc)&&(n=this.model))if(a=c.as(e,g.BeginFormaDragEvent)){for(var s=c.clone(e.dragDelegate.draggedFormae),l=!0,f=c.iter(s);!f.done;f.next()){var m=f.value;c.opt(m.controller,(function(e){return 0==e.duplicatable}))&&(l=!1)}t.undoRedoMgr.beginBranch(),1==e.dragDelegate.modifierKeys.alt&&1==l&&t.doAction(new h.DuplicateAction(c.clone(s),!1,!1,!0)),p.DragFacade.processBeginFormaDrag(a),t.undoRedoMgr.beginGesture(),this.updateHandles()}else(o=c.as(e,g.FormaDragEvent))?t.doActionWithCompletion(new w.DragAction(o,null),(function(e,t){var a,o;(a=c.as(e,u.DragActionResult))&&(o=a.snapLines)&&(n.beginUpdates(),n.mutable.snapLines.setAll(c.clone(o)),n.updatesComplete(),r.updateHandles())})):(i=c.as(e,g.EndFormaDragEvent))&&(c.opt(S.Host.logging,(function(n){return n.logToAnalytics(d.AnalyticsConstants.kAnalyticsFormaeDragged,{contextualData1:"Selected count: "+t.selection.selectedCount,contextualData2:"Dragged count: "+e.dragDelegate.draggedFormae.length})})),n.beginUpdates(),n.mutable.snapLines.clear(),n.updatesComplete(),t.doActionWithCompletion(new w.DragAction(i,null),(function(e,n){r.updateHandles(),t.undoRedoMgr.endGesture(!0),t.undoRedoMgr.endBranch(!0)})),this.updateHandles())},isDragging:function(){return this.dragging}}}),s)},yHU1:function(e,t,n){var a,o,i,r=t,s=n("oAGj"),l=n("gXiO"),c=n("quOg"),u=n("FNB+"),d=n("Pil/"),f=n("fWxZ"),h=n("P83h"),p=n("iCxV"),m=n("1HsO"),g=n("8vXU"),v=n("lmwz"),S=n("rxGp"),w=n("fNpk"),b=n("g8Fi"),A=n("KIfs"),T=n("6Tzw"),H=n("mxdD");r.BeginPointerTrackingResponseEnum=s.defineEnum("BeginPointerTrackingResponseEnum",{TrackAsGroup:0,TrackWithinGroup:1,DoNotTrack:2}),r.IPSMDelegate=s.defineProtocol("IPSMDelegate",{handleEvent:"(PSMFormaControllerEvent) -> Void"}),r.nearestFormaWithController=function(e){return null==e?(p.Host.logging.logForCategory(S.LogCategories.kDrag,"nearestFormaWithController nil startingForma",g.LogLevelEnum.ERROR_LEVEL),null):s.opt(e,(function(e){return e.visit(u.FormaTraversal.NearestAncestor,(function(e,t,n){return null!=e.controller}))}))},r.getNearestActionableController=function(e){return null==e?(p.Host.logging.logForCategory(S.LogCategories.kDrag,"getNearestActionableController nil startingForma",g.LogLevelEnum.ERROR_LEVEL),null):e.visit(u.FormaTraversal.NearestAncestor,(function(e,t,n){var a;return!!(a=e.controller)&&(a.selectable||a.moveable)}))},r.targetForma=function(e,t,n){if(null==t)return[null,null];for(var a=r.getNearestActionableController(t),o=t;null!=a;){if(null==a.controller)return w.LegacyCoreAssert.fail("PSMpD getNearest calls failed",void 0,"targetForma","FormaDrag.swift",79),[null,o];var i,s=d.BeginPointerTrackingEvent.init_bef7(a,[o],n);if(e.handleEvent(s),s.trackingResponse!=r.BeginPointerTrackingResponseEnum.TrackAsGroup)return s.trackingResponse==r.BeginPointerTrackingResponseEnum.TrackWithinGroup?[a.controller,o]:(w.LegacyCoreAssert.isTrue(s.trackingResponse==r.BeginPointerTrackingResponseEnum.DoNotTrack,"unknown tracking response",void 0,"targetForma","FormaDrag.swift",105),[null,o]);if(!(i=a.parent))return[null,o];o=a,a=r.nearestFormaWithController(i),w.LegacyCoreAssert.isTrue(null!=a,"nearestFormaWithController unexpectedly returned nil",{kind:i.kind},"targetForma","FormaDrag.swift",92)}return[null,o]},r.FormaState=(a=function(e,t){this.draggedForma_=e,this.startPlacement_=t},s.defineClass({name:"FormaState",ctor:a,props:{update:function(){this.startPlacement_=this.draggedForma_.placement},clone:function(){return new a(this.draggedForma_,this.startPlacement_)}}}),a),r.FormaPageDragDelegate=(o=function(e,t,n){this.draggedFormae_=[],this.delegate=e,this.dragController=t,this.modifierKeys={},l.CoreObject.call(this);for(var a=s.iter(n);!a.done;a.next()){var o=a.value;this.targetNewForma(o)}},s.defineClass({name:"FormaPageDragDelegate",ctor:o,superName:"CoreObject",statics:{_implements:function(e){return"ActiveDragDelegateProtocol"==e}},props:{draggedFormae:{get:function(){return this.draggedFormae_.map((function(e){return e.draggedForma_}),this)}},updateModifierKeys:function(e){e.pointers.length>0&&(this.modifierKeys=s.clone(e.pointers[0].modifierKeys))},targetNewForma:function(e){this.draggedFormae_.push(s.clone(new r.FormaState(e,e.placement)))},startPlacementObsolete:{get:function(){return s.first(this.draggedFormae_).startPlacement_}},forEachDraggedForma:function(e){for(var t=s.iter(this.draggedFormae_);!t.done;t.next()){var n=t.value;e(n.draggedForma_,n.startPlacement_)}},activeDragDidBegin:function(e){var t=new d.BeginFormaDragEvent(e);this.delegate.handleEvent(t)},activeDragDidActivate:function(e){return 1!=e.pointers.length||e.pointers[0].type!=b.PointerTypeEnum.Mouse},activeDragDidDeactivate:function(e,t){if(t){var n=new h.FormaAlignmentChangedEvent(s.first(this.draggedFormae),[],null);s.first(this.draggedFormae).beginUpdate(n),s.first(this.draggedFormae).endUpdate(n)}},activeDragClaimNewPointers:function(e,t,n){var a=[],o=[],i=e.pointers.length;w.LegacyCoreAssert.isTrue(i>0&&t.length>0,"no pointers participating in active drag",void 0,"FormaPageDragDelegate.activeDragClaimNewPointers","FormaDrag.swift",222);for(var r=!0,l=s.iter(this.draggedFormae);!l.done;l.next()){var c;if((c=l.value.controller)&&!c.rotateable){r=!1;break}}for(var u=s.iter(t);!u.done;u.next()){var d=u.value;n?a.push(d):r?o.push(d):a.push(d)}return e.commitWithNewPointers(o,!0),a=a.concat(o)},activeDragDidCommit:function(e){for(var t=s.iter(s.range(0,this.draggedFormae_.length,!1));!t.done;t.next()){var n=t.value;this.draggedFormae_[n].update()}},activeDragDidMove:function(e,t){var n=new d.FormaDragEvent(e);this.delegate.handleEvent(n),this.updateModifierKeys(e)},activeDragDidChangePace:function(e,t,n){},activeDragHeldPointerEndedAsTap:function(e,t){},activeDragDidEnd:function(e,t,n){var a;if(t){var o=new d.EndFormaDragEvent(e);this.delegate.handleEvent(o),((a=s.opt(p.Host.platform,(function(e){return e.isWeb})))||null!=a)&&a&&((i=s.opt(e.pointerStateMachine,(function(e){return e.owner})).selection).isSelected(o.forma)||i.replaceSelection(o.forma))}else for(var i=s.opt(e.pointerStateMachine,(function(e){return e.owner})).selection,l=s.iter(n);!l.done;l.next()){var c=l.value;if(!c.cancelled){var u,h,m=s.opt(s.as(c.currentPage,f.FormaPage),(function(e){return e.formaAtPoint(c.startLocation,void 0,null)}));if(null==m)return;(u=r.getNearestActionableController(m))&&(c.tapCount%2==1?((h=new d.FormaClickEvent(u)).clickLocation=c.startLocation,h.modifierKeys=s.clone(e.activeDragDelegate.modifierKeys),!p.Host.platform.isWeb&&T.SelectionFacade.enableAdditionalMultiSelectGestures()&&null!=u.controller&&u.controller.canMultiSelect&&(i.selectedCount>1||n.length>1)&&(h.modifierKeys.shift=!0),this.delegate.handleEvent(h)):((h=new d.FormaDoubleClickEvent(u)).clickLocation=c.startLocation,h.modifierKeys=s.clone(e.activeDragDelegate.modifierKeys),this.delegate.handleEvent(h)))}}}}}),o),r.FormaPagePointerStateMachineDelegate=(i=function(e){this.myDrags=[],this.delegate=e,l.CoreObject.call(this)},s.defineClass({name:"FormaPagePointerStateMachineDelegate",ctor:i,superName:"CoreObject",statics:{_implements:function(e){return"PointerStateMachineDelegateProtocol"==e}},props:{activeDragDidFinish:function(e,t){s.remove(this.myDrags,t)},formaeInFlight:function(){for(var e=[],t=s.iter(this.myDrags);!t.done;t.next()){var n=t.value.activeDragDelegate;e=e.concat(n.draggedFormae)}return e},createDragsForPointers:function(e,t,n,a){for(var o=s.clone(t),i=s.clone(this.newDragsForPointers(e,o,n,a)),r=s.iter(i);!r.done;r.next()){var l=r.value;e.appendDrag(l),this.myDrags.push(l)}return o},newDragsForPointers:function(e,t,n,a){var o=[];if(0==t.length)return o;var i=s.as(e.owner,c.DocumentController),l=s.opt(i,(function(e){return e.selection})),d=function(e,t){var n,a;return(n=s.opt(e,(function(e){return e.viewportTransform})))||(n=s.opt(s.opt(t,(function(e){return e.page.view})),(function(e){return e.getViewportTransform()})))?Math.sqrt(Math.abs(n.determinant)):null!=(a=s.opt(i,(function(e){return e.viewScale})))?a:1},h=!0;if(p.Host.platform.isWeb&&!l.inCropMode){h=!1;for(var g=s.iter(t);!g.done;g.next())if(g.value.type==b.PointerTypeEnum.Touch){h=!0;break}if(!h&&(T.SelectionFacade.isMultiSelect(l)||T.SelectionFacade.isGroupSelect(l))&&1==t.length&&t[0].type==b.PointerTypeEnum.Mouse){var S=s.clone(i.model.handles.getAll());if(S.length>0&&null!=s.as(S[0],m.BoxTransformHandles)){var w=S[0],C=w.reference.bounds,F=w.reference.placement.inverse.transformPoint(t[0].currentLocation);h=C.containsPoint(F)}}}var M,y=null,D=[];if(M=s.opt(l,(function(e){return e.asFormaArray()})))for(var P=s.iter(M);!P.done;P.next()){var E,R,k,_=P.value,I=_;s.opt(l,(function(e){return 1==e.inCropMode&&v.ImageFacade.isFrame(_)}))?(E=v.ImageFacade.getImageFormaForForma(_))&&(I=E):((R=H.VideoFacade.getVideoFormaForForma(_))&&(I=R),(k=v.ImageFacade.getImageFormaForForma(_))&&(k.isLogo()||(I=k)));var N=r.targetForma(this.delegate,I,l),x=N[0],G=N[1];(O=x)&&(U=G)&&(null==y?(y=O,D.push(U)):s.opt(y,(function(e){return e.kind==O.kind}))&&D.push(U))}if(h&&null!=y&&0==a){(Q=new r.FormaPageDragDelegate(this.delegate,y,s.clone(D))).modifierKeys=s.clone(t[0].modifierKeys);for(var B=!0,z=s.iter(D);!z.done;z.next()){var L=z.value;if((O=L.controller)&&!O.rotateable){B=!1;break}}if(!B)for(;t.length>1;)t.pop();var V=new A.ActiveDrag(e,Q,t,null,d(null,null));o.push(V)}for(;t.length>0;){var O,U,j=t.pop(),W=(I=s.opt(s.as(j.currentPage,f.FormaPage),(function(e){return e.formaAtPoint(j.startLocation,void 0,null)})),r.targetForma(this.delegate,I,l));if(x=W[0],G=W[1],(O=x)&&(U=G)){for(var X=s.iter(o);!X.done;X.next()){var K=X.value,q=K.activeDragDelegate,Y=q.dragController==O&&s.eq(u._equality_Forma_Forma,s.first(q.draggedFormae),U);if(!n||Y){if(U.controller.rotateable){var Z=[j];K.commitWithNewPointers(Z,!0)}V=K;break}}if(null==V){if(!n&&a+o.length>0)break;var Q;(Q=y==O&&s.containsEq(D,U,u._equality_Forma_Forma)&&a+o.length==0?new r.FormaPageDragDelegate(this.delegate,O,s.clone(D)):new r.FormaPageDragDelegate(this.delegate,O,[U])).modifierKeys=s.clone(j.modifierKeys),Z=[j],V=new A.ActiveDrag(e,Q,Z,null,d(j,U)),o.push(V)}}}return o}}}),i)}}]);
//# sourceMappingURL=vendors_npm_spark_3fc4b535-97f953c8.js.map