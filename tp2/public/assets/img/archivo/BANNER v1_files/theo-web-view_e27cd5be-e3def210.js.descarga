(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[100,79,90],{"4pbt":function(e,t,o){var n,a;function r(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function i(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){s(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function s(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const{divide:d}=o("YLtl");n=[o("xeH2"),o("UFvF"),o("YLtl"),o("Uwho"),o("gBAB"),o("2ofD"),o("Na8G"),o("zTjw"),o("bBG2"),o("MGCh"),o("l+ZV"),o("+Ltv"),o("ZLL8"),o("3xdQ"),o("3xm6"),o("Avqh"),o("KFmL"),o("+VG/"),o("2Fsf"),o("0VUy"),o("5eso"),o("TW0n"),o("W1Jy"),o("M1RA"),o("tpS0"),o("0gXD"),o("0do5"),o("7LIx"),o("/Elb"),o("dIqn"),o("KQv+"),o("zeFu"),o("OI2j"),o("UzQk"),o("lulf"),o("dcsN"),o("ys7E"),o("rJP3"),o("K7z8"),o("YYuT"),o("a8ov"),o("TdwW"),o("1geK"),o("WpJZ"),o("I/Z9"),o("2PxR"),o("8Jtx"),o("ibPQ"),o("5d+0"),o("mwMu"),o("qnb0"),o("b2xK"),o("hSNs"),o("Pbp+"),o("GSfz"),o("L4yB"),o("Ww1C"),o("rjtT"),o("tQ0N"),o("q6ln"),o("4hMT"),o("UNP3"),o("XR60"),o("BQ0V"),o("Pv/z"),o("rx2z"),o("4AtL"),o("3cgi"),o("iXON"),o("GiJK"),o("rquo"),o("HetE"),o("ooew"),o("OMxe"),o("/TxD"),o("sjIh"),o("Mvsy"),o("bDzb"),o("CSmQ"),o("YC27"),o("EbV1"),o("+Mhg"),o("uzEs"),o("INJi"),o("rCSV"),o("Gklz"),o("el3O"),o("GKed"),o("CXs4")],void 0===(a=function(e,t,n,a,r,s,d,l,c,u,p,g,m,h,f,b,I,S,w,B,v,P,k,C,U,x,T,y,D,E,A,F,L,M,R,z,N,O,W,j,V,H,K,G,_,Y,X,{KeyboardShortcuts:Z},Q,$,q,J,ee,te,oe,ne,ae,re,ie,se,de,le,ce,ue,pe,ge,me,he,fe,be,Ie,Se,we,Be,ve,Pe,ke,Ce,Ue,xe,Te,ye,De,Ee,Ae,Fe,Le,Me,Re){!Promise.prototype.finally&&window.NativePromise.prototype.finally&&(Promise.prototype.finally=window.NativePromise.prototype.finally),void 0===Promise.allSettled&&window.NativePromise.allSettled&&(Promise.allSettled=window.NativePromise.allSettled);const ze=O.default,Ne=j.default,Oe=V.default,We=c.default,je=se.default,Ve=de.default,He=R.default,Ke=z.default,Ge=N.default,_e=E.default,Ye=ce.default,Xe=K.default,Ze=ue.default,Qe=p.default,$e=ge.default,{resolvePromiseOrTimeout:qe}=X,Je=he.default,{addNewImage:et}=pe,{addNewLogo:tt}=me,{checkWebGLSupport:ot}=fe,{initBrandKit:nt}=be,{checkWatermarkRemovalGrandfatherStatus:at,initWatermark:rt}=Ie,{EditingModes:it,RejectReason:st,WebAnimationEnabled:dt}=Se,lt=we.default,ct=ve.default,{StartupPerformance:ut,publishEditorDisplayed:pt}=Be,gt=Pe.default,{validateRemix:mt,validatePremiumRemix:ht}=ke,{initDesign:ft,repairDesign:bt}=Ce,It=Ue.default,St=W.default,wt=Re.default,Bt=Ae.default,vt=xe.default,Pt=Ee.default,kt=Fe.default,Ct=Q.ShortcutConstants;let Ut;const xt=Te.default;var Tt,yt;const Dt=Le.default,Et=Me.default;te.init();const At=new Bt;var Ft,Lt,Mt,Rt,zt,Nt=u.channel("controller"),Ot={},Wt=!0,jt=!1,Vt={errorDialogs:{}},Ht=[],Kt=-1,Gt=t.defer();const _t=new He,Yt=new Ke(_t);let Xt,Zt,Qt;var $t,qt,Jt,eo,to=new Z,oo=!1,no=["showFacebookUploadButton","showImageModalPanelOnload","showShareButton","showDownloadButton"],ao={default:{isDefault:!0,showShareButton:!0,showDownloadButton:!0},"facebook-cover-image-design":{showFacebookUpdateCoverButton:!0,showNoProfilePic:!1,showImageModalPanelOnload:!0},"facebook-holiday-ad-design":{showFacebookUploadButton:!0,showImageModalPanelOnload:!0},"twitter-design":{showTwitterUpload:!0}},ro=!1,io=!1,so="",lo="",co="";if(Ot.enabled=!1,window.newrelic&&window.newrelic.setCustomAttribute){const e=window.adobeIMS.getUserProfile().userId;window.newrelic.setCustomAttribute("adobeId",e)}function uo(e){Vt.collabStatusButton.$el.toggleClass("shared-document",!!e)}function po(e){la(e.authContext).then(()=>{Vt.postSideBarUI.brandIndicator.events.publish("brand-switch-complete")})}function go(){if(Lt.canUndo()){var e=Lt.getUndoDescription();We.publish("undoApplied",{actionDescription:e}),Lt.undo()}}function mo(){if(Lt.canRedo()){var e=Lt.getRedoDescription();We.publish("redoApplied",{actionDescription:e}),Lt.redo()}}At.subscribe("ui:handleAddImageButtonPress",gn),At.subscribe("ui:onTextTabButtonsShown",(function(){Lt.ensureLockupSelected(),Wn()})),At.subscribe("ui:onSwitchToAnyLocalTabSet",Wn),At.subscribe("ui:onCropTabButtonsHidden",(function(){Vt.topBarUI.undo.show(),Vt.topBarUI.redo.show(),Vt.postSideBarUI.sidebarCrop.hide()})),At.subscribe("ui:updateBrandKitLogoComponents",na),At.subscribe("ui:handleAddLogoButtonPress",hn),At.subscribe("ui:handleNavTabSelected",(function(){!function(){const e=Vt.postAppSection.getPanelById("PostRightSidebar");e&&e.update({width:320});const t=Vt.legacyRightSidebar.getPanelById("PostLegacySidebarContents");t&&t.show();Vt.designSurface&&Vt.designSurface.handleRightSidebarOpen()}()})),At.subscribe("ui:handleNavTabClosed",Ia),At.subscribe("ui:handleAssetRailPanelOpened",(function(e){Vt.topBarUI.savingIndicator.el.classList.add("showing-asset-rail-panel")})),At.subscribe("ui:handleAssetRailPanelClosed",(function(e){Vt.topBarUI.savingIndicator.el.classList.remove("showing-asset-rail-panel")})),At.subscribe("ui:handleAssetRailShowUpgradePopover",(function(e,t){"logos"===e&&d.showMerchPopover({position:"auto",anchorLocation:t.getBoundingClientRect(),width:320,positionOffset:-4,touchpointName:"postLogoButton"})})),At.subscribe("ui:exitReplaceMode",()=>{Tt.handleLeaveReplaceMode()}),At.subscribe("ui:returnToSpark",({skipSave:e,pathType:t})=>ga(e,t)),At.subscribe("ui:handleAddTextButtonPress",Ko),At.subscribe("ui:returnToGlobalSidebarState",qn),At.subscribe("ui:closeIsFromReturnToSpark",e=>{io=e}),At.subscribe("ui:previousSelectedFormaId",e=>{co=e}),At.subscribe("ui:saveTemplateChanges",(function(){Vt.designSurface.posterAdornments.hideSelectionBox(),Qt.waitForSaveToFinish().then((function(){marvel.navigate("/branding/"+qt.contextId,{trigger:!0})}))})),At.subscribe("ui:cancelTemplateChanges",(function(){var e=t.defer();Vt.designSurface.disable(),Lt.undoToInitialState(),St.setTemplateName($t,zt.templateName),n.delay((function(){Vt.designSurface.poster.update({core:Lt}),Vt.designSurface.poster.enable(),e.resolve()}),250),e.promise.done((function(){Qt.requestSave(),Qt.waitForSaveToFinish("Please wait...").then((function(){marvel.navigate("/branding/"+qt.contextId,{trigger:!0})}))}))})),At.subscribe("ui:handleUndo",go),At.subscribe("ui:handleRedo",mo),At.subscribe("ui:handleDebugMenuButtonPress",(function(){Vt.debugView&&Vt.debugView.show()})),At.subscribe("ui:handleHideLibrariesNewFlag",(function(){e("#sectionTabLibraries div.tab-new-tag").addClass("hide")}));var ho={dragStartX:0,dragStartY:0,dragX:0,dragY:0,dragDX:0,dragDY:0,dragging:!1,zoomingIn:!1,zoomingOut:!1,pointers:[]};function fo(e){e.preventDefault(),ho.zoomingIn||ho.zoomingOut?(e.currentTarget.addEventListener("mouseup",Io),ko(e)):(e.currentTarget.addEventListener("mouseup",Io),e.currentTarget.addEventListener("mousemove",bo),xo(e.clientX,e.clientY))}function bo(e){ho.dragging&&To(e.clientX,e.clientY)}function Io(e){e.currentTarget.removeEventListener("mouseup",Io),e.currentTarget.removeEventListener("mousemove",bo),e.preventDefault(),yo()}function So(e){e.preventDefault(),1===e.touches.length&&(xo(e.touches[0].clientX,e.touches[0].clientY),document.addEventListener("touchmove",wo),document.addEventListener("touchend",Bo),document.addEventListener("touchcancel",Bo))}function wo(e){e.preventDefault(),1===e.touches.length&&ho.dragging&&To(e.touches[0].clientX,e.touches[0].clientY)}function Bo(e){e.preventDefault(),0===e.touches.length&&(yo(),document.removeEventListener("touchmove",wo),document.removeEventListener("touchend",Bo),document.removeEventListener("touchcancel",Bo))}function vo(e){for(var t=0;t<ho.pointers.length;t++)if(ho.pointers[t].pointerId===e)return t;return-1}function Po(e){if(null==document.getElementById("PostCursorDiv")||!ho.zoomingIn&&!ho.zoomingOut){var t=vo(e.pointerId);t<0?ho.pointers.push(e):ho.pointers[t]=e,1===ho.pointers.length&&(xo(ho.pointers[0].clientX,ho.pointers[0].clientY),window.addEventListener("pointermove",Co,!1),window.addEventListener("pointerup",Uo,!1))}else ko(e)}function ko(e){if(ho.zoomingIn||ho.zoomingOut){const t=Lt.getNextZoomLevel(ho.zoomingIn),o=Qn(e.pageX,e.pageY);Vt.designSurface.posterAdornments.handleZoomToPoint(t,o),to.logShortcut(ho.zoomingIn?Ct.kZoomInKey:Ct.kZoomOutKey);const n=ho.zoomingIn?"in":"out";Vt.designSurface.posterAdornments.logZoomMethod("gesture",n)}}function Co(e){var t=vo(e.pointerId);t<0?ho.pointers.push(e):ho.pointers[t]=e,1===ho.pointers.length&&To(ho.pointers[0].clientX,ho.pointers[0].clientY)}function Uo(e){var t=vo(e.pointerId);t>=0&&ho.pointers.splice(t,1),0===ho.pointers.length&&ho.dragging&&(yo(),window.removeEventListener("pointermove",Co,!1),window.removeEventListener("pointerup",Uo,!1))}function xo(e,t){ho.dragging=!0,ho.dragStartX=ho.dragX=e,ho.dragStartY=ho.dragY=t;null!=document.getElementById("PostCursorDiv")&&ho.dragging&&Ao()}function To(e,t){ho.dragging&&(ho.dragDX=ho.dragX-e,ho.dragDY=ho.dragY-t,ho.dragX=e,ho.dragY=t,Vt.designSurface.posterAdornments.handlePanBy(new M.TheoPoint(ho.dragDX,ho.dragDY)))}function yo(){ho.dragging&&(ho.dragging=!1,ho.dragDX=0,ho.dragDY=0),ho.zoomIn=!1,ho.zoomOut=!1,to.logShortcut(Ct.kPanKey),Vt.designSurface.posterAdornments.logZoomMethod("gesture","pan"),Oo()}function Do(e){const t=window.navigator.platform.includes("Mac"),o=e.altKey,n=e.ctrlKey&&!t||e.metaKey&&t;if(!1===ho.dragging||o||n){if(null==document.getElementById("PostCursorDiv")){var a=document.createElement("div");a.setAttribute("class","PostCursorDiv"),a.id="PostCursorDiv",window.PointerEvent?a.addEventListener("pointerdown",Po,!1):(a.addEventListener("touchstart",So),a.addEventListener("mousedown",fo)),a.addEventListener("selectstart",(function(e){return e.preventDefault(),!1})),document.body.appendChild(a)}else o||n?(ho.zoomingIn=!o,ho.zoomingOut=o):(ho.zoomingIn=!1,ho.zoomingOut=!1);Ao()}}function Eo(e){if(ho.zoomingIn||ho.zoomingOut){const t=window.navigator.platform.includes("Mac");"Meta"===e.key&&t||"Control"===e.key&&!t?ho.zoomingIn=!1:"Alt"===e.key&&(ho.zoomingOut=!1)}!1===ho.dragging&&" "===e.key&&Oo()}function Ao(){const e=document.getElementById("PostCursorDiv");e&&(ho.zoomingIn?e.style.cursor="zoom-in":ho.zoomingOut?e.style.cursor="zoom-out":ho.dragging?e.style.cursor="grabbing":e.style.cursor="grab")}function Fo(){Vt.designSurface.posterAdornments.handleZoomInShortcut()}function Lo(){Vt.designSurface.posterAdornments.handleZoomOutShortcut()}function Mo(){Vt.designSurface.posterAdornments.handleZoomFitShortcut()}function Ro(){Vt.designSurface.posterAdornments.handleZoomFillShortcut()}function zo(){Vt.designSurface.posterAdornments.handleZoomActualSizeShortcut()}function No(e,t){Vt.designSurface.posterAdornments.handlePanViewShortcut(e,t)}function Oo(){const e=document.getElementById("PostCursorDiv");null!=e&&(window.PointerEvent?e.removeEventListener("pointerdown",Po,!1):(e.removeEventListener("touchstart",So),e.removeEventListener("mousedown",fo)),document.body.removeChild(e))}function Wo(){}function jo(){}function Vo(e,t,o){return Lt.updateCharStyleRanges(e,t,o)}function Ho(){var e=Lt.getTextForSelectedLockup();if(e){var o=Lt.getSelectedForma();Vt.textCapture.prompt(e).then((function({newText:n,newRanges:a}){if(n&&n!==e){var r=n.length.toString(),i=o.source;if(M.FormaSourceUtils.isDesignIngredient(i)){var s=M.BadgeFacade.getDesignIngredientIDAndType(i);We.publish("designIngredient:textEdited",{contextualData1:"id:"+s.id,contextualData2:"type:"+s.type,contextualData7:"lengthOfText:"+r})}else{var d=o.style,l=d.font.fontData.postScriptName,c=function(e){switch(e.backing){case M.LockupBacking.None:return"none";case M.LockupBacking.Rows:return"row";case M.LockupBacking.BannerHorizontal:return"bannerHorizontal";case M.LockupBacking.BannerVertical:return"bannerVertical";case M.LockupBacking.Knockout:return"knockout";case M.LockupBacking.LegacyShadow:return"none";default:if(e.backingArtworkID)return e.backingArtworkID}return"none"}(d);We.publish("customTextEdited",{contextualData7:"lengthOfText:"+r,contextualData10:"fontName:"+l,contextualData12:"shapeName:"+c})}return Lt.setTextForSelectedLockup(n,a)}return t.resolve()})).done(Vt.designSurface.posterAdornments.showSelectionBox)}}function Ko(){var e=!1;Lt.downloadNewLockupRandomFontsAsync(),Vt.textCapture.prompt("").then((function({newText:o}){if(o){var n=o.length.toString();return We.publish("editor:textCustomAdded",{contextualData7:"lengthOfText:"+n}),e=!0,Lt.addNewLockup(o,{select:!0})}return t.resolve()})).done((function(){e&&Vt.designSurface.posterAdornments.showSelectionBox()}))}function Go(){var e,t=Lt.getAllSelectedFormas();t&&(e=t,Lt.canDuplicateFormae(e)?Lt.duplicateFormae(e).done():pn())}function _o(e){Qo(),Lt.enterCropMode().then((function(){Vt.postSideBarUI.sidebarCrop.show(),Vt.postSideBarUI.sidebarCrop.moveToSection(e)}))}function Yo(e){Lt.applyAspectRatioCropToImage(e).done()}function Xo(e){Lt.applyShapeMaskToImage(e).done()}function Zo(){$o(),Lt.exitCropMode().then((function(){Vt.navStripUI.tabButtonBackgroundImage.select(),Vt.postSideBarUI.sidebarBackground.show()}))}function Qo(){e("#PostApp").addClass("crop-scrim"),e("#PostTopBar").addClass("crop-scrim").append('<div class="full-scrim"></div>'),e("#PostTopBar").find(".full-scrim").on("click",(function(e){Zo()}))}function $o(){e("#PostApp").removeClass("crop-scrim"),e("#PostTopBar").removeClass("crop-scrim"),e("#PostTopBar").find(".full-scrim").remove()}function qo({messageType:e,messageObj:t}){Vt.errorDialogs.actionFeedbackModal&&Vt.errorDialogs.actionFeedbackModal.hide();let o=t.message,n=null;if(e===M.ActionFeedbackMessageType.Error)if(t instanceof M.HostNetworkError)t.type===M.HostNetworkErrorType.NoInternetConnection?(o=f.translate("dialogs.networkError.kOfflineErrorTitle"),n=f.translate("dialogs.networkError.kOfflineErrorText")):(o=f.translate("dialogs.networkError.kGenericErrorTitle"),n=f.translate("dialogs.networkError.kGenericErrorText",{errorMessage:t.message||"Unknown error"}));else if(t instanceof M.HostCutoutMaskError)switch(o=f.translate("dialogs.networkError.kGenericErrorTitle"),t.type){case M.HostCutoutMaskErrorType.NoForegroundObjectImage:n=f.translate("dialogs.networkError.kCutoutMaskErrorText");break;case M.HostCutoutMaskErrorType.ImageTooLarge:n=f.translate("dialogs.networkError.kCutoutLargeImageErrorText");break;case M.HostCutoutMaskErrorType.ImageTooSmall:n=f.translate("dialogs.networkError.kCutoutSmallImageErrorText");break;case M.HostCutoutMaskErrorType.UnsupportedImageFormat:n=f.translate("dialogs.networkError.kCutoutUnsupportedImageErrorText");break;case M.HostCutoutMaskErrorType.InvalidImageUploaded:n=f.translate("dialogs.networkError.kCutoutInvalidImageErrorText");break;default:n=f.translate("dialogs.networkError.kGenericErrorText",{errorMessage:t.message||"Unknown error"})}else t instanceof M.CoreStringError&&(t.errorMessage===M.ErrorMessageConstants.kAddTextMissingFontError?(o=f.translate("dialogs.addTextFailedMissingFonts.kTitle"),n=f.translate("dialogs.addTextFailedMissingFonts.kMessage")):Nt.warn("Unhandled core string error "+t.id));o&&n&&(Vt.errorDialogs.actionFeedbackModal=new U({headerText:o,contentText:n,dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"OK",onClick:function(){Vt.errorDialogs.actionFeedbackModal.hide()}}]}),Vt.errorDialogs.actionFeedbackModal.show())}function Jo(){We.publish("editor:image:pinToBackgroundDisabled"),Lt.setImageAsForeground().done()}function en(){We.publish("editor:image:pinToBackgroundEnabled"),Lt.setImageAsBackground().done()}function tn(){nn("editor:image:backgroundRestorePressed",Lt.getSelectedForma()),Lt.restoreImageBackground().done()}function on(){nn("editor:image:backgroundRemovePressed",Lt.getSelectedForma()),Lt.removeImageBackground().done()}function nn(e,t){const o=M.ImageFacade.getImageContentForForma(t);let n="unknown";o&&o.mediaMetadata&&o.mediaMetadata.sourceName&&(n=o.mediaMetadata.sourceName);const a=t.isBackgroundImage()?"background":"floating";We.publish(e,{contextualData1:"imageSource:"+n,contextualData2:"imageType:"+a})}function an(){var e=Lt.getAllSelectedFormas();if(e){var t=Lt.getDeleteInfo(e);if(t.isDeleteable&&t.isBackgroundImage)var o=new U({headerText:"i18n.dialogs.delete.kHeaderText",contentText:"i18n.dialogs.delete.kContentText",dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.delete.kDeleteContentButtonLabel",onClick:function(){Lt.replaceImagesWithColors(null,[]).done(),o.hide()}},{class:"pill pill-primary-on-light",label:"i18n.dialogs.delete.kDeletePhotoSectionLabel",onClick:function(){dn(e),o.hide()}},{class:"pill pill-secondary-on-light",label:"i18n.common.kCancel",onClick:function(){o.hide()}}]});else t.isBackgroundImage?Lt.replaceImagesWithColors(null,[]).done():t.isDeleteable&&dn(e)}}function rn(e){const t=Lt.getAllSelectedFormas();Lt.groupItems(t,!0,e.method)}function sn(e){const t=Lt.getAllSelectedFormas();Lt.ungroupItems(t,!0,e.method)}function dn(e){e=e||Lt.getAllSelectedFormas(),Lt.deleteFormae(e).done()}function ln(t,o){const n=Lt.getViewToDocMatrix().inverse.transformPoint(o),a=Vt.designSurface.poster.$el.offset(),r=n.add(new M.TheoPoint(a.left,a.top));var i=e("#swapCellThumbnail");if(i.length)i.css({top:r.y+5+"px",left:r.x-50+"px"});else{var s=e('<div id="swapCellThumbnail"></div>').css({position:"absolute",top:r.y+5+"px",left:r.x-50+"px",opacity:.5,"box-shadow":"0px 0px 4px 0px"});if(e("body").append(s),t.isBackgroundImage()){var d=Lt.getImagePreviewData(t),l=e('<img src="'+d.url+'">').css({"max-height":"100px","max-width":"100px"});s.append(l)}else{var c=t.style.colors.fieldPrimary;if(c){var u=H.rgb2hex(H.solidColor2Rgba(c)),p=t.frame.width>t.frame.height;s.css({background:"#"+u,height:p?t.frame.height/t.frame.width*100+"px":"100px",width:p?"100px":t.frame.width/t.frame.height*100+"px"})}}}}function cn(){e("#swapCellThumbnail").remove()}function un(){Vt.postSideBarUI.sidebarCrop.recordFormaResize()}function pn(){var e=new U({headerText:"i18n.dialogs.tooManyImages.kHeaderText",contentText:"i18n.dialogs.tooManyImages.kContentText",dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"OK",onClick:function(){e.hide()}}]});e.show()}function gn(e){e=e||{},Lt.canAddMoreImages(1)?(Vt.designSurface.posterAdornments.hideSelectionBox(),At.publish("ui:previousSelectedFormaId",Lt.getSelectedFormaId()||""),Lt.deselect({silent:!0}),Vt.navStripUI.tabButtonBackgroundImage.hide({silent:!0,preventSelection:!0}),e.setHome=!0,e.label="Add photo",e.disallowClose=!1,At.publish("ui:showImagePicker",e),Vt.navStripUI.tabButtonBackgroundImage.select(),Vt.postSideBarUI.changeIconModalPanel.hide()):pn()}function mn(e){if(e=e||{},Tt.model._state.isReplaceMode)Tt.handleLeaveReplaceMode();else{var t=Lt.getSelectedForma();if(t){if(Lt.isIcon(t))Vt.navStripUI.tabButtonIcon.select(),e.label="Replace icon","dooplo"===t.contentNode.mediaMetadata.searchSource&&(e.context=e.context||{},e.context.class_name="DooploImagePickerContext",e.context.search_string=t.contentNode.mediaMetadata.searchTerm),function(e){e=e||{},At.publish("ui:showIconPicker",e)}(e);else{Vt.navStripUI.tabButtonBackgroundImage.select(),e.label="Replace photo";var o=t.isImage()&&t.childCount>0&&t.childAt(0).contentNode.mediaMetadata,n="ui:showImagePicker";o&&("cclight"===o.searchSource?(e.context=e.context||{},e.context.class_name="CCLightDesignAssetsImagePickerContext",e.context.search_string=o.searchTerm,e.context.search_props=o.searchProps,n="ui:showADesignAssetsPicker"):"dooplo"===o.searchSource&&(e.context=e.context||{},e.context.class_name="DooploImagePickerContext",e.context.search_string=t.childAt(0).contentNode.mediaMetadata.searchTerm)),At.publish(n,e)}Tt.handleEnterReplaceMode()}}}function hn(){_t.featureEnabled("entitle-brand-kit")?(Vt.navStripUI.tabButtonLogo.select(),Vt.postSideBarUI.changeImageModalPanel.hide(),Vt.postSideBarUI.changeIconModalPanel.hide()):d.showMerchPopover({$element:Vt.navStripUI.tabButtonTheme.$el,position:"bottom-left",width:320,positionOffset:-4,touchpointName:"postLogoButton"})}function fn(){We.publish("uploadNewLogoSelected"),Vt.designSurface.posterAdornments.hideSelectionBox()}var bn=n.throttle((function(e,t){Lt.applyGridStyle(e,t).done(),We.publish("layoutSelected",{layoutID:e.gridStyle.name})}),40);function In(e){if("Original"===e.id){var t=Lt.getOriginalImageSize();if(!t)return;e=M.DesignSizeLibrary.getOriginalSize(t.width,t.height)}return Vt.designSurface.disable(),Vt.designSurface.watermarkUI.updateWatermarkCoachmarkVisibility(!1),Lt.setPageSizeFromDesignSize(e).then((function(){Vt.designSurface.imageWrapper.update({aspect:e.aspectRatio||1}),Vt.postSideBarUI.sidebarBackground.updateFilters({tileAspect:e.aspectRatio||1}),n.delay((function(){Vt.designSurface.enable()}),50),Vt.designSurface.watermarkUI.handleWatermarkFootprintChanged(),We.publish("canvasSizeSelected",{aspectRatio:e.aspectRatio||1,targetId:e.id})}))}var Sn=n.throttle((function(e){"Custom"===e.id?function(){var e=Lt.getPageExportData(),t=e.pixelDimensions,o=Lt.getDocumentSizeId(),n=e.format,a=e.ppi;"Custom"===o&&(n=Lt.getPageCustomSizeFormat(),a=Lt.getPageCustomSizePPI());var r=new x({currentExportSize:t,currentFormat:n,currentPPI:a});r.events.subscribe("submit",(function(e){e.exportData.format===n&&t.width===e.exportData.pixelWidth&&t.height===e.exportData.pixelHeight||(In(M.DesignSizeLibrary.getCustomSize(e.exportData.width,e.exportData.height,e.exportData.format,e.exportData.ppi)),We.publish("customSizeSet",{dimensions:e.exportData.width+"x"+e.exportData.height+" "+e.exportData.format}))})),r.events.subscribe("cancel",(function(){Vt.postSideBarUI.sidebarResize.selectDocumentSizeWithId(Lt.getDocumentSizeId(),{silent:!0}),We.publish("customSizeCancelled")}))}():In(e)}),40);function wn(t,o,n){n.silent||!e(n.target).closest("[class*='tile-shuffle-button']").length&&0!==o||(0===o?Lt.setColorPalette(t,{shuffle:!0}).done():Lt.shuffleColorPalette().done())}function Bn(){const e=Tt.model.state;Vt.sidebarItemProperties.update({state:e,panelName:e.selectedItemType}),Vt.actionBar.update({state:e}),Vt.assetRailUI.designAssetsPicker.update({state:e}),Vt.assetRailUI.backgroundAssetsPicker.update({state:e})}function vn(e){e=e||{};var t,o=Lt.getDocumentSizeId();o===so&&"Custom"!==o||(so=o,Vt.postSideBarUI.sidebarResize.selectDocumentSizeWithId(Lt.getDocumentSizeId(),{silent:!0})),Vt.navStripUI.tabButtonPalette&&Vt.navStripUI.tabButtonPalette.isSelected()&&At.publish("ui:updateCurrentPalette"),Vt.navStripUI.tabButtonTheme&&(t=Lt.getThemeId())!==lo&&(Vt.postSideBarUI.sidebarTheme.selectThemeWithid(t,{silent:!0}),lo=t),e.formaAdded&&Tn(),Vt.postSideBarUI.sidebarAnimation&&At.publish("ui:updateSidebarAnimation"),Vt.animationPlayButton&&Vt.animationPlayButton.update({hidden:!Lt.hasAnimationStyle()}),ro=!0}var Pn=n.throttle((function(e,t){e.manifestPromise().then((function(e){return Lt.applyDesignTheme(e,t)})).then((function(){We.publish("designVariationSelected",{contextualData1:"variationTemplateDocumentId:"+e.assetId,contextualData2:"numShuffles:"+t})}))}),40),kn=n.throttle((function(e,t,o){e.premium&&!Yt.isEntitledToFeature("postTypeTemplate")?d.showMerchMessagingModal({workflow:"postTextLockup",asset:i({},e),totalAssets:o,analyticsPage:"editor:post"}):function(e){We.publish("editor:textLockupAdded",{contextualData1:"textLockupType:"+(e.premium?"paid":"free"),contextualData2:"textLockupId:"+e.asssetId}),Vt.designSurface.beginBadgeLoading(),e.manifestPromise().done((function(t){Lt.addBadge(t,e.assetId).catch(e=>{Nt.error("Ran into error with addBadge",e)}).finally(()=>{Vt.designSurface.endBadgeLoading()})}))}(e)}),40);function Cn(e){e.data.forma.isTypeLockup()&&Vt.navStripUI.tabButtonTheme&&Vt.navStripUI.tabButtonTheme.isSelected()&&Vt.postSideBarUI.sidebarTheme.setDesigns({aspectRatio:Lt.getPageAspectRatio(),wordCount:Lt.getLockupWordCount(),iconCount:Lt.getIconCount(),imageCount:Lt.getPotentialBackgroundImageCount(),metadata:Lt.getDesignVariationsMetadata(),docId:Lt.getDocumentCCID()}),e.selected&&!Vt.postSideBarUI.sidebarBackground.isHidden()&&Vt.postSideBarUI.sidebarBackground.updateFilters({whilePanelVisibleOnly:!0,image:Lt.getImagePreviewData(Lt.getSelectedForma())})}function Un(e){e.duplicatedImage&&Lt.updateConstrainedImages(),Tn()}function xn(e){yn(),e.deletedImage&&Lt.updateConstrainedImages()}function Tn(){yn()}function yn(){Vt.navStripUI.tabButtonTheme&&Vt.navStripUI.tabButtonTheme.isSelected()&&At.publish("ui:updateListOfDesigns")}function Dn(){if(Tt.handleLeaveReplaceMode(),Vt.navStripUI.tabButtonPalette&&Vt.navStripUI.tabButtonPalette.isSelected()){Lt.getAllSelectedFormas().length?Vt.postSideBarUI.sidebarPalette.unbindColorPicker({hidePicker:!0}):Vt.postSideBarUI.sidebarPalette.rebindColorPicker()}"no-selection"===Lt.getSelectedFormaType()&&Ia()}function En(){yt.handleAnnotationsChanged(Lt.getFirstAnnotation())}function An(e){const t=Array.isArray(e.forma)?e.forma[0]:e.forma;Vt.topBarUI.downloadButton&&Vt.topBarUI.downloadButton.el.hideDownloadList(),Vt.sharePostButton&&Vt.sharePostButton.el.hideMenuDropdown(),Vt.postSideBarUI.changeImageModalPanel.hide(),Vt.postSideBarUI.changeIconModalPanel.hide(),t?(Vt.legacyRightSidebar.hide(),Vt.sidebarItemProperties.show(),Vt.actionBar.show()):(Ia(),Vt.sidebarItemProperties.hide(),Vt.actionBar.hide(),qn())}function Fn(){if(!Lt.isMultiSelect()){var e=Lt.getSelectedForma();e&&(e.isTypeLockup()?Ho():(e.isImage()&&!e.isLogo()||Lt.isIcon(e))&&mn())}}function Ln({backgroundColor:e}){Vt.errorDialogs.imageCorruptedModal||(Vt.errorDialogs.imageCorruptedModal=new U({headerText:'\n            <span class="error-modal-header">\n              <span>i18n.dialogs.corruptedDocument.kHeaderText</span>\n              <i class="error-modal-header__icon"></i>\n            </span>\n          ',contentText:`<div class="error-modal-content">\n                <span>i18n.dialogs.corruptedDocument.kContentText</span>\n                <span class="error-modal-content_placeholder-indicator" style="background-color: #${e};"></span>\n              </div>`,dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.corruptedDocument.kButtonLabel",onClick:function(){Vt.errorDialogs.imageCorruptedModal.hide()}}]})),Vt.errorDialogs.imageCorruptedModal.show()}function Mn(){if(Vt.postSideBarUI.sidebarLayout){var e=Vt.postSideBarUI.sidebarResize.getSelected(),t=Lt.getDocumentSize(),o=Lt.getImageSizeIfFullBleed(),n=o&&o.width&&o.height&&Math.atan(o.height/o.width)*(4/Math.PI),a=t&&t.width&&t.height&&Math.atan(t.height/t.width)*(4/Math.PI),r=Math.abs(n-a)<=.01;e&&e.item&&"original"===e.item.data.aspect&&!r&&Vt.postSideBarUI.sidebarResize.deselectSelected()}}function Rn(e){var t=f.toLocaleKey(Lt.getUndoDescription());t?(Vt.topBarUI.undo.update({hoverLabel:"i18n.app.kActionLabel",context:{"action-type":"i18n.app.kUndo","action-name":"i18n.actions."+t}}),Vt.topBarUI.undo.enable()):(Vt.topBarUI.undo.update({hoverLabel:"i18n.app.kUndo"}),Vt.topBarUI.undo.disable());var o=f.toLocaleKey(Lt.getRedoDescription());o?(Vt.topBarUI.redo.update({hoverLabel:"i18n.app.kActionLabel",context:{"action-type":"i18n.app.kRedo","action-name":"i18n.actions."+o}}),Vt.topBarUI.redo.enable()):(Vt.topBarUI.redo.update({hoverLabel:"i18n.app.kRedo"}),Vt.topBarUI.redo.disable());const n=Lt.getWatermarkEnabledForDoc();Vt.designSurface.watermarkUI.updateWatermarkStatus(n),function(e){(function(){if(!Vt.topBarUI.downloadButton)return;const{downloadOptionsList:e,selectedOption:t}=Vt.topBarUI.getDownloadOptions();Vt.topBarUI.downloadButton.update({selectedOption:t,optionsList:e})})(),Vt.designSurface.updatePlaybackButton(e)}(e),_t.featureEnabled("post-pgm-visualizer-messages")&&function(){if(Lt){const e=Lt.documentSize();window.postMessage({type:"PGM_UPDATED",graphContent:Lt.getGraph(!0).encode(),documentId:Lt.documentId(),cpServiceDomain:Oe.cpServiceDomain,documentSize:{width:e.width,height:e.height}},"*")}}()}function zn(){On(),Lt.updateConstrainedImages(),Lt.validateDoc("undo")}function Nn(){On(),Lt.updateConstrainedImages(),Lt.validateDoc("redo")}function On(){Vt.postSideBarUI.sidebarBackground&&!Vt.postSideBarUI.sidebarBackground.isHidden()&&Vt.postSideBarUI.sidebarBackground.selectCurrentColor({silent:!0}),Vt.postSideBarUI.sidebarIcon&&!Vt.postSideBarUI.sidebarIcon.isHidden()&&Vt.postSideBarUI.sidebarIcon.selectCurrentColor({silent:!0}),Vt.postSideBarUI.sidebarText&&!Vt.postSideBarUI.sidebarText.isHidden()&&Vt.postSideBarUI.sidebarText.selectCurrentColor({silent:!0}),Vt.postSideBarUI.sidebarPalette&&!Vt.postSideBarUI.sidebarPalette.isHidden()&&Vt.postSideBarUI.sidebarPalette.selectCurrentPalette({silent:!0})}function Wn(){Vt.navStripUI.tabButtonPalette.isSelected()&&Vt.postSideBarUI.sidebarPalette.unbindColorPicker()}function jn(e){Gn(e,tt,!0)}function Vn(e){var t,o=Y.getImageMediaMetadata(e.info);Tt.model._state.isReplaceMode&&(t=Lt.getSelectedForma())&&!t.isShape()&&(t=null),Lt.createFormaFromSVG(e.files[0],o,t),We.publish("editor:iconAdded",{contextualData1:"keyword:"+(e.info.searchText||""),contextualData2:"isReplacing:"+!!t})}function Hn(e){let t,o="null";var n=e.replacementForma&&e.replacementForma.isBackgroundImage();if(e.info){const n=e.files&&e.files[0];n&&n.source?t=n.source:e.info.source?t=e.info.source.name:(Nt.debug("unknown source in handleImagePickerItemSelected analytics",e),t="unknown"),void 0!==e.info.searchText&&(o=e.info.searchText)}else t="upload";We.publish("editor:photoAdded",{contextualData1:"source:"+t,contextualData2:"imageLayer:"+(n?"background":"floating"),contextualData3:"keyword:"+o,contextualData4:"isReplacing:"+!!e.replacementForma})}function Kn(e){var t,o=!!e.replacementForma,n=e.info.searchText,a=e.info.searchFiltersStr,r=e.replacementForma&&e.replacementForma.isBackgroundImage();t="backgrounds"===e.designAssetsPanelId?"editor:backgroundAdded":"editor:assetAdded",n||a||(n="null",a="null");var i={contextualData1:"assetPath:"+e.info.design_intent,contextualData2:"filters:"+a,contextualData3:"isPremium:"+("premium"===e.info.licensingCategory),contextualData4:"keyword:"+n,contextualData5:"assetID:"+e.info.id,contextualData6:"parentPath:"+e.info.directory,contextualData7:"imageLayer:"+(r?"background":"floating"),contextualData8:"isReplacing:"+o};We.publish(t,i)}function Gn(e,t=et,o=!1){const n=Tt.model._state.isReplaceMode;if(n||Lt.canAddMoreImages(1)){const a=Lt.getSelectedForma();if((n||null!=a&&a.isShape())&&(e.replacementForma=a,e.replacementForma&&(e.replacementForma.isLogo()&&!o||o&&!e.replacementForma.isLogo()||e.replacementForma.isShape()||e.replacementForma.isTypeLockup()||"Root"===e.replacementForma.kind?e.replacementForma=null:e.replacementFrame=e.replacementForma.finalFrame,!e.replacementForma&&!Lt.canAddMoreImages(1))))return void pn();if(o&&(e.floatingImageStrategy=M.FloatingImageStrategy.IfHasAlphaOrIsLogo),o||null!=e.replacementForma)e.designAssetsPanelId?Kn(e):o||Hn(e),_n(e,t);else{if(e.designAssetsPanelId?Kn(e):Hn(e),!_t.featureEnabled("post-pgm-poster"))return e.floatingImageStrategy=M.FloatingImageStrategy.IfHasAlphaOrIsLogo,void _n(e,t);!function(e,t){e.floatingImageStrategy=M.FloatingImageStrategy.Always,_n(e,t)}(e,t)}}else pn()}function _n(e,o){var n=t.defer();const a=Tt.model._state.isReplaceMode;o({coreWrapper:Lt,uiStateController:Tt,data:e,docSavedDfd:n,component:Vt,isReplaceMode:a,refreshCurrentBrandElements:da}).catch(e=>Nt.error("Failed to add image",e)),n.promise.done()}function Yn(e){var t={files:[{source:"adobestock",mimeType:e.newItemInfo.mimeType,original:{link:e.newItemInfo.href,height:e.newItemInfo.height,width:e.newItemInfo.width},preview:{link:e.newItemInfo.href,height:e.newItemInfo.height,width:e.newItemInfo.width},thumbnail:{link:e.newItemInfo.thumb.url,height:e.newItemInfo.thumb.height,width:e.newItemInfo.thumb.width},licenseInfo:e.newItemInfo.info}],info:e.newItemInfo.info};Tt.handleEnterReplaceMode(),Gn(t,et)}function Xn(e){e&&e.id&&0===e.id.indexOf("bk_")&&We.publish("usedBrandKitPalette"),We.publish("paletteSelected")}function Zn(e,t,o){Ht.push(e.events.subscribe(t,o))}function Qn(e,t){var o=Vt.designSurface.poster.$el.offset();return{x:e-o.left,y:t-o.top}}function $n(e,t){const o=Qn(e.pageX,e.pageY),n=Lt.getViewToDocMatrix().transformPoint(o),a=M.TheoRect.fromSize(Lt.getDocumentSize()).locatePoint(n);a.x>=0&&a.x<=1&&a.y>=0&&a.y<=1?Vt.designSurface.poster.getColorAtPoint({x:Math.round(n.x),y:Math.round(n.y)}).then((function(o){var n=H.rgb2hex(o);"click"===e.type?t.handleEyeDropperClicked(n):t.handleEyeDropperMoved(n,e)})):"click"===e.type?t.handleEyeDropperClicked(!1):t.handleEyeDropperMoved(!1,e)}function qn(e){(e=e||{}).silent="boolean"==typeof e.silent&&e.silent,Tt&&Tt.handleLeaveReplaceMode(),Vt.navStripUI.globalTabsWrapper&&!Vt.navStripUI.globalTabsWrapper.isActive()&&Vt.navStripUI.globalTabsWrapper.show(),Vt.navStripUI.tabButtonLayout&&Vt.navStripUI.tabButtonLayout.isSelected()&&Vt.postSideBarUI.sidebarLayout.returnFromSelectionState(),Vt.navStripUI.tabButtonPalette&&Vt.navStripUI.tabButtonPalette.isSelected()&&Vt.postSideBarUI.sidebarPalette.rebindColorPicker()}async function Jn(t){if(Tt=new xt(Lt,ze),jt&&Mt===Rt?(Vt.topBarUI&&Vt.topBarUI.updateCoreWrapper(Lt),Vt.navStripUI&&Vt.navStripUI.updateCoreWrapper(Lt),Vt.postSideBarUI&&Vt.postSideBarUI.updateCoreWrapper(Lt),Vt.sidebarItemProperties&&Vt.sidebarItemProperties.updateCoreWrapper(Lt),Vt.actionBar&&Vt.actionBar.updateCoreWrapper(Lt)):await async function(){jt=!0;var t=Mt===it.TEMPLATE?"template-mode main-toolbar toolbar":"main-toolbar toolbar";Vt.postEditorView=new k({id:"PostEditorContent",layout:"rows",parent:Vt.windowPanel,panels:[{id:"PostTopBar",class:t,size:"66px"},{id:"PostApp",size:"auto"}]}),Vt.topBarUI=new ct({editingMode:Mt,coreWrapper:Lt,postFeatureController:_t,events:At,templateNode:$t,waitForSaveToFinish:Qt.waitForSaveToFinish,waitForQuietSaveToFinish:Qt.waitForQuietSaveToFinish,includesPaidAdobeFonts:Ot.includesPaidAdobeFonts,templatePublisherModalParent:Vt.postEditorView,getDocumentRendition:e=>Vt.designSurface.poster.getRendition(e)}),Vt.postAppSection=new k({layout:"columns",panels:[{id:"PostLeftSidebar",size:"80px"},{id:"PostCanvasSection",size:"auto"},{id:"PostRightSidebar",size:"80px"}],parent:"PostApp"}),Vt.legacyRightSidebar=new k({layout:"columns",panels:[{id:"PostLegacySidebarContents",size:"280px"},{id:"PostNavStrip",size:"80px"}],parent:"PostRightSidebar"}),Vt.assetRailSidebar=new k({layout:"columns",panels:[{id:"PostAssetRailNavStrip",size:"80px"}],parent:"PostLeftSidebar"}),it.TEMPLATE,Vt.designSurface=new Ze(Lt,Wt,dt,_t,Jt),Vt.sidebarItemProperties=new F({id:"sidebarItemProperties",parent:"PostRightSidebar",coreWrapper:Lt,controller:Ot,hidden:!0}),Vt.actionBar=new T({id:"actionBarPopUp",parent:"PostCanvasSection",hidden:!0,coreWrapper:Lt,controller:Ot}),Vt.colorPicker=new y({id:"colorPicker",parent:Vt.postEditorView,top:180,left:10,width:250,height:350,hideBrandkit:!_t.featureEnabled("entitle-brand-kit")}),Ut=new kt(Vt.colorPicker,e("#PostEditorContent"),$n),Vt.postSideBarUI=new wt({editingMode:Mt,previousSelectedFormaId:co,events:At,postFeatureController:_t,coreWrapper:Lt,waitForSaveToFinish:Qt.waitForSaveToFinish,waitForQuietSaveToFinish:Qt.waitForQuietSaveToFinish,colorPicker:Vt.colorPicker,designSurface:Vt.designSurface}),_t.featureEnabled("post-enable-debug-menu")&&(Vt.debugView=new D({id:"PostDebugView",parent:"PostCanvasSection"})),Vt.navStripUI=new Dt({events:At,coreWrapper:Lt,postFeatureController:_t,entitlementController:Yt,ExperimentEngine:te,editingMode:Mt,postEditorView:Vt.postEditorView}),Vt.assetRailUI=new Et({events:At,previousSelectedFormaId:co,coreWrapper:Lt,postFeatureController:_t,entitlementController:Yt,ExperimentEngine:te,editingMode:Mt,waitForSaveToFinish:Qt.waitForSaveToFinish,waitForQuietSaveToFinish:Qt.waitForQuietSaveToFinish,controller:Ot,postEditorView:Vt.postEditorView,designSurface:Vt.designSurface,userIsPremium:_t.featureEnabled("is-paid-user"),premiumBadgeVariant:"diamond",dragAndDropEnabled:!1}),Vt.textCapture=new A({parent:Vt.windowPanel,hidden:!0,updateCharStyleRangesCallback:Vo})}().catch(Nt.error),Qt.setComponents({poster:Vt.designSurface.poster,topBarUI:Vt.topBarUI}),Xt=new je({doc:Lt.getDocument(),am:Zt,poster:Vt.designSurface.poster}),Vt.topBarUI&&Vt.topBarUI.setExportController(Xt),Vt.assetRailUI&&Vt.assetRailUI.addContentLogoButton&&Vt.assetRailUI.updateAddContentLogoButtonEnabledState(),yt=new Ge(Tt),Zn(Tt,"ui-state-updated",Bn),Zn(Lt,"design-updated",vn),Zn(Lt,"design-updated",Tt.handleDocumentUpdated.bind(Tt)),Zn(Lt,"forma-updated",Cn),Zn(Lt,"formae-duplicated",Un),Zn(Lt,"formae-deleted",xn),Zn(Lt,"forma-added",Tn),Zn(Lt,"forma-selected",An),Zn(Lt,"selection-changed",Dn),Zn(Lt,"selection-changed",Tt.handleSelectionChanged.bind(Tt)),Zn(Lt,"update-annotations",En),Zn(Lt,"undo-redo-state-changed",Rn),Zn(Lt,"undo-finished",zn),Zn(Lt,"redo-finished",Nn),Zn(Lt,"layer-double-tapped",Fn),Zn(Lt,"show-image-forma-corrupted-modal",Ln),Zn(Lt,"current-brand-changed",ca),Zn(Lt,"exit-crop-mode",$o),Zn(Lt,"show-actionfeedback-message-modal",qo),Zn(Lt,"enter-char-style-mode",Wo),Zn(Lt,"exit-char-style-mode",jo),Zn(Lt,"force-reload-editor",Qt.handleForceReloadRequest),Zn(Lt,"update-save-promise",Qt.handleUpdateSaveRequest),Zn(Lt,"clean-up-after-save",Qt.cleanUpAfterSave),Zn(Lt,"trigger-save",Qt.handlePlatformSaveTriggered),Lt.bindToSaveManager(),Zn(Vt.actionBar,"buttonpress-edit",Ho),Zn(Vt.actionBar,"buttonpress-change-photo",Ot.handleReplaceImageButtonPress),Zn(Vt.actionBar,"buttonpress-duplicate",Go),Zn(Vt.actionBar,"buttonpress-delete",an),Zn(Vt.actionBar,"buttonpress-group",rn),Zn(Vt.actionBar,"buttonpress-ungroup",sn),Zn(Vt.actionBar,"stock-image-licensed",Yn),Zn(Vt.designSurface.posterAdornments,"buttonpress-edit",Ho),Zn(Vt.designSurface.posterAdornments,"buttonpress-duplicate",Go),Zn(Vt.designSurface.posterAdornments,"buttonpress-delete",an),Zn(Vt.designSurface.posterAdornments,"buttonpress-group",rn),Zn(Vt.designSurface.posterAdornments,"buttonpress-ungroup",sn),Zn(Vt.designSurface.posterAdornments,"buttonpress-addText",Ko),Zn(Vt.designSurface.posterAdornments,"buttonpress-change-photo",mn),Zn(Vt.designSurface.posterAdornments,"buttonpress-logo",hn),Zn(Vt.designSurface.posterAdornments,"update-swap-thumbnail",ln),Zn(Vt.designSurface.posterAdornments,"remove-swap-thumbnail",cn),Zn(Vt.designSurface.posterAdornments,"handle-drag",un),Zn(Vt.designSurface.posterAdornments,"stock-image-licensed",Yn),Zn(Vt.designSurface.posterAdornments,"post-interaction-layer-clicked",(function(){Vt.topBarUI.docNameInput.$el.is(":focus")&&Vt.topBarUI.docNameInput.blur(),Vt.topBarUI.downloadButton&&Vt.topBarUI.downloadButton.el.hideDownloadList(),Vt.topBarUI.sharePostButton&&Vt.topBarUI.sharePostButton.el.hideMenuDropdown(),Vt.designSurface.posterAdornments&&Vt.designSurface.posterAdornments.closeZoomComboBox(),Vt.fontPicker&&!Vt.fontPicker.isHidden()&&Vt.fontPicker.hide(),Ut.hide()})),Zn(Vt.postSideBarUI.sidebarText,"buttonpress-edit",Ho),Zn(Vt.postSideBarUI.sidebarText,"buttonpress-delete",an),Zn(Vt.postSideBarUI.sidebarText,"buttonpress-addText",Ko),Zn(Vt.postSideBarUI.sidebarText,"get-new-brandkit-colors",ra),Zn(Vt.postSideBarUI.sidebarText,"eyedropper-changed",(function(e){$n(e,Vt.postSideBarUI.sidebarText)})),Zn(Vt.postSideBarUI.sidebarText,"buttonpress-close",qn),Zn(Vt.postSideBarUI.sidebarText,"size-slide-start",Vt.designSurface.posterAdornments.hideSelectionBox),Zn(Vt.postSideBarUI.sidebarText,"size-slide-end",Vt.designSurface.posterAdornments.showSelectionBox),Zn(Vt.designSurface.poster,"rendered-image-layer-url-changed",Mn),Zn(Vt.postSideBarUI.sidebarTheme,"item-selected",Pn),Zn(Vt.postSideBarUI.sidebarTheme,"brand-button-pressed",ta),Zn(Vt.postSideBarUI.sidebarTheme,"theme-panel-title-bar-close",Ia),Zn(Vt.postSideBarUI.sidebarBackground,"buttonpress-change-photo",mn),Zn(Vt.postSideBarUI.sidebarBackground,"buttonpress-add-photo",gn),Zn(Vt.postSideBarUI.sidebarBackground,"filter-selected",(function(e,t,o){Lt.setImageFilterForSelection(e,t,o).done()})),Zn(Vt.postSideBarUI.sidebarBackground,"bg-color-selected",(function(e){Lt.setColorForSelection(e).done()})),Zn(Vt.postSideBarUI.sidebarBackground,"image-forma-replace-with-color",Lt.updateConstrainedImages),Zn(Vt.postSideBarUI.sidebarBackground,"eyedropper-changed",(function(e){$n(e,Vt.postSideBarUI.sidebarBackground)})),Zn(Vt.postSideBarUI.sidebarBackground,"buttonpress-close",qn),Zn(Vt.postSideBarUI.sidebarBackground,"buttonpress-set-foreground",Jo),Zn(Vt.postSideBarUI.sidebarBackground,"buttonpress-set-background",en),Zn(Vt.postSideBarUI.sidebarBackground,"buttonpress-crop",_o),Zn(Vt.postSideBarUI.sidebarBackground,"buttonpress-set-cutout-none",tn),Zn(Vt.postSideBarUI.sidebarBackground,"buttonpress-set-cutout-remove-background",on),Zn(Vt.postSideBarUI.sidebarLayout,"grid-item-selected",bn),Zn(Vt.postSideBarUI.sidebarLayout,"layout-panel-title-bar-close",Ia),Zn(Vt.postSideBarUI.sidebarResize,"size-item-selected",Sn),Zn(Vt.postSideBarUI.sidebarResize,"resize-panel-title-bar-close",Ia),Zn(Vt.postSideBarUI.sidebarPalette,"item-selected",wn),Zn(Vt.postSideBarUI.sidebarPalette,"item-selected",Xn),Zn(Vt.postSideBarUI.sidebarPalette,"eyedropper-changed",(function(e){$n(e,Vt.postSideBarUI.sidebarPalette)})),Zn(Vt.postSideBarUI.sidebarPalette,"update-palette-color",(function(e,t){Lt.updateColorInTheme(e,t).done()})),Zn(Vt.postSideBarUI.sidebarPalette,"color-panel-title-bar-close",Ia),Zn(Vt.postSideBarUI.sidebarLogo,"buttonpress-closeLogoPanel",qn),Zn(Vt.postSideBarUI.sidebarIcon,"buttonpress-replace-icon",mn),Zn(Vt.postSideBarUI.sidebarIcon,"icon-color-selected",(function(e,t){Lt.setColorForSelection(e,t).done()})),Zn(Vt.postSideBarUI.sidebarIcon,"hide-icon-picker",(function(){Vt.postSideBarUI.changeIconModalPanel.hide()})),Zn(Vt.postSideBarUI.sidebarIcon,"eyedropper-changed",(function(e){$n(e,Vt.postSideBarUI.sidebarIcon)})),Zn(Vt.postSideBarUI.sidebarCrop,"crop-shape-selected",Xo),Zn(Vt.postSideBarUI.sidebarCrop,"crop-aspect-ratio-selected",Yo),Zn(Vt.postSideBarUI.sidebarCrop,"close-crop-picker",Zo),Zn(Vt.postSideBarUI.sidebarBackground,"hide-image-picker",(function(){Vt.postSideBarUI.changeImageModalPanel.hide()})),Zn(Vt.assetRailUI.iconPicker,"item-selected",Vn),Zn(Vt.assetRailUI.libImagePicker,"item-selected",Gn),Zn(Vt.assetRailUI.imagePicker,"item-selected",Gn),Zn(Vt.assetRailUI.designAssetsPicker,"item-selected",Gn),Zn(Vt.assetRailUI.backgroundAssetsPicker,"item-selected",Gn),Zn(Vt.assetRailUI.addTextSidebar,"badge-selected",kn),Zn(Vt.assetRailUI.addTextSidebar,"close-buttonpress",qn),Zn(Vt.assetRailUI.logoPicker,"item-selected",e=>Je({component:Vt,logoData:e,coreWrapper:Lt})),Zn(Vt.assetRailUI.logoPicker,"buttonpress-uploadNewLogo",fn),Zn(Vt.assetRailUI.logoPicker,"logo-uploaded",jn),Zn(Vt.colorPicker,"brand-color-added",ra),Zn(Vt.colorPicker,"colorChangeModal",(function(e){"begin"===e.type&&(oo?(Lt.endBranch(!0),Lt.beginBranch()):(oo=!0,Lt.beginBranch()))})),Zn(Vt.designSurface.posterAdornments,"post-interaction-layer-pointer-down",(function(){oo&&(Lt.endBranch(!0),oo=!1)})),Vt.postSideBarUI.brandIndicator&&Zn(Vt.postSideBarUI.brandIndicator,"switch-brand",po),Vt.postSideBarUI.sidebarAnimation&&(Zn(Vt.postSideBarUI.sidebarAnimation,"animation-loading-begin",Vt.designSurface.handleAnimationLoadingBegin),Zn(Vt.postSideBarUI.sidebarAnimation,"animation-loading-end",Vt.designSurface.handleAnimationLoadingEnd),Zn(Vt.postSideBarUI.sidebarAnimation,"animation-panel-title-bar-close",Ia)),Vt.postAppSection&&Zn(Vt.postAppSection,"change:size",Sa),jt&&(An({forma:null}),Vt.navStripUI.globalTabsWrapper.hide(),Tt.handleSelectionChanged()),Qt.resumeSave(),"new"!==qt.operation&&"remix"!==qt.operation&&"new-template-from-template"!==qt.operation||Qt.requestSave(!1,!0),Vt.postSideBarUI.imagePicker&&Vt.postSideBarUI.imagePicker.home(),Mt===it.TEMPLATE?Vt.topBarUI.topColorStrip.$el.css({background:"#ffffff"}):Vt.topBarUI.topColorStrip.$el.css({background:"#10c459"}),Vt.topBarUI.collabStatusButton){var o=s.currentDoc.getCollaboration()&&"NONE"!==s.currentDoc.getCollaboration();Vt.topBarUI.updateCollabStatusButton(o)}lt(Lt,dt),Mt!==it.TEMPLATE&&(t.showShareButton?Vt.topBarUI.sharePostButton.show():Vt.topBarUI.sharePostButton.hide(),t.showDownloadButton?Vt.topBarUI.downloadButton.show():Vt.topBarUI.downloadButton.hide()),Vt.postSideBarUI.sidebarTheme.setCoreWrapper(Lt),Vt.postSideBarUI.sidebarText.setCoreWrapper(Lt),Vt.postSideBarUI.sidebarBackground.setCoreWrapper(Lt),Vt.postSideBarUI.sidebarLogo.setCoreWrapper(Lt),Vt.postSideBarUI.sidebarIcon.setCoreWrapper(Lt),Vt.postSideBarUI.sidebarMultiselect.setCoreWrapper(Lt),Vt.postSideBarUI.sidebarGroup.setCoreWrapper(Lt),Vt.postSideBarUI.sidebarLayout.setCoreWrapper(Lt),Vt.postSideBarUI.sidebarLayout.deselectSelected(),Vt.postSideBarUI.sidebarCrop.setCoreWrapper(Lt),Vt.postSideBarUI.sidebarResize.setCoreWrapper(Lt),Vt.postSideBarUI.sidebarResize.deselectSelected(),Vt.postSideBarUI.sidebarAnimation&&Vt.postSideBarUI.sidebarAnimation.setCoreWrapper(Lt),Vt.debugView&&Vt.debugView.setCoreWrapper(Lt),Pt.setCoreWrapper(Lt),Vt.postEditorView.show(),Vt.windowPanel.resize(),Vt.assetRailUI.sidebarTemplates&&(qt.projectContext||(qt.projectContext=s.getProjectContexts()),Vt.assetRailUI.sidebarTemplates.setupSessionData(qt,s.currentDoc,eo,Zt.remixParentAnalyticsMetadata,_t.featureEnabled("is-paid-user")),Vt.assetRailUI.sidebarTemplates.setCoreWrapper(Lt));var a,r,i=Date.now(),d=Vt.designSurface.poster.events.subscribe("rendered",(function(){var e=Date.now()-i;We.publish("post:posterInitialRenderEnd",{contextualData1:"timeElapsedMs:"+e,contextualData2:"editorOperation:"+qt.operation,contextualData3:"numImages:"+Lt.imageFormas().length}),Vt.assetRailUI.sidebarTemplates&&Vt.assetRailUI.sidebarTemplates.events.publish("poster-initial-render-end"),d.remove()}));Vt.designSurface.initializeComponents(Lt,Wt),Vt.postSideBarUI.brandIndicator&&Vt.postSideBarUI.brandIndicator.update({collaborationStatus:s.currentDoc.getCollaboration()||"NONE",isEntitled:_t.featureEnabled("entitle-brand-kit")}),Vt.postSideBarUI.sidebarBackground.update(),Vt.designSurface.watermarkUI.updateWatermarkStatus(Wt,!0),Vt.assetRailUI.showPanelOnEditorStartIfValidPanelId(t.startingMenu,qt)&&delete t.startingMenu,Mt===it.TEMPLATE?(Vt.navStripUI.tabButtonResize.select(),a=St.getTemplateName($t),r=f.translate("app.kDefaultTemplateName")):(t.startingMenu?"colors"===t.startingMenu?Vt.navStripUI.tabButtonPalette.select():"layout"===t.startingMenu?Vt.navStripUI.tabButtonLayout.select():"resize"===t.startingMenu?Vt.navStripUI.tabButtonResize.select():Vt.navStripUI.tabButtonTheme.select():t.showImageModalPanelOnload?(Vt.navStripUI.tabButtonBackgroundImage.select(),Vt.postSideBarUI.changeImageModalPanel.show()):"remix"===qt.operation||"new-from-template"===qt.operation?Vt.navStripUI.tabButtonLayout.select():Vt.navStripUI.tabButtonTheme.select(),a=Lt.getDocument().documentName,r=f.translate("app.kDefaultDocName")),Vt.topBarUI.docNameInput&&((a=a||r)===r?(Vt.topBarUI.docNameInput.$el.addClass("placeholder"),Vt.topBarUI.docNameInput.$el.removeClass("named")):(Vt.topBarUI.docNameInput.$el.removeClass("placeholder"),Vt.topBarUI.docNameInput.$el.addClass("named")),Vt.topBarUI.docNameInput.setText(a));(parseInt(window.marvel.features.getFeature("post-libraries-usage-count"),10)||0)>2&&n.delay((function(){At.publish("ui:handleHideLibrariesNewFlag")}),1),window.addEventListener("resize",(function(e){Vt.designSurface.posterAdornments.handleWindowResize(),Vt.designSurface.watermarkUI.updateWatermarkDiscoverabilityComponents()})),Rn({atShowEditor:!0}),Vt.topBarUI.resetTemplatePublisherForm()}function ea(e){const o=ze.getCurrentBrandElements();if(!o||!o.activated)return t.resolve(null);e||o.coreBrand||oa(o),Vt.designSurface&&Vt.designSurface.beginImageLoading();const n=e?Ne.getLiteCoreBrand(o):Promise.resolve(o.coreBrand),a=o.belongsToUser?ze.checkForRestrictedFonts():t.resolve([]);let r;return n.then(e=>(r=e,a)).then((function(e){if(e.length){const o=t.defer();return window.marvel.events.trigger("missing-brand-fonts-ux",{doc:s.currentDoc,missingFonts:e,defer:o}),o.promise.then(e=>e?t.resolve():t.reject({brandFontsVerificationFailed:!0}))}return t.resolve()})).then(()=>r?Lt.brandDocument(r):t.resolve()).then(()=>{Vt.designSurface&&Vt.designSurface.endImageLoading()}).catch(e=>{if(e&&e.brandFontsVerificationFailed)return t.resolve();const o=e&&e.message?": "+e.message:"";return Nt.error("brandDocument error "+o,e),t.resolve()})}function ta(e){const t=ze.getCurrentBrandElements();"INCOMING"!==s.currentDoc.getCollaboration()||t&&(!t||!1!==t.showBrandInUI)?t&&t.activated?(ea(),We.publish("brandifyApplied")):window.marvel.events.trigger("spark-post-show-brandify-onboarding",{element:e.$element}):re.showAlert(f.translate("dialogs.brandifySharedProjectAlert.kHeaderText"),f.translate("dialogs.brandifySharedProjectAlert.kContentText"),{okText:f.translate("dialogs.brandifySharedProjectAlert.kButtonLabel")})}function oa(e){if(e&&e.coreBrand)return M.Host.setAuthoringContext(e.coreBrand),e.coreBrand;M.Host.setAuthoringContext(null)}function na(e){Vt.assetRailUI.logoPicker&&(e&&e.primaryLogoPromise?Vt.assetRailUI.logoPicker.updateListOfBrandKitLogos(e):Vt.assetRailUI.logoPicker.updateListOfBrandKitLogos([]))}function aa(e){var t=e&&e.activated?e:null;Vt.postSideBarUI.sidebarPalette&&Vt.postSideBarUI.sidebarPalette.setListOfBrandKitPalettes(t),Vt.postSideBarUI.sidebarText&&Vt.postSideBarUI.sidebarText.setBrandKitColors(Lt.getBrandKitColorsPalettesForSelectedLockup(t)),Vt.postSideBarUI.sidebarBackground&&Vt.postSideBarUI.sidebarBackground.setBrandKitColors(t),Vt.postSideBarUI.sidebarIcon&&Vt.postSideBarUI.sidebarIcon.setBrandKitColors(t),Vt.colorPicker&&Vt.colorPicker.update({authoringContext:ze.currentBrandKit(),brandColors:t&&t.colors||[]})}function ra(){!function(e){const o=ze.getCurrentBrandElements();!_t.featureEnabled("entitle-brand-kit")||o&&!1===o.showBrandInUI?t():ze.refreshBrandColors().then((function(t){oa(t),e&&aa(t)}))}(!0)}function ia(e){e=e||ze.getCurrentBrandElements();const t=ze.currentBrandKit();let o=e;e&&!1===e.showBrandInUI&&(o=null),na(o),aa(o),Vt.postSideBarUI.sidebarText&&Vt.postSideBarUI.sidebarText.setBrandkit(e&&!1!==e.showBrandInUI?t:null),Vt.postSideBarUI.sidebarTheme&&Vt.postSideBarUI.sidebarTheme.setBrandKitThemes(o),Vt.postSideBarUI.brandIndicator&&Vt.postSideBarUI.brandIndicator.setBrand(e,t);_t.featureEnabled("entitle-brand-kit")?Vt.colorPicker.setEntitlement(!0):Vt.colorPicker.setEntitlement(!1)}function sa(e,t){oa(e),t&&ia(e)}function da(e,o){return ze.refreshCachedCurrentBrandElements().then(fa(o,t=>{sa(t,e)})).catch(e=>{if(e&&e.message===st.STALE_SESSION)return t.reject(e);Nt.error("refreshCurrentBrandElements: "+e)})}function la(e,o=!0){const n=ze.switchCurrentAuthoringContext(e).then(e=>{if(sa(e,!0),o)return Lt.changeBranding(e.coreBrand)});return qe(n,3e5).catch(e=>{const o=e?e.message:"";return re.showAlert(f.translate("dialogs.switchBrandFailureAlert.kHeaderText"),f.translate("dialogs.switchBrandFailureAlert.kContentText"),{okText:f.translate("dialogs.switchBrandFailureAlert.kButtonLabel")}),Nt.error("switchBrand error: "+o,e),t.reject()})}function ca(e){e!==(ze.getCurrentBrandElements()&&ze.getCurrentBrandElements().id)&&la(e,!1)}let ua;function pa(e){if(e=e||{},!ua){ua=t.defer();const n=Date.now();o.e(57).then(function(t){const a=o("+7aA"),r=Date.now();Nt.info("headless load time = "+(r-n));("string"==typeof e.authoringContextId?ze.getBrandKitById(e.authoringContextId):Promise.resolve()).then(e=>a.initialize(e)).finally(()=>{const e=Date.now();Nt.info("headless init time = "+(e-r)),ua.resolve(a)})}.bind(null,o)).catch(o.oe)}return ua.promise}function ga(e,t){var o="/";if("organizer"===t?o+="projects":"create_brand"===t&&(o+="branding/create"),oo=!1,Qt){if(io=!0,e="boolean"==typeof e&&e)Qt.cancelPendingCoreSaves(),Qt.resolveSaveDeferred();else{if(ma())return Qt.cancelPendingCoreSaves(),void ha({returnPath:o});Qt.executePendingCoreSaves()}Qt.waitForSaveToFinish().then((function(){Lt&&Lt.willCloseDocument(),window.marvel.navigate(o,{trigger:!0})}))}else window.marvel.navigate(o,{trigger:!0})}function ma(){return"new"===qt.operation&&"blank"===qt.workflow&&!ro}function ha(e){e=e||{};const o=t.defer(),n=new U({headerText:"i18n.dialogs.saveNonDirtyNewBlank.kHeaderText",contentText:"i18n.dialogs.saveNonDirtyNewBlank.kContentText",dismissable:!0,onDismissed:function(){o.resolve({dismissed:!0})},buttons:[{class:"pill pill-primary-on-dark",label:"i18n.dialogs.saveNonDirtyNewBlank.kDontSave",onClick:function(){n.hide(),o.resolve(!1)}},{class:"pill pill-secondary-on-light",label:"i18n.dialogs.saveNonDirtyNewBlank.kSaveProject",onClick:function(){n.hide(),o.resolve(!0)}}]});o.promise.then((function(o){if(!o.dismissed)if(Qt.requestSave(!0),o)Qt.waitForQuietSaveToFinish().then((function(){e.returnPath?window.marvel.navigate(e.returnPath,{trigger:!0}):e.defer&&e.defer.resolve()}));else{const o=new U({headerText:"i18n.dialogs.saveNonDirtyNewBlank.kDeleteProgress",contentText:'<div class="postspinner postspinner-small"></div>',dismissable:!1});o.show();const n=function(){o.hide()};window.marvel.events.once("design-view-unloading",n),Qt.waitForQuietSaveToFinish().then((function(){const o=t.defer();window.marvel.events.trigger("delete-current-doc",{doc:s.currentDoc,defer:o}),o.promise.then((function(){e.returnPath?window.marvel.navigate(e.returnPath,{trigger:!0}):e.defer&&e.defer.resolve()}))}))}}))}function fa(e,o){var n=this;return function(){if("number"==typeof e&&e!==Kt)return t.reject(new Error(st.STALE_SESSION));var a=[].slice.apply(arguments);try{var r=o.apply(n,a);return r}catch(e){return t.reject(e)}}}function ba(e){e&&e.message===st.STALE_SESSION?Nt.warn("Abandoning stale session. May be benign."):(window.marvel.events.trigger("hide-interstitial"),!e||e.userCanceledNPW||e.doNotLog||e.isWebGLUnavailable?(e&&e.isWebGLUnavailable&&Nt.warn("Failed to enable Post editor due to WebGL unavailability"),ga(!0)):(e.url=window.location.href,Nt.error("error enabling Post editor",e),Vt.windowPanel.show(),Vt.errorDialogs.enableEditorErrorModal=ae(e,()=>{ga(!0)})))}function Ia(){Vt.legacyRightSidebar.show(),Vt.navStripUI.deselectSelectedTabs();const e=Vt.legacyRightSidebar.getPanelById("PostLegacySidebarContents");e&&e.hide();const t=Vt.postAppSection.getPanelById("PostRightSidebar");t&&t.update({width:80}),Vt.sidebarItemProperties.hide(),Vt.designSurface&&Vt.designSurface.handleRightSidebarClose()}function Sa(){const e=Vt.legacyRightSidebar.getPanelById("PostLegacySidebarContents");if(e){e.isHidden()||(e.hide(),this.windowResizeTimout&&clearTimeout(this.windowResizeTimeout),this.windowResizeTimeout=setTimeout(()=>{const t=Vt.postAppSection.getPanelById("PostRightSidebar");t&&t.update({width:320}),e&&e.show()},200))}}return Ot.handleAnnotationClicked=()=>{const e=Lt.getFirstAnnotation();e?yt.handleAnnotationClicked(e):Nt.warn("Annotation clicked when none exists")},Ot.enable=function(e,o){Zt=new Ve;var a=++Kt;function r(e=!1){if(a!==Kt||!0===e)throw new Error(st.STALE_SESSION)}if(!e)return;Vt.errorDialogs.fontMissingNoticeModal&&Vt.errorDialogs.fontMissingNoticeModal.hide(),Ft=e,Vt.windowPanel?Vt.windowPanel.update({parentDomElement:Ft,hidden:!0}):Vt.windowPanel=new v({id:"PostWindowPanel",parentDomElement:Ft,hidden:!0});const i=new ut;i.start();var d,l=0,c="new"===(qt=o).operation;Rt=Mt,Mt=it.DOCUMENT,"edit-template"===qt.operation&&(Mt=it.TEMPLATE),Ot.enabled=!0;var u=at(_t),p=t.allSettled([Qt?Qt.saveDocumentDeferred:t.resolve(),_t.loadFeatures()]);m.doSerial([p,function(){return f.initLocalization(f.sparkSelectedLocale)}]).then(fa(a,(function(){const e=_t.featureEnabled("entitle-brand-kit");return gt.listenToMarvelEvents(qt,Vt,e,uo),M.Host.setFeatureController(_t),ht(Vt,qt,e,Zt,r)}))).then(fa(a,()=>ot(Vt))).then(fa(a,(function(){if(!c)return t.resolve();Vt.newPostWorkflow||(Vt.newPostWorkflow=new _e({parent:Vt.windowPanel})),We.publish("newProjectWorkflowLoaded");var e=Date.now(),n=Vt.newPostWorkflow.prompt(o);return Vt.windowPanel.show(),n.then((function(t){eo=d=t,l=Date.now()-e,window.marvel.events.trigger("show-interstitial",{typeName:"post"})}))}))).then(fa(a,(function(){return nt(qt,_t,r)}))).then(fa(a,(function(){const[e,t]=It(Vt,Gt.promise);return t.then(e=>{e?Lt&&Lt.replaceMissingFonts():ga(!0)}),e}))).then(fa(a,()=>da(!1,a))).then(fa(a,async()=>{({coreWrapper:Lt,templateNode:$t}=await vt({appConfig:qt,templateNode:$t,validateSession:r})),Qt=new $e(Lt,Mt,qt.operation,_t,$t),M.Host.setCoreWrapper(Lt),M.FormaToPGMUtils.cpEnv=qt.cpServiceDomain===window.marvel.settings.cpsStage?"stage":"prod",Lt.validateDoc("open"),Zt.setDocument(Lt.getDocument()),Gt.resolve(Lt)})).then(fa(a,async()=>{const e=!!Tt&&Tt.model._state.isReplaceMode;await ft({appConfig:qt,newPostParams:d,queryParams:o,isReplaceMode:e,coreWrapper:Lt,component:Vt,addNewImage:et,brandDocument:ea,validateSession:r})&&(ro=!0)})).then(fa(a,(function(){var e="remix"===qt.operation,o="new-from-template"===qt.operation,n=qt.cpServiceDomain||"cc-api-cp.adobe.io",r=Lt.getRemixParentsCpIds(),i=qt.cpAssetId||(r?r[r.length-1]:null),d=o?qt.templateId:Lt.getAuthoringContextThemeId();return o&&Lt.setAuthoringContextThemeId(qt.templateId),Zt.getRemixParentCPMetadata(i,n,!!d).then(fa(a,(function(t){e&&(s.currentDoc.name="",Lt.setRemixParentCpId(t.id))}))).catch((function(o){return o&&o.message===st.STALE_SESSION||e?t.reject(o):(Nt.warn("Failed to get parent CP metadata for a non-remix flow",o),t.resolve())}))}))).then(fa(a,()=>mt(Vt,qt,Lt))).then(fa(a,(async function(){({isWatermarkEnabled:Wt,dismissedWatermarkCoachmark:Jt}=await rt(u,qt,_t,Lt,r))}))).then(fa(a,(function(){Lt.resetUserActions(),Lt.monitorTransactions(),Jn(function(e){e=e||{};var t=ao.default;if(e.workflow&&ao.hasOwnProperty(e.workflow)&&(t=n.clone(ao[e.workflow])),e.startingMenu&&(t.startingMenu=e.startingMenu),!t.isDefault&&e.buttons){var o=e.buttons;o.indexOf("facebook_upload")>=0&&(t.showFacebookUploadButton=!0),o.indexOf("share")>=0&&(t.showShareButton=!0),o.indexOf("download")>=0&&(t.showDownloadButton=!0)}return n.each(no,(function(o){var a;n.isUndefined(e[o])||(a="true"===e[o]||"false"!==e[o]&&e[o],t[o]=a)})),t}(o)).then(fa(a,()=>{Mt===it.TEMPLATE&&(zt={templateName:St.getTemplateName($t)}),Vt.windowPanel.show(),window.marvel.events.trigger("hide-interstitial"),ia(ze.getCurrentBrandElements()),"remix"!==qt.operation&&"new-from-template"!==qt.operation&&"new"!==qt.operation||(Vt.navStripUI&&Vt.navStripUI.globalTabsWrapper.show({silent:!0,noSelect:!0}),Ia())})).catch(Nt.error)}))).then(fa(a,(function(){pt(qt,Zt,Lt),window.marvel.events.trigger("editor-displayed",{appName:"post"}),i.end(qt,l,jt),Ye.startListening({handleUndo:go,handleRedo:mo,handleSelectAll:Lt.selectAll,handleDeselectAll:Lt.deselectAll,handlePanOn:Do,handlePanOff:Eo,handleZoomIn:Fo,handleZoomOut:Lo,handleZoomFit:Mo,handleZoomFill:Ro,handleZoomActualSize:zo,handlePanView:No}),bt(qt,Vt,Lt)}))).catch(ba).done()},Ot.getMetadataForExportAnalytics=function(e,t){return Zt.getMetadataForExportAnalytics(e,t)},Ot.disable=function(){Ot.enabled=!1,ze.resetBrandCaches(),$t=null,zt=null,ro=!1,eo=null,Object.keys(Vt.errorDialogs).forEach(e=>Vt.errorDialogs[e].hide()),qn({silent:!0}),Vt.windowPanel&&Vt.windowPanel.hide(),Tt&&(Tt.destroy(),Tt=null),Gt=t.defer(),Qt.waitForSaveToFinish(!1).then(()=>{Vt.designSurface&&Vt.designSurface.poster.update({core:null}),Vt.designSurface&&Vt.designSurface.posterAdornments.disable(),Vt.postEditorView&&Vt.postEditorView.hide(),Vt.newPostWorkflow&&Vt.newPostWorkflow.hide(),gt.unlistenToMarvelEvents(),function(){for(var e=0;e<Ht.length;e++)Ht[e].remove();Ht=[]}(),Ye.stopListening()})},Ot.handleUnload=function(){if(!Lt)return t();const e=Lt.getDocument();if(!e)return t();const o=G.getAllStringForFormaUsedWheelSuggestions(e);if(o.length>0&&We.publish("lockupStyleCaptured",{contextualData1:"styleString:"+o,contextualData2:"location:EditorClose"}),!io&&ma()){var n=t.defer();return ha({defer:n}),n.promise}return io=!1,Qt.waitForSaveToFinish()},Ot.getCurrentDocumentSynthesizedName=function(){return Lt.getCurrentDocumentSynthesizedName()},Ot.getCurrentDocumentDescription=function(){return Lt.getCurrentDocumentDescription()},Ot.getRemixAncestorsIntoMachineTags=function(e){return Lt.getRemixAncestorsIntoMachineTags(e)},Ot.getDocumentSize=function(){return Lt.getDocumentSize()},Ot.getCoreWrapperPromise=function(){return Gt.promise},Ot.saveAsCopyToTemplate=function(){var e,t;return Vt.designSurface.poster.getRendition({width:500,imageQuality:.75}).then((function(e){return t=e,r.getController()})).then((function(e){return e.getGlobalActiveContext()})).then((function(t){if(!(e=t))throw new Error("No current BrandKit.");return St.createEmptyPostTemplate(e)})).then((function(o){var n=q.toTemplateExternal(e,o,q.CommitChanges.AUTO);return Lt.saveCopyWithRenditions(n,null,t)}))},Ot.getDownloadImageBlobPromise=function(e,t,o){if(Ot.enabled)return Xt.generateImageBlob(t,o);let n;return pa({authoringContextId:e.getDCXRoot().getValue("authctx#ctxid")}).then(t=>{const o=$.fromDocument(e),a=new J;return n=new h({persistSource:o,persistSave:a}),n.whenInitialized().then(()=>t)}).then(e=>{var o=n.getDocument();le.reportNounProjectIds(o,a,n.requestSave);const r=je.getRenditionParams(o,t);return e.getRenditionBlobPromise(n,r)})},Ot.getPgmGraphForPublish=function(){return Xe.getPgmGraphForPublish(Lt)},Ot.hasAnimationStyle=function(){return!!Lt&&Lt.hasAnimationStyle()},Ot.webAnimationEnabled=function(){return dt},Ot.getCompositeImageFiles=function(e){var o;return pa().then((function(){var t=$.fromDocument(e),n=new J;return(o=new h({persistSource:t,persistSave:n})).whenInitialized()})).then((function(){var e=o.imageFormas(),n=[];e.forEach((function(e){n.push(Qe.load(Oe.decodeUrl(e.contentNode.url)))}));var a=[];return t.all(n).then((function(){for(var e=[],o=[],n=0;n<arguments[0].length;n++){var r=arguments[0][n];if(r instanceof HTMLImageElement){o.push(r.src);var i=r.src.substring(r.src.lastIndexOf("=")+1),s=_.createCanvas(r);e.push(_.canvasToBlob(s,i))}}return t.all(e).then((function(){for(var e=0;e<arguments[0].length;e++){var t=arguments[0][e],n=new RegExp(/asset_id=([^&]*)/),r=n.exec(o[e])[1],i=o[e].substring(o[e].lastIndexOf("/")+1);a.push({name:r+"."+i,assetId:r,blob:t})}return a})).catch((function(e){Nt.error("getCompositeImageFiles fail-1",e)}))})).catch((function(e){Nt.error("getCompositeImageFiles fail-2",e)}))}))},Ot.includesUploadedFonts=function(){return!!Lt&&Lt.includesUploadedFonts()},Ot.includesPaidAdobeFonts=function(){return Lt?Lt.getDocFontSourceUsage().indexOf(M.describeFontSource(M.FontSource.TYPEKIT_PREMIUM))>-1:(Nt.warn("includesPaidAdobeFonts: Unable to get font usage info from doc - coreWrapper unavailable"),"unknown")},Ot.getRemixParentsCpIds=function(){return Lt?Lt.getRemixParentsCpIds():(Nt.warn("getRemixParentsCpIds: Unable to get remix parent ids from doc - coreWrapper unavailable"),null)},Ot.getConstrainedImages=function(){return Lt?Lt.getConstrainedImages():(Nt.warn("getConstrainedImages: Unable to get constrained images info from doc - coreWrapper unavailable"),null)},Ot.getFontsUsed=function(){var e=t.defer();return Gt.promise.done((function(){Lt?e.resolve(Lt.getFontsUsed()):e.reject("coreWrapper is undefined")}),(function(){e.reject("could not load coreWrapper")})),e.promise},Ot.setCPProjectId=function(e){Lt&&Lt.setCPProjectID(e)},Ot.setCPAlias=function(e){Lt&&Lt.setCommunityPlatformAlias(e)},Ot.setCPAssetId=function(e){Lt&&Lt.setCommunityPlatformAssetID(e)},Ot.setPublishedContentEtag=function(e){Lt&&Lt.setPublishedEtag(e)},Ot.showColorPicker=function(e){const t=i(i({},e),{},{coreWrapper:Lt,containingElement:Vt.sidebarItemProperties.el});Ut.show(t)},Ot.handleReplaceImageButtonPress=function(e){mn(e)},Ot.enterCropMode=function(){Qo(),Lt.enterCropMode().done()},Ot.exitCropMode=function(e){$o(),Lt.exitCropMode(!e).done()},Ot.addExistingLogo=function(e){const t=ze.getCurrentBrandElements(),o=t&&t.logos&&t.logos.find(t=>t.id===e);o&&Je({component:Vt,logoData:o,coreWrapper:Lt})},Ot.addNewLogo=function(){const e=new ye({parent:Vt.postEditorView,type:"image",hidden:!0});e.events.subscribe("item-selected",(function(t){jn(t),e.remove()})),e.click(),fn()},Ot.showFontPicker=function(t){const o=e(t);Vt.fontPicker?(Vt.fontPicker.setAnchorElement(o),Vt.fontPicker.setContainingElement(o)):(Vt.fontPicker=new De({anchorEl:o,hidden:!0}),Vt.fontPicker.setContainingElement(o),Vt.fontPicker.events.subscribe("add-custom-fonts-attempted",(function(){d.showMerchPopover({anchorLocation:t.getBoundingClientRect(),touchpointName:"postCustomFontsButton"})}))),Vt.fontPicker.setCoreWrapper(Lt);const n=ze.getCurrentBrandElements();n&&!1!==n.showBrandInUI?Vt.fontPicker.update({authoringContext:ze.currentBrandKit()}):Vt.fontPicker.update({authoringContext:null}),Vt.fontPicker.isHidden()?Vt.fontPicker.show():Vt.fontPicker.hide()},Ot.handleShuffleStyleButtonClicked=function(){Pt.handleStyleSliderValueChange()},Ot.getFeatureController=function(){return _t},Ot}.apply(t,n))||(e.exports=a)}}]);
//# sourceMappingURL=theo-web-view_e27cd5be-e3def210.js.map