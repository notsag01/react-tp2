(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[45],{DjTP:function(t,e,n){var r,o,i=e,a=n("oAGj"),s=n("cZuM"),l=n("gXiO"),u=n("FNB+"),c=n("iCxV"),f=n("fdtz"),m=n("fNpk"),h=n("c+uM"),d=n("tGKA"),p=n("8t9B"),g=n("ThKb"),v=n("oKlP"),C=n("sIWg"),F=n("1NAc"),_=n("zjY7");i.SpringConstraint=(r=function(t,e,n,r,o,i,a){this.nodeA=t,this.nodeB=e,this.pinA=n,this.pinB=r,this.vertical=o,this.length=i,this.stiffness=a,this.oldLengthDebug=0,this.oldStiffnessDebug=0,this.proportional=!1},a.defineClass({name:"SpringConstraint",ctor:r}),r),i.SpringLayoutController=(o=function(t){this.parentNode_=null,this.springConstraints_={},this.debugPrint_=!1,this.STRONG_STIFF=9e4,this.STRUT_STIFF=9e7,this.ITERATION_STEP_SIZE=50,this.SPACER_UPDATE_THRESHOLD=50,this.LOGISTIC_L_SCALE=1e3,this.LOGISTIC_K_SCALE=.01,this.LOGISTIC_X_SCALE=100,this.LOGISTIC_B_SCALE=1,this.SPACER_LOGISTIC_L=.5,this.SPACER_LOGISTIC_K=1,this.SPACER_LOGISTIC_X=0,this.SPACER_LOGISTIC_B=10,this.NODE_LOGISTIC_L=1,this.NODE_LOGISTIC_K=.5,this.NODE_LOGISTIC_X=0,this.NODE_LOGISTIC_B=1,this.group_=t,l.CoreObject.call(this)},a.defineClass({name:"SpringLayoutController",ctor:o,superName:"CoreObject",statics:{_implements:function(t){return"ResizeLayoutController"==t}},props:{beginUpdateGroup:function(){if(this.oldBounds_=this.group_.bounds,null!=this.oldBounds_){var t=a.clone(this.group_.filterWithCallback((function(t){return null!=t.controller&&!t.isGridCell()&&t.kind!=f.ImageForma.KIND&&t.frame.area>1}),u.FormaTraversal.JustChildren));this.parentNode_=new _.VisualStructureDetector(a.clone(t),this.group_).inferVisualStructure();for(var e=a.iter(this.group_.filterWithCallback((function(t){return t.isTypeLockup()})));!e.done;e.next()){var n,r=e.value;(n=a.as(r.controller,p.TypeLockupController))&&n.addLineBreakConstraints()}}},endUpdateGroup:function(){for(var t=a.iter(this.group_.filterWithCallback((function(t){return t.isTypeLockup()})));!t.done;t.next()){var e,n=t.value;(e=a.as(n.controller,p.TypeLockupController))&&e.removeLineBreakConstraints()}},updateGroup:function(){var t,e,n;(t=this.oldBounds_)&&(e=this.group_.bounds)&&(n=this.solveSpringSystem(t,e))&&this.updateFormaFromStructure(n)},solveSpringSystem:function(t,e){if(null==this.parentNode_)return null;var n={};n[this.parentNode_.id]=this.parentNode_;for(var r=a.iter(this.parentNode_.descendents);!r.done;r.next()){var o=r.value;n[o.id]=o}var i=this.parentNode_.clone();this.createSpringConstraints(i),this.updateAllConstraints(i,!1);var s=[i];a.append(s,i.descendents);for(var l=a.clone(this.getForegroundLeafs(i)),u=i.frame.scaleXY(e.width/t.width,e.height/t.height,v.TheoPoint.ZERO),c=a.toInt(Math.ceil(Math.max(Math.abs(u.height-i.frame.height),Math.abs(u.width-i.frame.width))/this.ITERATION_STEP_SIZE)+1),f=a.iter(a.range(0,c,!1));!f.done;f.next()){var h=f.value;this.debugPrint_&&(a.info("\n-----------------\niteration: "+h+"\n"),this.printNodes(i),a.info("\n")),i.frame=u;for(var d=h>=c-1,p=a.iter(s);!p.done;p.next()){var g,F,y,b=p.value;if((g=b.frame)&&(F=a.as(b,_.VisualNodeGroup))&&(y=this.springConstraints_[F.id])){m.LegacyCoreAssert.isTrue(null!=n[b.origNode.id],"did not find node in original node map",void 0,"SpringLayoutController.solveSpringSystem","SpringLayoutController.swift",188),this.debugPrint_&&a.info("node:"+b.description+" oldFrame: "+n[b.origNode.id].frame.asIntString);for(var S=a.iter(y);!S.done;S.next()){var P=S.value,T=P[0].vertical,x=T?g.height:g.width,w=T?F.frame.minY:F.frame.minX,M=this.adjustSpringSet(a.clone(P),x,w,d,i);F.frame=T?new C.TheoRect(g.minX,g.minY,g.maxX,g.minY+M):new C.TheoRect(g.minX,g.minY,g.minX+M,g.maxY),this.setSpringStiffnesses(F,a.clone(P),a.clone(l),this.debugPrint_),this.adjustSpringsToMatchOldSize(a.clone(P),a.clone(n))&&this.setSpringStiffnesses(F,a.clone(P),a.clone(l))}}}}return this.debugPrint_&&(a.info("\n -----------------------------\n  after resize: "),this.printNodes(i)),i},adjustSpringSet:function(t,e,n,r,o){if(t.length<1)return 0;for(var i=t[0].vertical,s=0,l=0,u=a.iter(t);!u.done;u.next())s+=(F=u.value).length,l+=1/((F.proportional?1:F.stiffness)*(e/F.length));var f=e-s,m=1/l,h=f;Math.abs(f)>this.ITERATION_STEP_SIZE&&!r&&(h=f<0?-1*this.ITERATION_STEP_SIZE:this.ITERATION_STEP_SIZE);var p=m*h;this.debugPrint_&&a.info("  constraint set: "+(i?"vert":"horiz")+"  desiredL "+Math.round(e)+" currL "+Math.round(s)+" totalD "+Math.round(f)+"  currD "+Math.round(h));for(var g=0,v=a.iter(a.range(0,t.length,!1));!v.done;v.next()){var F,_=v.value;(F=t[_]).oldLengthDebug=F.length,F.oldStiffnessDebug=F.stiffness;var y=p/((F.proportional?1:F.stiffness)*(e/F.length));isNaN(y)&&(a.opt(c.Host.logging,(function(t){return t.error("nan update")})),y=0);var b=Math.max(.01,F.length+y);if(F.nodeA==F.nodeB){var S=F.nodeA,P=S.frame.aspectRatio,T=n+g;if(S.frame=i?new C.TheoRect(S.frame.minX,T,S.frame.maxX,T+b):new C.TheoRect(T,S.frame.minY,T+b,S.frame.maxY),S.maintainAspectRatio&&!F.proportional&&S.parent!=o){var x=C.TheoRect.fromSize(S.frame.fitAspectRatioWithin(P));if(x.height>15){var w=this.getParentChildPin(S.frame,S.parent.frame),M=d.Matrix2D.translation(S.frame.eval(w).subtract(x.eval(w)));x=x.transform(M);var D=i?S.frame.height-x.height:S.frame.width-x.width;S.frame=x;var A=F.vertical?w.y:w.x;.5==A?(t[_-1].length+=D/2,t[_+1].length+=D/2):0==A?t[_+1].length+=D:1==A&&(t[_-1].length+=D),b=i?x.height:x.width}}}F.length=b,g+=b}return g},adjustSpringsToMatchOldSize:function(t,e){for(var n=!1,r=a.iter(a.range(1,t.length-1,!1));!r.done;r.next()){var o=r.value,i=t[o];if(i.nodeA==i.nodeB&&!i.proportional){var s=i.nodeA,l=e[s.origNode.id].frame,u=s.frame;if(l.area-u.area>0){var c=t[o-1],f=t[o+1],m=.2*Math.max(c.length,f.length);if(m<10)continue;var h=i.vertical?u.height:u.width,d=l.area/(i.vertical?u.width:u.height)-h;Math.abs(d)>m&&(d=d<0?-1*m:m);var p=1/(1/c.stiffness+1/i.stiffness+1/f.stiffness)*d,g=p/c.stiffness,v=c.length;c.length-g>this.SPACER_UPDATE_THRESHOLD&&(c.length=Math.max(1e-4,c.length-g));var C=p/f.stiffness,F=f.length;f.length-C>this.SPACER_UPDATE_THRESHOLD&&(f.length=Math.max(1e-4,f.length-C));var _=i.length;i.length=i.length+(v-c.length)+(F-f.length),n=n||Math.abs(_-i.length)>0}}}return n},createSpringConstraints:function(t){this.springConstraints_={};for(var e=a.clone(this.getForegroundLeafs(t)),n=[t];n.length>0;){var r,o=n[0];n.splice(0,1),(r=a.as(o,_.VisualNodeGroup))&&(this.springConstraints_[r.id]=this.createSpringConstraintsForGroup(r,!1,a.clone(e)).concat(this.createSpringConstraintsForGroup(r,!0,a.clone(e))),n=r.children.concat(n))}},updateAllConstraints:function(t,e){void 0===t&&(t=null),void 0===e&&(e=!1);for(var n=null!=t?t:this.parentNode_,r=[n],o=a.clone(this.getForegroundLeafs(n));r.length>0;){var i,s,l=r[0];if(r.splice(0,1),(i=a.as(l,_.VisualNodeGroup))&&(s=this.springConstraints_[i.id])){for(var u=a.iter(s);!u.done;u.next()){var c=u.value;this.setSpringStiffnesses(i,a.clone(c),a.clone(o),e)}r=i.children.concat(r)}}},printNodes:function(t){for(var e=[t],n=[];e.length>0;){var r,o=e[0];if(e.splice(0,1),(C=a.as(o,_.VisualNodeGroup))&&(r=this.springConstraints_[C.id])){for(var i=a.iter(r);!i.done;i.next())for(var s=i.value,l=a.iter(s);!l.done;l.next()){var u=l.value;if(u.nodeA==u.nodeB){var c=this.getNodeStiffness(u.nodeA,u.vertical);n.push({node:u.nodeA,vertical:u.vertical,stiffness:c})}}e=C.children.concat(e)}}for(var f=[],m={},h=a.iter(n);!h.done;h.next())if(c=h.value,!f.includes(c.node)){for(var d="",p=(o=c.node).parent;null!=p;)p=a.opt(p,(function(t){return t.parent})),d+="\t";d+="node: "+o.description;for(var g=a.iter(n);!g.done;g.next()){var v=g.value;v.node==o&&(d+=(v.vertical?" v: ":" h: ")+a.toString(Math.round(v.stiffness)))}m[o.shortID]=d,f.push(o)}for(e=[t];e.length>0;){var C,F;o=e[0],e.splice(0,1),(C=a.as(o,_.VisualNodeGroup))&&(e=C.children.concat(e)),this.debugPrint_&&null!=(F=m[o.shortID])&&a.info(F)}},setConstraintsOnNode:function(t,e,n,r,o){var i,s=o?t.frame.minY:t.frame.minX,l=(o?t.frame.maxY:t.frame.maxX)-s,u=o?e.frame.minY:e.frame.minX,c=(o?e.frame.maxY:e.frame.maxX)-u,f=!1,m=!1,h=!1;n<.1*l&&(f=!0),r<.1*l&&(m=!0),(i=a.as(e,_.VisualNodeLeaf))&&(i.forma.isTypeLockup()?c>.66*l&&(f=!0,m=!0):Math.abs(n-r)<=1&&n<.25*l&&(f=!0,m=!0)),f&&m||(h=!0),o?(e.constraintBottom=f,e.constraintTop=m,e.constraintHeight=h):(e.constraintLeft=f,e.constraintRight=m,e.constraintWidth=h)},getContextualSpacerLength:function(t,e,n){var r,o=t.vertical,i=t.nodeA==e?t.nodeB:t.nodeA,s=t.length,l=!1,u=[];null!=(h=a.as(i,_.VisualNodeLeaf))&&(l=h.hasForegroundRole,u=[h]),(r=a.as(i,_.VisualNodeGroup))&&(l=(u=a.clone(this.getForegroundLeafs(r))).length>0);for(var c=n.concat(),f=a.iter(u);!f.done;f.next()){var h=f.value;c.includes(h)&&a.remove(c,h)}if(l){var d=C.TheoRect.Zero;if(o){var p=t.nodeA.frame.horizontalLine(t.pinA).p1.y,g=t.nodeB.frame.horizontalLine(t.pinB).p1.y;d=new C.TheoRect(i.frame.minX,p,i.frame.maxX,g)}else{var v=t.nodeA.frame.verticalLine(t.pinA).p1.x,F=t.nodeB.frame.verticalLine(t.pinB).p1.x;d=new C.TheoRect(v,i.frame.minY,F,i.frame.maxY)}for(var y=a.iter(c);!y.done;y.next()){h=y.value,m.LegacyCoreAssert.isTrue(i!=h,"did not expect to find constraint node in leaves being checked",void 0,"SpringLayoutController.getContextualSpacerLength","SpringLayoutController.swift",691);for(var b,S=!1,P=a.iter(u);!P.done;P.next()){var T=P.value;(h.forma.finalFrame.xDistance(T.forma.finalFrame)<=0&&!o||h.forma.finalFrame.yDistance(T.forma.finalFrame)<=0&&o)&&(S=!0)}S||(b=a.opt(h.frame,(function(t){return t.intersectionWith(d)})))&&(s=Math.min(s,b.L1Distance(i.frame)))}}return s},setSpringStiffnesses:function(t,e,n,r){if(void 0===r&&(r=!1),0!=e.length){var o=e[0].vertical,i=o?t.frame.minY:t.frame.minX,s=(o?t.frame.maxY:t.frame.maxX)-i;if(3==e.length){m.LegacyCoreAssert.isTrue(e[1].nodeA==e[1].nodeB,"for basic parent constraint, nodeA and nodeB should match",void 0,"SpringLayoutController.setSpringStiffnesses","SpringLayoutController.swift",729);var l=e[1].nodeA,u=this.getContextualSpacerLength(e[0],t,a.clone(n)),f=this.getContextualSpacerLength(e[2],t,a.clone(n));l.resetConstraints(o),l instanceof _.VisualNodeLeaf&&this.setConstraintsOnNode(t,l,u,f,o);var h=o?l.constraintBottom:l.constraintLeft,d=o?l.constraintHeight:l.constraintWidth,p=o?l.constraintTop:l.constraintRight;e[0].stiffness=h?this.STRONG_STIFF:this.getSpacerStiffness(u,s,o),e[1].stiffness=d?this.STRONG_STIFF:this.getNodeStiffness(l,o),e[2].stiffness=p?this.STRONG_STIFF:this.getSpacerStiffness(f,s,o),(0==e[0].stiffness||isNaN(e[0].stiffness)||0==e[1].stiffness||isNaN(e[1].stiffness)||0==e[2].stiffness||isNaN(e[2].stiffness))&&a.opt(c.Host.logging,(function(t){return t.error("error in spring stiffness")}))}else for(var g=a.iter(e);!g.done;g.next())(y=g.value).nodeA==y.nodeB?y.stiffness=this.getNodeStiffness(y.nodeA,y.vertical):y.stiffness=this.getSpacerStiffness(y.length,s,y.vertical),(0==y.stiffness||isNaN(y.stiffness))&&a.opt(c.Host.logging,(function(t){return t.error("error in spring stiffness")}));for(var v=a.iter(e);!v.done;v.next())(y=v.value).length<1&&(y.stiffness=this.STRUT_STIFF);for(var C=!1,F=a.iter(e);!F.done;F.next()){var y=F.value;Math.abs(y.oldLengthDebug-y.length)>1&&(C=r)}if(C)for(var b=a.iter(e);!b.done;b.next()){var S=b.value,P=S.vertical?"vert":"horiz";a.info("\t A:"+S.nodeA.shortID+" B:"+S.nodeB.shortID+" "+P+" oldK:"+Math.round(S.oldStiffnessDebug)+"  newK:"+Math.round(S.stiffness)+" oldL:"+Math.round(S.oldLengthDebug)+"  newL:"+Math.round(S.length)+"  ")}}},createFlowSpringConstraints:function(t,e){m.LegacyCoreAssert.isTrue(t.children.length>1,"visual node group must have at least one child",void 0,"SpringLayoutController.createFlowSpringConstraints","SpringLayoutController.swift",815);var n=e?t.frame.minY:t.frame.minX,r=e?t.frame.maxY:t.frame.maxX,o=r-n,s=a.sort(t.children,(function(t,n){return e?t.frame.minY<n.frame.minY:t.frame.minX<n.frame.minX})),l=[],u=e?s[0].frame.minY:s[0].frame.minX,c=(y=e?s[s.length-1].frame.maxY:s[s.length-1].frame.maxX)-u,f=Math.max(u-n,0),h=Math.max(r-y,0),d=Math.max(n-u,0)/c,p=Math.max(y-r,0)/c;l.push(new i.SpringConstraint(t,s[0],0,d,e,f,this.getSpacerStiffness(f,o,e)));for(var g=!1,v=a.iter(a.range(0,s.length,!1));!v.done;v.next()){var C=v.value;g=g||s[C].bgConstraint;var F=e?s[C].frame.minY:s[C].frame.minX,_=e?s[C].frame.maxY:s[C].frame.maxX;if(l.push(new i.SpringConstraint(s[C],s[C],0,1,e,_-F,this.getNodeStiffness(s[C],e))),C<s.length-1){var y=e?s[C].frame.maxY:s[C].frame.maxX,b=e?s[C+1].frame.minY:s[C+1].frame.minX,S=Math.abs(y-b);l.push(new i.SpringConstraint(s[C],s[C+1],1,0,e,S,this.getSpacerStiffness(S,o,e)))}}l.push(new i.SpringConstraint(s[s.length-1],t,p,1,e,h,this.getSpacerStiffness(h,o,e)));for(var P=a.iter(l);!P.done;P.next())P.value.proportional=g;for(var T=0,x=a.iter(l);!x.done;x.next())T+=x.value.length;return Math.abs(o-T)>1&&m.LegacyCoreAssert.fail("constraint length failure",void 0,"SpringLayoutController.createFlowSpringConstraints","SpringLayoutController.swift",883),l},createParentSpringConstraints:function(t,e,n,r){var o=n?t.frame.minY:t.frame.minX,s=n?t.frame.maxY:t.frame.maxX,l=n?e.frame.minY:e.frame.minX,u=n?e.frame.maxY:e.frame.maxX,c=[],f=Math.max(l-o,0),m=Math.max(s-u,0),h=Math.abs(f-m)/(s-o);if(h<.05&&h>0){var d=(f+m)/2;f=d,m=d}c.push(new i.SpringConstraint(t,e,0,0,n,f,1)),c.push(new i.SpringConstraint(e,e,0,1,n,u-l,1)),c.push(new i.SpringConstraint(e,t,1,1,n,m,1));for(var p=a.iter(c);!p.done;p.next())p.value.proportional=e.bgConstraint;return this.setSpringStiffnesses(t,a.clone(c),a.clone(r)),c},createSpringConstraintsForGroup:function(t,e,n){if(t.layoutStrategy==_.GroupLayoutStrategy.VerticalFlow&&e||t.layoutStrategy==_.GroupLayoutStrategy.HorizontalFlow&&!e)return[this.createFlowSpringConstraints(t,e)];for(var r=[],o=a.iter(t.children);!o.done;o.next()){var i=o.value;r.push(a.clone(this.createParentSpringConstraints(t,i,e,a.clone(n))))}return r},getNodeStiffness:function(t,e){if((e?t.frame.height:t.frame.width)<10)return 1e6;var n,r,o=1;if(n=a.as(t,_.VisualNodeLeaf)){var i,s,l=t.frame;if((i=a.as(n.forma.controller,p.TypeLockupController))&&(s=n.forma.finalFrame)){var u=i.getAverageFontSize(),c=a.toDouble(i.numLines())/(a.toDouble(i.text.split("\n").length)+1e-4),f=s.height/c,m=s.width*c,h=new F.TheoSize(m,f).aspectRatio,d=s.aspectRatio,g=l.fitAspectRatioWithin(h).area,v=l.fitAspectRatioWithin(d).area,C=Math.max(g,v)/s.area;o=this.getFormaStiffness(u*C)}else o=this.getFormaStiffness(l.height)}else if(r=a.as(t,_.VisualNodeGroup)){var y;if(y=this.springConstraints_[r.id]){for(var b=0,S=a.iter(y);!S.done;S.next()){var P=S.value;if(P[0].vertical==e){for(var T=1,x=1,w=a.iter(P);!w.done;w.next()){var M=w.value,D=M.nodeA==M.nodeB?this.getNodeStiffness(M.nodeA,e):M.stiffness;D<this.STRONG_STIFF&&(T+=M.length*D,x+=M.length)}b=Math.max(b,T/a.toDouble(x))}}o=0==b?1:b}}return o},getParentChildPin:function(t,e){var n=.5,r=.5;return Math.abs(t.minX-e.minX)/e.width<.1&&(n=0),Math.abs(t.maxX-e.maxX)/e.width<.1&&(n=1),Math.abs(t.center.x-e.center.x)/e.width<.1&&(n=.5),Math.abs(t.minY-e.minY)/e.height<.1&&(r=0),Math.abs(t.maxY-e.maxY)/e.height<.1&&(r=1),Math.abs(t.center.y-e.center.y)/e.height<.1&&(r=.5),new v.TheoPoint(n,r)},updateFormaFromStructure:function(t){for(var e=[],n=a.clone(t.leafDescendents),r=a.iter(n);!r.done;r.next()){var o=r.value;e.push(o.forma)}for(var i={},l=a.iter(n);!l.done;l.next()){(o=l.value).inferenceData=_.VisualNodeData.init_ff0a(o,a.clone(e));for(var u=a.iter(n);!u.done;u.next()){var c,f=u.value;o!=f&&(nt=o.forma.finalFrame)&&(c=f.forma.finalFrame)&&(i[o.forma.formaID+f.forma.formaID]=nt.intersects(c),i[f.forma.formaID+o.forma.formaID]=nt.intersects(c))}}for(var m=a.iter(t.descendents);!m.done;m.next()){var g,C,F,y=m.value;if((o=a.as(y,_.VisualNodeLeaf))&&(X=o.frame)&&(g=o.forma.frame)&&(C=o.initFrame)&&(F=o.parent)){var b=o.forma,S=X,P=!1;(E=a.as(o.forma.controller,p.TypeLockupController))&&1==E.numLines()&&h.LockupStyle.layoutSupportsAlignments(E.lockupStyle.layout)&&(P=!0);var T=b.placement.transformValues,x=Math.abs(T.rotCosine)/(Math.abs(T.rotCosine)+Math.abs(T.rotSine)),w=Math.abs(T.rotSine)/(Math.abs(T.rotCosine)+Math.abs(T.rotSine)),M=new v.TheoPoint(S.width/C.width,S.height/C.height),D=new v.TheoPoint(M.x*x+M.y*w,M.x*w+M.y*x);if(null!=b.controller&&b.controller.maintainAspectRatio){var A=Math.min(D.x,D.y);b.bounds=a.opt(b.bounds,(function(t){return t.scaleXY(A,A,new v.TheoPoint(0,0))}))}else b.bounds=a.opt(b.bounds,(function(t){return t.scaleXY(D.x,D.y,new v.TheoPoint(0,0))}));(E=a.as(o.forma.controller,p.TypeLockupController))&&E.snapSizeToBounds();var E,L=.5,I=.5,k=S.center.x,N=S.center.y,G=F.layoutStrategy==_.GroupLayoutStrategy.VerticalFlow&&1==F.alignments.length&&F.alignments.includes(s.AlignmentType.Left),R=F.layoutStrategy==_.GroupLayoutStrategy.VerticalFlow&&1==F.alignments.length&&F.alignments.includes(s.AlignmentType.Right);if(!(Math.abs(C.center.x-g.center.x)/C.width<.01)){var B=C.minX-g.minX,O=g.maxX-C.maxX;G=G||B>0&&O<=0,R=R||O>0&&B<=0}G?(L=(C.minX-g.minX)/g.width,k=S.minX):R&&(L=1-(g.maxX-C.maxX)/g.width,k=S.maxX),P&&(E=a.as(o.forma.controller,p.TypeLockupController))&&(E.beginBlockedUpdate(),a.opt(E.lockupStyle,(function(t){return t.layout=h.LockupLayout.Standard})),E.lockupStyle.alignment=G?h.LockupAlignment.Left:R?h.LockupAlignment.Right:h.LockupAlignment.Center,E.endBlockedUpdate(),E.styleChanged()),C.minY-g.minY>0&&(I=(C.minY-g.minY)/g.height,N=S.minY),g.maxY-C.maxY>0&&(I=1-(g.maxY-C.maxY)/g.height,N=S.maxY),b.movePinToPoint(new v.TheoPoint(L,I),new v.TheoPoint(k,N))}}for(var Y=a.iter(t.descendents);!Y.done;Y.next()){var X;if(y=Y.value,(o=a.as(y,_.VisualNodeLeaf))&&(X=o.forma.frame)){var z,U=null,K=1/0,H=null,j=null,V=1/0,W=null;if(z=a.opt(o.inferenceData,(function(t){return t.alignments})))for(var Z=a.iter(n);!Z.done;Z.next()){var J;if(J=z[(lt=Z.value).forma.formaID])for(var q=lt.forma.frame,Q=a.iter(J);!Q.done;Q.next()){var $=Q.value,tt=null;$.line.type==s.AlignmentType.Right&&(tt=Math.abs(q.maxX-X.maxX)+.1*q.L1Distance(X)),$.line.type==s.AlignmentType.Left&&(tt=Math.abs(q.minX-X.minX)+.1*q.L1Distance(X)),$.line.type==s.AlignmentType.CenterX&&(tt=Math.abs(q.center.x-X.center.x)+.1*q.L1Distance(X)),null!=tt&&tt<K&&$.line.line.length<600&&(K=tt,H=$.line.type,U=q);var et=null;$.line.type==s.AlignmentType.Top&&(et=Math.abs(q.minY-X.minY)+.1*q.L1Distance(X)),$.line.type==s.AlignmentType.Bottom&&(et=Math.abs(q.maxY-X.maxY)+.1*q.L1Distance(X)),$.line.type==s.AlignmentType.CenterY&&(et=Math.abs(q.center.y-X.center.y)+.1*q.L1Distance(X)),null!=et&&et<V&&$.line.line.length<600&&(V=et,W=$.line.type,j=q)}}var nt,rt,ot=0,it=0;if(null!=H&&H==s.AlignmentType.CenterX&&(ot=U.center.x-o.forma.frame.center.x),null!=H&&H==s.AlignmentType.Left&&(ot=U.minX-o.forma.frame.minX),null!=H&&H==s.AlignmentType.Right&&(ot=U.maxX-o.forma.frame.maxX),null!=W&&W==s.AlignmentType.CenterY&&(it=j.center.y-o.forma.frame.center.y),null!=W&&W==s.AlignmentType.Bottom&&(it=j.maxY-o.forma.frame.maxY),null!=W&&W==s.AlignmentType.Top&&(it=j.minY-o.forma.frame.minY),ot=Math.min(ot,0),it=Math.min(it,0),(ot<0||it<0)&&(null!=H&&o.forma.controller.setAlignmentType(H),o.forma.move(d.Matrix2D.translationXY(ot,it)),(nt=o.forma.finalFrame)&&(rt=a.opt(o.forma.parent,(function(t){return t.finalFrame}))))){for(var at=!1,st=a.iter(n);!st.done;st.next()){var lt;(lt=st.value)!=o&&lt.forma.finalFrame.intersects(nt)&&!i[o.forma.formaID+lt.forma.formaID]&&(at=!0)}rt.contains(nt)&&!at||o.forma.move(d.Matrix2D.translationXY(-ot,-it))}}}this.debugPrint_&&a.info("after update: \n "+this.group_.print())},getSpacerStiffness:function(t,e,n){if(t<1)return this.STRUT_STIFF;var r=this.SPACER_LOGISTIC_L*this.LOGISTIC_L_SCALE,o=this.SPACER_LOGISTIC_K*this.LOGISTIC_K_SCALE,i=this.SPACER_LOGISTIC_X*this.LOGISTIC_X_SCALE,a=this.SPACER_LOGISTIC_B*this.LOGISTIC_B_SCALE;return r/(1+Math.pow(g.TheoMatrix.E_DOUBLE,o*(t-i)))+a},getFormaStiffness:function(t){var e=this.NODE_LOGISTIC_L*this.LOGISTIC_L_SCALE,n=this.NODE_LOGISTIC_K*this.LOGISTIC_K_SCALE,r=this.NODE_LOGISTIC_X*this.LOGISTIC_X_SCALE,o=this.NODE_LOGISTIC_B*this.LOGISTIC_B_SCALE;return e/(1+Math.pow(g.TheoMatrix.E_DOUBLE,n*(t-r)))+o},getForegroundLeafs:function(t){for(var e=[],n=a.iter(t.leafDescendents);!n.done;n.next()){var r=n.value;r.hasForegroundRole&&e.push(r)}return e}}}),o)},H9Ol:function(t,e,n){var r,o,i,a,s=e,l=n("oAGj"),u=n("0wFF"),c=n("cZuM"),f=n("yhkb"),m=n("yGNn"),h=n("ascj"),d=n("fVJ2"),p=n("dJuF"),g=n("quOg"),v=n("wNKJ"),C=n("FNB+"),F=n("6ZWm"),_=n("waL6"),y=n("yHU1"),b=n("Pil/"),S=n("cmoc"),P=n("OdB2"),T=n("P83h"),x=n("9Lk3"),w=n("ZK0l"),M=n("/afT"),D=n("pnSN"),A=n("iCxV"),E=n("fdtz"),L=n("lmwz"),I=n("fNpk"),k=n("c+uM"),N=n("tGKA"),G=n("3DEm"),R=n("jcfx"),B=n("KIfs"),O=n("K0Rh"),Y=n("JO5d"),X=n("Zifs"),z=n("djAF"),U=n("35Q0"),K=n("umUn"),H=n("fAXt"),j=n("8t9B"),V=n("mL0c"),W=n("oKlP"),Z=n("sIWg"),J=n("1NAc");s.ControllerMetadata=(r=function(){},o={},l.defineClass({name:"ControllerMetadata",ctor:r,superName:"DBObject",statics:{SCHEMA_CLASS_NAME:"ControllerMetadata",codec:{get:function(){return void 0===o.codec&&(o.codec=p.DBPropertyCodec.registerCodec(r.SCHEMA_CLASS_NAME,p.DBPropertyCodec.directObjectCodec(r.SCHEMA_CLASS_NAME))),o.codec}},factory:{get:function(){return function(t,e,n,o){return r.init_866e(n,t)}}},_implements:function(t){return"IDBObject"==t}},props:{init_866e:function(t,e){l.super_init(this,d.DBObject,d.DBObject.prototype.init_866e,t,e)},init_dd5d:function(t,e){l.super_init(this,d.DBObject,d.DBObject.prototype.init_dd5d,l.clone(t),l.clone(e))},init_d41d:function(){l.super_init(this,d.DBObject,d.DBObject.prototype.init_dd5d,{},{})},className:{get:function(){return r.SCHEMA_CLASS_NAME}}}}),r),s.FormaController=(i=function(t,e,n){this.blockedUpdate_=0,this.controllerMetadata_=null,this.kind=t,this.forma_=e,this.owner_=n},l.defineClass({name:"FormaController",ctor:i,superName:"CoreObject",props:{owner:{get:function(){return this.owner_}},forma:{get:function(){return this.forma_}},parentController:function(){for(var t=l.opt(this.forma,(function(t){return t.parent}));null!=t&&null!=t.controller;)t=t.parent;return null==t?null:t.controller},moveable:{get:function(){return null==this.forma.allowUserMove||this.forma.allowUserMove}},floating:{get:function(){return this.moveableInDirection(new W.TheoPoint(1,0))&&this.moveableInDirection(new W.TheoPoint(0,1))}},moveableInDirection:function(t){var e;return(e=l.as(l.opt(l.opt(this.forma,(function(t){return t.parent})),(function(t){return t.controller})),w.GroupController))?e.childMoveableInDirection(this.forma,t)&&this.moveable:this.moveable},selectable:{get:function(){return!1}},rotateable:{get:function(){return this.moveable}},flippable:{get:function(){return!this.userGroupMember&&this.moveable}},nudgeable:{get:function(){return!0}},scalable:{get:function(){var t=this;return!l.opt(this.forma,(function(e){return null==e.parent||null!=t.forma&&x.GridController.isBackgroundColoredCell(t.forma)}))}},replaceable:{get:function(){return!0}},deleteable:{get:function(){return!0}},duplicatable:{get:function(){return!1}},userGroup:{get:function(){return!1}},userGroupChild:{get:function(){var t;return!(!(t=l.opt(l.opt(l.opt(this.forma,(function(t){return t.parent})),(function(t){return t.controller})),(function(t){return t.userGroup})))&&null==t)&&t}},userGroupMember:{get:function(){return this.userGroup||this.userGroupChild}},canGroup:{get:function(){return this.selectable&&this.floating}},enableChildMove:{get:function(){return!this.userGroupMember||this.forma.page.document.controller.enableMoveableChildren}},userGroupRoot:{get:function(){var t;if(!this.userGroupChild)return null;for(var e=this.forma;((t=l.opt(l.opt(l.opt(e,(function(t){return t.parent})),(function(t){return t.controller})),(function(t){return t.userGroupChild})))||null!=t)&&t;)e=l.opt(e,(function(t){return t.parent}));return l.as(l.opt(e,(function(t){return t.parent})),D.GroupForma)}},copyTo:function(t){return void 0===t&&(t=null),m.CorePromise.resolve(null)},duplicate:function(){return this.copyTo()},opacityChangeable:{get:function(){return this.moveable}},maintainAspectRatio:{get:function(){return!1}},selectionHandlePositions:{get:function(){return I.LegacyCoreAssert.isTrue(this.selectable,"this forma isn't selectable. why get the handle positions?",void 0,"FormaController","FormaController.swift",194),[new W.TheoPoint(0,0),new W.TheoPoint(0,1),new W.TheoPoint(1,0),new W.TheoPoint(1,1)]}},showHandle:function(t){var e,n;return(e=this.forma)&&null!=(n=l.opt(l.opt(e.parent,(function(t){return t.controller})),(function(n){return n.showChildHandle(e,t)})))?n:this.selectionHandlePositions.includes(t)},visibleSelectionHandlePositions:{get:function(){for(var t=[],e=l.iter(this.selectionHandlePositions);!e.done;e.next()){var n=e.value;this.showHandle(n)&&t.push(n)}return t}},showChildHandle:function(t,e){var n,r;if((n=t.finalFrame)&&(r=l.opt(t.root,(function(t){return t.finalFrame})))){var o=n.eval(e);return o.x>=5&&o.y>=5&&o.x<=r.maxX-5&&o.y<=r.maxY-5}return!1},alignmentDetector:{get:function(){return null==this.alignmentDetector_&&(this.alignmentDetector_=c.AlignmentDetector.init_a05b(this.forma_)),this.alignmentDetector_},set:function(t){this.alignmentDetector_=t}},getAlignments:function(t){var e,n,r;if(void 0===t&&(t=!1),(n=this.forma_)&&(r=n.bounds)){var o={kind:n.kind,controllerKind:(e=l.opt(n.controller,(function(t){return t.kind})))||null!=e?e:""};I.LegacyCoreAssert.isFalse(isNaN(r.origin.x)||isNaN(r.origin.y),"forma has Nan origin pt",l.clone(o),"FormaController.getAlignments","FormaController.swift",246),I.LegacyCoreAssert.isFalse(isNaN(r.size.width),"forma has Nan width",l.clone(o),"FormaController.getAlignments","FormaController.swift",247),I.LegacyCoreAssert.isFalse(isNaN(r.size.height),"forma has Nan height",l.clone(o),"FormaController.getAlignments","FormaController.swift",248);var i=n.kind==O.RootForma.KIND||n.isGridCell()?c.AlignmentDetector.ALIGNMENT_ROOT:c.AlignmentDetector.ALIGNMENT_FORMA,a=n.kind==O.RootForma.KIND||n.isGridCell()?c.AlignmentLocation.Root:c.AlignmentLocation.Forma,s=n.visit(C.FormaTraversal.FurthestAncestor,(function(t,e,n){return!0})),u=n.totalPlacement;return[new c.AlignmentLine(c.AlignmentType.Left,a,i,r.verticalLine(0).transform(u),!1,s),new c.AlignmentLine(c.AlignmentType.CenterX,a,i,r.verticalLine(.5).transform(u),!1,s),new c.AlignmentLine(c.AlignmentType.Right,a,i,r.verticalLine(1).transform(u),!1,s),new c.AlignmentLine(c.AlignmentType.Top,a,i,r.horizontalLine(0).transform(u),!1,s),new c.AlignmentLine(c.AlignmentType.CenterY,a,i,r.horizontalLine(.5).transform(u),!1,s),new c.AlignmentLine(c.AlignmentType.Bottom,a,i,r.horizontalLine(1).transform(u),!1,s)]}return[]},addForma:function(t,e,n){var r;return(r=l.as(t.root,O.RootForma))?(e.controller.fit(r.frame.insetRel(.25,.25,.25,.25)),r.appendChild(e),m.CorePromise.resolve(null)):m.CorePromise.reject("page has no root?")},getUserPerceivedFrame:function(){for(var t,e,n,r,o=l.clone(this.getAlignments()),i=l.iter(o);!i.done;i.next()){var a=i.value;if(a.location==c.AlignmentLocation.Forma)switch(a.type){case 0:t=a.line;break;case 2:e=a.line;break;case 3:n=a.line;break;case 5:r=a.line}}var s=l.opt(this.forma,(function(t){return t.finalFrame}));if(null!=s&&(null==t&&(t=s.verticalLine(0)),null==e&&(e=s.verticalLine(1)),null==n&&(n=s.horizontalLine(0)),null==r&&(r=s.horizontalLine(1))),null!=t&&null!=e&&null!=n&&null!=r){var u=t.intersection(n),f=n.intersection(e),m=r.intersection(e),h=r.intersection(t);if(null!=u&&null!=f&&null!=m&&null!=h)return Z.TheoRect.boundsOfPoints([u,f,m,h])}return l.opt(this.forma,(function(t){return t.finalFrame}))},canMultiSelect:{get:function(){return this.selectable&&this.floating}},move:function(t){var e;(e=this.forma_)&&(e.placement=e.placement.concat(t),this.updateParentGroup())},place:function(t){var e;(e=this.forma_)&&(e.placement=t,this.updateParentGroup())},flip:function(t){var e;void 0===t&&(t=!1),(e=this.forma_)&&(H.TransformFacade.flipForma(e,t),this.updateParentGroup())},rotate:function(t){var e;void 0===t&&(t=Math.PI/180),(e=this.forma_)&&(H.TransformFacade.rotateForma(e,t),this.updateParentGroup())},rotation:function(){var t;return(t=this.forma_)?t.rotation():0},nudge:function(t){var e;(e=this.forma_)&&(H.TransformFacade.translateForma(e,t),this.updateParentGroup())},fit:function(t){var e,n;(e=this.forma)&&(e.placement=N.Matrix2D.Identity,e.bounds=Z.TheoRect.fromSize(t.size),(n=e.frame)&&(e.move(N.Matrix2D.uniformScaling(n.aspectRatio>=1?t.width/n.width:t.height/n.height)),e.moveCenterToPoint(t.center)),this.updateParentGroup())},fitInArea:function(t){var e,n,r;if(r=this.forma){var o=t.area,i=l.opt(r.bounds,(function(t){return t.aspectRatio})),a=Math.sqrt(i*o),s=Math.sqrt(o/i),u=l.opt(r.root,(function(t){return t.bounds})),c=l.opt(u,(function(e){return e.locatePoint(t.center)}));c=new W.TheoPoint(G.MathUtils.nearestMultiple((e=l.opt(c,(function(t){return t.x})))||null!=e?e:.5,.5),G.MathUtils.nearestMultiple((n=l.opt(c,(function(t){return t.y})))||null!=n?n:.5,.5));var f=new Z.TheoRect(0,0,a,s),m=t.evalXY(c.x,c.y);f=f.moveToPoint(m,c),r.controller.fit(f)}},clone:function(t){return new _.FormaControllerFactory(this.owner).createController(this.kind,t)},match:function(t){var e,n,r,o;if((e=this.forma)&&(n=e.bounds)&&(r=t.forma)&&(o=r.bounds)&&!n.equal(o))if(this.maintainAspectRatio&&!L.ImageFacade.isPotentialBackgroundImage(e)){var i=o.fitAspectRatioWithin(n.aspectRatio);e.bounds=Z.TheoRect.fromSize(i),e.moveCenterToPoint(r.frame.center)}else e.bounds=r.bounds},postMatch:function(t){},beginBlockedUpdate:function(){this.blockedUpdate_+=1},endBlockedUpdate:function(){this.blockedUpdate_-=1},blockUpdate:{get:function(){return this.blockedUpdate_>0}},styleChanged:function(){},formaWillChangeState:function(t,e){},formaDidChangeState:function(t,e){},formaWillCommitState:function(t){},formaDidCommitState:function(t){},contentID:{get:function(){return null}},settings:{get:function(){return null}},attach:function(){},detach:function(){},controllerMetadata:{get:function(){return this.controllerMetadata_},set:function(t){this.controllerMetadata_=t,l.count(t.state.allProperties)>0&&this.decodeMetadata()}},decodeMetadata:function(){},postDecode:function(){},onEvent:function(t){this.preProcessEvent(t)||this.processEvent(t)||this.postProcessEvent(t)},preProcessEvent:function(t){return!1},processEvent:function(t){return null==this.owner||((e=l.as(t,b.BeginPointerTrackingEvent))?e.trackingResponse=y.BeginPointerTrackingResponseEnum.TrackWithinGroup:t instanceof b.BeginFormaDragEvent?this.processBeginFormaDrag(t):t instanceof b.EndFormaDragEvent?this.processEndFormaDrag(t):t instanceof b.FormaDragEvent?this.processFormaDrag(t):t instanceof b.FormaClickEvent?this.processFormaClick(t):t instanceof b.FormaDoubleClickEvent?this.processFormaDoubleClick(t):t instanceof b.BeginFormaResizeEvent?this.processBeginFormaResize(t):t instanceof b.FormaResizeEvent?this.processFormaResize(t):t instanceof b.EndFormaResizeEvent&&this.processEndFormaResize(t)),!1;var e},processFormaDoubleClick:function(t){},processBeginFormaResize:function(t){var e,n;this.alignmentDetector_=c.AlignmentDetector.init_a05b(this.forma_),(e=l.as(l.opt(this.forma.parent,(function(t){return t.controller})),w.GroupController))&&e.beginChildResizeEvent(t),(n=l.opt(l.opt(this.owner,(function(t){return t.document})),(function(t){return t.firstPage})))&&n.publish(new P.BeginFormaResizeMessage(n))},processFormaResize:function(t){var e,n;if(this.clearAlignmentLines(),(e=this.forma.bounds)&&(n=t.pin)){var r=this.forma.placement.transformPoint(this.forma.bounds.eval(n)),o=t.newSize.width>=0?t.newSize.width:this.forma.bounds.width,i=t.newSize.height>=0?t.newSize.height:this.forma.bounds.height,a=null!=t.pin&&(.5==t.pin.x||.5==t.pin.y),s=new J.TheoSize(o,i);a||!this.maintainAspectRatio&&t.forma.kind!=S.FrameForma.KIND||(s=this.owner.selection.inCropMode?e.size.myAspectRatioFitWithin(s):e.size.myAspectRatioClosestCorner(s));var l=this.forma.placement.extractedScale;this.forma.placement=l.matrix,this.forma.bounds=Z.TheoRect.fromSize(s);var u=this.forma.placement.transformPoint(this.forma.bounds.eval(t.pin));this.forma.move(N.Matrix2D.translation(W._minus_TheoPoint_TheoPoint(r,u))),this.updateParentGroup()}},processEndFormaResize:function(t){var e;(e=l.opt(l.opt(this.owner,(function(t){return t.document})),(function(t){return t.firstPage})))&&e.publish(new P.EndFormaResizeMessage(e));var n,r=new T.FormaAlignmentChangedEvent(this.forma_,[],null);this.forma_.beginUpdate(r),this.forma_.endUpdate(r),(n=l.as(l.opt(this.forma.parent,(function(t){return t.controller})),w.GroupController))&&n.endChildResizeEvent(t)},processBeginFormaDrag:function(t){this.clearAlignmentLines();var e=l.clone(t.dragDelegate.draggedFormae);this.alignmentDetector_=c.AlignmentDetector.init_f94b(l.clone(e));var n=this.owner.document.firstPage;n.publish(new P.BeginFormaDragMessage(n))},afterProcessBeginFormaDrag:function(t){},processEndFormaDrag:function(t){var e=l.first(t.dragDelegate.draggedFormae),n=t.drag.viewportScale,r=26/n;v.DragFacade.rescueFormaToPageBounds(e,r,24/n);var o=new T.FormaAlignmentChangedEvent(e,[],null);e.beginUpdate(o),e.endUpdate(o);var i,a,s=this.owner.document.firstPage;if(s.publish(new P.EndFormaDragMessage(s)),i=l.opt(e.root,(function(t){return t.filterWithCallback((function(t){return t instanceof D.GroupForma&&null!=t.controller}))})))for(var u=l.iter(i);!u.done;u.next()){var c,f=u.value;(c=l.as(f.controller,w.GroupController))&&c.canClaimForma(e)&&c.claimForma(e)}else A.Host.logging.error("Error: forma has not root "+e.print());(a=l.as(e.controller,j.TypeLockupController))&&a.invalidateStyleScores()},afterProcessEndFormaDrag:function(t){},containsForma:function(t){var e,n=l.clone(t.totalPlacement.transformPoints(l.clone(t.bounds.points))),r=l.clone(this.forma.totalPlacement.inverse.transformPoints(l.clone(n))),o=r.map((function(t){return t.x}),this),i=r.map((function(t){return t.y}),this),a=Z.TheoRect.fromXYXY(l.min(o),l.min(i),l.max(o),l.max(i));return!!(e=l.opt(this.forma.bounds,(function(t){return t.intersectionWith(a)})))&&e.area>.8*a.area},clearAlignmentLines:function(){var t=new T.FormaAlignmentChangedEvent(this.forma,[],[]);this.forma.beginUpdate(t),this.forma.endUpdate(t)},beforeProcessFormaDrag:function(t){},afterProcessFormaDrag:function(t){},processFormaDrag:function(t){var e=this,n=t.drag,r=1==t.dragDelegate.draggedFormae.length;t.dragDelegate.forEachDraggedForma((function(t,o){return e.processOneFormaDrag(n,t,o,r)}))},processOneFormaDrag:function(t,e,n,r){if(null!=this.owner){var o=this.owner;if(I.LegacyCoreAssert.isTrue(null!=e.controller,"processFormaDrag dragged forma with nil controller",{kind:e.kind,controllerKind:this.kind},"FormaController.processOneFormaDrag","FormaController.swift",777),null!=e.controller){var i=e.controller;if(!(!i.moveable||o.interactionMode==g.InteractionMode.SelectionFocused&&o.selection.selectedCount>0&&!o.selection.isSelected(e)))if(w=t.newDragPlacement)i.place(w);else{var a=new T.FormaTransformChangedEvent(e);e.beginUpdate(a);var s,u=l.opt(e.parent,(function(t){return t.totalPlacement.inverse}))||N.Matrix2D.Identity,c=t.freeMovement(u),f=c.movement,m=c.rise,h=c.run,d=h>0&&Math.abs(m/h),p=new W.TheoPoint(.5,.5);switch(s=e.parent instanceof S.FrameForma?e.parent.bounds.center:N._asterisk_TheoPoint_Matrix2D(e.bounds.center,n),p=e.bounds.locatePoint(e.placement.inverse.transformPoint(s)),t.dragMode){case 1:f=t.noScale(u,s);break;case 2:f=t.noRotation(u,s)}d=t.dragMode==B.DragMode.NoScaleNoSkew,I.LegacyCoreAssert.isFalse(0==f.determinant,"movement determinant should be non-zero",void 0,"FormaController.processOneFormaDrag","FormaController.swift",830),N._asterisk_Matrix2D_Matrix2D(N._asterisk_Matrix2D_Matrix2D(N.Matrix2D.translation(s),f),N.Matrix2D.translation(W._negate_TheoPoint(s))),t.uncommitedMovement=f;var v=t.activePace()==B.DragPace.MediumPace||t.currentlySnapped;r||(v=!1),t.dragMode==B.DragMode.UniformScaleNoRotationNoSkew&&(v=!1);var F,_=l.clone(e.filterByControllerKind(x.GridController.KIND,C.FormaTraversal.NearestAncestor));(F=l.as(l.opt(l.first(_),(function(t){return t.controller})),x.GridController))&&F.isChildSwappable(e)&&(v=!1);var y,b=t.currentlySnapped;if(y=e.controller){var w=N._asterisk_Matrix2D_Matrix2D(n,f);if(y.place(w),t.currentlySnapped=!1,v)null!=y.setSnappedPlacement(d?p:null,8/t.viewportScale,!1).movement&&(t.currentlySnapped=!0),!b&&t.currentlySnapped&&t.commitDrag();else{var M=new T.FormaAlignmentChangedEvent(e,[],null);this.forma_.beginUpdate(M),this.forma_.endUpdate(M)}}t.currentlySnapped,e.endUpdate(a);var D=o.document.firstPage;D.publish(new P.FormaDragMessage(D))}}}},processFormaClick:function(t){var e,n=this;this.alignmentDetector_=c.AlignmentDetector.init_a05b(this.forma_);var r,o=t.forma,i=1==t.modifierKeys.shift||1==t.modifierKeys.command||1==t.modifierKeys.control;r=A.Host.platform.isWeb?"Web":A.Host.platform.isIOS?"iOS":A.Host.platform.isAndroid?"Android":"Unknown",i?this.owner.selection.isSelected(o)?(this.owner.selection.deselectForma(o),l.opt(A.Host.logging,(function(t){return t.logToAnalytics(u.AnalyticsConstants.kAnalyticsEventClickOccured,{contextualData2:"New selected count: "+l.toString(n.owner.selection.selectedCount),contextualData3:"Did deselect: yes",contextualData4:"Platform: "+r})}))):(this.owner.selection.selectForma(o),l.opt(A.Host.logging,(function(t){return t.logToAnalytics(u.AnalyticsConstants.kAnalyticsEventClickOccured,{contextualData2:"New selected count: "+l.toString(n.owner.selection.selectedCount),contextualData3:"Did deselect: no",contextualData4:"Platform: "+r})}))):this.owner.selection.isSelected(o)?((e=l.opt(A.Host.platform,(function(t){return t.isWeb})))||null!=e)&&e||this.owner.selection.deselectForma(o):(o.controller.selectable&&this.owner.selection.replaceSelection(o),this.owner.controllerSettingsState.settings=null)},setSnappedPlacement:function(t,e,n){var r,o=this.alignmentDetector.snapped_Placement(t,e,n),i=o[0],a=o[1];(r=i)&&this.move(r);for(var u=[],c=l.iter(this.alignmentDetector.possibleAlignmentLines);!c.done;c.next())for(var f=c.value,m=l.iter(f.lines);!m.done;m.next()){var h=m.value;u.push(h)}var d=new T.FormaAlignmentChangedEvent(this.forma_,l.clone(a),null);return this.forma_.beginUpdate(d),this.forma_.endUpdate(d),new s.SnappedPlacement(i,l.clone(a.length>0?a:null))},updateParentGroup:function(){var t,e=l.opt(this.forma,(function(t){return t.parent}));(t=l.as(l.opt(e,(function(t){return t.controller})),w.GroupController))&&t.childUpdate(this.forma_)},postProcessEvent:function(t){return!1},containsPoint:function(t,e){var n;return void 0===e&&(e=0),!!(n=l.opt(this.forma,(function(t){return t.bounds})))&&(0!=e?n.outsetXY(e,e):n).containsPoint(t)},applyStyle:function(t,e){void 0===e&&(e=0),l.opt(this.forma,(function(e){return e.applyStyle(t)}))},shuffleColorAssignment:function(){if(l.opt(this.forma,(function(t){return null!=t.style}))&&!this.userGroup){var t,e=this.getCurrentColors(this.forma.style).length,n=[];if(t=this.getBackgroundColor()){var r=this.forma.page.colorLibraryController,o=l.clone(r.getThemeColorKeys());if(o.length>e){var i=r.getKeyOfColorInTheme(r.getTheoColorForSolidColor(t));null!=i&&l.remove(o,i)}for(var a=[],s=l.iter(o);!s.done;s.next()){var u=s.value,c=r.getSolidColorForKey(u);null!=c&&c.contrasts(t,!1)&&a.push(u)}a.length>=e&&(o=l.clone(a)),l.shuffleInPlace(o);for(var f=0;f<e;)n.push(r.getTheoColorForKey(o[f])),f+=1}for(var m=l.iter(l.range(0,n.length,!1));!m.done;m.next()){var h,d=m.value;if(null!=(h=this.forma.page.colorLibraryController.getKeyOfColorInTheme(n[d]))){var p,g=(new R.ProfilingColorMap).overridePaletteMappingDueToContrast(h,this.forma.formaID);(p=this.forma.page.colorLibraryController.getTheoColorForKey(g))&&(n[d]=p)}}this.applyColors(l.clone(n))}},getSuggestableColors:function(){for(var t=this.forma.page.colorLibraryController,e=l.clone(t.getColorThemeAsArrayOfTheoColors()),n=[],r=l.iter(e);!r.done;r.next()){var o=r.value;o.isBrandkitColor()||n.push([o])}return n},getCurrentColors:function(t){var e,n,r=[];return this.primaryColorVisible()&&(e=t.colors.color(h.ColorRole.FieldPrimary))&&r.push(e),this.secondaryColorVisible()&&(n=t.colors.color(h.ColorRole.FieldSecondary))&&r.push(n),r},applyColors:function(t,e){var n;if(void 0===e&&(e=h.ColorRole.FieldPrimary),n=this.forma){var r=l.clone(n.page.colorLibraryController.addColorsToTheme(l.clone(t),n));r.length>0&&n.style.colors.setColorId(h.ColorRole.FieldPrimary,r[0]),r.length>1&&n.style.colors.setColorId(h.ColorRole.FieldSecondary,r[1])}this.updateParentGroup()},primaryColorVisible:function(){return!0},secondaryColorVisible:function(){return!1},applyOpacity:function(t){l.opt(l.opt(l.opt(this.forma,(function(t){return t.root})),(function(t){return t.animation})),(function(t){return t.invalidate()})),l.opt(this.forma,(function(e){return e.style.opacity=t})),this.updateParentGroup()},currentOpacity:{get:function(){var t;return(t=l.opt(this.forma,(function(t){return t.style.opacity})))||null!=t?t:1}},preferredXAlignment:{get:function(){return null}},setAlignmentType:function(t){},currentHeightScale:{get:function(){var t,e;if((t=l.opt(this.forma,(function(t){return t.bounds})))&&(e=l.opt(this.forma,(function(t){return t.totalPlacement})))){var n=l.clone(t.evalPts([W.TheoPoint.ZERO,new W.TheoPoint(0,1)])),r=l.clone(e.transformPoints(l.clone(n)));return r[0].distanceTo(r[1])}return null}},getSizeHeightScales:function(){var t;return(t=l.opt(this.forma,(function(t){return t.bounds})))?[{size:t.size,scale:t.height}]:[]},setHeightScale:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=e||this.getPin();null!=r&&(r.targetHeight=t,this.matchPreviousPin(r,n))},getParentForPin:function(){var t;return(t=this.forma)?l.opt(l.opt(t.parent,(function(t){return t.controller})),(function(t){return t.kind==w.GroupController.KIND}))?t.parent:M.GroupDetector.getVisualParent(t):null},determinePinPosition:function(t,e,n,r,o,i,a,s){var l=i-o,u=Math.max((t-o)/l,0),c=Math.min(1-(i-e)/l,1),f=Math.max(Math.max(o,0)-t,0)/l,m=Math.max(e-i,0)/l,h=Math.max(Math.max(o,0)-n,0)/l,d=Math.max(Math.min(r,e)-i,0)/l;return this.isFrameCentered(h,d)||this.isFrameCentered(f,m)?(u+c)/2:G.MathUtils.absDouble(a-t)<25?0:G.MathUtils.absDouble(s-e)<25?1:h>d?c:u},isFrameCentered:function(t,e){var n=.1+Math.min(t,e);return G.MathUtils.absDouble(t-e)<n&&(t>=0&&e>=0||t+e<.05)},visualParent:{get:function(){return M.GroupDetector.getVisualParent(this.forma)}},visualParentExpansionFrame:{get:function(){var t=M.GroupDetector.getVisualParent(this.forma),e=this.getExpansionBounds(t);return t.totalPlacement.transformRect(e)}},interpolateWithDelta:function(t,e,n,r){var o=Math.min(Math.max(n,0),1),i=Math.min(r,Math.abs(t-e)),a=(1-o)*t+o*e;return Math.abs(e-a)<i&&(a=e+(t>e?1:-1)*i),a},getExpansionBounds:function(t,e,n){var r,o,i,a,s;if(void 0===e&&(e=.5),void 0===n&&(n=0),(o=this.forma)&&o.bounds&&(i=o.parent)&&(a=t.bounds)&&(s=this.getFrameInOtherFormaCoord(t))){for(var u=a.minX,c=a.maxX,f=a.minY,m=a.maxY,h=l.clone(i.filterWithCallback((function(t){return!(!(r=l.opt(t.controller,(function(t){return t.floating})))&&null==r)&&r}))),d=l.iter(h);!d.done;d.next()){var p,g=d.value;if(!l.eq(C._equality_Forma_Forma,g,o)&&(p=l.opt(g.controller,(function(e){return e.getFrameInOtherFormaCoord(t)})))){if(!g.isTypeLockup()&&p.intersects(s))continue;var v=Math.max(s.minX,p.minX),F=Math.min(s.maxX,p.maxX),_=Math.max(s.minY,p.minY),y=Math.min(s.maxY,p.maxY),b=G.MathUtils.absDouble(1-(F-v)/Math.min(s.width,p.width))<.2,S=G.MathUtils.absDouble(1-(y-_)/Math.min(s.height,p.height))<.2;F>v&&!S&&(p.center.y>s.center.y?m=Math.min(m,this.interpolateWithDelta(s.maxY,p.minY,e,n)):f=Math.max(f,this.interpolateWithDelta(s.minY,p.maxY,e,n))),y>_&&!b&&(p.center.x>s.center.x?c=Math.min(c,this.interpolateWithDelta(s.maxX,p.minX,e,n)):u=Math.max(u,this.interpolateWithDelta(s.minX,p.maxX,e,n)))}}return new Z.TheoRect(u,f,c,m)}return null},boundaryAlignment:function(t,e){return G.MathUtils.absDouble(t.minX-e.minX)<25||G.MathUtils.absDouble(t.maxX-e.maxX)<25||G.MathUtils.absDouble(t.minY-e.minY)<25||G.MathUtils.absDouble(t.maxY-e.maxY)<25},getPinBounds:function(t){return l.opt(this.forma,(function(t){return t.bounds}))},getRelativePin:function(t,e,n){var r,o;if((r=this.forma)&&(o=this.alignmentDetector)){var i,a=1;(i=l.opt(r.page.view,(function(t){return t.getViewportTransform()})))&&(a=Math.sqrt(Math.abs(i.determinant)));var s=c.AlignmentDetector.DISTANCE_THRESHOLD/a,u=l.clone(o.detectFormaAlignments(2*s,!0,!1));l.sortInPlace(u,(function(t,e){return 10*Math.abs(t.offset.length())+t.line.line.length+.1*l.toDouble(t.line.type)<10*Math.abs(e.offset.length())+e.line.line.length+.1*l.toDouble(e.line.type)}));for(var f=r.totalPlacement,m=l.iter(u);!m.done;m.next()){var h,d,p,g,v,C=m.value;if((h=l.opt(this.getPinBounds(t),(function(t){return t.transform(f)})))&&(d=C.forma)&&(p=l.opt(C.forma,(function(t){return t.totalPlacement})))&&(g=d.controller)&&(v=l.opt(g.getPinBounds(V.PinBoundsType.Bounds),(function(t){return t.transform(p)})))){var F=Math.max(0,-1*Math.min(h.maxY-v.minY,v.maxY-h.minY));if(d.parent!=r.parent||v.area<=e.area||v.intersects(h)||!g.floating||F>200)continue;var _=null;C.line.type==c.AlignmentType.CenterX?_=.5:C.line.type==c.AlignmentType.Left?_=0:C.line.type==c.AlignmentType.Right&&(_=1);var y,b,S,P,T,x,w=V.PinBoundsType.Bounds;if(null!=(y=_)&&(b=this.getPinBounds(t))&&(S=C.forma)&&(P=S.controller)&&null!=(T=P.currentHeightScale)&&(x=P.getPinBounds(w))){var M=S.totalPlacement,D=M.transformPoint(x.eval(new W.TheoPoint(.5,.5))),A=f.inverse.transformPoint(D),E=.5;A.y>b.maxY?E=1:A.y<b.minY&&(E=0);var L,I,k=new W.TheoPoint(y,E),N=new W.TheoPoint(y,1-E),G=N;if((L=S.frame)&&(I=S.bounds)){var R=S.placement.inverse.transformPoint(L.eval(N));G=new W.TheoPoint(Math.max(0,Math.min(1,R.x/I.width)),Math.max(0,Math.min(1,R.y/I.height)))}var B=M.transformPoint(x.eval(G)),O=f.transformPoint(b.eval(k)),Y=Math.abs(O.y-B.y),X=Y/T;return new V.TheoPin(r,t,k,S,w,G,n,Y,X,!0)}}}}return null},getPin:function(t,e){if(void 0===t&&(t=!0),void 0===e&&(e=!0),!this.floating)return null;var n,r,o,i,a,s=null;if((n=this.forma)&&(r=n.finalFrame)&&(o=l.opt(n.root,(function(t){return t.finalFrame})))&&(i=this.getParentForPin())&&(a=i.finalFrame)){var u=this.currentHeightScale;null==u||!n.isShape()&&0!=u||(u=null);var c,f=V.PinBoundsType.Bounds,m=r,h=!1;l.as(this,w.GroupController)&&(c=l.opt(l.as(n,D.GroupForma),(function(t){return t.childrenFinalFrame})))&&(m=c,(h=this.boundaryAlignment(c,o))&&(f=V.PinBoundsType.ChildrenBounds));var d,p,g,v=Math.abs(a.center.x-r.center.x)<5;if(!t||h||v||(s=this.getRelativePin(f,m,u)),null==s){if((d=n.bounds)&&(p=i.bounds)&&(g=this.getExpansionBounds(i))){var C=i.totalPlacement.transformRect(g),F=this.determinePinPosition(a.minX,a.maxX,C.minX,C.maxX,r.minX,r.maxX,m.minX,m.maxX),_=this.determinePinPosition(a.minY,a.maxY,C.minY,C.maxY,r.minY,r.maxY,m.minY,m.maxY),y=r.eval(new W.TheoPoint(F,_)),b=n.totalPlacement.inverse.transformPoint(y),S=new W.TheoPoint(b.x/d.width,b.y/d.height),P=i.totalPlacement.inverse.transformPoint(y),T=new W.TheoPoint(P.x/p.width,P.y/p.height),x=V.PinBoundsType.Bounds;s=new V.TheoPin(n,f,S,i,x,T,u,0,0)}}else l.opt(A.Host.logging,(function(t){return t.warning("pinned relatively")}))}return s},matchPreviousPin:function(t,e,n,r){var o,i,a,s,u,c,f,m,h,d,p,g;if(void 0===e&&(e=!1),void 0===n&&(n=.5),void 0===r&&(r=0),(h=this.forma)&&(d=this.getParentForPin())&&(p=d.bounds)&&(g=this.getExpansionBounds(d,n,r))){for(var v=h.isTypeLockup()&&!this.maintainAspectRatio?2:1,C=l.iter(l.range(0,v,!1));!C.done;C.next()){var F,_=C.value,y=((o=t.targetHeight)||null!=o?o:(i=this.currentHeightScale)||null!=i?i:1)/((a=this.currentHeightScale)||null!=a?a:(s=t.targetHeight)||null!=s?s:1),b=0==_?.01:.05;if(Math.abs(y-1)<b)break;if(F=this.getFrameInOtherFormaCoord(d)){F=F.scale(1.1,new W.TheoPoint(.5,.5));var S=Math.max(F.minX-g.minX,0),P=Math.max(Math.min(g.maxX,p.maxX)-F.maxX,0),T=Math.max(F.minY-g.minY,0),x=Math.max(Math.min(g.maxY,p.maxY)-F.maxY,0);S=0==t.pinPoint.x?0:S,P=1==t.pinPoint.x?0:P,T=0==t.pinPoint.y?0:T,x=1==t.pinPoint.y?0:x,Math.abs(t.pinPoint.x-.5)<1e-6&&(S=Math.min(S,P),P=Math.min(S,P)),Math.abs(t.pinPoint.y-.5)<1e-6&&(T=Math.min(T,x),x=Math.min(T,x));var w=1+(S+P)/F.width,M=1+(T+x)/F.height,D=Math.min(y,w),A=Math.min(y,M);this.maintainAspectRatio&&(D=Math.min(D,A),A=D),h.bounds=l.opt(h.bounds,(function(t){return t.scaleXY(D,A,W.TheoPoint.ZERO)}))}}var E,L,I,k,N;if(y=((u=t.targetHeight)||null!=u?u:(c=this.currentHeightScale)||null!=c?c:1)/((f=this.currentHeightScale)||null!=f?f:(m=t.targetHeight)||null!=m?m:1),Math.abs(y-1)>.001&&(E=h.finalFrame)&&(L=h.bounds)&&(I=l.opt(h.root,(function(t){return t.finalFrame})))&&(k=this.getExpansionBounds(d,n,r))&&(e||L.width*y<k.width&&L.height*y<k.height&&E.width*y<I.width&&E.height*y<I.height)){var G=h.placement.transformValues;h.placement=h.placement.scaleTo(G.xscale*y,G.yscale*y)}(N=l.as(h.controller,j.TypeLockupController))&&N.snapSizeToBounds(),h.move(t.offsetMatrix()),this.preventOutofBounds(d,g)}},getFrameInOtherFormaCoord:function(t){var e,n;return(e=this.forma.bounds)&&(n=t.totalPlacement.inverse)?t==l.opt(this.forma,(function(t){return t.parent}))?l.opt(this.forma,(function(t){return t.frame})):this.forma.totalPlacement.concat(n).transformRect(e):null},preventOutofBounds:function(t,e,n){void 0===n&&(n=0);var r,o,i,a=e||t.bounds;if((r=this.forma)&&(o=a)&&(i=this.getFrameInOtherFormaCoord(t))&&!o.contains(i)){var s=o.insetXY(n,n),l=i.minX-s.minX,u=i.maxX-s.maxX,c=i.minY-s.minY,f=i.maxY-s.maxY,m=0;l<0&&u>0?m=Math.abs(l)<u?-l:-u:l<0?m=-l:u>0&&(m=-u);var h=0;return c<0&&f>0?h=Math.abs(c)<f?-c:-f:c<0?h=-c:f>0&&(h=-f),r.move(N.Matrix2D.translationXY(m,h)),0!=m||0!=h}return!1},linkedForma:function(t){var e,n;return(e=this.forma.parent)&&(n=e.controller)?n.linkedFormaForChild(this.forma,t):[]},linkedFormaForChild:function(t,e){return[]},getZOrder:function(){var t,e=-1;return null==this.forma||null==this.forma.parent?(I.LegacyCoreAssert.fail("asked to get z-order when forma or its parent is nil",void 0,"FormaController.getZOrder","FormaController.swift",1879),e):e=(t=this.forma.parent.indexOfChild(this.forma))||null!=t?t:-1},setZOrder:function(t){null!=this.forma&&null!=this.forma.parent?this.forma.parent.insertChildAt(this.forma,t):I.LegacyCoreAssert.fail("asked to set z-order when forma or its parent is nil",void 0,"FormaController.setZOrder","FormaController.swift",1891)},getMinLayerIndex:function(){var t=0;if(null==this.forma||null==this.forma.parent)return I.LegacyCoreAssert.fail("asked to get minimum layer index when forma or its parent is nil",void 0,"FormaController.getMinLayerIndex","FormaController.swift",1901),t;var e=this.forma.parent;return null!=e&&(t=l.clone(e.filterWithCallback((function(t){return(t.isBackgroundImage()||t.isShape()&&!t.hasIntent(C.Forma.INTENT_TEMP_IMAGE_CROP))&&null!=t.controller&&!t.controller.floating}),C.FormaTraversal.JustChildren)).length),t},getReorderableLayerCount:function(){var t;return null==this.forma?(I.LegacyCoreAssert.fail("asked to get number of reorderable layers when forma or its parent is nil",void 0,"FormaController.getReorderableLayerCount","FormaController.swift",1920),0):!this.enableChildMove&&this.userGroupChild||l.opt(this.forma,(function(t){return t.isGridCell()}))?0:(t=l.opt(this.getSiblingFormae(),(function(t){return t.length})))||null!=t?t:0},getSiblingFormae:function(){return null==this.forma?(I.LegacyCoreAssert.fail("siblings requested for nil forma",void 0,"FormaController.getSiblingFormae","FormaController.swift",1939),null):l.opt(this.forma,(function(t){return t.isGridCell()}))?null:(t=l.opt(this.forma,(function(t){return t.parent})))?t.filterWithCallback((function(t){return!t.isBackgroundImage()&&!t.hasIntent(C.Forma.INTENT_TEMP_IMAGE_CROP)&&!x.GridController.isBackgroundColoredCell(t)}),C.FormaTraversal.JustChildren):null;var t},doesContrast:function(){var t,e,n;return!!((t=this.forma)&&(e=t.style.colors.fieldPrimary)&&(n=this.getBackgroundColor()))&&e.contrasts(n,!1)},contrastCheck:function(t){var e,n,r;if(void 0===t&&(t=!0),(e=this.forma.style.colors.fieldPrimary)&&null!=(n=this.forma.style.colors.colorID(h.ColorRole.FieldPrimary))&&(r=this.getBackgroundColor())&&!e.contrasts(r,t)){var o=e.contrastWithColor(r),i=f.ColorLibraryController.getBackgroundContrastKey(n);this.forma.page.colorLibraryController.setTheoColorToLibrary(K.TheoColor.init_5344(o,null,null),i),this.forma.style.colors.setColorId(h.ColorRole.FieldPrimary,i)}},getBackingContrastRole:function(){return h.ColorRole.FieldPrimary},getBackgroundColor:function(t){void 0===t&&(t=null);var e=this;if(null==this.forma.finalFrame)return null;var n,r=null!=t?t:this.forma.finalFrame;if(n=l.as(this.forma.root,O.RootForma)){var o=n.style.colors.fieldPrimary,i=l.opt(n.finalFrame,(function(t){return t.intersectionWith(r)}));if(null==i)return null;r=i,(s=l.as(this,j.TypeLockupController))&&s.styleController.targetedLockupStyle!==s.lockupStyle&&s.textBacked&&!k.LockupStyle.isShadowLook(s.lockupStyle.textLook)&&(o=s.lockupStyle.colors.fieldPrimary),null==o&&(l.opt(A.Host.logging,(function(t){return t.warning("Possible error. background color is nil.")})),o=X.SolidColor.WHITE);for(var a=l.iter(n.visitAsArray(C.FormaTraversal.PreOrder));!a.done;a.next()){var s,u,c,f=a.value,m=f.finalFrame,h=f.controller;if(null!=h&&!l.eq(C._equality_Forma_Forma,f,this.forma)&&null!=m&&((s=l.as(f.controller,j.TypeLockupController))&&(u=s.lockupStyle)&&u.backing==k.LockupBacking.Knockout&&u.textLook==k.LockupTextLook.KnockoutOnly&&(o=f.style.colors.fieldSecondary),!(c=h)||c.kind==Y.ShapeController.KIND||c.kind==F.FrameController.KIND)){for(var d=f.parent,p=!1;null!=d&&d.kind!=O.RootForma.KIND&&d!=f;){if(d==this.forma){p=!0;break}d=d.parent}if(!p){var g=r.intersectionWith(m);if(null!=g&&g.area/r.area>.5){var v,_;if(f.parent==l.opt(this.forma,(function(t){return t.parent}))&&null!=f.parent&&null!=(v=l.opt(f.parent,(function(t){return t.indexOfChild(e.forma)})))&&null!=(_=f.parent.indexOfChild(f))&&v<_)continue;if(f instanceof S.FrameForma){var y=f.controller.getAverageColor(r);null!=y?o=o.blend(y,y.alpha):(A.Host.logging.warning("Error: Couldn't find the background color"),o=new X.SolidColor(.5,.5,.5,1))}else if(f instanceof z.ShapeForma){if(!(new R.ProfilingColorMap).checkIfTwoFormaAreInSamePaletteMappingGroup(f.formaID,this.forma.formaID)&&!(new R.ProfilingColorMap).checkIfTwoFormaAreInSamePaletteMappingGroup(f.formaID,this.forma.formaID+R.ProfilingColorMap.backingColorKey)){var b=l.opt(l.opt(l.as(f,z.ShapeForma),(function(t){return t.contentNode})),(function(t){return t.getTag(U.TAG_SHAPE_ID)}));if(null==b||U.ShapeLibrary.FilledBackingShapes.includes(b)){var P=f.style.colors.fieldPrimary,T=l.as(f,z.ShapeForma).getAverageAlpha(r);null!=P&&null!=o&&(o=o.blend(P,f.style.opacity*T))}}}else D.GroupForma}}}}return o}return null},getBackgroundColors:function(){var t,e,n=[];if((t=this.forma.finalFrame)&&(e=this.forma.root)){var r=l.clone(e.filterWithCallback((function(e){return e.isGraphic()&&e.kind!=E.ImageForma.KIND&&e.kind!=O.RootForma.KIND&&null!=e.finalFrame&&e.finalFrame.intersects(t)})));if(1==r.length&&r[0].isGridCell()&&r[0].isShape()){var o,i=r[0].style.colors.fieldPrimary;if((o=r[0].finalFrame)&&o.contains(t)&&null!=i)return[i]}for(var a=3;t.width/l.toDouble(a)<50&&1!=a;)a-=1;for(var s=3;t.height/l.toDouble(s)<50&&1!=s;)s-=1;for(var u=new J.TheoSize(t.width/l.toDouble(a),t.height/l.toDouble(s)),c=l.iter(l.range(0,a,!1));!c.done;c.next())for(var f=c.value,m=l.iter(l.range(0,s,!1));!m.done;m.next()){var h=m.value,d=Z.TheoRect.fromXYWH(l.toDouble(f)*u.width+t.origin.x,l.toDouble(h)*u.height+t.origin.y,u.width,u.height);null==(i=this.getBackgroundColor(d))||l.containsEq(n,i,X._equality_SolidColor_SolidColor)||n.push(i)}}return n},getBackgroundColorsFullList:function(){var t,e,n=[];if((t=this.forma.finalFrame)&&(e=this.forma.root)){var r=l.clone(e.filterWithCallback((function(e){return e.isGraphic()&&e.kind!=E.ImageForma.KIND&&e.kind!=O.RootForma.KIND&&null!=e.finalFrame&&e.finalFrame.intersects(t)})));if(1==r.length&&r[0].isGridCell()&&r[0].isShape()){var o,i=r[0].style.colors.fieldPrimary;if((o=r[0].finalFrame)&&o.contains(t)&&null!=i)return[i]}for(var a=new J.TheoSize(t.width/l.toDouble(16),t.height/l.toDouble(16)),s=l.iter(l.range(0,16,!1));!s.done;s.next())for(var u=s.value,c=l.iter(l.range(0,16,!1));!c.done;c.next()){var f=c.value,m=Z.TheoRect.fromXYWH(l.toDouble(u)*a.width+t.origin.x,l.toDouble(f)*a.height+t.origin.y,a.width,a.height);null!=(i=this.getBackgroundColor(m))&&n.push(i)}}return n},getAverageColor:function(t){return this.forma.style.colors.fieldPrimary},annotations:{get:function(){return null}},addAnnotation:function(t){},removeAnnotationsOfType:function(t){return!1}}}),i),s.SnappedPlacement=(a=function(t,e){this.movement=t,this.snapLines=l.clone(e)},l.defineClass({name:"SnappedPlacement",ctor:a,superName:"CoreObject"}),a)},JFv5:function(t,e,n){var r,o=e,i=n("oAGj"),a=n("gXiO"),s=n("FNB+"),l=n("9Lk3"),u=n("ZK0l"),c=n("/afT"),f=n("fdtz"),m=n("K0Rh"),h=n("T6jX"),d=n("8t9B"),p=n("oKlP"),g=n("zjod");o.ResizeLayoutController=i.defineProtocol("ResizeLayoutController",{beginUpdateGroup:"() -> Void",updateGroup:"() -> Void",endUpdateGroup:"() -> Void"}),o.ResizeLayoutType=i.defineEnum("ResizeLayoutType",{Proportional:"Proportional",Fit:"Fit",Pin:"Pin",Spring:"Spring"}),o.PinLayoutController=(r=function(t){this.formaToUpdate_=[],this.inferredGroups_=null,this.group_=t,a.CoreObject.call(this)},i.defineClass({name:"PinLayoutController",ctor:r,superName:"CoreObject",statics:{_implements:function(t){return"ResizeLayoutController"==t}},props:{beginUpdateGroup:function(){if(this.oldBounds_=this.group_.bounds,i.as(this.group_.root,m.RootForma)&&!this.group_.hasIntent(s.Forma.INTENT_INFERRED_TEMP_GROUP)&&i.opt(this.group_.root,(function(t){return null!=t.page.root_}))&&!h.TheoDocumentUtils.enableFastHeuristicsForComplexPage(this.group_.root.page)){var t=i.clone(c.GroupDetector.createOverlapGroups(this.group_));if(t.length>0){this.inferredGroups_=[];for(var e=i.iter(t);!e.done;e.next()){var n=e.value;this.inferredGroups_.push(n)}i.opt(i.as(this.group_.controller,l.GridController),(function(t){return t.inferGridCellAssignment()}))}}this.formaToUpdate_=[];for(var r=i.iter(this.group_.visitAsArray(s.FormaTraversal.JustChildren));!r.done;r.next()){var o=r.value;if(o.kind!=f.ImageForma.KIND&&o.kind!=g.VideoForma.KIND){var a;(a=i.as(o.controller,u.GroupController))&&a.beginUpdateGroup();var d=i.opt(o.controller,(function(t){return t.getPin(!0)}));null==d||d.isRelativePin?this.formaToUpdate_.push({forma:o,pin:d}):this.formaToUpdate_.splice(0,0,{forma:o,pin:d})}}},updateGroup:function(){if(null!=this.oldBounds_){for(var t=this.oldBounds_.size,e=this.group_.bounds.size,n=new p.TheoPoint(e.width/t.width,e.height/t.height),r=i.iter(this.formaToUpdate_);!r.done;r.next()){var o;if((o=(v=r.value).forma.frame)&&o.area>0){var a=v.forma,s=a.placement.transformValues,l=Math.abs(s.rotCosine)/(Math.abs(s.rotCosine)+Math.abs(s.rotSine)),u=Math.abs(s.rotSine)/(Math.abs(s.rotCosine)+Math.abs(s.rotSine)),c=new p.TheoPoint(n.x*l+n.y*u,n.x*u+n.y*l);if((g=i.as(a.controller,d.TypeLockupController))&&g.addLineBreakConstraints(),null!=a.controller&&a.controller.maintainAspectRatio){var f=Math.min(c.x,c.y);a.bounds=i.opt(a.bounds,(function(t){return t.scaleXY(f,f,new p.TheoPoint(0,0))}))}else a.bounds=i.opt(a.bounds,(function(t){return t.scaleXY(c.x,c.y,new p.TheoPoint(0,0))}));a.moveCenterToPoint(new p.TheoPoint(o.center.x*n.x,o.center.y*n.y))}}for(var m=i.iter(this.formaToUpdate_);!m.done;m.next()){var h,g,v=m.value;(h=v.pin)&&(i.opt(v.forma.controller,(function(t){return t.matchPreviousPin(h)})),(g=i.as(v.forma.controller,d.TypeLockupController))&&g.removeLineBreakConstraints())}}},endUpdateGroup:function(){for(var t=i.iter(this.group_.visitAsArray(s.FormaTraversal.JustChildren));!t.done;t.next()){var e,n=t.value;if((e=i.as(n.controller,u.GroupController))&&e.endUpdateGroup(),n.hasIntent(s.Forma.INTENT_INFERRED_TEMP_GROUP)&&null!=this.inferredGroups_&&this.inferredGroups_.includes(n)){for(var r=i.iter(n.visitAsArray(s.FormaTraversal.JustChildren));!r.done;r.next()){var o=r.value;this.group_.appendChild(o,!0)}n.removeFromParent(),i.opt(i.as(this.group_.controller,l.GridController),(function(t){return t.inferGridCellAssignment()})),i.remove(this.inferredGroups_,n)}}}}}),r)},"Pil/":function(t,e,n){var r,o,i,a,s,l,u,c,f,m,h,d,p,g=e,v=n("oAGj"),C=n("+nk0"),F=n("FNB+"),_=n("yHU1");g.FormaControllerEvent=(r=function(){},v.defineClass({name:"FormaControllerEvent",ctor:r,superName:"ControllerEvent",props:{forma:{get:function(){return v.first(this.formae)},set:function(t){v.eq(F._equality_Forma_Forma,v.first(this.formae),t)||(this.formae[0]=t)}},init_939b:function(t,e){this.formae=v.clone(e),C.ControllerEvent.call(this,t)},init_83ea:function(t,e){this.init_939b(t,[e])}}}),r),g.PSMFormaControllerEvent=(o=function(){},v.defineClass({name:"PSMFormaControllerEvent",ctor:o,superName:"FormaControllerEvent",props:{init_939b:function(t,e){v.super_init(this,g.FormaControllerEvent,g.FormaControllerEvent.prototype.init_939b,t,v.clone(e))},init_83ea:function(t,e){v.super_init(this,g.FormaControllerEvent,g.FormaControllerEvent.prototype.init_83ea,t,e)}}}),o),g.BeginPointerTrackingEvent=(i=function(){this.trackingResponse=_.BeginPointerTrackingResponseEnum.TrackAsGroup},v.defineClass({name:"BeginPointerTrackingEvent",ctor:i,superName:"PSMFormaControllerEvent",statics:{TYPE:{get:function(){return"BeginPointerTrackingEvent"}}},props:{dragTargetForma:{get:function(){return v.first(this.dragTargetFormae)},set:function(t){v.eq(F._equality_Forma_Forma,v.first(this.dragTargetFormae),t)||(this.dragTargetFormae[0]=t)}},init_bef7:function(t,e,n){this.dragTargetFormae=v.clone(e),this.selectionState=n,v.super_init(this,g.PSMFormaControllerEvent,g.PSMFormaControllerEvent.prototype.init_939b,i.TYPE,[t])},init_e511:function(t,e,n){this.init_bef7(t,[e],n)}}}),i),g.PSMFormaDragControllerEvent=(a=function(t,e){this.drag=e,this.dragDelegate=e.activeDragDelegate,v.super_init(this,g.PSMFormaControllerEvent,g.PSMFormaControllerEvent.prototype.init_939b,t,v.clone(this.dragDelegate.draggedFormae))},v.defineClass({name:"PSMFormaDragControllerEvent",ctor:a,superName:"PSMFormaControllerEvent"}),a),g.BeginFormaDragEvent=(s=function t(e){g.PSMFormaDragControllerEvent.call(this,t.TYPE,e)},v.defineClass({name:"BeginFormaDragEvent",ctor:s,superName:"PSMFormaDragControllerEvent",statics:{TYPE:{get:function(){return"BeginFormaDragEvent"}}}}),s),g.FormaDragEvent=(l=function t(e){g.PSMFormaDragControllerEvent.call(this,t.TYPE,e)},v.defineClass({name:"FormaDragEvent",ctor:l,superName:"PSMFormaDragControllerEvent",statics:{TYPE:{get:function(){return"FormaDragEvent"}}}}),l),g.EndFormaDragEvent=(u=function t(e){g.PSMFormaDragControllerEvent.call(this,t.TYPE,e)},v.defineClass({name:"EndFormaDragEvent",ctor:u,superName:"PSMFormaDragControllerEvent",statics:{TYPE:{get:function(){return"EndFormaDragEvent"}}}}),u),g.BeginFormaResizeEvent=(c=function t(e,n){this.spot=n,v.super_init(this,g.FormaControllerEvent,g.FormaControllerEvent.prototype.init_939b,t.TYPE,[e])},v.defineClass({name:"BeginFormaResizeEvent",ctor:c,superName:"FormaControllerEvent",statics:{TYPE:{get:function(){return"BeginFormaResizeEvent"}}}}),c),g.FormaResizeEvent=(f=function t(e,n,r){this.newSize=n,this.pin=r,v.super_init(this,g.FormaControllerEvent,g.FormaControllerEvent.prototype.init_939b,t.TYPE,[e])},v.defineClass({name:"FormaResizeEvent",ctor:f,superName:"FormaControllerEvent",statics:{TYPE:{get:function(){return"FormaResizeEvent"}}}}),f),g.EndFormaResizeEvent=(m=function t(e){v.super_init(this,g.FormaControllerEvent,g.FormaControllerEvent.prototype.init_939b,t.TYPE,[e])},v.defineClass({name:"EndFormaResizeEvent",ctor:m,superName:"FormaControllerEvent",statics:{TYPE:{get:function(){return"EndFormaResizeEvent"}}}}),m),g.FormaClickEvent=(h=function t(e){this.modifierKeys={},v.super_init(this,g.PSMFormaControllerEvent,g.PSMFormaControllerEvent.prototype.init_939b,t.TYPE,[e])},v.defineClass({name:"FormaClickEvent",ctor:h,superName:"PSMFormaControllerEvent",statics:{TYPE:{get:function(){return"FormaClickEvent"}}}}),h),g.FormaDoubleClickEvent=(d=function t(e){this.modifierKeys={},v.super_init(this,g.PSMFormaControllerEvent,g.PSMFormaControllerEvent.prototype.init_939b,t.TYPE,[e])},v.defineClass({name:"FormaDoubleClickEvent",ctor:d,superName:"PSMFormaControllerEvent",statics:{TYPE:{get:function(){return"FormaDoubleClickEvent"}}}}),d),g.AddFormaEvent=(p=function t(e){v.super_init(this,g.FormaControllerEvent,g.FormaControllerEvent.prototype.init_939b,t.TYPE,[e])},v.defineClass({name:"AddFormaEvent",ctor:p,superName:"FormaControllerEvent",statics:{TYPE:{get:function(){return"AddFormaEvent"}}}}),p)},"aen+":function(t,e,n){var r,o=e,i=n("oAGj"),a=n("H9Ol");o.AbsolutePositionController=(r=function(t,e,n){a.FormaController.call(this,t,e,n)},i.defineClass({name:"AbsolutePositionController",ctor:r,superName:"FormaController",statics:{KIND:{get:function(){return"AbsolutePositionController"}}}}),r)},dHJt:function(t,e,n){var r,o=e,i=n("oAGj"),a=n("16hp"),s=n("6Rk9"),l=n("iCxV"),u=n("tGKA"),c=n("oKlP");o.BadgeLayoutController=(r=function(t,e){void 0===e&&(e=!0),this._formae=i.clone(t),this._usePerceivedBounds=e},i.defineClass({name:"BadgeLayoutController",ctor:r,props:{update:function(){if(0!=this._formae.length){var t=this._formae[0],e=t.page.root,n=s.GeometryFacade.getFormaeBounds(i.clone(this._formae),this._usePerceivedBounds),r=new a.FormaPlacementSuggester(t,e),o=i.clone(r.createPlacementSuggestions(!0,n.aspectRatio));if(0==!o.length)for(var f=o[0].location,m=f.height/n.height,h=u.Matrix2D.translation(f.origin),d=i.iter(this._formae);!d.done;d.next()){var p=d.value;p.bounds=p.bounds.scale(m,c.TheoPoint.ZERO);var g=p.totalPlacement,v=(g.tx-n.minX)*m,C=(g.ty-n.minY)*m;p.placement=new u.Matrix2D(g.a,g.b,g.c,g.d,v,C).concat(h)}else i.opt(l.Host.logging,(function(t){return t.warning("Did not find a placement suggestion for badge.")}))}}}}),r)},k7ZV:function(t,e,n){n("oAGj")},lgJd:function(t,e,n){n("oAGj")},voLh:function(t,e,n){var r,o=e,i=n("oAGj"),a=n("gXiO"),s=n("FNB+"),l=n("P83h"),u=n("fdtz"),c=n("oKlP"),f=n("zjod");o.ProportionalLayoutController=(r=function(t){this.group_=t,this.oldBounds_={},a.CoreObject.call(this)},i.defineClass({name:"ProportionalLayoutController",ctor:r,superName:"CoreObject",statics:{_implements:function(t){return"ResizeLayoutController"==t}},props:{setInitBounds:function(){this.oldBounds_[this.group_.formaID]=this.group_.bounds},beginUpdateGroup:function(){this.startBounds_=this.group_.bounds,null==this.oldBounds_[this.group_.formaID]&&(this.oldBounds_[this.group_.formaID]=this.group_.bounds);for(var t=i.iter(this.group_.visitAsArray(s.FormaTraversal.JustChildren));!t.done;t.next()){var e=t.value;null==this.oldBounds_[e.formaID]&&(this.oldBounds_[e.formaID]=e.bounds)}},updateGroup:function(){if(null!=this.startBounds_){var t=this.startBounds_.size,e=this.group_.bounds.size,n=new c.TheoPoint(e.width/t.width,e.height/t.height),r=new l.FormaAnimationTransactionEvent(this.group_);this.group_.beginUpdate(r);for(var o=i.iter(this.group_.visitAsArray(s.FormaTraversal.JustChildren));!o.done;o.next()){var a,m,h,d=o.value;if(d.kind!=u.ImageForma.KIND&&d.kind!=f.VideoForma.KIND&&(a=d.frame)&&(m=this.oldBounds_[d.formaID])&&(h=this.oldBounds_[this.group_.formaID])&&a.area>0){var p=d.placement.transformValues,g=Math.abs(p.rotCosine)/(Math.abs(p.rotCosine)+Math.abs(p.rotSine)),v=Math.abs(p.rotSine)/(Math.abs(p.rotCosine)+Math.abs(p.rotSine)),C=new c.TheoPoint(n.x*g+n.y*v,n.x*v+n.y*g);if(null!=d.controller&&d.controller.maintainAspectRatio){var F=new c.TheoPoint(e.width/h.size.width,e.height/h.size.height),_=new c.TheoPoint(F.x*g+F.y*v,F.x*v+F.y*g),y=Math.min(_.x,_.y);d.bounds=m.scaleXY(y,y,new c.TheoPoint(0,0))}else d.bounds=i.opt(d.bounds,(function(t){return t.scaleXY(C.x,C.y,new c.TheoPoint(0,0))}));d.moveCenterToPoint(new c.TheoPoint(a.center.x*n.x,a.center.y*n.y))}}this.group_.endUpdate(r)}},endUpdateGroup:function(){}}}),r)},waL6:function(t,e,n){var r,o=e,i=n("oAGj"),a=n("gXiO"),s=n("6ZWm"),l=n("9Lk3"),u=n("ZK0l"),c=n("iCxV"),f=n("NkBu"),m=n("uxH+"),h=n("JO5d"),d=n("8t9B"),p=n("fGVU");o.FormaControllerFactory=(r=function(t){this.constructors_={},this.owner_=t,a.CoreObject.call(this),this.setConstructors()},i.defineClass({name:"FormaControllerFactory",ctor:r,superName:"CoreObject",props:{owner:{get:function(){return this.owner_},set:function(t){this.owner_=t,this.setConstructors()}},setConstructors:function(){var t=this;this.constructors_[u.GroupController.KIND]=function(e,n,r){return new u.GroupController(e,n,i.opt(t,(function(t){return t.owner_})))},this.constructors_[m.RootController.KIND]=function(e,n,r){return new m.RootController(e,n,i.opt(t,(function(t){return t.owner_})))},this.constructors_[s.FrameController.KIND]=function(e,n,r){return new s.FrameController(e,n,i.opt(t,(function(t){return t.owner_})))},this.constructors_[f.ImageController.KIND]=function(e,n,r){return new f.ImageController(e,n,i.opt(t,(function(t){return t.owner_})))},this.constructors_[p.VideoController.KIND]=function(e,n,r){return new p.VideoController(e,n,i.opt(t,(function(t){return t.owner_})))},this.constructors_[h.ShapeController.KIND]=function(e,n,r){return new h.ShapeController(e,n,i.opt(t,(function(t){return t.owner_})))},this.constructors_[d.TypeLockupController.KIND]=function(e,n,r){return new d.TypeLockupController(e,n,i.opt(t,(function(t){return t.owner_})))},this.constructors_[l.GridController.KIND]=function(e,n,r){return new l.GridController(e,n,i.opt(t,(function(t){return t.owner_})))},this.constructors_.AbsolutePositionController=function(e,n,r){return new m.RootController(e,n,i.opt(t,(function(t){return t.owner_})))},this.constructors_.responsive=function(e,n,r){return new u.GroupController(e,n,i.opt(t,(function(t){return t.owner_})))}},createController:function(t,e){var n=this.constructors_[t];return null==n?(i.opt(c.Host.logging,(function(e){return e.warning("createController: No constructor for kind "+t+" available.")})),null):n(t,e,this.owner_)}}}),r)},x7yN:function(t,e,n){var r,o=e,i=n("oAGj"),a=n("gXiO"),s=n("FNB+"),l=n("9Lk3"),u=n("oKlP");o.FitLayoutController=(r=function(t){this.group_=t,a.CoreObject.call(this)},i.defineClass({name:"FitLayoutController",ctor:r,superName:"CoreObject",statics:{_implements:function(t){return"ResizeLayoutController"==t}},props:{beginUpdateGroup:function(){this.oldBounds_=this.group_.bounds},updateGroup:function(){if(null!=this.oldBounds_){var t=this.oldBounds_.size,e=this.group_.bounds.size,n=new u.TheoPoint(e.width/t.width,e.height/t.height),r=Math.min(n.x,n.y),o=u.TheoPoint.ZERO;o=n.x>n.y?new u.TheoPoint(Math.max((e.width-t.width*r)/2,0),0):new u.TheoPoint(0,Math.max((e.height-t.height*r)/2,0));for(var a=i.iter(this.group_.visitAsArray(s.FormaTraversal.JustChildren));!a.done;a.next()){var c,f,m=a.value;(c=m.frame)&&c.area>0&&((f=i.as(m.controller,l.GridController))?f.resizeWithFit(this.group_.bounds,r,o):(m.bounds=i.opt(m.bounds,(function(t){return t.scale(r,new u.TheoPoint(0,0))})),m.moveCenterToPoint(new u.TheoPoint(c.center.x*r+o.x,c.center.y*r+o.y))))}}},endUpdateGroup:function(){}}}),r)}}]);
//# sourceMappingURL=vendors_npm_spark_fc608f14-13f83def.js.map