(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[36],{"+nk0":function(e,t,n){var o,r=t,i=n("oAGj"),a=n("gXiO");r.ControllerEvent=(o=function(e){this.type=e,a.CoreObject.call(this)},i.defineClass({name:"ControllerEvent",ctor:o,superName:"CoreObject"}),o)},"1HsO":function(e,t,n){var o,r,i,a,l,s,u,c,m,d,h=t,f=n("oAGj"),p=n("gXiO");h.BaseHandle=(o=function(){p.CoreObject.call(this)},f.defineClass({name:"BaseHandle",ctor:o,superName:"CoreObject"}),o),h.TransformType=f.defineEnum("TransformType",{None:0,RotateAboutCenter:1,Translate:2,ProportionalScaleAboutCenter:3,TopLeftCornerTranslate:4,TopRightCornerTranslate:5,BottomLeftCornerTranslate:6,BottomRightCornerTranslate:7,LeftSideTranslate:8,RightSideTranslate:9,TopSideTranslate:10,BottomSideTranslate:11,LetterSpacing:12,LineSpacing:13}),h.BoxReference=(r=function(e,t){this.placement=e,this.bounds=t},f.defineClass({name:"BoxReference",ctor:r,superName:"CoreObject"}),r),h.BoxHandleDisplayHint=f.defineEnum("BoxHandleDisplayHint",{ThinOutline:0,WideOutline:1,GroupOutlineColor:2,TextFrame:3,PreferLeftSideHandle:4,SuppressRotationHandle:5,SuppressTranslationHandle:6,SuppressResizeAnimation:7,CropMode:8}),h.BoxTransformHandles=(i=function(e,t,n,o,r){this.reference=e,this.allowedTransforms=f.clone(t),this.displayHints=f.clone(n),this.activeTransform=o,this.handlesTarget=r},f.defineClass({name:"BoxTransformHandles",ctor:i,superName:"BaseHandle"}),i),h.BoxTransformMultipleFormae=(a=function(e,t,n,o,r,i){this.formaIDs=f.clone(i),h.BoxTransformHandles.call(this,e,f.clone(t),f.clone(n),o,r)},f.defineClass({name:"BoxTransformMultipleFormae",ctor:a,superName:"BoxTransformHandles"}),a),h.HandleTransformStage=f.defineEnum("HandleTransformStage",{Begin:0,Update:1,End:2}),h.HandleTransformEvent=(l=function(e,t){this.viewportScale=1,this.handle=e,this.stage=t},f.defineClass({name:"HandleTransformEvent",ctor:l,superName:"CoreObject"}),l),h.TranslateTransformEvent=(s=function(e,t,n){this.event=n,h.HandleTransformEvent.call(this,e,t)},f.defineClass({name:"TranslateTransformEvent",ctor:s,superName:"HandleTransformEvent"}),s),h.MoveTransformEvent=(u=function(e,t,n){this.totalDelta=n,h.HandleTransformEvent.call(this,e,t)},f.defineClass({name:"MoveTransformEvent",ctor:u,superName:"HandleTransformEvent"}),u),h.RotateAboutCenterTransformEvent=(c=function(e,t,n,o){void 0===o&&(o=!0),this.totalDeltaRadians=n,this.doSnapping=o,h.HandleTransformEvent.call(this,e,t)},f.defineClass({name:"RotateAboutCenterTransformEvent",ctor:c,superName:"HandleTransformEvent"}),c),h.CornerTranslateTransformEvent=(m=function(e,t,n,o){this.transformType=n,this.position=o,h.HandleTransformEvent.call(this,e,t)},f.defineClass({name:"CornerTranslateTransformEvent",ctor:m,superName:"HandleTransformEvent"}),m),h.SideTranslateTransformEvent=(d=function(e,t,n,o){this.transformType=n,this.position=o,h.HandleTransformEvent.call(this,e,t)},f.defineClass({name:"SideTranslateTransformEvent",ctor:d,superName:"HandleTransformEvent"}),d)},"6NRR":function(e,t,n){var o,r,i,a=t,l=n("oAGj"),s=n("VQVe"),u=n("gXiO"),c=n("ascj"),m=n("FNB+"),d=n("URxh"),h=n("6ZWm"),f=n("cmoc"),p=n("P83h"),g=n("pnSN"),y=n("SDdr"),T=n("lmwz"),C=n("fNpk"),S=n("c+uM"),v=n("tGKA"),_=n("K17h"),F=n("djAF"),w=n("enh0"),A=n("8t9B"),E=n("90dd"),b=n("RkYL"),D=n("xm77"),I=n("zjod");a.KeyFrameSet=(o=function(){},l.defineClass({name:"KeyFrameSet",ctor:o}),o),a.AnimationRequestStopMessage=(r=function e(t){E.TheoMessage.call(this,e.TYPE,t)},l.defineClass({name:"AnimationRequestStopMessage",ctor:r,superName:"TheoMessage",statics:{TYPE:{get:function(){return"AnimationRequestStopMessage"}}}}),r),a.AnimationController=(i=function(e){this.staticStateTransaction_=null,this.document_=e,this.staticState_={},this.playing_=!1,this.postAnimationCallbacks_=null,u.CoreObject.call(this)},l.defineClass({name:"AnimationController",ctor:i,superName:"CoreObject",props:{playing:{get:function(){return this.playing_},set:function(e){this.playing_=e}},hasVideos:{get:function(){var e;return!!(e=this.document_)&&e.firstPage.root.filterWithCallback((function(e){return e instanceof I.VideoForma})).length>0}},hasTrueVideos:{get:function(){var e;return!!(e=this.document_)&&e.firstPage.root.filterWithCallback((function(e){var t;return!!(t=l.as(e,I.VideoForma))&&!t.isSticker()})).length>0}},hasAnimation:{get:function(){return this.hasVideos||this.hasAnimatedFormae}},hasAnimatedFormae:{get:function(){return null!=this.animationStyle&&!this.animationStyle.isNoStyle()&&0==!l.clone(this.document_.firstPage.root.filterWithCallback((function(e){return null!=e.animation||e.isVideo()}))).length}},gifStartTimeIndex:{get:function(){var e;if(e=this.animationStyle){var t=l.clone(this.document_.firstPage.root.filterWithCallback((function(e){return e instanceof I.VideoForma&&e.videoContentNode.isGIF})));if(0==t.length)return 0;for(var n=e.startTime.seconds,o=l.iter(t);!o.done;o.next()){var r,i=o.value;(r=l.opt(i.animation,(function(e){return e.keyFrames})))&&r.length>1&&(n=Math.max(n,r[1].time.seconds))}for(var a=l.clone(this.times),s=l.iter(l.range(0,a.length-1,!1));!s.done;s.next()){var u=s.value;if(n>=a[u].seconds&&n<a[u+1].seconds)return u}}return 0}},animationStyle:{get:function(){return _.MotionUtils.getCurrentAnimationStyle(this.document_)},set:function(e){var t,n=e;if(null==n&&(n=s.AnimationStyle.init_b946(s.AnimationStyle.NAME_NO_STYLE)),t=this.document_){var o=new p.AnimationStyleChangedEvent(t.firstPage.root);t.firstPage.root.beginUpdate(o),t.firstPage.animationLibrary.modifyModelForAnimation(n,t.firstPage.root),t.firstPage.root.endUpdate(o)}}},isCurrentAnimationValid:{get:function(){return _.MotionUtils.isCurrentAnimationValid(this.document_)}},duration:{get:function(){return l.last(this.times)||b.TheoTime.Zero}},times:{get:function(){var e;if(e=this.animationStyle){for(var t=[],n=e.endTime.value,o=l.toInt(e.endTime.timescale/s.AnimationStyle.DEFAULT_TIMESCALE),r=l.iter(l.stride(0,n,o));!r.done;r.next()){var i=r.value;t.push(new b.TheoTime(i,e.endTime.timescale))}return 0==t.length&&this.document_.firstPage.root.visitAll(m.FormaTraversal.PreOrder,(function(e){var n,o;(n=l.as(e,I.VideoForma))&&(o=l.opt(n.videoContentNode,(function(e){return e.times})))&&(t=l.clone(o))})),t}return[]}},preAnimation:function(){C.LegacyCoreAssert.isTrue(null==this.staticStateTransaction_,"preAnimation called with outstanding animation transaction",void 0,"AnimationController.preAnimation","AnimationController.swift",193),this.staticStateTransaction_=this.document_.beginTransaction("Animation")},postAnimation:function(){l.opt(this.staticStateTransaction_,(function(e){return e.rollback()})),this.staticStateTransaction_=null},processStopAnimationCallbacks:function(){var e;if(e=this.postAnimationCallbacks_){for(var t=l.iter(e);!t.done;t.next())(0,t.value)();this.postAnimationCallbacks_=null}},saveStaticState:function(){var e=this;this.staticState_={},this.document_.firstPage.root.visitAll(m.FormaTraversal.PreOrder,(function(t){if(null!=t.animation){var n=t.style.clone(),o=new d.KeyFrame(b.TheoTime.Zero,D.TimingFunctionType.Linear,t.placement,t.bounds,n);null!=n&&t.kind==I.VideoForma.KIND&&0==n.opacity&&l.info("opacity is 0?"),e.staticState_[t.formaID]=o}}))},revertToStaticState:function(){var e;if(null!=this.document_){if(e=this.staticState_)for(var t=l.iter(e);!t.done;t.next()){var n,o,r=t.key,i=t.value;if((n=l.opt(this.document_,(function(e){return e.firstPage.root.formaByID(r)})))&&i.style&&(o=l.as(n,w.TextForma))){var a=new p.FormaStyleChangedEvent(o);o.beginUpdate(a),o.renderRuns.clear(),o.endUpdate(a)}}}else C.LegacyCoreAssert.fail("no document. really?",void 0,"AnimationController.revertToStaticState","AnimationController.swift",238)},determineKeyFrameSetForTime:function(e,t){var n=new a.KeyFrameSet,o=e.keyFrames.length;if(o>0){for(var r=t.seconds,i=l.iter(l.toSequence(e.keyFrames));!i.done;i.next()){var s=i.value,u=s.offset,c=s.element;if(c.time.seconds>=r){n.kfB=c,u>0&&(n.kfA=e.keyFrames[u-1]);break}}null==n.kfB&&(n.kfA=e.keyFrames[o-1])}return n},determineAlpha:function(e,t){var n=1;if(null!=e.kfB&&null!=e.kfA){var o=new D.TheoTimingFunction(e.kfB.timingFunction),r=(t.seconds-e.kfA.time.seconds)/(e.kfB.time.seconds-e.kfA.time.seconds);n=o.evalX(r)}return n},determinePlacementShift:function(e,t){var n,o,r=v.Matrix2D.Identity;return(n=l.opt(e.kfA,(function(e){return e.placement})))?r=(o=l.opt(e.kfB,(function(e){return e.placement})))?n.interpolateWith(o,t):n:(o=l.opt(e.kfB,(function(e){return e.placement})))&&(r=o),r},moveToTime:function(e){var t=this;if(null==this.document_)return C.LegacyCoreAssert.fail("no document. really?",void 0,"AnimationController.moveToTime","AnimationController.swift",321),!1;if(null==this.staticState_)return C.LegacyCoreAssert.fail("no static state defined",void 0,"AnimationController.moveToTime","AnimationController.swift",326),!1;var n,o=!1,r=new p.FormaStyleChangedEvent(this.document_.firstPage.root);if(l.opt(this.document_,(function(e){return e.firstPage.beginUpdate(r)})),l.opt(this.document_,(function(n){return n.firstPage.root.visitAll(m.FormaTraversal.PreOrder,(function(n){var r,i;if((r=n.animation)&&(i=t.staticState_[n.formaID])){var a=t.determineKeyFrameSetForTime(r,e);if(null!=a.kfA||null!=a.kfB){o=!0;var u,c,d,C=t.determineAlpha(a,e),v=i.placement,_=t.determinePlacementShift(a,C);n.placement=v.concat(_),(u=l.opt(a.kfA,(function(e){return e.bounds})))&&(c=l.opt(a.kfB,(function(e){return e.bounds})))&&(u.equalWithAccuracy(c,.01)||(n.bounds=u.interpolateWith(c,C),(d=l.as(n.controller,h.FrameController))&&d.fitChildrenToFrame()));var E=l.opt(a.kfA,(function(e){return e.style})),b=l.opt(a.kfB,(function(e){return e.style}));if(null==E&&null==b)return;null==E?E=b:null==b&&(b=E);var D,I,R,L=new p.FormaStyleChangedEvent(n);if(n.beginUpdate(L),t.setBlendedRoles(n.style.colors,E.colors,b.colors,C),(D=l.as(E,S.LockupStyle))&&(I=l.as(b,S.LockupStyle))&&(R=l.as(n.style,S.LockupStyle)))for(var k=l.keys(R.characterStyles),x=l.iter(k);!x.done;x.next()){var P,M,G,K=x.value;(P=D.characterStyles[K])&&(M=I.characterStyles[K])&&(G=R.characterStyles[K])&&t.setBlendedRoles(G.colors,P.colors,M.colors,C)}var O,N=(1-C)*E.opacity+C*b.opacity,B=l.as(l.opt(l.opt(l.as(n,w.TextForma),(function(e){return e.lockupForma})),(function(e){return e.controller})),A.TypeLockupController);if(n.isTypeLockup()||null!=B){var z,U,Y,H=N,V=N;if((z=l.as(E,S.LockupStyle))&&(U=l.as(b,S.LockupStyle))&&(H=(1-C)*z.textOpacity+C*U.textOpacity,V=(1-C)*z.backingOpacity+C*U.backingOpacity),n.kind==F.ShapeForma.KIND)l.opt(n.parent,(function(e){return e.style.opacity=V}));else if(Y=l.as(n,w.TextForma))if(r.animationStyle.modifiesFormaTree){n.style.opacity=H;var W=(a.kfB||a.kfA).renderRuns;null!=a.kfB&&null!=a.kfA&&a.kfA.renderRuns.fillColors.runArrays.length>1&&0==W.fillColors.runArrays.length?Y.renderRuns.setAlphaFromAnimation(a.kfA.renderRuns,W,C):Y.renderRuns=W.clone()}else n.style.opacity=H;else n.kind==g.GroupForma.KIND&&n.visitAll(m.FormaTraversal.PreOrder,(function(e){e instanceof w.TextForma&&l.opt(e.parent,(function(e){return e.style.opacity=H})),e instanceof F.ShapeForma&&l.opt(e.parent,(function(e){return e.style.opacity=V}))}))}else if(n.kind==f.FrameForma.KIND){var q;(q=T.ImageFacade.getImageFormaForForma(n))&&(q.style.opacity=N)}else n.style.opacity=N;if(null!=E.filter&&null!=b.filter)if(r.animationStyle.name==s.AnimationStyle.NAME_BLUR){if(O=E.clone()){O.colorLibrary=E.colorLibrary;var j=E.filter.blurRadius,X=b.filter.blurRadius;O.filter.blurRadius=(1-C)*j+C*X,n.applyStyle(O)}}else if(!l.opt(E.filter,(function(e){return e.equals(b.filter)}))){var Z=y.AlphaBlendFilter.init_fa22(void 0,C,E.filter,b.filter);Z.style=n.style,n.style.filter=Z}n.endUpdate(L)}}}))})),n=l.opt(this.document_,(function(e){return e.firstPage.root}))){var i=new p.AnimationTimeChangedEvent(n,e);n.beginUpdate(i),n.endUpdate(i)}return l.opt(this.document_,(function(e){return e.firstPage.endUpdate(r)})),o},setBlendedRoles:function(e,t,n,o){var r,i;(r=t.fieldPrimary)&&(i=n.fieldPrimary)&&e.setBlendedColor(c.ColorRole.FieldPrimary,r,i,o),(r=t.fieldSecondary)&&(i=n.fieldSecondary)&&e.setBlendedColor(c.ColorRole.FieldSecondary,r,i,o)},stopWithCallback:function(e){var t;if(this.playing_){if(null==this.postAnimationCallbacks_?this.postAnimationCallbacks_=[e]:this.postAnimationCallbacks_.push(e),t=l.opt(this.document_,(function(e){return e.firstPage}))){var n=new a.AnimationRequestStopMessage(t);t.publish(n)}}else e()}}}),i)},AVHO:function(e,t,n){var o,r,i,a,l,s=t,u=n("oAGj"),c=n("gXiO");s.ControllerSettings=(o=function(e){this.type=e,c.CoreObject.call(this)},u.defineClass({name:"ControllerSettings",ctor:o,superName:"CoreObject"}),o),s.TypeLockupControllerSettings=(r=function e(t){this.controller=t,s.ControllerSettings.call(this,e.TYPE)},u.defineClass({name:"TypeLockupControllerSettings",ctor:r,superName:"ControllerSettings",statics:{TYPE:{get:function(){return"TypeLockupControllerSettings"}}}}),r),s.ImageControllerSettings=(i=function e(t){this.controller=t,s.ControllerSettings.call(this,e.TYPE)},u.defineClass({name:"ImageControllerSettings",ctor:i,superName:"ControllerSettings",statics:{TYPE:{get:function(){return"ImageControllerSettings"}}}}),i),s.RootControllerSettings=(a=function e(t){this.controller=t,s.ControllerSettings.call(this,e.TYPE)},u.defineClass({name:"RootControllerSettings",ctor:a,superName:"ControllerSettings",statics:{TYPE:{get:function(){return"RootControllerSettings"}}}}),a),s.ShapeControllerSettings=(l=function e(t){this.controller=t,s.ControllerSettings.call(this,e.TYPE)},u.defineClass({name:"ShapeControllerSettings",ctor:l,superName:"ControllerSettings",statics:{TYPE:{get:function(){return"ShapeControllerSettings"}}}}),l)},AnBp:function(e,t,n){var o,r,i,a,l,s,u=t,c=n("oAGj"),m=n("umUn");u.IEditorAttribute=c.defineProtocol("IEditorAttribute",{key:"String",isEqualTo:"(IEditorAttribute) -> Boolean"}),u.EditorAttributeBase=(o=function(e){this._key=e},c.defineClass({name:"EditorAttributeBase",ctor:o,superName:"CoreObject",props:{key:{get:function(){return this._key}}}}),o),u.ColorAttribute=(r=function e(t){this.colors=c.clone(t),u.EditorAttributeBase.call(this,e.KEY)},c.defineClass({name:"ColorAttribute",ctor:r,superName:"EditorAttributeBase",statics:{KEY:"color",_implements:function(e){return"IEditorAttribute"==e}},props:{isEqualTo:function(e){var t;if(t=c.as(e,r)){if(this.colors.length!=t.colors.length)return!1;for(var n=c.iter(c.range(0,this.colors.length,!1));!n.done;n.next()){var o=n.value;if(!c.eq(m._equality_TheoColor_TheoColor,this.colors[o],t.colors[o]))return!1}return!0}return!1}}}),r),u.OpacityAttribute=(i=function e(t){this.opacities=c.clone(t),u.EditorAttributeBase.call(this,e.KEY)},c.defineClass({name:"OpacityAttribute",ctor:i,superName:"EditorAttributeBase",statics:{KEY:"opacity",_implements:function(e){return"IEditorAttribute"==e}},props:{isEqualTo:function(e){var t;if(t=c.as(e,i)){if(this.opacities.length!=t.opacities.length)return!1;for(var n=c.iter(c.range(0,this.opacities.length,!1));!n.done;n.next()){var o=n.value;if(this.opacities[o]!=t.opacities[o])return!1}return!0}return!1}}}),i),u.MediaMetadataAttribute=(a=function e(t){this.mmds=c.clone(t),u.EditorAttributeBase.call(this,e.KEY)},c.defineClass({name:"MediaMetadataAttribute",ctor:a,superName:"EditorAttributeBase",statics:{KEY:"mediaMetadata",_implements:function(e){return"IEditorAttribute"==e}},props:{isEqualTo:function(e){var t;if(t=c.as(e,a)){if(this.mmds.length!=t.mmds.length)return!1;for(var n=c.iter(c.range(0,this.mmds.length,!1));!n.done;n.next()){var o=n.value;if(!this.mmds[o].isEqualTo(t.mmds[o]))return!1}return!0}return!1}}}),a),u.ControllerSettingAttribute=(l=function e(t){this.settings=c.clone(t),u.EditorAttributeBase.call(this,e.KEY)},c.defineClass({name:"ControllerSettingAttribute",ctor:l,superName:"EditorAttributeBase",statics:{KEY:"controllerSetting",_implements:function(e){return"IEditorAttribute"==e}},props:{isEqualTo:function(e){var t;if(t=c.as(e,l)){if(this.settings.length!=t.settings.length)return!1;for(var n=c.iter(c.range(0,this.settings.length,!1));!n.done;n.next()){var o=n.value;if(this.settings[o].type!=t.settings[o].type)return!1}return!0}return!1}}}),l),u.ImageAttribute=(s=function e(t){this.styles=c.clone(t),u.EditorAttributeBase.call(this,e.KEY)},c.defineClass({name:"ImageAttribute",ctor:s,superName:"EditorAttributeBase",statics:{KEY:"imageAttr",_implements:function(e){return"IEditorAttribute"==e}},props:{isEqualTo:function(e){var t;if(t=c.as(e,s)){if(this.styles.length!=t.styles.length)return!1;for(var n=c.iter(c.range(0,this.styles.length,!1));!n.done;n.next()){var o=n.value;if(!this.styles[o].equals(t.styles[o]))return!1}return!0}return!1}}}),s)},Bpjk:function(e,t,n){var o,r,i,a=t,l=n("oAGj"),s=n("gXiO");a.CropRatioPreset=(o=function(e,t,n,o,r){this.label=e,this.secondaryLabel=t,this.id=n,this.iconId=o,this.aspectRatio=r},l.defineClass({name:"CropRatioPreset",ctor:o,superName:"CoreObject"}),o),a.CropRatioPresetLibrary=(r=function(){s.CoreObject.call(this)},i={},l.defineClass({name:"CropRatioPresetLibrary",ctor:r,superName:"CoreObject",statics:{FREEFORM_ID:"Free",ORIGINAL_ID:"Original",NONE_ID:"None",FREECROP_PRESET:{get:function(){return void 0===i.FREECROP_PRESET&&(i.FREECROP_PRESET=new a.CropRatioPreset("k_Crop_Freeform","",r.FREEFORM_ID,"CropPaneFreeform",1)),i.FREECROP_PRESET}},ORIGINAL_SIZE_PRESET:{get:function(){return void 0===i.ORIGINAL_SIZE_PRESET&&(i.ORIGINAL_SIZE_PRESET=new a.CropRatioPreset("k_Crop_Original","",r.ORIGINAL_ID,"",0)),i.ORIGINAL_SIZE_PRESET}},ratios:{get:function(){return void 0===i.ratios&&(i.ratios=[new a.CropRatioPreset("k_Crop_Square","k_1_1_label","1:1","",1),new a.CropRatioPreset("","k_4_3_label","4:3","",1.33333333333),new a.CropRatioPreset("","k_3_4_label","3:4","",.75),new a.CropRatioPreset("","k_16_9_label","16:9","",1.77777777778),new a.CropRatioPreset("","k_9_16_label","9:16","",.5625)]),i.ratios}},getListOfRatios:function(){return r.ratios},getIdForRatio:function(e){var t=r.ratios.filter((function(t){return t.aspectRatio==e}),this);return 0==t.length?null:t[0].id}}}),r)},"G/OM":function(e,t,n){var o,r,i,a,l,s,u,c=t,m=n("oAGj");c.IFeatureSet=m.defineProtocol("IFeatureSet",{key:"String",isEqualTo:"(IFeatureSet) -> Boolean"}),c.FeatureSetBase=(o=function(e){this._key=e},m.defineClass({name:"FeatureSetBase",ctor:o,superName:"CoreObject",props:{key:{get:function(){return this._key}}}}),o),c.TextFrameAttributesFeature=(r=function e(){c.FeatureSetBase.call(this,e.KEY)},m.defineClass({name:"TextFrameAttributesFeature",ctor:r,superName:"FeatureSetBase",statics:{KEY:"TextFrameAttributesFeature",_implements:function(e){return"IFeatureSet"==e}},props:{isEqualTo:function(e){return e instanceof r}}}),r),c.AlignSpacingAttributesFeature=(i=function e(t,n,o,r){this.canAlign=t,this.canDistribute=n,this.canDoRow=o,this.canDoColumn=r,c.FeatureSetBase.call(this,e.KEY)},m.defineClass({name:"AlignSpacingAttributesFeature",ctor:i,superName:"FeatureSetBase",statics:{KEY:"AlignSpacingAttributesFeature",find:function(e){return m.as(e.find(i.KEY),i)},_implements:function(e){return"IFeatureSet"==e}},props:{isEqualTo:function(e){var t;return!!(t=m.as(e,i))&&t.canAlign==this.canAlign&&t.canDistribute==this.canDistribute&&t.canDoRow==this.canDoRow&&t.canDoColumn==this.canDoColumn}}}),i),c.FormaEditFeature=(a=function e(t,n,o,r,i,a,l,s){this.canMultiselect=t,this.canDuplicate=n,this.canGroup=o,this.canUngroup=r,this.canRecolor=i,this.canDelete=a,this.canEditSettings=l,this.supportsMultiStyle=s,c.FeatureSetBase.call(this,e.KEY)},m.defineClass({name:"FormaEditFeature",ctor:a,superName:"FeatureSetBase",statics:{KEY:"FormaEditFeature",_implements:function(e){return"IFeatureSet"==e}},props:{isEqualTo:function(e){var t;return!!(t=m.as(e,a))&&t.canMultiselect==this.canMultiselect&&t.canDuplicate==this.canDuplicate&&t.canGroup==this.canGroup&&t.canUngroup==this.canUngroup&&t.canRecolor==this.canRecolor&&t.canDelete==this.canDelete&&t.canEditSettings==this.canEditSettings&&t.supportsMultiStyle==this.supportsMultiStyle}}}),a),c.OpacityAttributesFeature=(l=function e(){c.FeatureSetBase.call(this,e.KEY)},m.defineClass({name:"OpacityAttributesFeature",ctor:l,superName:"FeatureSetBase",statics:{KEY:"OpacityAttributesFeature",_implements:function(e){return"IFeatureSet"==e}},props:{isEqualTo:function(e){return e instanceof l}}}),l),c.ImageFeature=(s=function e(t,n,o,r,i,a,l,s){this.canApplyFilter=t,this.canReplace=n,this.hasLicense=o,this.canCrop=r,this.canSetBackground=i,this.canSetFloating=a,this.canApplyBackgroundColor=l,this.canApplyCutout=s,c.FeatureSetBase.call(this,e.KEY)},m.defineClass({name:"ImageFeature",ctor:s,superName:"FeatureSetBase",statics:{KEY:"ImageFeature",_implements:function(e){return"IFeatureSet"==e}},props:{isEqualTo:function(e){var t;return!!(t=m.as(e,s))&&t.canApplyFilter==this.canApplyFilter&&t.canReplace==this.canReplace&&t.hasLicense==this.hasLicense&&t.canCrop==this.canCrop&&t.canSetBackground==this.canSetBackground&&t.canSetFloating==this.canSetFloating&&t.canApplyBackgroundColor==this.canApplyBackgroundColor&&t.canApplyCutout==this.canApplyCutout}}}),s),c.VideoAttributesFeature=(u=function e(){c.FeatureSetBase.call(this,e.KEY)},m.defineClass({name:"VideoAttributesFeature",ctor:u,superName:"FeatureSetBase",statics:{KEY:"VideoAttributesFeature",_implements:function(e){return"IFeatureSet"==e}},props:{isEqualTo:function(e){return e instanceof u}}}),u)},KSe6:function(e,t,n){var o,r,i=t,a=n("oAGj"),l=n("VQVe"),s=n("gXiO"),u=n("C42b"),c=n("ascj"),m=n("FNB+"),d=n("URxh"),h=n("6ZWm"),f=n("cmoc"),p=n("P83h"),g=n("9Lk3"),y=n("pnSN"),T=n("53P9"),C=n("ZhwN"),S=n("iCxV"),v=n("NkBu"),_=n("fdtz"),F=n("SDdr"),w=n("lmwz"),A=n("uWOl"),E=n("fNpk"),b=n("c+uM"),D=n("tGKA"),I=n("pmb0"),R=n("K17h"),L=n("K0Rh"),k=n("Zifs"),x=n("djAF"),P=n("enh0"),M=n("8t9B"),G=n("3UhB"),K=n("oKlP"),O=n("uUew"),N=n("RkYL"),B=n("xm77"),z=n("zjod"),U=n("mxdD");i.AnimationLibrary=(o=function e(){s.CoreObject.call(this);for(var t=a.clone(I.MotionFacade.createAllAnimationStyles()),n=a.iter(t);!n.done;n.next()){var o=n.value;e.animationStyles.push(o)}},r={},a.defineClass({name:"AnimationLibrary",ctor:o,superName:"CoreObject",statics:{animationStyles:{get:function(){return void 0===r.animationStyles&&(r.animationStyles=[l.AnimationStyle.init_b946(l.AnimationStyle.NAME_NO_STYLE),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_TYPE,0,2,l.AnimationStyleCategory.Text),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_DYNAMIC,0,4,l.AnimationStyleCategory.Text),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_FLICKER,0,2,l.AnimationStyleCategory.Text),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_COLORSWAP,0,3,l.AnimationStyleCategory.Text),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_FADE,0,3,l.AnimationStyleCategory.Text),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_SLIDE,0,3,l.AnimationStyleCategory.Text),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_GROW,0,2,l.AnimationStyleCategory.Text),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_ZOOM,0,2,l.AnimationStyleCategory.Image),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_PAN,0,2,l.AnimationStyleCategory.Image),l.AnimationStyle.init_b946(l.AnimationStyle.NAME_GRAYSCALE,l.AnimationStyleCategory.Image),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_BLUR,0,1,l.AnimationStyleCategory.Image),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_COLOR,0,5,l.AnimationStyleCategory.Image),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_FILL,0,5,l.AnimationStyleCategory.Image)]),r.animationStyles},set:function(e){r.animationStyles=e}},determineAnalyticName:function(e){var t="";if(e=e){switch(e.name){case"Type":t="Typewriter";break;case"ColorSwap":t="ColorShuffle";break;default:t=e.name}t=(t+e.variant).toLowerCase()}else t=(l.AnimationStyle.NAME_NO_STYLE+0).toLowerCase();return t},getDisplayableAnimationStyles:function(e){var t=!1,n=!1,r=!1,i=!1,s=!1,u=!1,c=!1,d=!1,f=!1,p=0;e.visitAll(m.FormaTraversal.PreOrder,(function(e){var o,l,m,y,T;if((o=a.as(e.controller,h.FrameController))&&(s=s||!e.isLogo()&&!e.isSticker(),e.isGridCell()&&!o.floating&&o.hasCutout&&(c=!0)),null!=U.VideoFacade.getTrueVideoFormaForForma(e)&&(u=!0),g.GridController.isBackgroundColoredCell(e)&&(c=!0),d||(d=g.GridController.hasLayoutPadding(e)),e.kind==P.TextForma.KIND&&(t=!0),(l=w.ImageFacade.getImageFormaForForma(e))&&(m=a.as(l.style,A.ImageStyle))&&m.isColorizedFilter&&(f=!0),(y=a.as(e.style,b.LockupStyle))&&(T=a.as(e.controller,M.TypeLockupController))){y.backing==b.LockupBacking.Knockout&&(n=!0),!S.Host.textModelUtils.usePGMRenderer()&&b.LockupStyle.isKnockoutLook(y.textLook)||(r=!0);var C=T.getCurrentFontSize();!i&&p>0&&Math.abs(C-p)/Math.min(C,p)>=.05&&(i=!0),p=Math.max(p,C)}}));for(var y=[],T=a.iter(o.animationStyles);!T.done;T.next()){var C=T.value;if((t||C.name!=l.AnimationStyle.NAME_FLICKER&&C.name!=l.AnimationStyle.NAME_DYNAMIC&&C.name!=l.AnimationStyle.NAME_TYPE)&&(!C.imageStyle||s&&!u)&&(t||!C.textStyle)){var v=C.clone();C.name==l.AnimationStyle.NAME_GROW&&n?v.variantCount=3:(C.name!=l.AnimationStyle.NAME_GROW||r&&i)&&(C.name!=l.AnimationStyle.NAME_SLIDE||r)?C.name!=l.AnimationStyle.NAME_DYNAMIC||r?C.name!=l.AnimationStyle.NAME_COLORSWAP||c||f||d||(v.variantCount=2):v.variantCount=3:v.variantCount=1,y.push(v)}}return y},isPremiumAnimationStyle:function(e){return e.name==l.AnimationStyle.NAME_TYPE&&2==e.variant||e.name==l.AnimationStyle.NAME_FLICKER&&2==e.variant||e.name==l.AnimationStyle.NAME_DYNAMIC&&0==e.variant},isAnimationStyleApplicable:function(e,t){var n,r=!1;if(n=a.as(t.firstPage.root,L.RootForma))for(var i=a.clone(o.getDisplayableAnimationStyles(n)),l=a.iter(i);!l.done;l.next())if(l.value.name==e.name){r=!0;break}return r},extendToIntegralCount:function(e,t,n){E.LegacyCoreAssert.isTrue(0!=t,"sub-duration to loop should be non-zero",void 0,"AnimationLibrary.extendToIntegralCount","AnimationLibrary.swift",2841),E.LegacyCoreAssert.isTrue(0!=n,"time scale should be non-zero",void 0,"AnimationLibrary.extendToIntegralCount","AnimationLibrary.swift",2842);var o=e/t,r=Math.ceil(o),i=Math.floor(o);return o-i<1/a.toDouble(n)&&(r=i),N.TheoTime.fromSeconds(r*t,n)},updateCurrentStyle:function(e,t){var n,r,i;void 0===t&&(t=!1),(n=R.MotionUtils.getCurrentAnimationStyle(e))&&(n.isNoStyle()&&!t||((r=a.as(e.firstPage.root,L.RootForma))?(i=o.isAnimationStyleApplicable(n,e)?n:e.firstPage.animationLibrary.getAnimationStyle(l.AnimationStyle.NAME_NO_STYLE))&&e.firstPage.animationLibrary.setRootAnimationStyle(i,r):a.opt(S.Host.logging,(function(e){return e.warning("Missing root")}))))}},props:{getAnimationStyle:function(e){for(var t,n=a.iter(o.animationStyles);!n.done;n.next()){var r=n.value;if(e==r.name){t=r;break}}return t},getNextAnimationStyleOfSameType:function(e){var t=e.clone();return t.variantCount>0&&(t.variant=(t.variant+1)%t.variantCount),t},getNoneStyle:function(){return this.getAnimationStyle(l.AnimationStyle.NAME_NO_STYLE)},getAllAnimationStyles:function(){return o.animationStyles},setStillAnimation:function(e,t,n,o){void 0===n&&(n=null),void 0===o&&(o=null);var r=n||t.startTime,i=o||t.endTime,a=[];a.push(new d.KeyFrame(r,B.TimingFunctionType.Linear)),a.push(new d.KeyFrame(i,B.TimingFunctionType.Linear)),e.animation=d.FormaAnimation.init_9e82(t,r,i,a.concat())},setScaleForma:function(e,t,n,o,r,i,l){var s,u=new K.TheoPoint(1,1),c=e.style.clone(),m=e.style.clone();(s=a.as(e.style,b.LockupStyle))&&s.backing==b.LockupBacking.Knockout&&2==t.variant?(m=R.MotionUtils.createOpacityStyle(e,0),u=new K.TheoPoint(20,20)):c=R.MotionUtils.createOpacityStyle(e,0);var h=e.frame,f=e.placement.inverse.transformPoint(h.eval(o)),p=D.Matrix2D.scaling(n),g=e.placement.concat(p).transformPoint(f),y=h.center.subtract(g),T=D.Matrix2D.scaling(u),C=e.placement.concat(T).transformPoint(f),S=h.center.subtract(C),v=[],_=D.Matrix2D.scaling(n).translate(y),F=D.Matrix2D.scaling(u).translate(S),w=i,A=l;if(2==t.variant){v.push(new d.KeyFrame(i,r,_,null,c));var E=new N.TheoTime(t.endTime.timescale,t.endTime.timescale);w=i.add(E),A=l.add(E)}v.push(new d.KeyFrame(w,r,_,null,c)),v.push(new d.KeyFrame(A,r,F,null,m)),e.animation=d.FormaAnimation.init_9e82(t,i,A,v.concat())},setGrowAnimation:function(e,t,n){if(1==t.variant||1==t.variantCount){var o=t.endTime.multiply(2/3);this.setScaleForma(e,t,new K.TheoPoint(.8,.8),new K.TheoPoint(.5,.5),B.TimingFunctionType.EaseOut,t.startTime,o)}else if(0==t.variant){var r=t.endTime.subtract(l.AnimationStyle.FADE_DURATION);a.containsEq(n,e,m._equality_Forma_Forma)?this.setScaleForma(e,t,new K.TheoPoint(.75,.75),new K.TheoPoint(.5,.5),B.TimingFunctionType.EaseOut,t.startTime,r):this.setFormaFade(e,t,t.startTime,t.endTime,r)}else 2==t.variant&&this.setScaleForma(e,t,new K.TheoPoint(1,1),new K.TheoPoint(.5,.5),B.TimingFunctionType.EaseOut,t.startTime,t.endTime)},getCenteredTransform:function(e,t,n){var o=e.parent.frame.center.subtract(new K.TheoPoint(e.parent.frame.minX,e.parent.frame.minY)),r=e.placement.inverse.transformPoint(o),i=D.Matrix2D.scalingXY(t,t),a=e.placement.concat(i).transformPoint(r),l=o.subtract(a);return D.Matrix2D.scalingXY(t,t).translate(l.add(n))},setImageAnimation:function(e,t,n,o,r){var i=w.ImageFacade.getFrameFormaForForma(e);if(!e.isLogo()&&!e.isSticker()){for(var l=1,s=e.placement,u=a.iter(o);!u.done;u.next()){var c=u.value,m=c[1],f=c[2],p=this.getCenteredTransform(e,f,m);e.placement=s,e.move(p);var g,y=e.placement;(g=a.as(a.opt(i,(function(e){return e.controller})),h.FrameController))&&g.fitChildrenToFrame();var T=e.placement.transformValues.xscale-y.transformValues.xscale,C=new K.TheoPoint(e.placement.tx-y.tx,e.placement.ty-y.ty);if(e.placement=s,r&&(C.length()>1||T>0)){var S=e.frame;f*(l=Math.max(l,1+T+3*Math.max(Math.abs(C.x)/S.width,Math.abs(C.y)/S.height)))<1&&(l=1/f)}for(var v=[],_=a.iter(o);!_.done;_.next()){var F=_.value,A=F[0],E=(m=F[1],f=F[2],this.getCenteredTransform(e,f*l,m));v.push(new d.KeyFrame(A,n,E,null,null))}e.animation=d.FormaAnimation.init_9e82(t,t.startTime,t.endTime,v.concat())}v=[];for(var b=a.iter(o);!b.done;b.next()){var D=b.value;A=D[0],m=D[1],f=D[2],E=this.getCenteredTransform(e,f*l,m),v.push(new d.KeyFrame(A,n,E,null,null))}e.animation=d.FormaAnimation.init_9e82(t,t.startTime,t.endTime,v.concat())}},applyLineFadeIn:function(e,t,n,o,r){var i,l=o.subtract(n),s=r;s.seconds*a.toDouble(e.length)>l.seconds/2&&(s=l.multiply(1/a.toDouble(2*e.length)));for(var u=l.subtract(s.multiply(a.toDouble(e.length))),c=n,m=a.iter(e);!m.done;m.next()){var d=m.value,h=(c=c.add(s)).add(u);this.setFormaAnimations(a.clone(d),t,0,(i=a.opt(a.first(d),(function(e){return e.style.opacity})))||null!=i?i:1,D.Matrix2D.Identity,B.TimingFunctionType.EaseInOut,n,c,h)}},setFadeAnimationTopDown:function(e,t){for(var n=[],o=a.iter(e);!o.done;o.next()){var r=o.value;r.isTypeLockup()&&n.push(r)}if(0==!n.length){for(var i=a.clone(R.MotionUtils.getTitleLockups(a.clone(n))),s=a.clone(i[0]),u=a.clone(i[1]),c=[],m=[],d=a.iter(s);!d.done;d.next()){var h=d.value,f=a.clone(R.MotionUtils.findTextLines2(h));if(0==!f.length)for(var p=a.iter(f);!p.done;p.next()){var g=p.value;m.push(g)}}m=a.clone(R.MotionUtils.sortTextLines(a.clone(m)));for(var y=a.iter(m);!y.done;y.next())g=y.value,c.push(a.clone(g.words));var T=new N.TheoTime(a.toInt(.25*a.toDouble(t.endTime.timescale)),t.endTime.timescale);this.applyLineFadeIn(a.clone(c),t,t.startTime,t.endTime,T);for(var C=t.endTime.subtract(l.AnimationStyle.FADE_DURATION),S=a.iter(u);!S.done;S.next()){var v=S.value;this.setFormaFade(v,t,t.startTime,t.endTime,C)}}},setFadeAnimation:function(e,t,n){var o;if(2==t.variant||1==t.variantCount){var r;if(a.as(e.controller,M.TypeLockupController)&&(r=a.opt(a.as(e,y.GroupForma),(function(e){return e.childAt(0)}))))this.setFormaAnimations([r],t,.05,e.style.opacity,D.Matrix2D.Identity,B.TimingFunctionType.EaseOut,t.startTime,t.startTime,t.endTime);else{var i=[];e.visitAll(m.FormaTraversal.PreOrder,(function(e){(e instanceof P.TextForma||e instanceof x.ShapeForma)&&i.push(e)})),e.isImage()&&(i=[e]),this.setFormaAnimations(a.clone(i),t,.05,e.style.opacity,D.Matrix2D.Identity,B.TimingFunctionType.EaseOut,t.startTime,t.startTime,t.endTime)}}else{var s=t.endTime.subtract(l.AnimationStyle.FADE_DURATION);if(a.containsEq(n,e,m._equality_Forma_Forma)){var u,c=!1;if(S.Host.textModelUtils.usePGMRenderer()||(u=a.as(e.controller,M.TypeLockupController))&&a.opt(u.lockupStyle,(function(e){return e.textLook==b.LockupTextLook.KnockoutOnly}))&&(c=!0),0==t.variant)c&&(u=a.as(e.controller,M.TypeLockupController))&&this.modifyLockupForAnimation(u,c),this.setLineAnimation(e,t,D.Matrix2D.Identity,B.TimingFunctionType.EaseInOut,t.startTime,t.endTime,new N.TheoTime(a.toInt(.25*a.toDouble(t.endTime.timescale)),t.endTime.timescale)),this.setStillAnimation(e,t);if(1==t.variant&&(u=a.as(e.controller,M.TypeLockupController))){this.modifyLockupForAnimation(u,c);for(var h=[],f=a.iter(e.visitAsArray(m.FormaTraversal.PreOrder));!f.done;f.next()){var p,g=f.value;(p=a.as(g,P.TextForma))&&h.push(p)}for(var T=e.finalFrame,C=a.iter(h);!C.done;C.next()){var v=C.value,_=.8*(v.finalFrame.center.x-T.minX)/T.width+.1;E.LegacyCoreAssert.isTrue(_<=1,"Unexpected text forma position encountered when setting fade animation",void 0,"AnimationLibrary.setFadeAnimation","AnimationLibrary.swift",691);var F=R.MotionUtils.createOpacityStyle(v,0),w=v.style;if(c){var A=(o=a.opt(a.as(a.opt(v.lockupForma,(function(e){return e.style})),b.LockupStyle),(function(e){return e.backingOpacity})))||null!=o?o:v.style.opacity;w=R.MotionUtils.createOpacityStyle(v,A)}var I=[],L=s.subtract(t.startTime).seconds*_,k=t.startTime.addSeconds(L),G=k.addSeconds(1);c?(I.push(new d.KeyFrame(t.startTime,B.TimingFunctionType.Linear,D.Matrix2D.Identity,null,w)),I.push(new d.KeyFrame(k,B.TimingFunctionType.Linear,D.Matrix2D.Identity,null,w)),I.push(new d.KeyFrame(G,B.TimingFunctionType.Linear,D.Matrix2D.Identity,null,F))):(I.push(new d.KeyFrame(t.startTime,B.TimingFunctionType.Linear,D.Matrix2D.Identity,null,F)),I.push(new d.KeyFrame(k,B.TimingFunctionType.Linear,D.Matrix2D.Identity,null,F)),I.push(new d.KeyFrame(G,B.TimingFunctionType.Linear,D.Matrix2D.Identity,null,w))),v.animation=d.FormaAnimation.init_9e82(t,t.startTime,G,I.concat())}this.setStillAnimation(e,t,null,s)}}else this.setFormaFade(e,t,t.startTime,t.endTime,s)}},setLineAnimation:function(e,t,n,o,r,i,l){var s,u,c=(s=a.opt(a.as(e.style,b.LockupStyle),(function(e){return e.textLook})))||null!=s?s:b.LockupTextLook.Fill,m=!S.Host.textModelUtils.usePGMRenderer()&&c==b.LockupTextLook.KnockoutOnly,d=b.LockupStyle.isKnockoutLook(c)&&!m&&!S.Host.textModelUtils.usePGMRenderer(),h=a.clone(R.MotionUtils.findTextLines(e)),f=i.subtract(r),p=l;p.seconds*a.toDouble(h.length)>f.seconds/2&&(p=f.multiply(1/a.toDouble(2*h.length)));var g=f.subtract(p.multiply(a.toDouble(h.length))),y=0,T=m?0:e.style.opacity;m&&(y=(u=a.opt(a.as(e.style,b.LockupStyle),(function(e){return e.backingOpacity})))||null!=u?u:e.style.opacity);var C=r;if(!d)for(var v=a.iter(h);!v.done;v.next()){var _=v.value,F=(C=C.add(p)).add(g);this.setFormaAnimations(a.clone(_),t,y,T,n,o,r,C,F)}var w=i.multiply(.5),A=a.clone(e.filterWithCallback((function(e){return e instanceof x.ShapeForma||e instanceof P.TextForma&&d})));m||this.setFormaAnimations(a.clone(A),t,y,T,D.Matrix2D.Identity,o,r,r,w)},setColorSwapAnimation:function(e,t,n){var o,r,i,s;if(void 0===n&&(n=null),0!=e.length){var m=e[0].page,f=new p.FormaStyleChangedEvent(m.root);m.beginUpdate(f);for(var y=0==t.variant||1==t.variant,T=[],C=a.iter(e);!C.done;C.next()){var F,b,I,R=C.value;E.LegacyCoreAssert.isFalse(R instanceof P.TextForma,"color swap animation: formae to color should not include text formae",void 0,"AnimationLibrary.setColorSwapAnimation","AnimationLibrary.swift",810),null!=R.controller&&R.kind!=L.RootForma.KIND&&((F=a.as(R.controller,g.GridController))?F.isBackgroundVisible()&&!y&&T.push(R.root):y&&!R.controller.moveable||((b=w.ImageFacade.getImageFormaForForma(R))?((I=a.as(b.style,A.ImageStyle))&&I.isColorizedFilter&&T.push(b),((o=a.opt(a.as(R.controller,h.FrameController),(function(e){return e.hasBackgroundColor})))||null!=o)&&o&&T.push(R)):T.push(R)))}T=a.sort(T,(function(e,t){return!(!(r=a.opt(e.controller,(function(e){return e.moveable})))&&null==r||!r)&&null!=(n=a.opt(e.parent,(function(t){return t.indexOfChild(e)})))&&null!=(o=a.opt(t.parent,(function(e){return e.indexOfChild(t)})))&&n<o;var n,o})),t.endTime=n||l.AnimationStyle.COLOR_SWAP_DURATION;for(var G=0==t.variant||2==t.variant?B.TimingFunctionType.Step1:B.TimingFunctionType.Linear,K=1==t.variant?.75:.5,O=a.toInt(a.toDouble(t.endTime.timescale)*K),z=a.toInt(a.toInt(t.endTime.value/O)),U={},Y=t.startTime.value,H={},V={},W=[],q=a.iter(T);!q.done;q.next()){if(R=q.value,(We=[]).push(new d.KeyFrame(t.startTime,G,D.Matrix2D.Identity,null,R.style)),U[R.formaID]=We,R.isTypeLockup()&&S.Host.textModelUtils.usePGMRenderer()){for(var j=a.clone(R.filterByKind(P.TextForma.KIND)),X=a.clone(R.filterByKind(x.ShapeForma.KIND)),Z=a.iter(j);!Z.done;Z.next()){var Q=Z.value;(je=[]).push(new d.KeyFrame(t.startTime,G,D.Matrix2D.Identity,null,Q.style)),U[Q.formaID]=je}for(var J=a.iter(X);!J.done;J.next()){var $=J.value;(Ze=[]).push(new d.KeyFrame(t.startTime,G,D.Matrix2D.Identity,null,$.style)),U[$.formaID]=Ze}}if(R.kind!=_.ImageForma.KIND){for(var ee=R.style.colors.colorID(c.ColorRole.FieldPrimary),te=a.iter(R.page.colorLibraryController.getThemeColorKeys());!te.done;te.next()){var ne,oe=te.value;(ne=R.style.colors.fieldPrimary)&&(le=R.page.colorLibraryController.getSolidColorForKey(oe))&&ne.distanceTo(le)<2&&(ee=oe)}null==H[ee=(i=ee)||null!=i?i:"missing"+a.toString(W.length)]&&(H[ee]=[],W.includes(ee)||W.push(ee)),H[ee].push(R);for(var re=R.style.colors.colorID(c.ColorRole.FieldSecondary),ie=a.iter(R.page.colorLibraryController.getThemeColorKeys());!ie.done;ie.next()){var ae,le;oe=ie.value,(ae=R.style.colors.fieldSecondary)&&(le=R.page.colorLibraryController.getSolidColorForKey(oe))&&ae.distanceTo(le)<2&&(re=oe)}null==V[re=(s=re)||null!=s?s:"missing"+a.toString(W.length)]&&(V[re]=[],W.includes(re)||W.push(re)),V[re].push(R)}}var se=a.clone(a.shuffle(m.colorLibraryController.getThemeColorKeys())),ue=[];if(T.length>0){for(var ce=e[0].database.beginTransaction("revert_transaction",null),me=a.iter(a.range(0,z,!1));!me.done;me.next()){for(var de={},he=a.iter(T);!he.done;he.next()){var fe,pe;(fe=(Oe=he.value).style.colors.fieldPrimary)&&(de[Oe.formaID+"primary"]=fe.asString),(pe=Oe.style.colors.fieldSecondary)&&(de[Oe.formaID+"secondary"]=pe.asString)}for(var ge=u.CoreRandom.nextIntUniform(se.length);ue.length>0&&se.length>1&&ge==ue[ue.length-1];)ge=u.CoreRandom.nextIntUniform(se.length);ue.push(ge);for(var ye=a.iter(a.range(0,2,!1));!ye.done;ye.next())for(var Te=1==ye.value,Ce=a.clone(Te?H:V),Se=a.iter(W);!Se.done;Se.next()){var ve,_e,Fe=Se.value;if((ve=Ce[Fe])&&null!=(_e=a.indexOf(W,Fe)))for(var we=a.iter(ve);!we.done;we.next())if((Oe=we.value).kind!=_.ImageForma.KIND)for(var Ae=!1,Ee=0;!Ae&&Ee<se.length;){var be=se[(_e+ge+Ee)%se.length];Ee+=1,Ae=!0;var De,Ie,Re=Te?c.ColorRole.FieldPrimary:c.ColorRole.FieldSecondary;if(Oe.style.colorTableSupportsRole(Re))if(Oe.style.colors.setColorId(Re,be),(De=Oe.style.colors.color(Re))&&null!=(Ie=de[Oe.formaID+(Re==c.ColorRole.FieldPrimary?"primary":"secondary")])&&Ie==De.asString&&(Ae=!1),null!=Oe.controller&&Oe.controller.moveable){var Le,ke=a.opt(Oe.controller,(function(e){return e.getBackingContrastRole()}));if(Le=Oe.style.colors.color(Re)){var xe=Re==c.ColorRole.FieldPrimary&&ke==c.ColorRole.FieldSecondary?Oe.style.colors.fieldSecondary:a.opt(Oe.controller,(function(e){return e.getBackgroundColor()})),Pe=Oe.isTypeLockup()?10:5,Me=new k.SolidColor(Le.red,Le.green,Le.blue,Oe.style.opacity);null!=xe&&Me.lightnessDifference(xe)<Pe&&(Ae=!1)}}}}for(var Ge=a.iter(T);!Ge.done;Ge.next()){var Ke,Oe=Ge.value;(Ke=a.as(Oe.controller,M.TypeLockupController))&&Ke.styleController.shuffleMultiStyleLockupColors()}Y+=O;for(var Ne=new N.TheoTime(Y,t.endTime.timescale),Be=a.iter(T);!Be.done;Be.next())if((R=Be.value).isImage()&&a.opt(a.as(R.controller,v.ImageController),(function(e){return e.shuffleColorAssignmentForAnimation()})),(R.isShape()||R.isTypeLockup())&&null==R.style.colors.color(c.ColorRole.FieldPrimary)&&E.LegacyCoreAssert.fail("error, can't be setting a nil colors",void 0,"AnimationLibrary.setColorSwapAnimation","AnimationLibrary.swift",1074),a.opt(U[R.formaID],(function(e){return e.push(new d.KeyFrame(Ne,G,D.Matrix2D.Identity,null,R.style))})),R.isTypeLockup()&&S.Host.textModelUtils.usePGMRenderer()){j=a.clone(R.filterByKind(P.TextForma.KIND)),X=a.clone(R.filterByKind(x.ShapeForma.KIND));for(var ze=a.iter(j);!ze.done;ze.next()){var Ue;Q=ze.value,(Ue=Q.style.clone())?(Ue.colors.owner=null,Ue.colors.setColor(c.ColorRole.FieldPrimary,Q.fontColor),Ue.colors.setColor(c.ColorRole.FieldSecondary,Q.fontStrokeColor),a.opt(U[Q.formaID],(function(e){return e.push(new d.KeyFrame(Ne,G,D.Matrix2D.Identity,null,Ue))}))):E.LegacyCoreAssert.fail("fail to generate keyframe for color shuffle: missing style in text forma",void 0,"AnimationLibrary.setColorSwapAnimation","AnimationLibrary.swift",1093)}for(var Ye=a.iter(X);!Ye.done;Ye.next())$=Ye.value,a.opt(U[$.formaID],(function(e){return e.push(new d.KeyFrame(Ne,G,D.Matrix2D.Identity,null,$.style))}))}}ce.rollback()}for(var He=e.concat(T),Ve=a.iter(this.uniqueFormae(a.clone(He)));!Ve.done;Ve.next()){var We;if(We=U[(R=Ve.value).formaID]){if(R.animation=d.FormaAnimation.init_9e82(t,t.startTime,t.endTime,We.concat()),R.isTypeLockup()&&S.Host.textModelUtils.usePGMRenderer()){j=a.clone(R.filterByKind(P.TextForma.KIND)),X=a.clone(R.filterByKind(x.ShapeForma.KIND));for(var qe=a.iter(j);!qe.done;qe.next()){var je;(je=U[(Q=qe.value).formaID])&&(Q.animation=d.FormaAnimation.init_9e82(t,t.startTime,t.endTime,je.concat()))}for(var Xe=a.iter(X);!Xe.done;Xe.next()){var Ze;(Ze=U[($=Xe.value).formaID])&&($.animation=d.FormaAnimation.init_9e82(t,t.startTime,t.endTime,Ze.concat()))}}}else R.kind==L.RootForma.KIND?this.setStillAnimation(e[0].root,t):R.animation=null}m.endUpdate(f)}},setFlickerAnimation:function(e,t){var n,o,r,i,s,u,c;if(0!=e.length){for(var h=[],f=a.iter(e);!f.done;f.next()){var p;null!=(v=f.value).controller&&v.controller.moveable&&!v.isGridCell()&&null==a.as(v,_.ImageForma)&&this.shouldAnimateShape(v)&&((p=w.ImageFacade.getImageFormaForForma(v))?h.push(p):h.push(v))}var g=a.clone(this.getTitleLockups(e[0].root));if(0!=g.length){for(var y=1==t.variant,T=2!=t.variant&&!S.Host.textModelUtils.usePGMRenderer(),C=a.iter(g);!C.done;C.next()){var v=C.value;a.remove(h,v),(L=a.as(v.controller,M.TypeLockupController))&&a.opt(L.lockupStyle,(function(e){return e.textLook!=b.LockupTextLook.KnockoutOnly}))&&(T=!1)}for(var F=[],A=[],I=a.iter(g);!I.done;I.next()){var L,K=I.value;if(L=a.as(K.controller,M.TypeLockupController))if(this.modifyLockupForAnimation(L,T),!y&&this.lockupDoesPerLetterLayout(K)){var z=a.clone(a.as(L.groupLetterFormaeByWord(),["Array",["Array",m.Forma]]));a.append(F,a.clone(z)),a.append(A,a.clone(z))}else{for(var U=a.clone(L.getAllTextFormae()),Y=a.iter(U);!Y.done;Y.next())v=Y.value,F.push([v]);y&&(U=a.clone(G.TypeLockupUtils.sortTextFormae(a.clone(U))),U=a.clone(G.TypeLockupUtils.padTextFormaeForLetterAnimation(a.clone(U),!1)));for(var H=a.iter(U);!H.done;H.next())v=H.value,A.push([v])}}2==t.variant&&(A=[g]);var V=a.toInt(2*a.toDouble(t.endTime.timescale)),W=new N.TheoTime(V+1,t.endTime.timescale),q=W.add(l.AnimationStyle.FADE_DURATION),j=B.TimingFunctionType.EaseOut,X=B.TimingFunctionType.Step,Z=a.toInt(.15*a.toDouble(t.endTime.timescale)),Q=a.toInt(a.toInt(V/Z)),J={},$=t.startTime.value;E.LegacyCoreAssert.isTrue(q.value>W.value,"end fade time must exceed start fade time",void 0,"AnimationLibrary.setFlickerAnimation","AnimationLibrary.swift",1252);for(var ee=a.iter(F);!ee.done;ee.next()){e=ee.value;for(var te=a.iter(e);!te.done;te.next())v=te.value,(nt=[]).push(new d.KeyFrame(t.startTime,X,D.Matrix2D.Identity,null,v.style)),J[v.formaID]=nt}for(var ne={},oe=a.iter(a.range(0,Q,!1));!oe.done;oe.next()){$+=Z;for(var re=new N.TheoTime($,t.endTime.timescale),ie=0,ae=null,le=a.iter(a.toSequence(A));!le.done;le.next()){for(var se=le.value,ue=se.offset,ce=(e=se.element,(n=a.opt(e[0].controller,(function(e){return e.currentOpacity})))||null!=n?n:e[0].style.opacity),me=2*(this.randomDbl()-.5)*ce,de=0,he=!1;de<5&&!he;){de+=1;for(var fe=a.iter(e);!fe.done;fe.next()){v=fe.value;var pe=(o=a.opt(v.controller,(function(e){return e.currentOpacity})))||null!=o?o:v.style.opacity,ge=(r=ne[v.formaID])||null!=r?r:pe,ye=v.isTypeLockup()?pe:1;Math.abs(ge-Math.min(Math.max(ge+me,0),ye))<.1?me=2*(this.randomDbl()-.5):he=!0}}for(var Te=a.iter(e);!Te.done;Te.next()){v=Te.value,pe=(i=a.opt(v.controller,(function(e){return e.currentOpacity})))||null!=i?i:v.style.opacity,ye=v.isTypeLockup()?pe:1;var Ce=Math.min(Math.max(pe+me,0),ye);if(ne[v.formaID]=Ce,y){if(ze=a.as(v,P.TextForma)){var Se,ve,_e=ze.graphemeCount,Fe=!1,we=ze.fontColor,Ae=new k.SolidColor(we.red,we.green,we.blue,Ce),Ee=ze.fontStrokeColor,be=new k.SolidColor(Ee.red,Ee.green,Ee.blue,Ce);if(ue-1>=0&&(Se=a.as(a.opt(ze.lockupForma,(function(e){return e.style})),b.LockupStyle))&&(ve=a.as(a.first(A[ue-1]),P.TextForma))&&b.LockupStyle.isDuplicateFormaLook(Se.textLook)&&G.TypeLockupUtils.formaForSameTextRun(ze,ve)&&ve.formaID==a.opt(ae,(function(e){return e.formaID}))&&v.formaID!=a.opt(ae,(function(e){return e.formaID}))&&(Fe=!0,Ae=new k.SolidColor(we.red,we.green,we.blue,(s=ne[ve.formaID])||null!=s?s:Ce),be=new k.SolidColor(Ee.red,Ee.green,Ee.blue,(u=ne[ve.formaID])||null!=u?u:Ce)),Fe||(v===ae?ie+=1:ie=0,ae=v),ie<_e)if(0==ie){E.LegacyCoreAssert.isTrue(pe==v.style.opacity,"current opacity does not match first character's opacity",void 0,"AnimationLibrary.setFlickerAnimation","AnimationLibrary.swift",1346);var De=new d.KeyFrame(re,X,D.Matrix2D.Identity,null,v.style);De.renderRuns.applyColors(Ae,be,new O.TextRange(ie,ie+1)),a.opt(J[v.formaID],(function(e){return e.push(De)}))}else{var Ie=(c=a.opt(J[v.formaID],(function(e){return e.length})))||null!=c?c:0;Ie>0&&J[v.formaID][Ie-1].renderRuns.applyColors(Ae,be,new O.TextRange(ie,ie+1))}}}else{var Re=R.MotionUtils.createOpacityStyle(v,Ce),Le=new d.KeyFrame(re,X,D.Matrix2D.Identity,null,Re);a.opt(J[v.formaID],(function(e){return e.push(Le)}))}}}}for(var ke=a.iter(F);!ke.done;ke.next()){e=ke.value;for(var xe=a.iter(e);!xe.done;xe.next()){v=xe.value;var Pe=T?R.MotionUtils.createOpacityStyle(v,0):v.style;J[v.formaID].push(new d.KeyFrame(q,j,D.Matrix2D.Identity,null,Pe))}}for(var Me=a.iter(h);!Me.done;Me.next()){v=Me.value;var Ge=R.MotionUtils.createOpacityStyle(v,0),Ke=v.style;if(null==J[v.formaID]&&(J[v.formaID]=[],J[v.formaID].push(new d.KeyFrame(t.startTime,j,D.Matrix2D.Identity,null,Ge)),J[v.formaID].push(new d.KeyFrame(W,j,D.Matrix2D.Identity,null,Ge)),J[v.formaID].push(new d.KeyFrame(q,j,D.Matrix2D.Identity,null,Ke)),q.value<t.endTime.value&&J[v.formaID].push(new d.KeyFrame(t.endTime,j,D.Matrix2D.Identity,null,Ke)),v.isTypeLockup()&&S.Host.textModelUtils.usePGMRenderer())){for(var Oe=a.clone(v.filterByKind(P.TextForma.KIND)),Ne=a.clone(v.filterByKind(x.ShapeForma.KIND)),Be=a.iter(Oe);!Be.done;Be.next()){var ze=Be.value,Ue=R.MotionUtils.createOpacityStyle(ze,0),Ye=ze.style,He=[];He.push(new d.KeyFrame(t.startTime,j,D.Matrix2D.Identity,null,Ue)),He.push(new d.KeyFrame(W,j,D.Matrix2D.Identity,null,Ue)),He.push(new d.KeyFrame(q,j,D.Matrix2D.Identity,null,Ye)),q.value<t.endTime.value&&He.push(new d.KeyFrame(t.endTime,j,D.Matrix2D.Identity,null,Ye)),ze.animation=d.FormaAnimation.init_9e82(t,t.startTime,t.endTime,He.concat())}for(var Ve=a.iter(Ne);!Ve.done;Ve.next()){var We=Ve.value,qe=R.MotionUtils.createOpacityStyle(We,0),je=We.style,Xe=[];Xe.push(new d.KeyFrame(t.startTime,j,D.Matrix2D.Identity,null,qe)),Xe.push(new d.KeyFrame(W,j,D.Matrix2D.Identity,null,qe)),Xe.push(new d.KeyFrame(q,j,D.Matrix2D.Identity,null,je)),q.value<t.endTime.value&&Xe.push(new d.KeyFrame(t.endTime,j,D.Matrix2D.Identity,null,je)),We.animation=d.FormaAnimation.init_9e82(t,t.startTime,t.endTime,Xe.concat())}}}for(var Ze=[],Qe=a.iter(A);!Qe.done;Qe.next()){e=Qe.value;for(var Je=a.iter(e);!Je.done;Je.next()){var $e=Je.value;Ze.push($e)}}for(var et=e.concat(Ze),tt=a.iter(this.uniqueFormae(a.clone(et)));!tt.done;tt.next()){var nt,ot;if(nt=J[(v=tt.value).formaID])v.animation=d.FormaAnimation.init_9e82(t,t.startTime,t.endTime,nt.concat()),v.kind==P.TextForma.KIND&&(ot=a.opt(a.opt(v.parent,(function(e){return e.parent})),(function(e){return e.parent})))&&ot.isTypeLockup()&&null==ot.animation&&this.setStillAnimation(ot,t),this.validateKeyFrames(nt.concat(),"flicker/setStillAnimation");else v.animation=null}}}},shouldAnimateShape:function(e){return!e.isShape()||(e.isGridCell()||null!=e.controller&&e.controller.moveable,!1)},modifyLockupForAnimation:function(e,t){var n,o;if(t){var r=(n=a.opt(e.lockupStyle,(function(e){return e.textLook})))||null!=n?n:b.LockupTextLook.Fill,i=a.opt(e.lockupStyle,(function(e){return e.colors.colorID(c.ColorRole.FieldPrimary)}));if(b.LockupStyle.isKnockoutLook(r)&&t){e.beginBlockedUpdate(),a.opt(e.lockupStyle,(function(e){return e.textLook=b.LockupTextLook.KnockoutAndFill}));var l=a.opt(e.lockupStyle,(function(e){return e.colors.colorID(c.ColorRole.FieldSecondary)}));a.opt(e.lockupStyle,(function(e){return e.colors.setColorId(c.ColorRole.FieldPrimary,l)})),e.endBlockedUpdate()}E.LegacyCoreAssert.isTrue(0==e.forceLetterFormaMode,"unexpectedly found forced letter forma mode when modifying lockup for animation",void 0,"AnimationLibrary.modifyLockupForAnimation","AnimationLibrary.swift",1543),e.updateGroup(),b.LockupStyle.isKnockoutLook(r)&&t&&(a.opt(e.forma,(function(t){return t.visitAll(m.FormaTraversal.PreOrder,(function(t){t.kind==P.TextForma.KIND&&(t.style.opacity=(o=a.opt(e.lockupStyle,(function(e){return e.backingOpacity})))||null!=o?o:t.style.opacity)}))})),e.beginBlockedUpdate(),a.opt(e.lockupStyle,(function(e){return e.textLook=r})),a.opt(e.lockupStyle,(function(e){return e.colors.setColorId(c.ColorRole.FieldPrimary,i)})),e.endBlockedUpdate())}},useKnockoutAnimation:function(e,t){var n;return!(S.Host.textModelUtils.usePGMRenderer()||!(n=e.lockupStyle)||!(n.textLook==b.LockupTextLook.KnockoutOnly||b.LockupStyle.isKnockoutLook(n.textLook)&&t==l.AnimationStyle.WORD_CENTERED_VARIANT))},getRandomLetterAppearKeyFrames:function(e,t,n,o,r,i,s,u){for(var c,m,h,f,p=s,g=a.iter(e);!g.done;g.next())for(var y=g.value,T=a.iter(y);!T.done;T.next()){var C=T.value,S=[],v=R.MotionUtils.createOpacityStyle(C,0),_=!1;if((K=a.as(a.opt(a.opt(a.as(C,P.TextForma),(function(e){return e.lockupForma})),(function(e){return e.controller})),M.TypeLockupController))&&(_=this.useKnockoutAnimation(K,t)),_){var F=(c=a.opt(a.as(a.opt(a.opt(a.as(C,P.TextForma),(function(e){return e.lockupForma})),(function(e){return e.style})),b.LockupStyle),(function(e){return e.backingOpacity})))||null!=c?c:C.style.opacity;v=R.MotionUtils.createOpacityStyle(C,F)}S.push(new d.KeyFrame(n.startTime,o,D.Matrix2D.Identity,null,v)),r[C.formaID]=S}for(var w=a.iter(i);!w.done;w.next()){var A=w.value,E=A.key,I=new N.TheoTime(a.toInt(Math.max(p-1,0)),n.endTime.timescale);I.value<=n.startTime.value&&(I=new N.TheoTime(a.toInt(n.startTime.value+1),n.endTime.timescale));var L=new N.TheoTime(a.toInt(p),n.endTime.timescale);L.value<=I.value&&(L=new N.TheoTime(I.value+1,n.endTime.timescale));for(var x=a.iter(A.value);!x.done;x.next()){var K,B=x.value,z=B.style,U=!1;(K=a.as(a.opt(B.lockupForma,(function(e){return e.controller})),M.TypeLockupController))&&(U=this.useKnockoutAnimation(K,t)),v=R.MotionUtils.createOpacityStyle(B,0),U&&t!=l.AnimationStyle.WORD_CENTERED_VARIANT&&(F=(m=a.opt(a.as(a.opt(B.lockupForma,(function(e){return e.style})),b.LockupStyle),(function(e){return e.backingOpacity})))||null!=m?m:B.style.opacity,v=R.MotionUtils.createOpacityStyle(B,F));var Y=B.graphemeCount,H=B.fontColor,V=B.fontStrokeColor,W=k.SolidColor.fromAlphaOverride(H,0),q=k.SolidColor.fromAlphaOverride(V,0);U&&(W=H,H=k.SolidColor.fromAlphaOverride(H,0),q=V,V=k.SolidColor.fromAlphaOverride(V,0));var j=new d.KeyFrame(I,o,D.Matrix2D.Identity,null,v),X=new d.KeyFrame(L,o,D.Matrix2D.Identity,null,z),Z=(h=a.opt(r[B.formaID],(function(e){return e.length})))||null!=h?h:0;if(Z>0){for(var Q=r[B.formaID][Z-1].renderRuns.fillColors,J=a.iter(Q.runArrays);!J.done;J.next()){var $=J.value;X.renderRuns.fillColors.apply($.attr,$.range)}for(var ee=r[B.formaID][Z-1].renderRuns.strokeColors,te=a.iter(ee.runArrays);!te.done;te.next())$=te.value,X.renderRuns.strokeColors.apply($.attr,$.range)}var ne=new O.TextRange(0,Y);1==Z&&(X.renderRuns.applyColors(W,q,ne),a.opt(r[B.formaID],(function(e){return e.push(j)}))),X.renderRuns.applyColors(H,V,E);for(var oe=[],re=a.iter(X.renderRuns.fillColors.runArrays);!re.done;re.next())$=re.value,a.eq(k._equality_SolidColor_SolidColor,$.attr,H)&&oe.push($.range);a.sortInPlace(oe,(function(e,t){return e.start<t.start}));var ie=a.clone(G.TypeLockupUtils.cleanupAndMerge(a.clone(oe)));X.renderRuns.clear();var ae=[ne];1==W.alpha&&(ae=a.clone(G.TypeLockupUtils.invertRanges(a.clone(ie),ne.end)));for(var le=a.iter(ae);!le.done;le.next()){var se=le.value;X.renderRuns.applyColors(W,q,se)}for(var ue=a.iter(ie);!ue.done;ue.next()){var ce=ue.value;X.renderRuns.applyColors(H,V,ce)}if(U&&((f=a.opt(a.first(ie),(function(e){return e.length})))||null!=f?f:0)>=Y){var me=R.MotionUtils.createOpacityStyle(B,0),de=new d.KeyFrame(L,o,D.Matrix2D.Identity,null,me);a.opt(r[B.formaID],(function(e){return e.push(de)}))}else a.opt(r[B.formaID],(function(e){return e.push(X)}))}p+=u}},lockupDoesPerLetterLayout:function(e){var t;return!!(t=a.as(e.style,b.LockupStyle))&&b.LockupStyle.doesPerLetterLayout(t.layout)},setDynamicWordAnimation:function(e,t){var n,o,r=this;if(0!=e.length){var i=t.variant,s=t.name==l.AnimationStyle.NAME_TYPE;s&&(i+=10);var u=a.clone(this.getTitleLockups(e[0].root));if(0!=u.length){var c=!0;if(i==l.AnimationStyle.WORD_CENTERED_VARIANT){var h=u.filter((function(e){return!r.lockupDoesPerLetterLayout(e)}),this);0==h.length?c=!1:u=a.clone(h)}for(var f=[],p=a.iter(e);!p.done;p.next()){var g;null!=(v=p.value).controller&&v.controller.moveable&&!v.isGridCell()&&null==a.as(v,_.ImageForma)&&this.shouldAnimateShape(v)&&((g=w.ImageFacade.getImageFormaForForma(v))?f.push(g):f.push(v))}for(var y=!1,C=!1,S=a.iter(u);!S.done;S.next()){var v=S.value;a.remove(f,v),!y&&v.controller instanceof M.TypeLockupController&&(y=this.useKnockoutAnimation(v.controller,i))}var F=[],A=[],I=0,L=0;if(y)for(var K=a.iter(u);!K.done;K.next()){var z=K.value;(St=a.as(z.controller,M.TypeLockupController))&&(C=this.useKnockoutAnimation(St,i),this.modifyLockupForAnimation(St,C))}for(var U=a.iter(u);!U.done;U.next())z=U.value,C=!1,(St=a.as(z.controller,M.TypeLockupController))&&(I+=T.GraphemeUtils.countGraphemes(St.text),L+=St.text.split(" ").length,C=this.useKnockoutAnimation(St,i)),z.visitAll(m.FormaTraversal.PreOrder,(function(e){var t,n;(t=a.as(e,P.TextForma))&&F.push(t),(n=a.as(e,x.ShapeForma))&&(i==l.AnimationStyle.WORD_APPEAR_VARIANT&&!C||i==l.AnimationStyle.WORD_ZOOM_IN_VARIANT||i==l.AnimationStyle.WORD_CENTERED_VARIANT)&&A.push(n)}));a.sortInPlace(A,(function(e,t){return e.frame.width>t.frame.width})),F=a.clone(G.TypeLockupUtils.sortTextFormae(a.clone(F))),s&&i!=l.AnimationStyle.LETTER_RANDOM_FADE_VARIANT&&(F=a.clone(G.TypeLockupUtils.padTextFormaeForLetterAnimation(a.clone(F),i==l.AnimationStyle.LETTER_APPEAR_VARIANT)));var Y,H=[];i==l.AnimationStyle.WORD_CENTERED_VARIANT?c?((Y=a.first(A))&&H.push([Y]),f=f.concat(a.clone(A))):H.push(a.clone(A)):i!=l.AnimationStyle.WORD_APPEAR_VARIANT&&i!=l.AnimationStyle.WORD_ZOOM_IN_VARIANT||H.push(a.clone(A));var V=[],W=!1;if(i==l.AnimationStyle.LETTER_RANDOM_FADE_VARIANT){for(var q=[],j=null,X=a.iter(F);!X.done;X.next()){var Z=X.value;null!=j&&G.TypeLockupUtils.formaForSameTextRun(Z,j)&&b.LockupStyle.isDuplicateFormaLook(Z.lockupForma.style.textLook)&&q.push(Z),j=Z}for(var Q=a.iter(q);!Q.done;Q.next()){var J=Q.value;a.remove(F,J)}for(var $=a.iter(F);!$.done;$.next()){v=$.value,H.push([v]);for(var ee=null,te=a.iter(q);!te.done;te.next())J=te.value,G.TypeLockupUtils.formaForSameTextRun(v,J)&&(H.push([J]),ee=J);for(var ne=a.iter(a.range(0,v.graphemeCount,!1));!ne.done;ne.next()){var oe,re=ne.value,ie=new O.TextRange(re,re+1),ae=[];ae.push(v),(oe=ee)&&ae.push(oe),V.push({key:ie,value:ae})}(oe=ee)&&a.remove(q,oe)}V=a.clone(a.shuffle(V))}else for(var le=[],se=a.iter(F);!se.done;se.next()){v=se.value,W||!b.LockupStyle.isDuplicateFormaLook(v.lockupForma.style.textLook)||y&&i==l.AnimationStyle.WORD_CENTERED_VARIANT||(W=!0);var ue,ce=!1;if(!s&&(ue=v.lockupForma)&&(St=a.as(ue.controller,M.TypeLockupController))&&this.lockupDoesPerLetterLayout(ue)){var me=ue.id;if(!le.includes(me)){var de=a.clone(a.as(St.groupLetterFormaeByWord(),["Array",["Array",m.Forma]]));a.append(H,a.clone(de)),le.push(ue.id)}ce=!0}ce||H.push([v])}var he=B.TimingFunctionType.Step;i==l.AnimationStyle.WORD_ZOOM_IN_VARIANT?he=B.TimingFunctionType.EaseOut:i==l.AnimationStyle.LETTER_APPEAR_FADE_VARIANT&&(he=B.TimingFunctionType.Linear);var fe=B.TimingFunctionType.EaseOut,pe=s?1.5:1,ge=Math.max(Math.min(a.toDouble(I)/7,2),pe);!s&&L>10&&(ge+=.25*a.toDouble(L-10),ge=Math.min(15,ge));var ye=i==l.AnimationStyle.LETTER_APPEAR_VARIANT||i==l.AnimationStyle.LETTER_APPEAR_FADE_VARIANT?.15:0,Te=i==l.AnimationStyle.LETTER_RANDOM_FADE_VARIANT?V.length:H.length;W&&(Te=a.toInt(Te/2));var Ce=ge/a.toDouble(Te+2),Se=a.toDouble(t.endTime.timescale)*Ce,ve=a.toInt(a.toDouble(t.endTime.timescale)*(ge+ye)),_e=new N.TheoTime(ve,t.endTime.timescale),Fe=_e.add(s?l.AnimationStyle.FADE_DURATION:new N.TheoTime(2,t.endTime.timescale));0==f.length&&(Fe=new N.TheoTime(_e.value+1,_e.timescale)),t.endTime=Fe;var we=new N.TheoTime(t.endTime.timescale,t.endTime.timescale);i==l.AnimationStyle.LETTER_APPEAR_VARIANT&&(we=new N.TheoTime(0,t.endTime.timescale));var Ae={},Ee=a.toDouble(t.startTime.value)+ye*a.toDouble(t.endTime.timescale);if(i==l.AnimationStyle.LETTER_RANDOM_FADE_VARIANT)this.getRandomLetterAppearKeyFrames(a.clone(H),i,t,he,Ae,a.clone(V),Ee,Se);else for(var be=Ee,De=null,Ie=0,Re=1,Le=a.iter(H);!Le.done;Le.next()){e=Le.value;for(var ke=a.iter(e);!ke.done;ke.next()){var xe;if(v=ke.value,(Xe=a.as(v,P.TextForma))&&(j=a.as(De,P.TextForma))&&(xe=a.as(a.opt(Xe.lockupForma,(function(e){return e.style})),b.LockupStyle))&&G.TypeLockupUtils.formaForSameTextRun(Xe,j)&&b.LockupStyle.isDuplicateFormaLook(xe.textLook)&&v!==De){Ae[v.formaID]=[];for(var Pe=a.iter(Ae[j.formaID]);!Pe.done;Pe.next()){var Me=Pe.value,Ge=a.opt(Me.style,(function(e){return e.clone()}));a.opt(Ge,(function(e){return e.colors.fieldPrimary=Xe.style.colors.fieldPrimary})),a.opt(Ge,(function(e){return 0!=e.opacity}))&&a.opt(Ge,(function(e){return e.opacity=Xe.style.opacity}));var Ke=new d.KeyFrame(Me.time,Me.timingFunction,Me.placement,Me.bounds,Ge,Me.relativePlacement);Ke.renderRuns.copyColorAlpha(Xe,Me.renderRuns),Ae[v.formaID].push(Ke)}be-=Se}else{s&&(v===De?Ie+=1:Ie=0),De=v;var Oe=new N.TheoTime(a.toInt(Math.max(be-Re,0)),t.endTime.timescale);Se<1&&(Re=Se),Oe.value<=t.startTime.value&&(Oe=new N.TheoTime(a.toInt(t.startTime.value+1),t.endTime.timescale));var Ne=new N.TheoTime(a.toInt(be),t.endTime.timescale);Ne.value<=Oe.value&&Se>=1&&(Ne=new N.TheoTime(Oe.value+1,t.endTime.timescale));var Be=new N.TheoTime(a.toInt(be+Se-1),t.endTime.timescale);Be.value<=Ne.value&&(Be=new N.TheoTime(Ne.value+1,t.endTime.timescale));var ze,Ue,Ye=new N.TheoTime(Be.value+1,t.endTime.timescale),He=v.style;if(C=!1,(St=a.as(v.controller,M.TypeLockupController))&&(C=this.useKnockoutAnimation(St,i)),(ze=a.as(a.opt(a.opt(a.as(v,P.TextForma),(function(e){return e.lockupForma})),(function(e){return e.controller})),M.TypeLockupController))&&(C=this.useKnockoutAnimation(ze,i)),i==l.AnimationStyle.LETTER_APPEAR_VARIANT){var Ve=C?0:1;Ue=R.MotionUtils.createOpacityStyle(v,Ve)}else{var We=C?0:Math.min(Ne.seconds/we.seconds,.8);Ue=R.MotionUtils.createOpacityStyle(v,We)}var qe=R.MotionUtils.createOpacityStyle(v,0);if(C&&i!=l.AnimationStyle.WORD_CENTERED_VARIANT){var je=(n=a.opt(a.as(a.opt(a.opt(a.as(v,P.TextForma),(function(e){return e.lockupForma})),(function(e){return e.style})),b.LockupStyle),(function(e){return e.backingOpacity})))||null!=n?n:v.style.opacity;qe=R.MotionUtils.createOpacityStyle(v,je);var Xe,Ze=!1;(Xe=a.as(v,P.TextForma))&&(Ze=Ie>=Xe.graphemeCount),s&&!Ze||(He=R.MotionUtils.createOpacityStyle(v,0))}if(s&&0!=Ie||(Ae[v.formaID]=[],Ae[v.formaID].push(new d.KeyFrame(t.startTime,he,D.Matrix2D.Identity,null,qe))),i==l.AnimationStyle.WORD_CENTERED_VARIANT){var Qe=this.calculateWordCenteredDynamicShift(v);v.isShape()&&y?(Ae[v.formaID].push(new d.KeyFrame(Oe,he,D.Matrix2D.Identity,null,qe)),Ae[v.formaID].push(new d.KeyFrame(Ne,he,D.Matrix2D.Identity,null,qe))):(Ae[v.formaID].push(new d.KeyFrame(Oe,he,Qe,null,qe)),Ae[v.formaID].push(new d.KeyFrame(Ne,he,Qe,null,He))),v.isShape()?y?(Ae[v.formaID].push(new d.KeyFrame(_e.addVal(-10),fe,D.Matrix2D.Identity,null,qe)),Ae[v.formaID].push(new d.KeyFrame(_e.addVal(-9),he,D.Matrix2D.Identity,null,He))):(Ae[v.formaID].push(new d.KeyFrame(_e.addVal(-10),fe,Qe,null,He)),Ae[v.formaID].push(new d.KeyFrame(_e.addVal(-9),he,Qe,null,qe))):(Ae[v.formaID].push(new d.KeyFrame(Be,he,Qe,null,He)),Ae[v.formaID].push(new d.KeyFrame(Ye,he,Qe,null,qe))),v.isShape()&&y?Ae[v.formaID].push(new d.KeyFrame(_e,he,D.Matrix2D.Identity,null,He)):Ae[v.formaID].push(new d.KeyFrame(_e,he,D.Matrix2D.Identity,null,qe))}else if(i==l.AnimationStyle.WORD_ZOOM_IN_VARIANT){var Je,$e,et=v.isFullCanvas?1:10;if(Qe=D.Matrix2D.Identity,(Je=a.opt(a.opt(v.root,(function(e){return e.finalFrame})),(function(e){return e.center})))&&($e=v.totalPlacement.inverse)){var tt=$e.transformPoint(Je).subtract(v.bounds.center),nt=D.Matrix2D.scalingXYfromPoint(v.frame.center,et,et);Qe=nt.translate(tt)}a.opt(Ae[v.formaID],(function(e){return e.push(new d.KeyFrame(Oe,he,Qe,null,qe))})),a.opt(Ae[v.formaID],(function(e){return e.push(new d.KeyFrame(Ne,he,Qe,null,He))})),a.opt(Ae[v.formaID],(function(e){return e.push(new d.KeyFrame(Be,he,D.Matrix2D.Identity,null,He))}))}else if(i==l.AnimationStyle.LETTER_APPEAR_FADE_VARIANT){E.LegacyCoreAssert.fail("AnimationStyle.LETTER_APPEAR_FADE_VARIANT not updated for word forma",void 0,"AnimationLibrary.setDynamicWordAnimation","AnimationLibrary.swift",2139),a.opt(Ae[v.formaID],(function(e){return e.push(new d.KeyFrame(Oe,he,D.Matrix2D.Identity,null,qe))})),a.opt(Ae[v.formaID],(function(e){return e.push(new d.KeyFrame(Ne,he,D.Matrix2D.Identity,null,Ue))}));var ot=Ne.addSeconds(we.seconds),rt=Fe.seconds>ot.seconds?ot:Fe.addVal(-1);a.opt(Ae[v.formaID],(function(e){return e.push(new d.KeyFrame(rt,he,D.Matrix2D.Identity,null,He))}))}else{var it=new d.KeyFrame(Oe,he,D.Matrix2D.Identity,null,qe),at=new d.KeyFrame(Ne,he,D.Matrix2D.Identity,null,He);if(s){if(Z=a.as(v,P.TextForma)){var lt=Z.graphemeCount,st=Ie<lt?Ie:lt,ut=Z.fontColor,ct=Z.fontStrokeColor,mt=new k.SolidColor(ut.red,ut.green,ut.blue,0);C&&i!=l.AnimationStyle.WORD_CENTERED_VARIANT&&(mt=ut,ut=new k.SolidColor(ut.red,ut.green,ut.blue,0),ct=new k.SolidColor(ct.red,ct.green,ct.blue,0)),at.renderRuns.applyColors(ut,ct,new O.TextRange(0,st)),at.renderRuns.applyColors(mt,mt,new O.TextRange(st,lt))}var dt=new d.KeyFrame(Oe,he,D.Matrix2D.Identity,null,He);dt.renderRuns=at.renderRuns,a.opt(Ae[v.formaID],(function(e){return e.push(dt)}))}else a.opt(Ae[v.formaID],(function(e){return e.push(it)}));a.opt(Ae[v.formaID],(function(e){return e.push(at)}))}this.validateKeyFrames(Ae[v.formaID].concat(),"variants")}}be+=Se}for(var ht=a.iter(f);!ht.done;ht.next())v=ht.value,qe=R.MotionUtils.createOpacityStyle(v,0),C=!1,(St=a.as(a.opt(a.opt(a.as(v,P.TextForma),(function(e){return e.lockupForma})),(function(e){return e.controller})),M.TypeLockupController))&&(C=this.useKnockoutAnimation(St,i)),C&&v instanceof P.TextForma&&(je=(o=a.opt(a.as(a.opt(a.opt(a.as(v,P.TextForma),(function(e){return e.lockupForma})),(function(e){return e.style})),b.LockupStyle),(function(e){return e.backingOpacity})))||null!=o?o:v.style.opacity,qe=R.MotionUtils.createOpacityStyle(v,je)),null==Ae[v.formaID]&&((Ft=[]).push(new d.KeyFrame(t.startTime,fe,D.Matrix2D.Identity,null,qe)),Ae[v.formaID]=Ft,a.opt(Ae[v.formaID],(function(e){return e.push(new d.KeyFrame(_e,fe,D.Matrix2D.Identity,null,qe))})),this.validateKeyFrames(Ae[v.formaID].concat(),"createOpacityStyle"));for(var ft=[],pt=a.iter(H);!pt.done;pt.next()){e=pt.value;for(var gt=a.iter(e);!gt.done;gt.next()){var yt=gt.value;ft.push(yt)}}for(var Tt=f.concat(ft),Ct=a.iter(this.uniqueFormae(a.clone(Tt)));!Ct.done;Ct.next()){var St;He=(v=Ct.value).style,C=!1,(St=a.as(a.opt(a.opt(a.as(v,P.TextForma),(function(e){return e.lockupForma})),(function(e){return e.controller})),M.TypeLockupController))&&(C=this.useKnockoutAnimation(St,i)),C&&v instanceof P.TextForma&&(He=R.MotionUtils.createOpacityStyle(v,0)),(Ft=Ae[v.formaID])&&Ft.length>0&&Ft[Ft.length-1].time.value>=Fe.value&&a.info("error?"),Ae[v.formaID].push(new d.KeyFrame(Fe,fe,D.Matrix2D.Identity,null,He)),Fe.value-15<t.endTime.value&&Ae[v.formaID].push(new d.KeyFrame(t.endTime.addVal(15),fe,D.Matrix2D.Identity,null,He)),this.validateKeyFrames(Ae[v.formaID].concat(),"fade time checks")}for(var vt=e.concat(ft).concat(f),_t=a.iter(this.uniqueFormae(a.clone(vt)));!_t.done;_t.next()){var Ft,wt;if(Ft=Ae[(v=_t.value).formaID])v.animation=d.FormaAnimation.init_9e82(t,t.startTime,t.endTime,Ft.concat()),v.kind==P.TextForma.KIND&&(wt=a.opt(a.opt(v.parent,(function(e){return e.parent})),(function(e){return e.parent})))&&wt.isTypeLockup()&&null==wt.animation&&this.setStillAnimation(wt,t),this.validateKeyFrames(a.clone(v.animation.keyFrames),"dynamicWord/setStillAnimation");else v.animation=null}}}},findLockupAncestor:function(e){return a.as(e.visit(m.FormaTraversal.NearestAncestor,(function(e,t,n){return e.isTypeLockup()})),y.GroupForma)},calculateWordCenteredDynamicShift:function(e){var t,n,o,r;if((t=this.findLockupAncestor(e))&&this.lockupDoesPerLetterLayout(t))return D.Matrix2D.Identity;if((n=a.opt(a.opt(e.root,(function(e){return e.finalFrame})),(function(e){return e.center})))&&(o=e.totalPlacement.inverse)&&(r=a.opt(e.bounds,(function(e){return e.center})))){var i;(i=a.as(e,P.TextForma))&&(r=i.getBoundsCenter());var l=o.transformPoint(n);return D.Matrix2D.translation(l.subtract(r))}return D.Matrix2D.Identity},uniqueFormae:function(e){for(var t=[],n=a.iter(e);!n.done;n.next()){var o=n.value;a.containsEq(t,o,m._equality_Forma_Forma)||t.push(o)}return t},getTitleLockups:function(e){var t=a.clone(e.filterWithCallback((function(e){return e.isTypeLockup()})));if(0==t.length)return[];a.sortInPlace(t,(function(e,t){return e.controller.currentHeightScale>t.controller.currentHeightScale}));for(var n=t[0],o=[n],r=a.iter(t);!r.done;r.next()){var i,l,s=r.value;if(!a.eq(m._equality_Forma_Forma,s,n)&&(i=a.as(s.controller,M.TypeLockupController))&&(l=a.as(n.controller,M.TypeLockupController))){var u=i.getCurrentFontSize(),c=l.getCurrentFontSize();Math.abs(u-c)/Math.min(u,c)<.05&&o.push(s)}}return o},setSlideAnimation:function(e,t,n){var o,r=[],i=[],s=!1,u=!1;if(S.Host.textModelUtils.usePGMRenderer()||(o=a.opt(a.as(e.controller,M.TypeLockupController),(function(e){return e.lockupStyle})))&&(b.LockupStyle.isKnockoutLook(o.textLook)&&o.backing==b.LockupBacking.Knockout&&(s=!0),u=b.LockupStyle.isKnockoutLook(o.textLook)&&o.textLook!=b.LockupTextLook.KnockoutOnly),e.isTypeLockup()?e.visitAll(m.FormaTraversal.PreOrder,(function(e){u||e instanceof x.ShapeForma?i.push(e):e instanceof P.TextForma&&r.push(e)})):r.push(e),2==t.variant||1==t.variantCount||s){var c=75;s&&(c=2==t.variant||1==t.variantCount?-75:0==t.variant?-200:200);var h=D.Matrix2D.translation(new K.TheoPoint(-c,0)),f=D.Matrix2D.translation(new K.TheoPoint(c,0)),p=t.endTime.multiply(2/3);if(this.setFormaAnimations(a.clone(r),t,0,e.style.opacity,h,B.TimingFunctionType.EaseInOut,t.startTime,t.startTime,p),this.setFormaAnimations(a.clone(i),t,0,e.style.opacity,f,B.TimingFunctionType.EaseInOut,t.startTime,t.startTime,p),e.isTypeLockup()){var g=[];g.push(new d.KeyFrame(t.startTime,B.TimingFunctionType.Linear)),g.push(new d.KeyFrame(p,B.TimingFunctionType.Linear)),e.animation=d.FormaAnimation.init_9e82(t,t.startTime,t.endTime,g.concat()),e.animation=d.FormaAnimation.init_9e82(t,t.startTime,p,g.concat())}}else{var y=t.endTime.subtract(l.AnimationStyle.FADE_DURATION);a.containsEq(n,e,m._equality_Forma_Forma)?(h=D.Matrix2D.translation(new K.TheoPoint(0==t.variant?-200:200,0)),this.setLineAnimation(e,t,h,B.TimingFunctionType.EaseInOut,t.startTime,y,new N.TheoTime(a.toInt(.1*a.toDouble(t.endTime.timescale)),t.endTime.timescale)),this.setStillAnimation(e,t,t.startTime,y)):this.setFormaFade(e,t,t.startTime,t.endTime,y)}},setFormaFade:function(e,t,n,o,r){var i,a=e;(i=w.ImageFacade.getImageFormaForForma(e))&&(a=i);var l=a.style,s=R.MotionUtils.createOpacityStyle(a,0),u=[];u.push(new d.KeyFrame(n,B.TimingFunctionType.Linear,D.Matrix2D.Identity,null,s)),u.push(new d.KeyFrame(r,B.TimingFunctionType.Linear,D.Matrix2D.Identity,null,s)),u.push(new d.KeyFrame(o,B.TimingFunctionType.Linear,D.Matrix2D.Identity,null,l)),e.animation=d.FormaAnimation.init_9e82(t,n,o,u.concat())},getShiftingMatrix:function(e,t,n,o){var r,i=e.finalFrame,a=e.root.frame,l=e.root.placement.inverse.transformPoint(a.eval(n)),s=D.Matrix2D.scaling(t),u=e.root.placement.concat(s).transformPoint(l);return r=o?u.subtract(i.center):a.center.subtract(u),D.Matrix2D.scaling(t).translate(r)},setFormaAnimations:function(e,t,n,o,r,i,l,s,u){void 0===n&&(n=null),void 0===o&&(o=null),void 0===r&&(r=D.Matrix2D.Identity),void 0===i&&(i=B.TimingFunctionType.Linear);for(var c=a.iter(e);!c.done;c.next()){var m=c.value,h=m.style,f=null!=n?R.MotionUtils.createOpacityStyle(m,n):h,p=null!=o?R.MotionUtils.createOpacityStyle(m,o):h,g=[];l.value!=s.value&&g.push(new d.KeyFrame(l,i,r,null,f)),g.push(new d.KeyFrame(s,i,r,null,f)),g.push(new d.KeyFrame(u,i,D.Matrix2D.Identity,null,p)),m.animation=d.FormaAnimation.init_9e82(t,l,u,g.concat())}},setGreyscaleAnimation:function(e,t){var n=[],o=e.page.imageFilterLibrary.getImageStyle("Greyscale").clone();o.colorLibrary=e.style.colorLibrary;var r=e.style.clone();null==r.filter&&(r.filter=F.CompositeFilter.init_514f(void 0,"None",0,"normal",void 0,void 0,"none")),E.LegacyCoreAssert.isTrue(o.colorLibrary==e.style.colorLibrary,"color library mismatch: forma style and greyscale image style",void 0,"AnimationLibrary.setGreyscaleAnimation","AnimationLibrary.swift",2556),E.LegacyCoreAssert.isTrue(r.colorLibrary==e.style.colorLibrary,"color library mismatch: forma style and clone",void 0,"AnimationLibrary.setGreyscaleAnimation","AnimationLibrary.swift",2557),o.adjustments=e.style.adjustments,r.adjustments=e.style.adjustments,n.push(new d.KeyFrame(t.startTime,B.TimingFunctionType.Linear,D.Matrix2D.Identity,null,o)),n.push(new d.KeyFrame(t.endTime,B.TimingFunctionType.Linear,D.Matrix2D.Identity,null,r)),e.animation=d.FormaAnimation.init_9e82(t,t.startTime,t.endTime,n.concat())},setBlurAnimation:function(e,t){t.endTime=l.AnimationStyle.DEFAULT_DURATION.subtract(new N.TheoTime(30,30));var n=[],o=e.style.clone(),r=e.style.clone();null!=o.filter&&o.filter instanceof F.CompositeFilter||((o=e.page.imageFilterLibrary.getImageStyle("Blur").clone()).colorLibrary=e.style.colorLibrary,(r=e.page.imageFilterLibrary.getImageStyle("Blur").clone()).colorLibrary=e.style.colorLibrary),E.LegacyCoreAssert.isTrue(o.colorLibrary==e.style.colorLibrary,"color library mismatch: forma style and first clone",void 0,"AnimationLibrary.setBlurAnimation","AnimationLibrary.swift",2589),E.LegacyCoreAssert.isTrue(r.colorLibrary==e.style.colorLibrary,"color library mismatch: forma style and second clone",void 0,"AnimationLibrary.setBlurAnimation","AnimationLibrary.swift",2590),o.adjustments=e.style.adjustments,r.adjustments=e.style.adjustments,o.filter.blurRadius=20,r.filter.blurRadius=0,n.push(new d.KeyFrame(t.startTime,B.TimingFunctionType.EaseOut,D.Matrix2D.Identity,null,o)),n.push(new d.KeyFrame(t.endTime,B.TimingFunctionType.EaseOut,D.Matrix2D.Identity,null,r)),e.animation=d.FormaAnimation.init_9e82(t,t.startTime,t.endTime,n.concat())},setFillAnimation:function(e,t){var n,o,r=[];if((n=e.style.clone())&&(o=e.style.clone())){n.filter=F.CompositeFilter.init_514f(void 0,"Fill",1,"normal",void 0,void 0,"none"),null==o.filter&&(o.filter=F.CompositeFilter.init_514f(void 0,"None",0,"normal",void 0,void 0,"none")),n.colorLibrary=e.style.colorLibrary,o.colorLibrary=e.style.colorLibrary,n.adjustments=e.style.adjustments,o.adjustments=e.style.adjustments;var i=a.clone(e.page.colorLibraryController.getThemeColorKeys());i.length>t.variant&&(n.colors.fieldPrimary=e.page.colorLibraryController.getSolidColorForKey(a.as(i[t.variant],"String")),n.colors.fieldSecondary=null,a.opt(n.filter,(function(e){return e.style=n})),a.opt(o.filter,(function(e){return e.style=o})),r.push(new d.KeyFrame(t.startTime,B.TimingFunctionType.EaseInOut,D.Matrix2D.Identity,null,n)),r.push(new d.KeyFrame(t.endTime,B.TimingFunctionType.EaseInOut,D.Matrix2D.Identity,null,o)),e.animation=d.FormaAnimation.init_9e82(t,t.startTime,t.endTime,r.concat()))}},setColorSwitchAnimation:function(e,t){var n,o,r=[];if((n=e.style.clone())&&(o=e.page.imageFilterLibrary.getImageStyle("Overlay").clone())){var i;if(null==n.filter&&(n.filter=F.CompositeFilter.init_514f(void 0,"None",0,"normal",void 0,void 0,"none")),i=a.as(o.filter,F.CompositeFilter)){var l=a.clone(e.page.colorLibraryController.getThemeColorKeys());l.length>t.variant&&(o.colors.fieldPrimary=e.page.colorLibraryController.getSolidColorForKey(a.as(l[t.variant],"String"))),i.mix=Math.max(i.mix,1)}E.LegacyCoreAssert.isTrue(n.colorLibrary==e.style.colorLibrary,"color library mismatch: forma style and clone",void 0,"AnimationLibrary.setColorSwitchAnimation","AnimationLibrary.swift",2671),o.colorLibrary=e.style.colorLibrary,n.adjustments=e.style.adjustments,o.adjustments=e.style.adjustments,r.push(new d.KeyFrame(t.startTime,B.TimingFunctionType.EaseInOut,D.Matrix2D.Identity,null,n)),r.push(new d.KeyFrame(t.endTime,B.TimingFunctionType.EaseInOut,D.Matrix2D.Identity,null,o)),e.animation=d.FormaAnimation.init_9e82(t,t.startTime,t.endTime,r.concat())}},setZoomAnimation:function(e,t){var n=0==t.variant?.8:1.2;e instanceof f.FrameForma?this.setScaleForma(e,t,new K.TheoPoint(n,n),new K.TheoPoint(.5,.5),B.TimingFunctionType.EaseOut,t.startTime,t.endTime):this.setImageAnimation(e,t,B.TimingFunctionType.EaseOut,[[t.startTime,K.TheoPoint.ZERO,n],[t.endTime,K.TheoPoint.ZERO,1]],!0)},setPanningAnimation:function(e,t){var n,o,r,i=!(!(n=a.opt(a.as(e,_.ImageForma),(function(e){return e.hasAlpha()})))&&null==n)&&n;(o=w.ImageFacade.getFrameFormaForForma(e))&&(r=a.as(o.controller,h.FrameController))&&(i=i||r.hasCutout);var l=1==t.variant?-150:150;this.setImageAnimation(e,t,B.TimingFunctionType.EaseOut,[[t.startTime,new K.TheoPoint(l,0),1],[t.endTime,K.TheoPoint.ZERO,1]],!i)},randomDbl:function(){return a.toDouble(u.CoreRandom.nextInt)/a.toDouble(u.CoreRandom.randMax)},setAnimationStyleForFormae:function(e,t,n){if(void 0===n&&(n=null),t.name==l.AnimationStyle.NAME_COLORSWAP)this.setColorSwapAnimation(a.clone(e),t,n);else if(t.name==l.AnimationStyle.NAME_FLICKER)this.setFlickerAnimation(a.clone(e),t);else if(t.name==l.AnimationStyle.NAME_DYNAMIC||t.name==l.AnimationStyle.NAME_TYPE)this.setDynamicWordAnimation(a.clone(e),t);else if(t.name==l.AnimationStyle.NAME_FADE&&0==t.variant)this.setFadeAnimationTopDown(a.clone(e),t);else{for(var o=!1,r=a.as(a.opt(a.first(e),(function(e){return e.root})),L.RootForma),i=a.clone(null!=r?this.getTitleLockups(r):[]),s=a.iter(e);!s.done;s.next()){var u=s.value;o=o||!a.containsEq(i,u,m._equality_Forma_Forma)}t.name==l.AnimationStyle.NAME_SLIDE&&t.variantCount<2&&(t.endTime=t.endTime.addSeconds(-1));for(var c=N.TheoTime.Zero,d=a.iter(e);!d.done;d.next()){var h;if(null!=(u=d.value).controller){var p,g,y=u.hasIntent(m.Forma.INTENT_ICON)&&this.shouldAnimateShape(u),T=u.kind==f.FrameForma.KIND&&u.controller.moveable;if(y||u.isTypeLockup()||T)(g=a.as(u.controller,M.TypeLockupController))&&g.updateGroup(),t.name==l.AnimationStyle.NAME_NO_STYLE?u.animation=null:t.name==l.AnimationStyle.NAME_GROW?this.setGrowAnimation(u,t,a.clone(i)):t.name==l.AnimationStyle.NAME_FADE?this.setFadeAnimation(u,t,a.clone(i)):t.name==l.AnimationStyle.NAME_SLIDE&&this.setSlideAnimation(u,t,a.clone(i));else if(p=w.ImageFacade.getImageFormaForForma(u)){var C;if((C=a.as(u,z.VideoForma))&&C.videoContentNode.isGIF){this.setStillAnimation(p,t);continue}if(t.name==l.AnimationStyle.NAME_NO_STYLE)p.animation=null;else if(t.name==l.AnimationStyle.NAME_BLUR)this.setBlurAnimation(p,t);else if(t.name==l.AnimationStyle.NAME_GRAYSCALE)this.setGreyscaleAnimation(p,t);else if(t.name==l.AnimationStyle.NAME_FILL)this.setFillAnimation(p,t);else if(t.name==l.AnimationStyle.NAME_COLOR)this.setColorSwitchAnimation(p,t);else if(t.name==l.AnimationStyle.NAME_PAN){var S=p.controller.floating?p.parent:p;this.setPanningAnimation(S,t)}else t.name==l.AnimationStyle.NAME_ZOOM&&(S=p.controller.floating?p.parent:p,this.setZoomAnimation(S,t))}}(h=u.animation)&&h.endTime.seconds>c.seconds&&(c=h.endTime)}c.seconds>0&&(t.endTime=c)}},setRootAnimationStyle:function(e,t){this.setStillAnimation(t,e),R.MotionUtils.invalidateAnimation(t.page.document)},modifyModelForAnimation:function(e,t){var n,r,i=this,s=a.as((e||t.page.animationLibrary.getNoneStyle()).forkToDatabase(C.GUIDUtils.makeGUID(),!1,t.database,null),l.AnimationStyle);if(r=s){var u=new p.FormaAnimationChangedEvent(t);if(t.beginUpdate(u),I.MotionFacade.canApplyStyle(r))return I.MotionFacade.applyStyle(t,r),void t.endUpdate(u);var c=r.name,g=c==l.AnimationStyle.NAME_NO_STYLE,y=c==l.AnimationStyle.NAME_COLORSWAP;r.endTime=g?l.AnimationStyle.NOOP_DURATION:l.AnimationStyle.DEFAULT_DURATION;var T=[],S=N.TheoTime.Zero,v=[],_=!1;t.visitAll(m.FormaTraversal.PreOrder,(function(e){var t,o,r;if((t=a.as(e,z.VideoForma))&&(o=a.opt(t.parent,(function(e){return e.controller})))){var i=U.VideoFacade.getDurationForVideo(t);i.isZero||(o.moveable?v.push(t):S.seconds<i.seconds&&(S=i))}if(e.animation=null,r=e.controller){if(r.userGroup)return;r.moveable&&!e.isVideo()&&(_=!0);var l=r.moveable&&e.isImage()&&!e.isSticker(),s=y&&l&&!(!(n=a.opt(a.as(r,h.FrameController),(function(e){return e.hasBackgroundColor})))&&null==n)&&n;l&&!s||e.isLogo()||T.push(e)}}));for(var F=a.iter(v);!F.done;F.next()){var A,b=F.value;a.remove(T,b),(A=b.parent)&&a.remove(T,A)}_||(r.endTime=l.AnimationStyle.NOOP_DURATION);var D=r.endTime.timescale,L=null;if(y&&!S.isZero){var k=S.seconds,x=l.AnimationStyle.COLOR_SWAP_DURATION.seconds;L=o.extendToIntegralCount(x,k,D)}this.setAnimationStyleForFormae(a.clone(T),r,L);var P=r.endTime,M=P,G=N.TheoTime.fromTimeInTimescale(l.AnimationStyle.STILL_DURATION,D);if(v.length>0||!S.isZero){for(var K=l.AnimationStyle.GIF_DURATION,O=N.TheoTime.Zero,B=a.iter(v);!B.done;B.next()){var Y=B.value,H=U.VideoFacade.getDurationForVideo(Y);H.laterThan(O)&&(O=H)}if(S.isZero){if(!y){var V=O.seconds,W=Math.max(V,K.seconds),q=o.extendToIntegralCount(W,V,D);M=P.add(q)}}else{var j=P.seconds;if(!y){var X=S.safeSubtract(P);!g&&X.earlierThan(G)&&(X=G),X.earlierThan(O)&&(X=O),g&&v.length>0&&X.earlierThan(K)&&(X=K),j+=X.seconds}k=S.seconds,M=o.extendToIntegralCount(j,k,D)}for(var Z=y?r.startTime:r.endTime,Q=a.iter(v);!Q.done;Q.next()){Y=Q.value;var J=R.MotionUtils.createOpacityStyle(Y,0),$=Y.style,ee=[];g||y?ee.push(d.KeyFrame.makeFromTimeAndStyle(Z,$)):(ee.push(d.KeyFrame.makeFromTimeAndStyle(r.startTime,J)),ee.push(d.KeyFrame.makeFromTimeAndStyle(Z,J)),ee.push(d.KeyFrame.makeFromTimeAndStyle(Z.addSeconds(.5),$))),ee.push(d.KeyFrame.makeFromTimeAndStyle(M,$)),Y.animation=d.FormaAnimation.init_9e82(r,Z,M,ee.concat())}}else y||(M=M.add(G));r.endTime=M;for(var te=a.iter(T);!te.done;te.next()){var ne,oe,re=te.value;(ne=a.as(re,z.VideoForma))&&(oe=a.opt(ne.parent,(function(e){return e.controller})))&&!oe.moveable&&g&&this.setStillAnimation(re,r)}!y&&r.endTime.value>0&&this.setStillAnimation(t,r),t.visitAll(m.FormaTraversal.PreOrder,(function(e){var t,n;(t=e.animation)&&(e.kind==f.FrameForma.KIND&&(n=w.ImageFacade.getImageFormaForForma(e))&&null==n.animation&&i.setStillAnimation(n,r),i.validateKeyFrames(a.clone(t.keyFrames),"applyStyle/setStillAnimation"))})),t.endUpdate(u)}else E.LegacyCoreAssert.fail("Unable to fall back on 'None' style while applying animation?!?",void 0,"AnimationLibrary.modifyModelForAnimation","AnimationLibrary.swift",3132),t.animation=null},validateKeyFrames:function(e,t){var n=e.length;if(!(n<=1))for(var o=a.iter(a.range(0,n-1,!1));!o.done;o.next()){var r=o.value,i=e[r],l=e[r+1];i.time.value>l.time.value&&l.time.value>0&&a.opt(S.Host.logging,(function(e){return e.error("keyframe time error on frames "+r+"/"+(r+1)+" with context "+t)}))}}}}),o)},aO0D:function(e,t,n){var o,r,i,a,l,s=t,u=n("oAGj"),c=n("gXiO");s.CropAsset=(o=function(e,t){this.id=e,this.iconId=t},u.defineClass({name:"CropAsset",ctor:o,superName:"CoreObject"}),o),s.CropShape=(r=function(e,t,n){this.fixAspectRatio=n,s.CropAsset.call(this,e,t)},u.defineClass({name:"CropShape",ctor:r,superName:"CropAsset"}),r),s.RasterMask=(i=function(e,t,n,o,r){void 0===r&&(r="image/png"),this.width=n,this.height=o,this.mimeType=r,s.CropAsset.call(this,e,t)},u.defineClass({name:"RasterMask",ctor:i,superName:"CropAsset"}),i),s.CropAssetLibrary=(a=function(){c.CoreObject.call(this)},l={},u.defineClass({name:"CropAssetLibrary",ctor:a,superName:"CoreObject",statics:{shapes:{get:function(){return void 0===l.shapes&&(l.shapes=[new s.CropShape("circle","crop_shape_circle",!0),new s.CropShape("roundedRectangle","crop_shape_roundedRectangle",!1),new s.CropShape("equilateralTriangle","crop_shape_equilateralTriangle",!1),new s.CropShape("rightTriangle","crop_shape_rightTriangle",!1),new s.CropShape("oval","crop_shape_oval",!1),new s.CropShape("halfCircle","crop_shape_halfCircle",!0),new s.CropShape("diamond","crop_shape_diamond",!1),new s.CropShape("hexagon","crop_shape_hexagon",!1),new s.CropShape("parallelogram","crop_shape_parallelogram",!1),new s.CropShape("pentagon","crop_shape_pentagon",!1),new s.CropShape("heart","crop_shape_heart",!0),new s.CropShape("star","crop_shape_star",!0)]),l.shapes}},rasterMasks:{get:function(){return void 0===l.rasterMasks&&(l.rasterMasks=[new s.RasterMask("raster-01","raster-01",1418,1050),new s.RasterMask("raster-Brush-Frame-1","raster-Brush-Frame-1",1126,1050),new s.RasterMask("raster-Brush-Frame-2","raster-Brush-Frame-2",1126,1050),new s.RasterMask("raster-Brush-Frame-3","raster-Brush-Frame-3",1126,1050),new s.RasterMask("raster-Torn-Edge-1","raster-Torn-Edge-1",956,1050),new s.RasterMask("raster-Torn-Edge-2","raster-Torn-Edge-2",755,1050),new s.RasterMask("raster-Torn-Edge-3","raster-Torn-Edge-3",1400,2161),new s.RasterMask("raster-Torn-Edge-4","raster-Torn-Edge-4",956,1050),new s.RasterMask("raster-film-frame-2","raster-film-frame-2",616,1050),new s.RasterMask("raster-film-strip-frame-1","raster-film-strip-frame-1",850,782)]),l.rasterMasks}},getListOfShapes:function(){return a.shapes},getListOfRasterMasks:function(){return a.rasterMasks},getCropShapeFromID:function(e){return a.shapes.find((function(t){return t.id==e}),this)},getRasterMaskFromID:function(e){return a.rasterMasks.find((function(t){return t.id==e}),this)}}}),a)},h67N:function(e,t,n){var o,r=t,i=n("oAGj"),a=n("gXiO"),l=n("6ZWm"),s=n("tQF8"),u=n("4mVB"),c=n("iCxV"),m=n("fdtz"),d=n("fNpk"),h=n("3v9D"),f=n("sIWg");r.GridLibrary=(o=function(){this.gridStyles=[u.GridStyle.init_bf40("Single","Simple",[new s.GridCell(new f.TheoRect(0,0,1,1))],void 0,void 0,void 0,l.CropType.PreserveFocus),u.GridStyle.init_bf40("Single-Overlap","Banner",[new s.GridCell(new f.TheoRect(0,0,1,1)),new s.GridCell(new f.TheoRect(.25,0,.75,1),null,.75)]),u.GridStyle.init_bf40("Single-Center-Overlap","Banner",[new s.GridCell(new f.TheoRect(0,0,1,1)),new s.GridCell(new f.TheoRect(.25,.25,.75,.75),null,.75)]),u.GridStyle.init_bf40("Half-2",void 0,[new s.GridCell(new f.TheoRect(0,0,.5001,1)),new s.GridCell(new f.TheoRect(.5001,0,1,1))]),u.GridStyle.init_bf40("Third-2",void 0,[new s.GridCell(new f.TheoRect(0,0,1/3,1)),new s.GridCell(new f.TheoRect(1/3,0,1,1))]),u.GridStyle.init_bf40("Half-2-1",void 0,[new s.GridCell(new f.TheoRect(0,0,.5001,.5001)),new s.GridCell(new f.TheoRect(0,.5001,.5001,1)),new s.GridCell(new f.TheoRect(.5001,0,1,1))]),u.GridStyle.init_bf40("Third-2-1",void 0,[new s.GridCell(new f.TheoRect(0,0,1/3,1)),new s.GridCell(new f.TheoRect(1/3,0,1,.5001)),new s.GridCell(new f.TheoRect(1/3,.5001,1,1))]),u.GridStyle.init_bf40("Third-3",void 0,[new s.GridCell(new f.TheoRect(0,0,1/3,1)),new s.GridCell(new f.TheoRect(1/3,0,2/3,1)),new s.GridCell(new f.TheoRect(2/3,0,1,1))]),u.GridStyle.init_bf40("Half-2-2",void 0,[new s.GridCell(new f.TheoRect(0,0,.5,.5)),new s.GridCell(new f.TheoRect(0,.5,.5,1)),new s.GridCell(new f.TheoRect(.5,0,1,.5)),new s.GridCell(new f.TheoRect(.5,.5,1,1))]),u.GridStyle.init_bf40("Half-3-1",void 0,[new s.GridCell(new f.TheoRect(0,0,1/3,1/3)),new s.GridCell(new f.TheoRect(0,1/3,1/3,2/3)),new s.GridCell(new f.TheoRect(0,2/3,1/3,1)),new s.GridCell(new f.TheoRect(1/3,0,1,1))]),u.GridStyle.init_bf40("Half-1-3",void 0,[new s.GridCell(new f.TheoRect(0,0,.5001,1)),new s.GridCell(new f.TheoRect(.5001,0,1,1/3)),new s.GridCell(new f.TheoRect(.5001,1/3,1,2/3)),new s.GridCell(new f.TheoRect(.5001,2/3,1,1))]),u.GridStyle.init_bf40("Third-1-2-1",void 0,[new s.GridCell(new f.TheoRect(0,0,1/3,1)),new s.GridCell(new f.TheoRect(1/3,0,2/3,.5001)),new s.GridCell(new f.TheoRect(1/3,.5001,2/3,1)),new s.GridCell(new f.TheoRect(2/3,0,1,1))]),u.GridStyle.init_bf40("Half-2-2-Offset",void 0,[new s.GridCell(new f.TheoRect(.5,0,1,.35)),new s.GridCell(new f.TheoRect(0,.65,.5,1)),new s.GridCell(new f.TheoRect(0,0,.5,.65)),new s.GridCell(new f.TheoRect(.5,.35,1,1))]),u.GridStyle.init_bf40("Fourth-1",void 0,[new s.GridCell(new f.TheoRect(0,0,1/4,1)),new s.GridCell(new f.TheoRect(1/4,0,.5001,1)),new s.GridCell(new f.TheoRect(.5001,0,3/4,1)),new s.GridCell(new f.TheoRect(3/4,0,1,1))]),u.GridStyle.init_bf40("Half-2-3",void 0,[new s.GridCell(new f.TheoRect(0,0,1,.5001)),new s.GridCell(new f.TheoRect(0,.5001,.5001,1)),new s.GridCell(new f.TheoRect(.5001,.5001,1,.75)),new s.GridCell(new f.TheoRect(.5001,.75,1,1))]),u.GridStyle.init_bf40("Half-1-3",void 0,[new s.GridCell(new f.TheoRect(0,0,.5001,1)),new s.GridCell(new f.TheoRect(.5001,0,3/4,.5001)),new s.GridCell(new f.TheoRect(3/4,0,1,.5001)),new s.GridCell(new f.TheoRect(.5001,.5001,1,1))]),u.GridStyle.init_bf40("Third-2-3-2",void 0,[new s.GridCell(new f.TheoRect(0,0,.75,.25)),new s.GridCell(new f.TheoRect(.75,0,1,.75)),new s.GridCell(new f.TheoRect(.25,.25,.75,.75)),new s.GridCell(new f.TheoRect(0,.25,.25,1)),new s.GridCell(new f.TheoRect(.25,.75,1,1))]),u.GridStyle.init_bf40("Third-1-3-1",void 0,[new s.GridCell(new f.TheoRect(0,0,1/3,1)),new s.GridCell(new f.TheoRect(1/3,0,2/3,1/3)),new s.GridCell(new f.TheoRect(1/3,1/3,2/3,2/3)),new s.GridCell(new f.TheoRect(1/3,2/3,2/3,1)),new s.GridCell(new f.TheoRect(2/3,0,1,1))]),u.GridStyle.init_bf40("Fifth-5",void 0,[new s.GridCell(new f.TheoRect(0,0,.2,1)),new s.GridCell(new f.TheoRect(.2,0,.4,1)),new s.GridCell(new f.TheoRect(.4,0,.6,1)),new s.GridCell(new f.TheoRect(.6,0,.8,1)),new s.GridCell(new f.TheoRect(.8,0,1,1))]),u.GridStyle.init_bf40("Third-2-1-2",void 0,[new s.GridCell(new f.TheoRect(0,0,1/3,2/3)),new s.GridCell(new f.TheoRect(0,2/3,1/3,1)),new s.GridCell(new f.TheoRect(1/3,0,2/3,1)),new s.GridCell(new f.TheoRect(2/3,0,1,1/3)),new s.GridCell(new f.TheoRect(2/3,1/3,1,1))]),u.GridStyle.init_bf40("Third-1-1-4",void 0,[new s.GridCell(new f.TheoRect(0,0,2/3,1)),new s.GridCell(new f.TheoRect(2/3,0,1,1/4)),new s.GridCell(new f.TheoRect(2/3,1/4,1,.5001)),new s.GridCell(new f.TheoRect(2/3,.5001,1,3/4)),new s.GridCell(new f.TheoRect(2/3,3/4,1,1))]),u.GridStyle.init_bf40("Split-3-2",void 0,[new s.GridCell(new f.TheoRect(0,0,1/3,.5001)),new s.GridCell(new f.TheoRect(0,.5001,.5001,1)),new s.GridCell(new f.TheoRect(1/3,0,2/3,.5001)),new s.GridCell(new f.TheoRect(2/3,0,1,.5001)),new s.GridCell(new f.TheoRect(.5001,.5001,1,1))]),u.GridStyle.init_bf40("Split-2-3",void 0,[new s.GridCell(new f.TheoRect(0,0,.5001,.5001)),new s.GridCell(new f.TheoRect(0,.5001,1/3,1)),new s.GridCell(new f.TheoRect(.5001,0,1,.5001)),new s.GridCell(new f.TheoRect(1/3,.5001,2/3,1)),new s.GridCell(new f.TheoRect(2/3,.5001,1,1))]),u.GridStyle.init_bf40("Half-3-3",void 0,[new s.GridCell(new f.TheoRect(0,0,.5,1/3)),new s.GridCell(new f.TheoRect(0,1/3,.5,2/3)),new s.GridCell(new f.TheoRect(0,2/3,.5,1)),new s.GridCell(new f.TheoRect(.5,0,1,1/3)),new s.GridCell(new f.TheoRect(.5,1/3,1,2/3)),new s.GridCell(new f.TheoRect(.5,2/3,1,1))]),u.GridStyle.init_bf40("Split-2-2-2",void 0,[new s.GridCell(new f.TheoRect(0,0,1/3,2/3)),new s.GridCell(new f.TheoRect(0,2/3,1/3,1)),new s.GridCell(new f.TheoRect(1/3,0,2/3,.5001)),new s.GridCell(new f.TheoRect(1/3,.5001,2/3,1)),new s.GridCell(new f.TheoRect(2/3,0,1,1/3)),new s.GridCell(new f.TheoRect(2/3,1/3,1,1))]),u.GridStyle.init_bf40("Quarter-2-2-2-2",void 0,[new s.GridCell(new f.TheoRect(0,0,.5001,2/3)),new s.GridCell(new f.TheoRect(0,2/3,1/4,1)),new s.GridCell(new f.TheoRect(1/4,2/3,.5001,1)),new s.GridCell(new f.TheoRect(.5001,0,3/4,1/3)),new s.GridCell(new f.TheoRect(3/4,0,1,1/3)),new s.GridCell(new f.TheoRect(.5001,1/3,1,1))]),u.GridStyle.init_bf40("Third-2-2-3",void 0,[new s.GridCell(new f.TheoRect(0,0,2/3,2/3)),new s.GridCell(new f.TheoRect(0,2/3,1/3,1)),new s.GridCell(new f.TheoRect(1/3,2/3,2/3,1)),new s.GridCell(new f.TheoRect(2/3,0,1,1/3)),new s.GridCell(new f.TheoRect(2/3,1/3,1,2/3)),new s.GridCell(new f.TheoRect(2/3,2/3,1,1))]),u.GridStyle.init_bf40("Third-3-2-2",void 0,[new s.GridCell(new f.TheoRect(0,0,1/3,1/3)),new s.GridCell(new f.TheoRect(0,1/3,1/3,2/3)),new s.GridCell(new f.TheoRect(0,2/3,1/3,1)),new s.GridCell(new f.TheoRect(1/3,0,1,2/3)),new s.GridCell(new f.TheoRect(1/3,2/3,2/3,1)),new s.GridCell(new f.TheoRect(2/3,2/3,1,1))]),u.GridStyle.init_bf40("Split-3-1-3",void 0,[new s.GridCell(new f.TheoRect(0,0,1/3,1/3)),new s.GridCell(new f.TheoRect(0,1/3,1,2/3)),new s.GridCell(new f.TheoRect(0,2/3,1/3,1)),new s.GridCell(new f.TheoRect(1/3,0,2/3,1/3)),new s.GridCell(new f.TheoRect(1/3,2/3,2/3,1)),new s.GridCell(new f.TheoRect(2/3,0,1,1/3)),new s.GridCell(new f.TheoRect(2/3,2/3,1,1))]),u.GridStyle.init_bf40("Split-2-3-2",void 0,[new s.GridCell(new f.TheoRect(0,0,.5001,1/3)),new s.GridCell(new f.TheoRect(0,1/3,1/3,2/3)),new s.GridCell(new f.TheoRect(0,2/3,.5001,1)),new s.GridCell(new f.TheoRect(1/3,1/3,2/3,2/3)),new s.GridCell(new f.TheoRect(.5001,0,1,1/3)),new s.GridCell(new f.TheoRect(2/3,1/3,1,2/3)),new s.GridCell(new f.TheoRect(.5001,2/3,1,1))]),u.GridStyle.init_bf40("Half-4-4",void 0,[new s.GridCell(new f.TheoRect(0,0,.5001,1/4)),new s.GridCell(new f.TheoRect(0,1/4,.5001,.5001)),new s.GridCell(new f.TheoRect(0,.5001,.5001,3/4)),new s.GridCell(new f.TheoRect(0,3/4,.5001,1)),new s.GridCell(new f.TheoRect(.5001,0,1,1/4)),new s.GridCell(new f.TheoRect(.5001,1/4,1,.5001)),new s.GridCell(new f.TheoRect(.5001,.5001,1,3/4)),new s.GridCell(new f.TheoRect(.5001,3/4,1,1))]),u.GridStyle.init_bf40("Split-3-2-3",void 0,[new s.GridCell(new f.TheoRect(0,0,1/3,1/3)),new s.GridCell(new f.TheoRect(0,1/3,.5001,2/3)),new s.GridCell(new f.TheoRect(0,2/3,1/3,1)),new s.GridCell(new f.TheoRect(1/3,0,2/3,1/3)),new s.GridCell(new f.TheoRect(1/3,2/3,2/3,1)),new s.GridCell(new f.TheoRect(2/3,0,1,1/3)),new s.GridCell(new f.TheoRect(.5001,1/3,1,2/3)),new s.GridCell(new f.TheoRect(2/3,2/3,1,1))]),u.GridStyle.init_bf40("Third-3-3-3",void 0,[new s.GridCell(new f.TheoRect(0,0,1/3,1/3)),new s.GridCell(new f.TheoRect(0,1/3,1/3,2/3)),new s.GridCell(new f.TheoRect(0,2/3,1/3,1)),new s.GridCell(new f.TheoRect(1/3,0,2/3,1/3)),new s.GridCell(new f.TheoRect(1/3,1/3,2/3,2/3)),new s.GridCell(new f.TheoRect(1/3,2/3,2/3,1)),new s.GridCell(new f.TheoRect(2/3,0,1,1/3)),new s.GridCell(new f.TheoRect(2/3,1/3,1,2/3)),new s.GridCell(new f.TheoRect(2/3,2/3,1,1))]),u.GridStyle.init_bf40("Third-4-1-4",void 0,[new s.GridCell(new f.TheoRect(0,0,1/3,1/4)),new s.GridCell(new f.TheoRect(0,1/4,1/3,.5001)),new s.GridCell(new f.TheoRect(0,.5001,1/3,3/4)),new s.GridCell(new f.TheoRect(0,3/4,1/3,1)),new s.GridCell(new f.TheoRect(1/3,0,2/3,1)),new s.GridCell(new f.TheoRect(2/3,0,1,1/4)),new s.GridCell(new f.TheoRect(2/3,1/4,1,.5001)),new s.GridCell(new f.TheoRect(2/3,.5001,1,3/4)),new s.GridCell(new f.TheoRect(2/3,3/4,1,1))]),u.GridStyle.init_bf40("Third-4-3-2",void 0,[new s.GridCell(new f.TheoRect(0,0,1/3,1/4)),new s.GridCell(new f.TheoRect(0,1/4,1/3,.5001)),new s.GridCell(new f.TheoRect(0,.5001,1/3,3/4)),new s.GridCell(new f.TheoRect(0,3/4,1/3,1)),new s.GridCell(new f.TheoRect(1/3,0,2/3,1/3)),new s.GridCell(new f.TheoRect(1/3,1/3,2/3,2/3)),new s.GridCell(new f.TheoRect(1/3,2/3,2/3,1)),new s.GridCell(new f.TheoRect(2/3,0,1,.5001)),new s.GridCell(new f.TheoRect(2/3,.5001,1,1))]),u.GridStyle.init_bf40("Split-2-3-4",void 0,[new s.GridCell(new f.TheoRect(0,0,.5001,1/3)),new s.GridCell(new f.TheoRect(0,1/3,1/3,2/3)),new s.GridCell(new f.TheoRect(0,2/3,1/4,1)),new s.GridCell(new f.TheoRect(.5001,0,1,1/3)),new s.GridCell(new f.TheoRect(1/3,1/3,2/3,2/3)),new s.GridCell(new f.TheoRect(1/4,2/3,.5001,1)),new s.GridCell(new f.TheoRect(2/3,1/3,1,2/3)),new s.GridCell(new f.TheoRect(.5001,2/3,3/4,1)),new s.GridCell(new f.TheoRect(3/4,2/3,1,1))])],a.CoreObject.call(this)},i.defineClass({name:"GridLibrary",ctor:o,superName:"CoreObject",props:{layoutSuggestionModel:{get:function(){return null==this.layoutSuggestionModel_&&(this.layoutSuggestionModel_=i.opt(c.Host.learning,(function(e){return e.loadLayoutSuggestionModel()}))),this.layoutSuggestionModel_},set:function(e){this.layoutSuggestionModel_=e}},canFlipStyle:function(e){return!["Single","Single-Center-Overlap","Half-2-2","Third-2-3-2","Third-2-3-2-Spaced","Third-3-3-3","Third-2-2-3","Half-2-3","Third-4-3-2","Half-1-3","Third-3-2-2","Split-2-3-4"].includes(e.name)},basicFullDesignGridStyle:function(){var e=this.getGridStyle("Single");return e.moveableShift=!1,e},getAllGrids:function(){for(var e=[],t=i.iter(this.gridStyles);!t.done;t.next()){var n=t.value;e.push(n),this.canFlipStyle(n)&&e.push(n.flipRegion())}return e},getLayoutsForRoot:function(e,t){void 0===t&&(t=null);var n,o=[],r=[];if(!(n=e.controller.getGridController()))return d.LegacyCoreAssert.fail("should always have a grid at this point",void 0,"GridLibrary.getLayoutsForRoot","GridLibrary.swift",558),[];for(var a=h.LayoutSuggester.init_abc1(n.forma,i.clone(t)),l=i.clone(e.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}))),s=i.clone(e.filterWithCallback((function(e){return null!=e.parent&&e.parent.isBackgroundImage()}))),u=s.length,c=!0,f=i.iter(s);!f.done;f.next()){var p=f.value;if(i.opt(i.opt(i.as(p,m.ImageForma),(function(e){return e.contentNode})),(function(e){return null==e.focusRegion}))){c=!1;break}}var g=[],y=1,T=c&&u>1?1:0,C=c?1:2,S=c?1:0;u>5&&(c?(y=0==l.length?2:1,T=0==l.length?2:1,C=0==l.length?0:1,S=0==l.length?0:1):(y=0==l.length?4:2,C=0==l.length?0:2));var v,_=i.clone(a.createSuggestions(!0,!1,!1,!1,y));(r=i.clone(a.createEqualSizeSuggestions(!1,10)),i.append(_,r),_.length>0&&i.append(g,_.slice(0,Math.min(y,_.length))),c&&(_=i.clone(a.createSuggestions(!0,!1,!1,!0,T))).length>0&&i.append(g,_.slice(0,Math.min(T,_.length))),0==!l.length)&&((v=i.clone(a.createSuggestions(!0,!1,!0,!1,C))).length>0&&i.append(g,v.slice(0,Math.min(C,v.length))),c&&(v=i.clone(a.createSuggestions(!0,!1,!0,!0,S))).length>0&&i.append(g,v.slice(0,Math.min(S,v.length))),i.append(r,a.createEqualSizeSuggestions(!0,10)));for(var F=i.iter(i.range(0,g.length,!1));!F.done;F.next())(P=g[x=F.value]).gridStyle.name="ContentAwareGrid-"+i.toString(x),P.gridStyle.category="Suggested",P.gridStyle.forma=n.forma,o.push(P.gridStyle);for(var w=i.clone(a.predictLayoutIds(3,i.clone(o))),A=i.iter(w);!A.done;A.next()){var E=A.value;if(L=this.getGridStyle(E)){var b=L.clone();b.category="Suggested",o.push(b)}}for(var D=e.filterWithCallback((function(e){return e.isBackgroundImage()})).length,I=[],R=i.iter(this.gridStyles);!R.done;R.next()){var L;(L=R.value).nonOverlappingCells().length>=D&&(o.push(L),I.push(L),this.canFlipStyle(L)&&(o.push(L.flipRegion()),I.push(L.flipRegion())))}for(var k=i.iter(i.range(0,r.length,!1));!k.done;k.next()){for(var x,P,M=(P=r[x=k.value]).gridStyle,G=!1,K=i.iter(I);!K.done;K.next())if(K.value.geometricEquals(M)){G=!0;break}G||o.push(M)}return o},getGridsByCellNumber:function(e,t){if(void 0===t&&(t=!0),1==e&&0==t)return[this.getGridStyle("Single")];for(var n=[],o=i.iter(this.gridStyles);!o.done;o.next()){var r=o.value,a=r.nonOverlappingCells().length;(t?a>=e:a==e)&&!r.anyOverlap&&(n.push(r),this.canFlipStyle(r)&&n.push(r.flipRegion()))}return 0==n.length&&d.LegacyCoreAssert.fail("No matching grids in the library. Need to implement a generic grid creator.",void 0,"GridLibrary.getGridsByCellNumber","GridLibrary.swift",623),n},getGridStyle:function(e){for(var t,n=i.iter(this.gridStyles);!n.done;n.next()){var o=n.value;if(e==o.name){t=o;break}if(this.canFlipStyle(o)){var r=o.flipRegion();if(e==r.name){t=r;break}}}return t},getCategoryForStyle:function(e){var t;return null!=(t=e.category)?t:"Single"==e.name?"Simple":e.name.includes("Overlap")?"Banner":e.name.includes("ContentAwareGrid")?"Suggested":"Grid"}}}),o)},lqhW:function(e,t,n){var o,r,i,a,l=t,s=n("oAGj"),u=n("gXiO"),c=n("ylxa"),m=n("1NAc");l.DesignSize=(o=function(e,t,n,o,r,i,a){this.label=e,this.subLabel=t,this.id=n,this.iconId=o,this.category=r,this.aspectRatio=i,this.exportData=a},s.defineClass({name:"DesignSize",ctor:o,superName:"CoreObject"}),o),l.DesignSizeCategory=(r=function(e,t){this.id=e,this.label=t},s.defineClass({name:"DesignSizeCategory",ctor:r,superName:"CoreObject"}),r),l.DesignSizeCategories=(i=function(){u.CoreObject.call(this)},a={},s.defineClass({name:"DesignSizeCategories",ctor:i,superName:"CoreObject",statics:{SocialPost:{get:function(){return void 0===a.SocialPost&&(a.SocialPost=new l.DesignSizeCategory("socialPost","SOCIAL POST")),a.SocialPost}},Print:{get:function(){return void 0===a.Print&&(a.Print=new l.DesignSizeCategory("print","PRINT")),a.Print}},SocialProfile:{get:function(){return void 0===a.SocialProfile&&(a.SocialProfile=new l.DesignSizeCategory("socialProfile","SOCIAL PROFILE")),a.SocialProfile}},Standard:{get:function(){return void 0===a.Standard&&(a.Standard=new l.DesignSizeCategory("standard","STANDARD")),a.Standard}},Custom:{get:function(){return void 0===a.Custom&&(a.Custom=new l.DesignSizeCategory("Custom","Custom")),a.Custom}},Default:{get:function(){return void 0===a.Default&&(a.Default=new l.DesignSizeCategory("Default","Default")),a.Default}},getCategories:function(){return[i.SocialPost,i.Print,i.SocialProfile,i.Standard]}}}),i),l.DesignSizeLibrary=function(){var e=function(){u.CoreObject.call(this)},t={};return s.defineClass({name:"DesignSizeLibrary",ctor:e,superName:"CoreObject",statics:{MAX_EDGE:2560,designSizes:{get:function(){return void 0===t.designSizes&&(t.designSizes=[new l.DesignSize("k_Instagram_label","k_Instagram_subLabel","Instagram","instagram_icon",l.DesignSizeCategories.SocialPost,1,new c.FormaPageExportData(new m.TheoSize(1080,1080),c.PageExportFormat.PIXELS)),new l.DesignSize("k_InstagramStory_label","k_InstagramStory_subLabel","InstagramStory","instagram_icon",l.DesignSizeCategories.SocialPost,.5625,new c.FormaPageExportData(new m.TheoSize(1080,1920),c.PageExportFormat.PIXELS)),new l.DesignSize("k_InstagramPortrait_label","k_InstagramPortrait_subLabel","InstagramPortrait","instagram_icon",l.DesignSizeCategories.SocialPost,.8,new c.FormaPageExportData(new m.TheoSize(1080,1350),c.PageExportFormat.PIXELS)),new l.DesignSize("k_InstagramLandscape_label","k_InstagramLandscape_subLabel","InstagramLandscape","instagram_icon",l.DesignSizeCategories.SocialPost,1.91,new c.FormaPageExportData(new m.TheoSize(1080,566),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Facebook_label","k_Facebook_subLabel","Facebook","facebook_icon",l.DesignSizeCategories.SocialPost,1.91,new c.FormaPageExportData(new m.TheoSize(1200,628),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Pinterest_label","k_Pinterest_subLabel","Pinterest","pinterest_icon",l.DesignSizeCategories.SocialPost,.666969147,new c.FormaPageExportData(new m.TheoSize(735,1102),c.PageExportFormat.PIXELS)),new l.DesignSize("k_YouTubeThumbnail_label","k_YouTubeThumbnail_subLabel","YouTubeThumbnail","youtube_icon",l.DesignSizeCategories.SocialPost,1.77777777778,new c.FormaPageExportData(new m.TheoSize(1280,720),c.PageExportFormat.PIXELS)),new l.DesignSize("k_LinkedInBlogPost_label","k_LinkedInBlogPost_subLabel","LinkedInBlogPost","linkedin_icon",l.DesignSizeCategories.SocialPost,1.91082803,new c.FormaPageExportData(new m.TheoSize(1200,628),c.PageExportFormat.PIXELS)),new l.DesignSize("k_SnapchatStory_label","k_SnapchatStory_subLabel","SnapchatStory","snapchat_icon",l.DesignSizeCategories.SocialPost,.5625,new c.FormaPageExportData(new m.TheoSize(1080,1920),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Twitter_label","k_Twitter_subLabel","Twitter","twitter_icon",l.DesignSizeCategories.SocialPost,1.79104477612,new c.FormaPageExportData(new m.TheoSize(1200,670),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Letter_label","k_Letter_subLabel","Letter","",l.DesignSizeCategories.Print,.772727,new c.FormaPageExportData(new m.TheoSize(8.5,11),c.PageExportFormat.INCHES,c.FormaPageExportData.DEFAULT_PPI)),new l.DesignSize("k_Poster_label","k_Poster_subLabel","Poster","",l.DesignSizeCategories.Print,.647,new c.FormaPageExportData(new m.TheoSize(11,17),c.PageExportFormat.INCHES,c.FormaPageExportData.DEFAULT_PPI)),new l.DesignSize("k_Card_label","k_Card_subLabel","Card","",l.DesignSizeCategories.Print,.71428571,new c.FormaPageExportData(new m.TheoSize(5,7),c.PageExportFormat.INCHES,c.FormaPageExportData.DEFAULT_PPI)),new l.DesignSize("k_A5_label","k_A5_subLabel","A5","",l.DesignSizeCategories.Print,.70483871,new c.FormaPageExportData(new m.TheoSize(148,210),c.PageExportFormat.MILLIMETERS,c.FormaPageExportData.DEFAULT_PPI)),new l.DesignSize("k_A4_label","k_A4_subLabel","A4","",l.DesignSizeCategories.Print,.70695553,new c.FormaPageExportData(new m.TheoSize(210,297),c.PageExportFormat.MILLIMETERS,c.FormaPageExportData.DEFAULT_PPI)),new l.DesignSize("k_A3_label","k_A3_subLabel","A3","",l.DesignSizeCategories.Print,.7071155,new c.FormaPageExportData(new m.TheoSize(297,420),c.PageExportFormat.MILLIMETERS,c.FormaPageExportData.DEFAULT_PPI)),new l.DesignSize("k_FacebookProfileCover_label","k_FacebookProfileCover_subLabel","FacebookProfileCover","facebook_icon",l.DesignSizeCategories.SocialProfile,2.62820513,new c.FormaPageExportData(new m.TheoSize(1640,624),c.PageExportFormat.PIXELS)),new l.DesignSize("k_PageCover_label","k_PageCover_subLabel","FacebookPageCover","facebook_icon",l.DesignSizeCategories.SocialProfile,1.77777777778,new c.FormaPageExportData(new m.TheoSize(1200,675),c.PageExportFormat.PIXELS)),new l.DesignSize("k_EventCover_label","k_EventCover_subLabel","FacebookEventCover","facebook_icon",l.DesignSizeCategories.SocialProfile,1.91,new c.FormaPageExportData(new m.TheoSize(1920,1005),c.PageExportFormat.PIXELS)),new l.DesignSize("k_YouTubeChannelArt_label","k_YouTubeChannelArt_subLabel","YouTubeChannelArt","youtube_icon",l.DesignSizeCategories.SocialProfile,1.77777777778,new c.FormaPageExportData(new m.TheoSize(2560,1440),c.PageExportFormat.PIXELS)),new l.DesignSize("k_TwitchBanner_label","k_TwitchBanner_subLabel","TwitchBanner","twitch_icon",l.DesignSizeCategories.SocialProfile,4,new c.FormaPageExportData(new m.TheoSize(1920,480),c.PageExportFormat.PIXELS)),new l.DesignSize("k_TwitterHeader_label","k_TwitterHeader_subLabel","TwitterHeader","twitter_icon",l.DesignSizeCategories.SocialProfile,3,new c.FormaPageExportData(new m.TheoSize(1500,500),c.PageExportFormat.PIXELS)),new l.DesignSize("k_EtsyCover_label","k_EtsyCover_subLabel","EtsyCover","etsy_icon",l.DesignSizeCategories.SocialProfile,4,new c.FormaPageExportData(new m.TheoSize(3360,840),c.PageExportFormat.PIXELS)),new l.DesignSize("k_LinkedInProfileCover_label","k_LinkedInProfileCover_subLabel","LinkedInProfileCover","linkedin_icon",l.DesignSizeCategories.SocialProfile,3.878787878787879,new c.FormaPageExportData(new m.TheoSize(1536,396),c.PageExportFormat.PIXELS)),new l.DesignSize("k_EventbriteEventImage_label","k_EventbriteEventImage_subLabel","EventbriteEventImage","eventbrite_icon",l.DesignSizeCategories.SocialProfile,2,new c.FormaPageExportData(new m.TheoSize(2160,1080),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Phone_label","k_Phone_subLabel","iPhone","phone_icon",l.DesignSizeCategories.Standard,.5625,new c.FormaPageExportData(new m.TheoSize(1080,1920),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Square_label","k_Square_subLabel","Square","",l.DesignSizeCategories.Standard,1,new c.FormaPageExportData(new m.TheoSize(2560,2560),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Landscape_label","k_Landscape_subLabel","3:2","",l.DesignSizeCategories.Standard,1.5,new c.FormaPageExportData(new m.TheoSize(2550,1700),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Slide_label","k_Slide_subLabel","4:3","",l.DesignSizeCategories.Standard,1.33333333333,new c.FormaPageExportData(new m.TheoSize(2560,1920),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Widescreen_label","k_Widescreen_subLabel","16:9","",l.DesignSizeCategories.Standard,1.77777777778,new c.FormaPageExportData(new m.TheoSize(2560,1440),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Portrait_label","k_Portrait_subLabel","2:3","",l.DesignSizeCategories.Standard,.66666666666,new c.FormaPageExportData(new m.TheoSize(1700,2550),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Banner_label","k_Banner_subLabel","3:1","",l.DesignSizeCategories.Standard,3,new c.FormaPageExportData(new m.TheoSize(2559,853),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Wide_label","k_Wide_subLabel","2:1","",l.DesignSizeCategories.Standard,2,new c.FormaPageExportData(new m.TheoSize(2560,1280),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Tall_label","k_Tall_subLabel","1:2","",l.DesignSizeCategories.Standard,.5,new c.FormaPageExportData(new m.TheoSize(1280,2560),c.PageExportFormat.PIXELS)),new l.DesignSize("k_SparkVideoSlide_label","k_SparkVideoSlide_subLabel","SparkVideoSlide","sparkvideo_icon",l.DesignSizeCategories.Standard,1.77777777778,new c.FormaPageExportData(new m.TheoSize(1280,720),c.PageExportFormat.PIXELS)),new l.DesignSize("k_SparkVideoSlideSquare_label","k_SparkVideoSlideSquare_subLabel","SparkVideoSlideSquare","sparkvideo_icon",l.DesignSizeCategories.Standard,1,new c.FormaPageExportData(new m.TheoSize(720,720),c.PageExportFormat.PIXELS)),new l.DesignSize("k_KindleCover_label","k_KindleCover_subLabel","KindleCover","kindle_icon",l.DesignSizeCategories.Standard,.625,new c.FormaPageExportData(new m.TheoSize(1600,2560),c.PageExportFormat.PIXELS)),new l.DesignSize("k_BlogPost_label","k_BlogPost_subLabel","BlogPost","blog_icon",l.DesignSizeCategories.Standard,1.78,new c.FormaPageExportData(new m.TheoSize(712,400),c.PageExportFormat.PIXELS))]),t.designSizes}},getListOfResizeShapes:function(){return e.designSizes},getById:function(t){for(var n=s.iter(e.designSizes);!n.done;n.next()){var o=n.value;if(o.id==t)return o}return null},getCustomSize:function(e,t,n,o){return new l.DesignSize("k_Custom_label","k_Custom_subLabel","Custom","custom_icon",l.DesignSizeCategories.Custom,e/t,new c.FormaPageExportData(new m.TheoSize(e,t),n,n==c.PageExportFormat.PIXELS?null:o))},getOriginalSize:function(e,t){return new l.DesignSize("k_OriginalSize_label","","Original","",l.DesignSizeCategories.Default,e/t,new c.FormaPageExportData(new m.TheoSize(e,t),c.PageExportFormat.PIXELS))},getByCategory:function(t){return e.designSizes.filter((function(e){return e.category.id==t}),this)}}}),e}()},oknb:function(e,t,n){var o,r,i=t,a=n("oAGj"),l=n("90dd"),s=n("ZoS2");i.ControllerSettingsState=(o=function(){s.TheoPublishingObject.call(this)},a.defineClass({name:"ControllerSettingsState",ctor:o,superName:"TheoPublishingObject",statics:{_implements:function(e){return"TheoMessagePublisher"==e}},props:{settings:{get:function(){return this.settings_},set:function(e){this.settings_=e,this.publish(new i.ControllerSettingsStateChangeMessage(this,this.settings))}}}}),o),i.ControllerSettingsStateChangeMessage=(r=function e(t,n){this.settings=n,l.TheoMessage.call(this,e.TYPE,t)},a.defineClass({name:"ControllerSettingsStateChangeMessage",ctor:r,superName:"TheoMessage",statics:{TYPE:{get:function(){return"ControllerSettingsStateChangeMessage"}}}}),r)},quOg:function(e,t,n){var o,r,i,a,l=t,s=n("oAGj"),u=n("0wFF"),c=n("oknb"),m=n("qUXk"),d=n("7S/6"),h=n("BbDD"),f=n("7siz"),p=n("waL6"),g=n("yHU1"),y=n("Pil/"),T=n("OdB2"),C=n("P83h"),S=n("iCxV"),v=n("g8Fi"),_=n("KIfs"),F=n("i5Hy"),w=n("n/CE"),A=n("9YN4"),E=n("90dd"),b=n("ZoS2"),D=n("rrhp");l.InteractionMode=s.defineEnum("InteractionMode",{DefaultInteraction:0,SelectionFocused:1,AutomaticGrid:2}),l.ClickMessage=(o=function e(t,n){this.state=t,E.TheoMessage.call(this,e.TYPE,n)},s.defineClass({name:"ClickMessage",ctor:o,superName:"TheoMessage",statics:{TYPE:{get:function(){return"ClickMessage"}}}}),o),l.DoubleClickMessage=(r=function e(t,n){this.state=t,E.TheoMessage.call(this,e.TYPE,n)},s.defineClass({name:"DoubleClickMessage",ctor:r,superName:"TheoMessage",statics:{TYPE:{get:function(){return"DoubleClickMessage"}}}}),r),l.DesignControllerPSMDelegate=(i=function(e){this.dc=e},s.defineClass({name:"DesignControllerPSMDelegate",ctor:i,statics:{_implements:function(e){return"IPSMDelegate"==e}},props:{handleEvent:function(e){var t,n,o,r;(t=s.as(e,y.PSMFormaDragControllerEvent))?this.dc.designControllerHandlesPointers?this.dc.designController.handles.handleFormaDragEvents(t):t.dragDelegate.dragController.onEvent(t):(n=s.as(e,y.BeginPointerTrackingEvent))?s.opt(n.forma.controller,(function(e){return e.onEvent(n)})):(o=s.as(e,y.FormaClickEvent))?this.dc.designControllerHandlesPointers?this.dc.designController.click.handleClick(o):s.opt(o.forma.controller,(function(e){return e.onEvent(o)})):(r=s.as(e,y.FormaDoubleClickEvent))&&(this.dc.designControllerHandlesPointers?this.dc.designController.click.handleDoubleClick(r):s.opt(r.forma.controller,(function(e){return e.onEvent(r)})))}}}),i),l.DocumentController=(a=function(){var e;this.blockNonSelectedUpdates_=!1,this.interactionMode_=l.InteractionMode.DefaultInteraction,this.pointerStateMachine_=null,this.viewScale_=1,this.designControllerHandlesPointers=!1,this.designControllerHandlesSwap=!0,this.enableMoveableChildren=!1,this.formaEventStackCounter=0,this.currentGestureActionsLogged=[],this.currentGestureScope="",this.controllerFactory_=new p.FormaControllerFactory(null),this.pointers_=new v.PointersState,this.selection_=new w.SelectionState,this.editorModel_=new f.EditorModel,this.designControllerFactory_=new d.DesignControllerFactory,this.controllerSettingsState_=new c.ControllerSettingsState,this.undoRedoMgr_=new D.UndoRedoManager(((e=s.opt(S.Host.platform,(function(e){return e.isMobile})))||null!=e)&&e?D.UndoRedoSelectionPolicyEnum.PreserveSelection:D.UndoRedoSelectionPolicyEnum.RestoreSelection),this.designController_=m.DesignController.NullController,this.saveMgr_=new F.SaveManager,b.TheoPublishingObject.call(this),this.controllerFactory_.owner=this,this.pointers_.owner=this,this.selection_.owner=this,this.editorModel_.owner=this,this.designControllerFactory_.owner=this,this.controllerSettingsState_.owner=this,this.undoRedoMgr_.owner=this,this.saveMgr_.owner=this,this.updateEditorModel(),this.selection_.subscribe(this,w.SelectionStateChangedMessage.TYPE),this.selection_.subscribe(this,w.SelectionStateModeChangedMessage.TYPE),this.pointers_.subscribe(this,v.PointersStateChangeMessage.TYPE),h.DocumentSingletonTracker.creatingDocumentSingleton(this)},s.defineClass({name:"DocumentController",ctor:a,superName:"TheoPublishingObject",statics:{_implements:function(e){return"TheoMessageSubscriber"==e||"TheoMessagePublisher"==e}},props:{controllerFactory:{get:function(){return this.controllerFactory_}},document:{get:function(){return this.doc_}},selection:{get:function(){return this.selection_}},model:{get:function(){return this.editorModel_}},designController:{get:function(){return this.designController_}},controllerSettingsState:{get:function(){return this.controllerSettingsState_}},pointers:{get:function(){return this.pointers_}},pointerStateMachine:{get:function(){return this.pointerStateMachine_}},undoRedoMgr:{get:function(){return this.undoRedoMgr_}},saveMgr:{get:function(){return this.saveMgr_}},updateEditorModel:function(){var e=this;this.designController_=this.designControllerFactory_.getNewDesignController(this.editorModel_),this.editorModel_.beginUpdates(),s.opt(this.designController_,(function(t){return t.configureEditorModel(e.editorModel_)})),this.editorModel_.updatesComplete()},onMessage:function(e){var t,n,o,r;if(e instanceof w.SelectionStateChangedMessage)this.formaEventStackCounter=0,this.updateEditorModel();else if(e instanceof w.SelectionStateModeChangedMessage)this.updateEditorModel();else if(t=s.as(e,v.PointersStateChangeMessage))null==this.pointerStateMachine_&&t.changeType==v.PointersStateChangeTypeEnum.PointersDown?(this.pointerStateMachine_=new _.PointerStateMachine(new g.FormaPagePointerStateMachineDelegate(new l.DesignControllerPSMDelegate(this))),this.pointerStateMachine_.attach(this,this.pointers),this.pointerStateMachine_.onMessage(t)):null!=this.pointerStateMachine_&&0==this.pointers.pointerDownCount()&&(this.pointerStateMachine_.onMessage(t),this.pointerStateMachine_.detach(),this.pointerStateMachine_=null);else if(n=s.as(e,T.FormaBeginUpdateMessage))this.selection.isSelected(n.event.forma)&&(this.formaEventStackCounter+=1);else if(o=s.as(e,T.FormaEndUpdateMessage))(o.event instanceof C.FormaGroupEvent||o.event instanceof C.FormaUngroupEvent)&&this.updateEditorModel(),this.selection.isSelected(o.event.forma)&&this.formaEventStackCounter>0&&(this.formaEventStackCounter-=1,0==this.formaEventStackCounter&&this.updateHandlesAndAnnotations());else if(r=s.as(e,A.TheoDocumentDidDecodeMessage)){var i;(i=s.opt(r.document,(function(e){return e.firstPage})))&&this.subscribeToPage(i),this.updateEditorModel()}else e instanceof T.BeginFormaResizeMessage?s.opt(this.formaPageView,(function(e){return e.beginUserResize()})):e instanceof T.EndFormaResizeMessage&&s.opt(this.formaPageView,(function(e){return e.endUserResize()}))},notifyClick:function(e){this.publish(new l.ClickMessage(e,this))},notifyDoubleClick:function(e){this.publish(new l.DoubleClickMessage(e,this))},formaUpdateSubscription:{get:function(){return this.formaUpdateSubscription_},set:function(e){var t;(t=this.formaUpdateSubscription_)&&t.unsubscribe(),this.formaUpdateSubscription_=e}},beginFormaResizeSubscription:{get:function(){return this.beginFormaResizeSubscription_},set:function(e){s.opt(this.beginFormaResizeSubscription_,(function(e){return e.unsubscribe()})),this.beginFormaResizeSubscription_=e}},endFormaResizeSubscription:{get:function(){return this.endFormaResizeSubscription_},set:function(e){s.opt(this.endFormaResizeSubscription_,(function(e){return e.unsubscribe()})),this.endFormaResizeSubscription_=e}},subscribeToPage:function(e){this.formaUpdateSubscription=e.subscribe(this,T.FormaEndUpdateMessage.TYPE),e.subscribe(this,T.FormaBeginUpdateMessage.TYPE),this.beginFormaResizeSubscription=e.subscribe(this,T.BeginFormaResizeMessage.TYPE),this.endFormaResizeSubscription=e.subscribe(this,T.EndFormaResizeMessage.TYPE)},attach:function(e){var t,n=this;this.doc_=e,this.updateEditorModel(),(t=s.opt(this.doc_,(function(e){return e.firstPage})))&&this.subscribeToPage(t),s.opt(e,(function(e){return e.subscribe(n,A.TheoDocumentDidDecodeMessage.TYPE)})),this.undoRedoMgr_.setup()},canDoAction:function(e){return this.designController.actions.canDoAction(e)},doAction:function(e){var t=!1;this.doActionWithCompletion(e,(function(e,n){t=!0})),t||s.opt(S.Host.logging,(function(e){return e.warning("You've called doAction() which may presume the action is synchronous, but it's not. Consider using doActionWithCompletion instead.")}))},doActionWithCompletion:function(e,t){var n=null!=this.undoRedoMgr_.gestureScope,o=!1;if(n&&(this.undoRedoMgr_.gestureScope!=this.currentGestureScope&&(this.currentGestureActionsLogged=[],this.currentGestureScope=this.undoRedoMgr_.gestureScope),(o=null!=s.indexOf(this.currentGestureActionsLogged,e.type))||this.currentGestureActionsLogged.push(e.type)),!n||n&&!o){var r=this.selection.asFormaArray().map((function(e){return e.kind}),this);s.opt(S.Host.logging,(function(t){return t.logToAnalytics(u.AnalyticsConstants.kAnalyticsDataActionPerformed,{contextualData2:e.type,contextualData3:"Formae Selected: ["+r.join(",")+"]"})})),s.opt(S.Host.logging,(function(t){return t.logBreadcrumbToNewRelic(e.type,{formaeInvolved:"["+r.join(",")+"]"})}))}this.designController.actions.doActionWithCallback(e,t)},allowSelectionChanges:{get:function(){return this.interactionMode_!=l.InteractionMode.SelectionFocused}},undoWithCompletion:function(e){this.undoRedoMgr.undo(e)},redoWithCompletion:function(e){this.undoRedoMgr.redo(e)},setSelectionFocusedInteraction:function(){this.interactionMode_=l.InteractionMode.SelectionFocused},inSelectionFocusedInteractionMode:{get:function(){return this.interactionMode_==l.InteractionMode.SelectionFocused}},setAutomaticLayoutInteractionMode:function(){this.interactionMode_=l.InteractionMode.AutomaticGrid},inAutomaticLayoutInteractionMode:{get:function(){return this.interactionMode_==l.InteractionMode.AutomaticGrid}},setDefaultInteractionMode:function(){this.interactionMode_=l.InteractionMode.DefaultInteraction},inDefaultInteractionMode:{get:function(){return this.interactionMode_==l.InteractionMode.DefaultInteraction}},interactionMode:{get:function(){return this.interactionMode_},set:function(e){this.interactionMode_=e}},viewScale:{get:function(){return this.viewScale_},set:function(e){this.viewScale_=e}},formaPageView:{get:function(){return s.opt(this.doc_,(function(e){return e.firstPage.view}))}},updateHandles:function(){var e=this;this.editorModel_.beginUpdates(),s.opt(this.designController_,(function(t){return t.handles.updateHandles(e.editorModel_.mutable.handles)})),this.editorModel_.updatesComplete()},updateAnnotations:function(){var e=this;this.editorModel_.beginUpdates(),s.opt(this.designController_,(function(t){return t.annotations.updateAnnotations(e.editorModel_.mutable.annotations)})),this.editorModel_.updatesComplete()},updateHandlesAndAnnotations:function(){var e=this;this.editorModel_.beginUpdates(),s.opt(this.designController_,(function(t){return t.handles.updateHandles(e.editorModel_.mutable.handles)})),s.opt(this.designController_,(function(t){return t.annotations.updateAnnotations(e.editorModel_.mutable.annotations)})),this.editorModel_.updatesComplete()}}}),a)},yhkb:function(e,t,n){var o,r,i=t,a=n("oAGj"),l=n("kYI4"),s=n("9WSY"),u=n("gXiO"),c=n("C42b"),m=n("ascj"),d=n("dJuF"),h=n("FNB+"),f=n("9Lk3"),p=n("m404"),g=n("fdtz"),y=n("fNpk"),T=n("c+uM"),C=n("jcfx"),S=n("Zifs"),v=n("aN2p"),_=n("umUn");i.ColorLibraryController=(o=function e(t,n){this._themeKeys=null,this.DERIVED_LIGHT_BRIGHTNESS=.98,this.DERIVED_LIGHT_SATURATION=.03,this.DERIVED_DARK_BRIGHTNESS=.05;var o=this;u.CoreObject.call(this),this.library=t,this.document=n,this.librarySubscription_=a.opt(this.library,(function(e){return e.subscribe(o,s.ColorLibraryChangedMessage.TYPE)})),this.library.setColors({black:_.TheoColor.init_5344(S.SolidColor.BLACK,null,null),white:_.TheoColor.init_5344(S.SolidColor.WHITE,null,null)}),null==t.color("themeColor0")&&null==t.color("themeColor1")&&this.library.setColors({themeColor0:_.TheoColor.init_5344(e.defaultColor0,null,null),themeColor1:_.TheoColor.init_5344(e.defaultColor1,null,null),themeDerivedDark:_.TheoColor.init_5344(new S.SolidColor(.1,0,.1,1),null,null),themeDerivedLight:_.TheoColor.init_5344(new S.SolidColor(1,.9,1,1),null,null)})},r={},a.defineClass({name:"ColorLibraryController",ctor:o,superName:"CoreObject",statics:{kDefaultNumThemeColors:5,BLACK_KEY:"black",WHITE_KEY:"white",USER_KEY_PREFIX:"userColor",BW_KEYS:{get:function(){return void 0===r.BW_KEYS&&(r.BW_KEYS=[o.BLACK_KEY,o.WHITE_KEY]),r.BW_KEYS}},THEME_DERIVED_BW_KEYS:["themeDerivedLight","themeDerivedDark"],THEME_PROFILING_DERIVED_COLORS:["theme0Light","theme0Dark","theme1Light","theme1Dark","theme2Light","theme2Dark","theme3Light","theme3Dark","theme4Light","theme4Dark"],DERIVED_BASE_KEYS:["filterBase1","filterBase2","filterBase3"],FILTER_MULTIPLY_KEYS:["filterMultiply1","filterMultiply2","filterMultiply3"],FILTER_OVERLAY_KEYS:["filterOverlay1","filterOverlay2","filterOverlay3"],FILTER_BLEND_KEYS:["filterBlend1","filterBlend2","filterBlend3"],FILTER_SCREEN_KEYS:["filterScreen1","filterScreen2","filterScreen3"],FILTER_DUOTONE_LOW_KEYS:["filterDuotoneLow1","filterDuotoneLow2","filterDuotoneLow3"],FILTER_DUOTONE_HIGH_KEYS:["filterDuotoneHigh1","filterDuotoneHigh2","filterDuotoneHigh3"],IMAGE_KEYS:["imageColor0","imageColor1","imageColor2","imageColor3","imageColor4","imageColor5","imageColor6","imageColor7","imageColor8","imageColor9"],IMAGE_DERIVED_KEYS:["imageDerivedDominant","imageDerivedInteresting"],getLightnessContrastKey:function(e){return e+"LightnessContrast"},getBackgroundContrastKey:function(e){return e+"BackgroundContrast"},DERIVED_KEY_MAP:{filterOverlay1:"filterBase1",filterOverlay2:"filterBase2",filterOverlay3:"filterBase3",filterMultiply1:"filterBase1",filterMultiply2:"filterBase2",filterMultiply3:"filterBase3",filterScreen1:"filterBase1",filterScreen2:"filterBase2",filterScreen3:"filterBase3",filterBlend1:"filterBase1",filterBlend2:"filterBase2",filterBlend3:"filterBase3",filterDuotoneLow1:"filterBase1",filterDuotoneLow2:"filterBase2",filterDuotoneLow3:"filterBase3",filterDuotoneHigh1:"filterBase1",filterDuotoneHigh2:"filterBase2",filterDuotoneHigh3:"filterBase3"},ALL_DERIVED_KEYS:{get:function(){return void 0===r.ALL_DERIVED_KEYS&&(r.ALL_DERIVED_KEYS=o.makeAllKeys()),r.ALL_DERIVED_KEYS}},makeAllKeys:function(){var e=a.clone(o.THEME_DERIVED_BW_KEYS);return a.append(e,o.THEME_PROFILING_DERIVED_COLORS),a.append(e,o.DERIVED_BASE_KEYS),a.append(e,o.FILTER_MULTIPLY_KEYS),a.append(e,o.FILTER_OVERLAY_KEYS),a.append(e,o.FILTER_BLEND_KEYS),a.append(e,o.FILTER_SCREEN_KEYS),a.append(e,o.FILTER_DUOTONE_LOW_KEYS),a.append(e,o.FILTER_DUOTONE_HIGH_KEYS),a.append(e,o.THEME_PROFILING_DERIVED_COLORS),e},defaultColor0:{get:function(){return void 0===r.defaultColor0&&(r.defaultColor0=new S.SolidColor(.95,.05,.05,1)),r.defaultColor0}},defaultColor1:{get:function(){return void 0===r.defaultColor1&&(r.defaultColor1=new S.SolidColor(.95,.05,.95,1)),r.defaultColor1}},getNextKeyInSet:function(e){var t,n=e.substr(e.length-1,1);if(n>="0"&&n<="9"&&null!=(t=a.toInt(n))){var r=e.substr(0,e.length-1),i=r+a.toString(t+1);if(o.ALL_DERIVED_KEYS.includes(i))return[i,!1];if(i=r+"1",o.ALL_DERIVED_KEYS.includes(i))return[i,!0]}return[e,!1]},keyFromImage:function(e){return!(!o.IMAGE_KEYS.includes(e)&&!o.IMAGE_DERIVED_KEYS.includes(e))},_implements:function(e){return"TheoMessageSubscriber"==e}},props:{randomDbl:function(){return a.toDouble(c.CoreRandom.nextInt)/a.toDouble(c.CoreRandom.randMax)},getNumThemeColorKeys:function(){return this.getThemeColorKeys().length},getThemeColorKeys:function(){var e=this,t=[];return null==this._themeKeys&&(this._themeKeys=[],this.library.forEachColor((function(t,n){t.includes("themeColor")&&!t.includes("Contrast")&&e.library.color(t)&&e._themeKeys.push(t)})),0==this._themeKeys.length&&(this._themeKeys.push("themeColor0"),this._themeKeys.push("themeColor1"))),a.append(t,a.sort(this._themeKeys)),t},getNumProfilingColorsKeys:function(){return this.getProfilingColorKeys().length},getProfilingColorKeys:function(){for(var e=[],t=2*this.getNumThemeColorKeys(),n=a.iter(a.range(0,Math.min(t,o.THEME_PROFILING_DERIVED_COLORS.length),!1));!n.done;n.next()){var r=n.value,i=o.THEME_PROFILING_DERIVED_COLORS[r];this.library.color(i)&&e.push(i)}return e},setLightnessContrastColorAndReturnKey:function(e,t){var n=o.getLightnessContrastKey(e);if(null==this.library.color(n)){var r=t.rgbColor.contrastWithSelf();this.setTheoColorToLibrary(_.TheoColor.init_5344(r,null,null),n)}return n},isSparkColorInUse:function(e){return this.areSparkColorsInUse([e])},areSparkColorsInUse:function(e){if(0==e.length)return!1;for(var t=a.iter(a.toSequence(this.getThemeColorKeys()));!t.done;t.next()){var n=t.value.element,o=this.library.color(n);if(null!=o.sparkElementID&&o.sparkElementID.length>0&&e.includes(o.sparkElementID))return!0}return!1},areAnySparkColorsInUse:function(){for(var e=a.iter(a.toSequence(this.getThemeColorKeys()));!e.done;e.next()){var t=e.value.element,n=this.library.color(t);if(a.opt(n,(function(e){return null!=e.sparkElementID&&n.sparkElementID.length>0})))return!0}return!1},getSparkColor:function(e){if(a.isEmpty(e))return null;for(var t=a.iter(a.toSequence(this.getThemeColorKeys()));!t.done;t.next()){var n=t.value.element,o=this.library.color(n);if(null!=o.sparkElementID&&o.sparkElementID==e)return o}return null},updateSparkColor:function(e){for(var t=a.iter(a.toSequence(this.getThemeColorKeys()));!t.done;t.next()){var n=t.value.element,r=this.library.color(n);if(null!=r.sparkElementID&&r.sparkElementID==e.sparkElementID){this.library.setColor(n,e);var i=o.getLightnessContrastKey(n);if(null!=this.library.color(i)){var l=e.rgbColor.contrastWithSelf();this.setTheoColorToLibrary(_.TheoColor.init_5344(l,null,null),i)}return void this.updateDerivedColors()}}y.LegacyCoreAssert.fail("asked to update spark color which isn't currently used.",void 0,"ColorLibraryController.updateSparkColor","ColorLibraryController.swift",383)},calculateShadeDelta:function(e){for(var t=a.iter(a.toSequence(this.getThemeColorKeys()));!t.done;t.next()){var n=t.value.element,o=this.library.color(n);if(o.isBrandkitColor()&&o.isBrandkitPrimaryColor())for(var r=a.iter(e);!r.done;r.next()){var i=r.value;if(i.isBrandkitPrimaryColor()){var l=o.getBrandkitShadeRole(),s=i.getBrandkitShadeRole();if(null!=l&&null!=s){var u=l.substr(_.SHADE_ROLE_PREFIX.length),c=s.substr(_.SHADE_ROLE_PREFIX.length),m=a.toInt(u),d=a.toInt(c);if(null!=m&&null!=d)return d-m}return 0}}}return 0},updateSparkColorsByRole:function(e){for(var t=[],n=e.concat(),o=this.calculateShadeDelta(a.clone(e)),r=a.iter(a.toSequence(this.getThemeColorKeys()));!r.done;r.next()){var i=r.value.element;if((l=this.library.color(i)).isBrandkitColor()){var l,s=(l=this.library.color(i)).getBrandkitShadeRole();if(null!=s&&0!=o){var u=s.substr(_.SHADE_ROLE_PREFIX.length),c=a.toInt(u);if(null!=c&&(y.LegacyCoreAssert.isTrue(c>=0&&c<=6,"Shade out of range",void 0,"ColorLibraryController.updateSparkColorsByRole","ColorLibraryController.swift",454),0!=c&&6!=c)){var m=c+o;m<=0?m+=5:m>=6&&(m-=5),y.LegacyCoreAssert.isTrue(m>=0&&m<=6,"Desired shade out of range",void 0,"ColorLibraryController.updateSparkColorsByRole","ColorLibraryController.swift",468),s=_.SHADE_ROLE_PREFIX+a.toString(m)}}for(var d=!1,h=a.iter(n);!h.done;h.next()){var f=h.value;if(null!=s){if(f.getBrandkitShadeRole()==s){this.library.setColor(i,f),t.push(f),a.remove(n,f),d=!0;break}}else if(l.isBrandkitPrimaryColor()&&f.isBrandkitPrimaryColor()||l.isBrandkitSecondaryColor()&&f.isBrandkitSecondaryColor()){this.library.setColor(i,f),t.push(f),a.remove(n,f),d=!0;break}}if(!d)for(var p=a.iter(t);!p.done;p.next())if((f=p.value).isBrandkitSecondaryColor()){this.library.setColor(i,f),d=!0;break}}}this.updateDerivedColors(),a.info("updateSparkColorsByRole given list of "+e.length+" new colors. Used "+t.length+" of them.")},addNewThemeColorKey:function(){for(var e=2,t=a.clone(this.getThemeColorKeys());t.includes("themeColor"+a.toString(e));)e+=1;var n="themeColor"+a.toString(e);return this._themeKeys.push(n),n},addNewThemeKeyWithColor:function(e){var t=this.addNewThemeColorKey();return this.library.setColor(t,e),t},ensureDerivedColorsAreSet:function(){if(0==this.library.hasEntries(a.clone(o.ALL_DERIVED_KEYS))){for(var e=a.clone(this.getColorThemeAsArrayOfTheoColors()),t=a.clone(this.generateDerivedColorsForTheme(a.clone(e))),n={},r=a.iter(t);!r.done;r.next()){var i=r.key,l=r.value;null==this.library.color(i)&&(n[i]=l)}a.opt(this.library,(function(e){return e.setColors(a.clone(n))}))}},getTheoColorForSolidColor:function(e){for(var t=a.clone(this.getThemeColorKeys()),n=a.iter(t);!n.done;n.next()){var o=n.value,r=this.library.color(o);if(null!=r&&a.eq(S._equality_SolidColor_SolidColor,e,r.rgbColor))return r}return _.TheoColor.init_5344(e,null,null)},getKeyOfColorInTheme:function(e){for(var t,n=this.getThemeColorKeys().concat(o.THEME_DERIVED_BW_KEYS),r=a.iter(n);!r.done;r.next()){var i=r.value;if(a.eq(S._equality_SolidColor_SolidColor,e.rgbColor,a.opt(this.library.color(i),(function(e){return e.rgbColor})))){t=i;break}}return t},getCurrentThemeHexString:function(){for(var e="",t=a.iter(this.getThemeColorKeys());!t.done;t.next()){var n,o=t.value;(n=this.library.color(o))&&(e=e+n.rgbColor.hex+",")}return e},getBaseThemeKeyForDerivedKey:function(e){var t,n,r;return null!=(n=o.DERIVED_KEY_MAP[e])&&(r=this.library.color(n))&&(t=this.getKeyOfColorInTheme(r)),t},ensureUniqueColors:function(e){for(var t=a.sort(e,(function(e,t){return e.lightness<t.lightness})),n=[],o=a.iter(t);!o.done;o.next()){var r=o.value;(0==n.length||r.distanceTo(a.last(n).rgbColor)>2.3)&&n.push(_.TheoColor.init_5344(r,null,null))}if(n.length<e.length){for(var i=e.length-n.length,l=n[n.length-1].rgbColor.red,s=n[n.length-1].rgbColor.green,u=n[n.length-1].rgbColor.blue,c=n[n.length-1].rgbColor.alpha,m=a.iter(a.range(1,i,!0));!m.done;m.next()){var d=m.value,h=l+a.toDouble(d)*(1-l)/a.toDouble(i),f=s+a.toDouble(d)*(1-s)/a.toDouble(i),p=u+a.toDouble(d)*(1-u)/a.toDouble(i);n.push(_.TheoColor.init_5344(new S.SolidColor(h,f,p,c),null,null))}return n=a.reverse(n)}return n},generateDerivedColorsForTheme:function(e){if(e.length<this.getNumThemeColorKeys())return{};var t={},n=e[0].rgbColor.asHSB,r=new p.HSBColor(n.h,n.s,this.DERIVED_DARK_BRIGHTNESS,n.alpha),i=new p.HSBColor(n.h,this.DERIVED_LIGHT_SATURATION,this.DERIVED_LIGHT_BRIGHTNESS,n.alpha);t.themeDerivedDark=_.TheoColor.init_5344(r.asRGB,null,null),t.themeDerivedLight=_.TheoColor.init_5344(i.asRGB,null,null);for(var l=a.iter(a.range(0,e.length,!1));!l.done;l.next()){var s=(n=e[S=l.value].rgbColor.asHSB).b<.22?.03:n.b-.2,u=n.b>.78?.97:n.b+.2,c=n.s<.22?.03:n.s-.2,m=n.s>.78?.97:n.s+.2;r=new p.HSBColor(n.h,m,s,n.alpha),i=new p.HSBColor(n.h,c,u,n.alpha),t["theme"+a.toString(S)+"Dark"]=_.TheoColor.init_5344(r.asRGB,null,null),t["theme"+a.toString(S)+"Light"]=_.TheoColor.init_5344(i.asRGB,null,null)}for(var d=[],h=a.iter(a.range(0,2,!0));!h.done;h.next()){for(var f=h.value,g=0,y=0,T=a.iter(a.toSequence(e));!T.done;T.next()){var C=T.value,S=C.offset,v=C.element;if(!d.includes(S)){var F=v.rgbColor,w=0;F.asHSB.s>.1&&(w+=100+F.asHSB.s),F.asLAB.l>30&&(w+=100);for(var A=100,E=a.iter(d);!E.done;E.next()){var b=E.value;A=Math.min(A,F.asLAB.hueDistance(e[b].rgbColor.asLAB))}g<(w+=A)&&(g=w,y=S)}}d.push(y);var D=e[y];t[o.DERIVED_BASE_KEYS[f]]=D;var I=D.rgbColor.asHSB;t[o.FILTER_MULTIPLY_KEYS[f]]=_.TheoColor.init_5344(new p.HSBColor(I.h,(I.s+.5)/2,(I.b+1)/2,I.alpha).asRGB,null,null),t[o.FILTER_OVERLAY_KEYS[f]]=_.TheoColor.init_5344(new p.HSBColor(I.h,(I.s+1)/2,(I.b+1)/2,I.alpha).asRGB,null,null),t[o.FILTER_BLEND_KEYS[f]]=_.TheoColor.init_5344(new p.HSBColor(I.h,I.s,I.b,I.alpha).asRGB,null,null),t[o.FILTER_SCREEN_KEYS[f]]=_.TheoColor.init_5344(new p.HSBColor(I.h,I.s,I.b,I.alpha).asRGB,null,null),t[o.FILTER_DUOTONE_LOW_KEYS[f]]=_.TheoColor.init_5344(new p.HSBColor(I.h,Math.min(I.s,.8),Math.min(I.b,.2),I.alpha).asRGB,null,null),t[o.FILTER_DUOTONE_HIGH_KEYS[f]]=_.TheoColor.init_5344(new p.HSBColor(I.h,Math.min(I.s,.8),Math.max(I.b,.8),I.alpha).asRGB,null,null)}return t},updateDerivedColors:function(){var e=a.clone(this.getColorThemeAsArrayOfTheoColors()),t=a.clone(this.generateDerivedColorsForTheme(a.clone(e)));this.library.setColors(a.clone(t))},setTheoColorToLibrary:function(e,t){var n=this.library.color(t);this.library.setColor(t,e),null!=e.sparkElementID?l.BrandingFacade.brandDocumentForElement(this.document,e.sparkElementID,l.AUTHORING_CONTEXT_TYPE_COLOR):a.opt(n,(function(e){return null!=e.sparkElementID}))&&l.BrandingFacade.unBrandDocumentIfNoBrandedElements(this.document)},getSolidColorForKey:function(e){var t=this.library.color(e);return a.opt(t,(function(e){return e.rgbColor}))},getTheoColorForKey:function(e){return this.library.color(e)},clearCache:function(){this._themeKeys=null},onMessage:function(e){var t;if((t=a.as(e,s.ColorLibraryChangedMessage))&&null!=this._themeKeys&&t.isAfter){for(var n=!1,o=a.iter(t.affectedColorIDs);!o.done;o.next()){var r=o.value;if(a.opt(this.library,(function(e){return null!=e.color(r)}))){n=!0;break}}n&&this.clearCache()}},recordUndoState:function(){return this.library.recordUndoState()},restoreUndoState:function(e){var t;(t=a.as(e,["Dictionary","String",d.DBProperty]))&&(this.library.matchProperties(a.clone(t)),this.clearCache())},isDefaultInitialTheme:function(){var e,t,n=a.clone(this.getThemeColorKeys());return!(2!=n.length||!(e=a.opt(a.opt(this.library,(function(e){return e.color(n[0])})),(function(e){return e.rgbColor})))||!(t=a.opt(a.opt(this.library,(function(e){return e.color(n[1])})),(function(e){return e.rgbColor}))))&&(a.eq(S._equality_SolidColor_SolidColor,e,o.defaultColor0)&&a.eq(S._equality_SolidColor_SolidColor,t,o.defaultColor1))},getColorThemeAsArrayOfSolidColors:function(){for(var e=[],t=a.clone(this.getThemeColorKeys()),n=a.iter(t);!n.done;n.next()){var o,r=n.value;(o=this.library.color(r))&&e.push(o.rgbColor)}return a.sort(e,(function(e,t){return e.lightness<t.lightness}))},getColorThemeAsArrayOfTheoColors:function(){var e=[],t=a.clone(this.getThemeColorKeys());a.sortInPlace(t);for(var n=a.iter(t);!n.done;n.next()){var o,r=n.value;(o=this.library.color(r))&&e.push(o)}return a.sort(e,(function(e,t){return e.rgbColor.lightness<t.rgbColor.lightness}))},getThemeDerivedColorsAsArrayOfSolidColors:function(){for(var e=[],t=a.iter(a.toSequence(o.THEME_DERIVED_BW_KEYS));!t.done;t.next()){var n,r=t.value.element;(n=this.library.color(r))&&e.push(n.rgbColor)}return e},getThemeDerivedColorsAsArrayOfTheoColors:function(){for(var e=[],t=a.iter(a.toSequence(o.THEME_DERIVED_BW_KEYS));!t.done;t.next()){var n,r=t.value.element;(n=this.library.color(r))&&e.push(n)}return e},applyLegacyFilterColorsAndReturnKeys:function(e){var t,n,r;if(r=e.filter){var i,a;switch(r.name){case"Greyscale":case"GreyscaleDark":t="themeDerivedDark",n="themeDerivedDark";break;case"Monochrome":t=o.FILTER_MULTIPLY_KEYS[0];break;case"Duotone":t=o.FILTER_DUOTONE_LOW_KEYS[0],n=o.FILTER_DUOTONE_HIGH_KEYS[1];break;case"DesaturateMultiply":t=o.FILTER_MULTIPLY_KEYS[0];break;case"ReduceContrastOverlay":t=o.FILTER_OVERLAY_KEYS[0];break;default:t=o.FILTER_MULTIPLY_KEYS[0]}(i=e.colors.color(m.ColorRole.FieldPrimary))&&this.library.setColor(t,_.TheoColor.init_5344(i,null,null)),(a=e.colors.color(m.ColorRole.FieldSecondary))&&null!=n&&this.library.setColor(n,_.TheoColor.init_5344(a,null,null))}return{primaryKey:t,secondaryKey:n}},mergeSolidColorDictionaries:function(e,t){for(var n=a.clone(e),o=a.iter(t);!o.done;o.next()){var r=o.key,i=o.value;n[r]=i}return n},mergeTheoColorDictionaries:function(e,t){for(var n=a.clone(e),o=a.iter(t);!o.done;o.next()){var r=o.key,i=o.value;n[r]=i}return n},applyLegacyColorThemeFromDocument:function(e){var t,n={},o=[];if(t=a.opt(e,(function(e){return e.colorTheme})))for(var r=a.iter(a.range(0,5,!1));!r.done;r.next()){var i,l=r.value;if(i=a.as(t.swatchByTag("theme",a.toString(l)),v.SimpleSwatch)){var s,u=this.getThemeColorKeys()[l];if(s=i.color){var c=_.TheoColor.init_5344(s,null,null);n[u]=c,o.push(c)}}}else for(var m=a.iter(a.range(0,this.getNumThemeColorKeys(),!1));!m.done;m.next()){l=m.value;var d=1/a.toDouble(l+1),h=(u=this.getThemeColorKeys()[l],new S.SolidColor(d,d,d,1));c=_.TheoColor.init_5344(h,null,null),n[u]=c,o.push(c)}var f=a.clone(this.generateDerivedColorsForTheme(a.clone(o)));this.library.setColors(a.clone(this.mergeTheoColorDictionaries(a.clone(n),a.clone(f))))},deleteThemeColorsFromDocument:function(e){for(var t=a.iter(e);!t.done;t.next()){var n=t.value;this.library.setColor(n,null)}this.document.firstPage.root.visitAll(h.FormaTraversal.PreOrder,(function(t){var n=t.style.colors.colorID(m.ColorRole.FieldPrimary);null!=n&&e.includes(n)&&t.style.colors.setColorId(m.ColorRole.FieldPrimary,"themeColor0");var o=t.style.colors.colorID(m.ColorRole.FieldSecondary);null!=o&&e.includes(o)&&t.style.colors.setColorId(m.ColorRole.FieldSecondary,"themeColor1");var r=t.style.colors.colorID(m.ColorRole.Border);null!=r&&e.includes(r)&&t.style.colors.setColorId(m.ColorRole.Border,"themeDerivedDark")})),this.clearCache()},deleteExtraThemeColors:function(e){var t=[],n=a.clone(this.getThemeColorKeys()),r="themeColor".length;for(a.sortInPlace(n,(function(e,t){var n=e.substr(r),o=t.substr(r);return a.toInt(n)<a.toInt(o)}));n.length>e;){var i=n.pop();t.push(i),t.push(o.getLightnessContrastKey(i)),t.push(o.getBackgroundContrastKey(i))}this.deleteThemeColorsFromDocument(a.clone(t))},applyColorTheme:function(e,t,n){if(void 0===n&&(n=!1),e.length<2)y.LegacyCoreAssert.fail("Color themes must have at least 2 colors",void 0,"ColorLibraryController.applyColorTheme","ColorLibraryController.swift",1284);else{if(n&&e.length==this.getNumThemeColorKeys()){function o(e,t){return e.rgbColor.print()<t.rgbColor.print()}var r=a.clone(this.getColorThemeAsArrayOfTheoColors());a.sortInPlace(r,o);for(var i=a.sort(e,o),s=!0,u=a.iter(a.range(0,i.length,!1));!u.done;u.next()){var c=u.value;if(!a.eq(_._equality_TheoColor_TheoColor,r[c],i[c])){s=!1;break}}if(s)return}var m,d={},h=[];this.getNumThemeColorKeys()>e.length&&this.deleteExtraThemeColors(e.length);for(var f=a.iter(a.toSequence(e));!f.done;f.next()){var p=f.value,g=p.offset,T=p.element;d[g<this.getNumThemeColorKeys()?this.getThemeColorKeys()[g]:this.addNewThemeColorKey()]=T,h.push(T),null==m&&null!=T.sparkElementID&&(m=T)}var S=a.clone(this.generateDerivedColorsForTheme(a.clone(h)));this.library.setColors(a.clone(this.mergeTheoColorDictionaries(a.clone(d),a.clone(S)))),this.library.paletteID=t,null!=m?l.BrandingFacade.brandDocumentForElement(this.document,m.sparkElementID,l.AUTHORING_CONTEXT_TYPE_COLOR):l.BrandingFacade.unBrandDocumentIfNoBrandedElements(this.document),(new C.ProfilingColorMap).updateRoleProfilingColorMap(this.document.firstPage)}},enteredPalettePicker:function(){(new C.ProfilingColorMap).setPaletteMappingForFormaWithSameRGBColor(this.document.firstPage)},returnCurrentPaletteMapping:function(){return(new C.ProfilingColorMap).getCurrentPaletteMapping()},getRandomBackgroundColor:function(){var e=a.clone(this.getThemeColorKeys());return l.BrandingFacade.isDocumentBranded(this.document,!1)||a.append(e,o.THEME_DERIVED_BW_KEYS),e[c.CoreRandom.nextIntUniform(e.length)]},shuffleColorAssignments:function(){this.document.firstPage.root.style.colors.setColorId(m.ColorRole.FieldPrimary,this.getRandomBackgroundColor()),(new C.ProfilingColorMap).updateRoleProfilingColorMap(this.document.firstPage),(new C.ProfilingColorMap).updateCurrentColorIndices(),this.document.firstPage.root.visitAll(h.FormaTraversal.PreOrder,(function(e){null==e.controller||f.GridController.isBackgroundColoredCell(e)||e.controller.shuffleColorAssignment()}))},createInitialThemeFromImage:function(){var e,t,n=null,r=a.clone(this.document.firstPage.root.filterWithCallback((function(e){return e instanceof g.ImageForma})));if(r.length>0&&(e=a.as(r[0],g.ImageForma))&&(n=a.opt(e.contentNode,(function(e){return e.image}))),t=n){var i=a.clone(t.getImageColors(o.kDefaultNumThemeColors)),l=a.clone(this.ensureUniqueColors(a.clone(i)));this.applyColorTheme(a.clone(l),"image"),this.shuffleColorAssignments()}else y.LegacyCoreAssert.fail("createInitialThemeFromImage has no image to create a theme from",void 0,"ColorLibraryController.createInitialThemeFromImage","ColorLibraryController.swift",1465)},extractImageColors:function(){var e,t,n=[],r=[],i={},l=a.clone(this.document.firstPage.root.filterWithCallback((function(e){return e instanceof g.ImageForma&&!e.isLogo()&&e.parent.isBackgroundImage()})));l.length>0&&(e=a.as(l[l.length-1],g.ImageForma))&&(t=a.opt(e.contentNode,(function(e){return e.image})))&&(n=a.clone(t.getImageColors(o.kDefaultNumThemeColors)),r=a.clone(this.ensureUniqueColors(a.clone(n))));for(var s=a.iter(a.toSequence(r));!s.done;s.next()){var u=s.value,c=u.offset,m=u.element;i[o.IMAGE_KEYS[c]]=m}this.library.setColors(a.clone(i))},getSuggestedColorThemesAsArraysOfTheoColors:function(){var e=[],t=[];null==this.library.color(o.IMAGE_KEYS[0])&&this.extractImageColors();for(var n=a.iter(a.toSequence(o.IMAGE_KEYS));!n.done;n.next()){var r,i=n.value.element;(r=this.library.color(i))&&t.push(r)}if(t.length>0){var l=a.clone(this.removeSimilarColors(a.clone(t)));l.length>2&&e.push(a.clone(l))}var s=a.clone(this.getTheoColorsUsedInDocument()),u=o.kDefaultNumThemeColors-s.length+1;if(s.length>1&&u>0){for(var c=0,m=[],d=[],h=a.iter(s);!h.done;h.next()){var f=h.value,p=f.rgbColor.lightness;p>4&&p<96&&(m.push(f),d.push(f),c<u&&(c+=1,m.push(_.TheoColor.init_5344(f.rgbColor.contrastWithSelf())),p>50?d.push(_.TheoColor.init_5344(f.rgbColor.darkenForTint())):d.push(_.TheoColor.init_5344(f.rgbColor.lightenForTint()))))}var g=a.clone(this.removeSimilarColors(a.clone(d)));g.length>2&&e.push(a.clone(g));var y=a.clone(this.removeSimilarColors(a.clone(m)));y.length>2&&e.push(a.clone(y))}return e},removeSimilarColors:function(e){for(var t=a.sort(e,(function(e,t){return e.rgbColor.lightness<t.rgbColor.lightness})),n=[],o=a.iter(t);!o.done;o.next()){var r=o.value;(0==n.length||r.rgbColor.distanceTo(a.last(n).rgbColor)>2.3)&&n.push(r)}return n},getSuggestedColorsAsArraysOfTheoColors:function(){for(var e=a.clone(this.getSuggestedColorThemesAsArraysOfTheoColors()),t=[],n=a.iter(e);!n.done;n.next())for(var o=n.value,r=a.iter(o);!r.done;r.next()){var i=r.value;t.push(i)}return t},addUnlinkedColor:function(e){for(var t=0,n="unlinked"+a.toString(t),o=this.library.color(n);null!=o;)t+=1,n="unlinked"+a.toString(t),o=this.library.color(n);return this.library.setColor(n,_.TheoColor.init_5344(e,null,null)),n},getTheoColorsUsedInDocument:function(){var e=[];this.document.firstPage.root.visitAll(h.FormaTraversal.PreOrder,(function(t){var n;null!=(n=t.style.colors.colorID(m.ColorRole.FieldPrimary))&&(e.includes(n)||e.push(n)),null!=(n=t.style.colors.colorID(m.ColorRole.FieldSecondary))&&(e.includes(n)||e.push(n))}));for(var t=[],n=a.iter(e);!n.done;n.next()){var o=n.value,r=this.library.color(o);null!=r&&t.push(r)}return t},unusedColorKeys:function(e,t){var n=this,o=a.clone(this.getThemeColorKeys());if(t){for(var r=a.iter(this.getThemeColorKeys());!r.done;r.next()){var i=r.value,l=this.library.color(i);null!=l&&l.isBrandkitColor()&&a.remove(o,i)}if(0==o.length)return o}return this.document.firstPage.root.visitAll(h.FormaTraversal.PreOrder,(function(t){var r;if(null!=e&&t.formaID==e.formaID||(null!=(l=t.style.colors.colorID(m.ColorRole.FieldPrimary))&&(a.remove(o,l),null!=(s=n.getBaseThemeKeyForDerivedKey(l))&&null!=(u=a.indexOf(o,s))&&o.splice(u,1)),null!=(l=t.style.colors.colorID(m.ColorRole.FieldSecondary))&&(a.remove(o,l),null!=(s=n.getBaseThemeKeyForDerivedKey(l))&&null!=(u=a.indexOf(o,s))&&o.splice(u,1))),r=a.as(t.style,T.LockupStyle))for(var i=a.iter(r.characterStyles);!i.done;i.next()){var l,s,u,c=i.value;null!=(l=c.colors.colorID(m.ColorRole.FieldPrimary))&&(a.remove(o,l),null!=(s=n.getBaseThemeKeyForDerivedKey(l))&&null!=(u=a.indexOf(o,s))&&o.splice(u,1)),null!=(l=c.colors.colorID(m.ColorRole.FieldSecondary))&&(a.remove(o,l),null!=(s=n.getBaseThemeKeyForDerivedKey(l))&&null!=(u=a.indexOf(o,s))&&o.splice(u,1))}})),o},addColorsToTheme:function(e,t){for(var n=a.clone(this.unusedColorKeys(t,!0)),r=[],i=a.iter(a.range(0,e.length,!1));!i.done;i.next()){var l,s,u,c=e[i.value];null!=(s=this.getKeyOfColorInTheme(c))?(l=s,n.includes(s)&&a.remove(n,s)):(l=n.length>0?n[0]:this.addNewThemeColorKey(),this.setTheoColorToLibrary(c,l),null!=(u=a.indexOf(n,l))&&n.splice(u,1),this.setTheoColorToLibrary(_.TheoColor.init_5344(c.rgbColor.contrastWithSelf(),null,null),o.getLightnessContrastKey(l))),r.push(l)}return y.LegacyCoreAssert.isTrue(r.length==e.length,"should return as many keys as added colors",void 0,"ColorLibraryController.addColorsToTheme","ColorLibraryController.swift",1800),r}}}),o)}}]);
//# sourceMappingURL=vendors_npm_spark_c45bf18f-56287c52.js.map