(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[11],{"9kak":function(t,e,o){var r,i,a,n=e,l=o("oAGj");n.LockupRowInfo=(r=function(t,e){if(this.aspectRatio=0,this.words=[],this.text="",this.appendable=!0,this.rowHeightAdjustRatio=1,this.colOffsetLeft=0,this.colOffsetRight=0,void 0===t&&(t=null),void 0===e&&(e=!0),null!=t)for(var o=l.iter(t);!o.done;o.next()){var r=o.value;this.addWord(r)}this.appendable=e},l.defineClass({name:"LockupRowInfo",ctor:r,props:{addWord:function(t){if(this.words.length>0){var e=this.words[this.words.length-1];this.aspectRatio+=e.spaceAspectRatio,this.text+=" "}this.text+=t.text,this.words.push(t),this.aspectRatio+=t.aspectRatio,1!=this.words.length&&t.characterHeightRatio!=this.rowHeightAdjustRatio?this.rowHeightAdjustRatio=1:this.rowHeightAdjustRatio=t.characterHeightRatio},removeLastWord:function(){var t;if(t=l.last(this.words)){var e;if(this.words.splice(this.words.length-1,1),this.aspectRatio-=t.aspectRatio,e=l.last(this.words)){this.aspectRatio-=e.spaceAspectRatio;var o,r=this.text.split(" ");r.pop(),this.text=r.join(" "),1==this.rowHeightAdjustRatio&&null!=(o=l.opt(l.first(this.words),(function(t){return t.characterHeightRatio})))&&1!=o&&null==this.words.find((function(t){return t.characterHeightRatio!=o}),this)&&(this.rowHeightAdjustRatio=o)}else this.text="",this.rowHeightAdjustRatio=1;return t}return null}}}),r),n.LockupRowsInfo=(i=function(t,e,o,r,i,a){this.rows=l.clone(t),this.widestRow=e,this.primaryFontSize=o,this.averageRowHeight=r,this.width=i,this.height=a},a={},l.defineClass({name:"LockupRowsInfo",ctor:i,statics:{EMPTY:{get:function(){return void 0===a.EMPTY&&(a.EMPTY=new i([],new n.LockupRowInfo,0,0,0,0)),a.EMPTY}}}}),i)},EDIN:function(t,e,o){var r,i=e,a=o("oAGj"),n=o("JgVS"),l=o("cEEQ"),s=o("c+uM"),c=o("8t9B");i.NoDecorationStrategy=(r=function(){n.BaseDecorationStrategy.call(this)},a.defineClass({name:"NoDecorationStrategy",ctor:r,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{supportsConfiguration:function(t){return t.style.backing==s.LockupBacking.None},decorate:function(t,e){var o,r=t.style,i=!1;if((o=t.style.characterStyles[c.TypeLockupController.HIGHLIGHT_STYLE])&&(i=o.textLook==s.LockupTextLook.FillAndOutline2),r.textLook!=s.LockupTextLook.FillAndOutline2&&!i)return new n.DecorationResults([]);for(var u=[],h=a.iter(a.range(0,e.items.length,!1));!h.done;h.next()){var g=h.value,p=e.items[g];if(p.type==l.LockupItemType.Text){var d,k,y=r.textLook==s.LockupTextLook.FillAndOutline2;null!=(d=p.characterStyle)&&(k=t.style.characterStyles[d])&&(y=k.textLook==s.LockupTextLook.FillAndOutline2||k.textLook==s.LockupTextLook.UNSET&&y),y&&((p=p.clone()).hasPrimaryColor=!1,u.push(p))}}return new n.DecorationResults(a.clone(u))}}}),r)},GFAD:function(t,e,o){var r,i=e,a=o("oAGj");i.LockupUtils=(r=function(){},a.defineClass({name:"LockupUtils",ctor:r,statics:{percentageDiff:function(t,e){return 100*Math.abs((t-e)/((t+e)/2))}}}),r)},KdeS:function(t,e,o){var r,i=e,a=o("oAGj"),n=o("1NAc");i.LockupWordInfo=(r=function(t,e,o,r,i,a,l,s,c){this.complementaryStyleAspectRatio=null,this.complementaryStyleSpaceAspectRatio=null,void 0===c&&(c=n.TheoSize.Zero),this.text=t,this.aspectRatio=e,this.spaceAspectRatio=o,this.characterStyle=r,this.characterHeightRatio=i,this.isNewLine=a,this.canBreak=l,this.rangeInLockup=s,this.relativeMargins=c},a.defineClass({name:"LockupWordInfo",ctor:r}),r)},TkOd:function(t,e,o){var r,i,a,n,l,s,c,u,h,g,p,d,k,y,f=e,S=o("oAGj"),L=o("cZuM"),C=o("6h7+"),m=o("SpAV"),A=o("yhkb"),v=o("gXiO"),b=o("C42b"),D=o("YSlt"),T=o("Ohrj"),w=o("ascj"),O=o("FNB+"),x=o("QgZx"),B=o("lq1z"),E=o("iCxV"),F=o("3lr5"),_=o("VDg0"),I=o("fNpk"),P=o("c+uM"),R=o("hb8m"),W=o("3DEm"),U=o("jcfx"),K=o("Zifs"),N=o("35Q0"),V=o("p+tC"),G=o("UqVc"),M=o("EoOi"),H=o("umUn"),Y=o("T6jX"),z=o("8t9B"),j=o("3UhB"),q=o("oKlP"),J=o("oKI3");f.kColorPairDistanceThreshold=10,f.kPuffyTextThreshold=.12,S.gvar(f,"BACKING_SHAPES_BASIC",(function(){return N.ShapeLibrary.NonSvgBackingShapeIDs})),S.gvar(f,"BACKING_SHAPES_SVG",(function(){return N.ShapeLibrary.BrowsableBackingShapes})),S.gvar(f,"ALLOWED_BACKING_VALUES",(function(){return f.BACKING_SHAPES_BASIC.concat(f.BACKING_SHAPES_SVG)})),S.gvar(f,"BACKING_COUNT_SCALE",(function(){return S.toDouble(f.ALLOWED_BACKING_VALUES.length)})),S.gvar(f,"ALLOWED_LAYOUT_VALUES",(function(){return["left","right","center","fill"]})),S.gvar(f,"LAYOUT_COUNT_SCALE",(function(){return S.toDouble(f.ALLOWED_LAYOUT_VALUES.length)})),S.gvar(f,"ALLOWED_OPACITY_VALUES",(function(){return["full","mediumBacking","faintBacking","medium","faint"]})),S.gvar(f,"OPACITY_COUNT_SCALE",(function(){return S.toDouble(f.ALLOWED_OPACITY_VALUES.length)})),S.gvar(f,"ALLOWED_SHADOWANGLE_VALUES",(function(){return[45,135,225,315]})),S.gvar(f,"SHADOWANGLE_COUNT_SCALE",(function(){return S.toDouble(f.ALLOWED_SHADOWANGLE_VALUES.length)})),S.gvar(f,"ALLOWED_PADDING_VALUES",(function(){return[0,.33,.66,1]})),S.gvar(f,"PADDING_COUNT_SCALE",(function(){return S.toDouble(f.ALLOWED_PADDING_VALUES.length)})),S.gvar(f,"ALLOWED_SPACING_VALUES",(function(){return[0,.5,1]})),S.gvar(f,"SPACING_COUNT_SCALE",(function(){return S.toDouble(f.ALLOWED_SPACING_VALUES.length)})),S.gvar(f,"ALLOWED_TRACKING_VALUES",(function(){return[-.1,0,.5]})),f.LockupStyleAttributes=(r=function(){this.font=0,this.layout="fill",this.backing="none",this.opacity="useLockupOpacities",this.textOpacity=1,this.backingOpacity=1,this.primaryColor="themeColor0",this.secondaryColor="themeColor1",this.shadowAngle=135,this.spacing=.35,this.tracking=0,this.relativeFontScale=P.LockupStyle.DEFAULT_RELATIVE_FONT_SCALE,this.padding=.35,this.textLook="fill",this.shadowOffset=P.LockupStyle.DEFAULT_SHADOWOFFSET,this.strokeWeight=P.LockupStyle.DEFAULT_STROKEWEIGHT,this.wheelUsed=!1},S.defineClass({name:"LockupStyleAttributes",ctor:r,props:{clone:function(){var t=new r;return t.font=this.font,t.layout=this.layout,t.backing=this.backing,t.opacity=this.opacity,t.textOpacity=this.textOpacity,t.backingOpacity=this.backingOpacity,t.primaryColor=this.primaryColor,t.secondaryColor=this.secondaryColor,t.shadowAngle=this.shadowAngle,t.spacing=this.spacing,t.tracking=this.tracking,t.relativeFontScale=this.relativeFontScale,t.padding=this.padding,t.textLook=this.textLook,t.shadowOffset=this.shadowOffset,t.strokeWeight=this.strokeWeight,t.wheelUsed=this.wheelUsed,t}}}),r),f.getFontPairingMatrix=function(t){for(var e={},o=t.count,r=S.iter(S.range(0,o,!1));!r.done;r.next()){for(var i=r.value,a=t.fontAt(i),n=a.postScriptName,l={},s=S.iter(S.range(0,o,!1));!s.done;s.next()){var c=s.value,u=t.fontAt(c),h=u.postScriptName,g=i==c,p=1;p+=1+S.toDouble(10-W.MathUtils.absInt(a.formality-u.formality)),p+=1+S.toDouble(10-W.MathUtils.absInt(a.width-u.width)),p+=1+S.toDouble(W.MathUtils.absInt(a.blackness-u.blackness));var d=S.toDouble(a.drama-u.drama);p+=d,d<-1&&(p*=.1),a.square==u.square&&(p*=2),a.geometric==u.geometric&&(p*=2),a.italic==u.italic&&(p*=2),a.handdrawn&&u.handdrawn&&(p*=2);var k=a.slab&&u.slab,y=0==(a.slab||u.slab);k&&(p*=2);var f=a.serif&&u.serif;f&&y&&(p*=2),0==(a.serif||u.serif)&&(p*=2),f&&a.slab!=u.slab&&(p*=0);var L=a.decorative&&u.decorative;0==g&&L&&(p*=0),a.calligraphic&&u.calligraphic&&0==g&&(p*=0),l[h]=p}e[n]=S.clone(l)}return e},f.getFontPairScore=function(t,e,o){var r,i;if((r=t[e])&&null!=(i=r[o]))return i;return 0},f.hasSufficientLegibilityContrast=function(t,e){return t.contrasts(e,!1)},f.needsContrastingColor=function(t,e,o){return e!=P.LockupTextLook.Fill&&e!=P.LockupTextLook.KnockoutOnly||o},f.getTextOpacity=function(t){switch(t.opacity){case"medium":return _.kOpacityRuleMediumAlpha;case"faint":return _.kOpacityRuleFaintAlpha;case"useLockupOpacities":return t.textOpacity;default:return 1}},f.getBackingOpacity=function(t){switch(t.opacity){case"medium":case"mediumBacking":return _.kOpacityRuleMediumAlpha;case"faint":case"faintBacking":return _.kOpacityRuleFaintAlpha;case"useLockupOpacities":return t.backingOpacity;default:return 1}},f.getTextLook=function(t){var e;switch(t.textLook){case"fill":e=P.LockupTextLook.Fill;break;case"knockoutOnly":e=P.LockupTextLook.KnockoutOnly;break;case"knockoutAndOutline":e=P.LockupTextLook.KnockoutAndOutline;break;case"outlineOnly":e=P.LockupTextLook.OutlineOnly;break;case"fillAndOutline":e=P.LockupTextLook.FillAndOutline;break;case"fillAndOutline2":e=P.LockupTextLook.FillAndOutline2;break;case"shadow":e=P.LockupTextLook.Shadow;break;case"shadowAndOutline":e=P.LockupTextLook.ShadowAndOutline;break;case"knockoutAndShadow":e=P.LockupTextLook.KnockoutAndShadow;break;default:e=P.LockupTextLook.Fill}return e},f.InterestingLockupData=(i=function(t){var e,o,r,i,a,n,l,s,c,u,h,g,p,d,k,y,L,C,m,A,v,b,D;(v=S.as(t.style,P.LockupStyle))&&(g=f.lockupStyleToLockupStyleAttributes(v,t.page.document),u=S.opt(v.font,(function(t){return t.fontData.postScriptName})),(b=S.as(t.controller,z.TypeLockupController))&&(h=b.getCurrentFontSize()),A=f.lockupStyleToLockupStyleAttributes(v,t.page.document).backing),(b=S.as(t.controller,z.TypeLockupController))&&((D=b.size)&&(C=D.width,m=D.height,p=S.toDouble(D.width/D.height)),d=S.clone(t.totalPlacement.transformPoints(S.clone(t.bounds.points))),k=b.text.length,y=b.text,L=b.wordCount()),this.id=t.formaID,this.width=(e=C)||null!=e?e:100,this.height=(o=m)||null!=o?o:100,this.font=(r=u)||null!=r?r:"BebasNeue",this.lineHeight=(i=h)||null!=i?i:1,this.styleAttributes=g||new f.LockupStyleAttributes,this.aspectRatio=(a=p)||null!=a?a:1,this.pts=S.clone(d||[]),this.wordCount=(n=L)||null!=n?n:1,this.charCount=(l=k)||null!=l?l:1,this.originalBacking=(s=A)||null!=s?s:"",this.lockupString=(c=y)||null!=c?c:""},S.defineClass({name:"InterestingLockupData",ctor:i}),i),f.InterestingPageData=(a=function(t){this.colorsBehindSelectedLockup=[],this.numImages=0,this.shapeCount=0,this.selectedLockup=new f.InterestingLockupData(t);var e=this.selectedLockup,o=[this.selectedLockup],r=10,i=1e3,a=1e3;if(t.page.hasRoot()){var n,l;i=t.page.pageSize.width,a=t.page.pageSize.height,(n=S.as(t.controller,z.TypeLockupController))&&(this.colorsBehindSelectedLockup=S.clone(n.getBackgroundColors()),r=n.getBackgroundLightnessSpread(S.clone(this.colorsBehindSelectedLockup)),this.shapeCount=n.shapeCount()),0==this.colorsBehindSelectedLockup.length&&(l=t.page.root.style.colors.fieldPrimary)&&this.colorsBehindSelectedLockup.push(l);for(var s=S.clone(t.page.root.filterWithCallback((function(t){return t.isTypeLockup()}))),c=S.iter(s);!c.done;c.next())if((t=c.value).formaID!=this.selectedLockup.id){var u=new f.InterestingLockupData(t);u.lineHeight>e.lineHeight&&(e=u),o.push(u)}}this.height=a,this.width=i,this.numImages=t.root.filterWithCallback((function(t){return t.isBackgroundImage()})).length,this.lockups=S.clone(o),this.largestLineHeightLockup=e,0==this.colorsBehindSelectedLockup.length&&this.colorsBehindSelectedLockup.push(K.SolidColor.BLACK),this.lightnessSpreadBehindSelectedLockup=r},S.defineClass({name:"InterestingPageData",ctor:a,props:{isColorVisibleAgainstBackground:function(t){for(var e=S.iter(this.colorsBehindSelectedLockup);!e.done;e.next()){var o=e.value;if(!f.hasSufficientLegibilityContrast(t,o))return!1}return!0},ensureCorrectBackgroundColors:function(t){var e,o,r=[];(e=S.as(t.controller,z.TypeLockupController))&&(r=S.clone(e.getBackgroundColors())),0==r.length&&(o=t.page.root.style.colors.fieldPrimary)&&r.push(o),r.length>0&&(this.colorsBehindSelectedLockup=S.clone(r))}}}),a),f.getBackingStringForBackingEnumAndArtworkId=function(t,e){var o="none";switch(t){case 0:o="none";break;case 2:o="row";break;case 9:o="bannerHorizontal";break;case 8:o="bannerVertical";break;case 11:o="knockout";break;case 4:o="none";break;default:null!=e&&(o=e)}return o},f.getBackingEnumAndArtworkIdForBackingString=function(t){var e,o=null;switch(t){case"none":e=P.LockupBacking.None;break;case"row":e=P.LockupBacking.Rows;break;case"bannerHorizontal":e=P.LockupBacking.BannerHorizontal;break;case"bannerVertical":e=P.LockupBacking.BannerVertical;break;case"knockout":e=P.LockupBacking.Knockout;break;default:e=P.LockupBacking.SVGBackground,o=t}return{backing:e,artworkID:o}},f.lockupStyleToLockupStyleAttributes=function(t,e){var o,r=new f.LockupStyleAttributes,i=E.Host.fontProvider.getIncludedFonts(e);r.shadowAngle=t.shadowAngle;var a,n,l,s,c,u=-1;switch((a=t.font)&&(u=(o=i.indexOf(a.fontData))||null!=o?o:-1),r.font=u,r.spacing=t.spacing,r.tracking=t.tracking,r.padding=t.padding,r.textLook=t.textLookAsString,r.shadowOffset=t.shadowOffset,r.strokeWeight=t.strokeWeight,null!=(n=t.colors.colorID(w.ColorRole.FieldPrimary))&&(r.primaryColor=n),null!=(l=t.colors.colorID(w.ColorRole.FieldSecondary))&&(r.secondaryColor=l),t.opacityRule){case 1:s="mediumBacking";break;case 2:s="faintBacking";break;case 3:s="medium";break;case 4:s="faint";break;case 0:s="full";break;default:s="useLockupOpacities"}r.opacity=s,r.textOpacity=t.textOpacity,r.backingOpacity=t.backingOpacity;var h=t.layout;if(P.LockupStyle.isLetterGrid(h)||h==P.LockupLayout.Standard){var g=P.LockupStyle.isLetterGrid(h)?"letter-grid-":"";switch(t.alignment){case 0:c=g+"left";break;case 1:c=g+"right";break;case 2:c=g+"center";break;default:I.LegacyCoreAssert.fail("Unexpected alignment",{alignment:t.alignment},"lockupStyleToLockupStyleAttributes","LockupStyleController.swift",664),c=g+"left"}}else if(P.LockupStyle.isAutoLayout(h)){c="auto"+t.alignment}else if(P.LockupStyle.isPath(h)){c="path"+t.pathID}else c="fill";return r.layout=c,r.backing=f.getBackingStringForBackingEnumAndArtworkId(t.backing,t.backingArtworkID),r.wheelUsed=t.wheelUsed,r},f.lockupStyleAttributesToLockupStyle=function(t,e,o){var r,i,a,n=null,l=t.font;(I.LegacyCoreAssert.isTrue(l>-1,"lockupStyleAttributesToLockupStyle called with no font. It is valid for a character style to have no font but this function doesn't work for character styles ",void 0,"lockupStyleAttributesToLockupStyle","LockupStyleController.swift",706),l>-1)&&((a=E.Host.fontProvider.getIncludedFonts(o).fontAt(l))&&(n=j.TypeLockupUtils.createTheoFont(a,E.Host.brandkitManager.brandkitForDocument(o))));var s,c,u=w.ColorTable.init_25f6([{key:w.ColorRole.FieldPrimary,value:t.primaryColor},{key:w.ColorRole.FieldSecondary,value:t.secondaryColor}]);switch(t.opacity){case"mediumBacking":s=P.OpacityRule.MediumBacking;break;case"faintBacking":s=P.OpacityRule.FaintBacking;break;case"medium":s=P.OpacityRule.Medium;break;case"faint":s=P.OpacityRule.Faint;break;case"full":s=P.OpacityRule.Full;break;default:s=P.OpacityRule.UseLockupOpacities}var h,g,p=P.LockupAlignment.UNSET,d=J.TextPathID.UNSET,k=null;if(t.layout.startsWith("path"))c=P.LockupLayout.Path,null!=(h=S.toInt(t.layout.substr("path".length)))&&(d=(r=J.TextPathID.toCaseValue(h))||null!=r?r:J.TextPathID.UNSET)==J.TextPathID.Custom&&(g=e.customPath)&&(k=g);else if(t.layout.startsWith("auto")){var y;c=P.LockupLayout.Auto,null!=(y=S.toInt(t.layout.substr("auto".length)))&&(p=(i=P.LockupAlignment.toCaseValue(y))||null!=i?i:P.LockupAlignment.UNSET)}else switch(t.layout){case"left":c=P.LockupLayout.Standard,p=P.LockupAlignment.Left;break;case"right":c=P.LockupLayout.Standard,p=P.LockupAlignment.Right;break;case"center":c=P.LockupLayout.Standard,p=P.LockupAlignment.Center;break;case"letter-grid-left":c=P.LockupLayout.LetterGrid,p=P.LockupAlignment.Left;break;case"letter-grid-right":c=P.LockupLayout.LetterGrid,p=P.LockupAlignment.Right;break;case"letter-grid-center":c=P.LockupLayout.LetterGrid,p=P.LockupAlignment.Center;break;case"fill":default:c=P.LockupLayout.FitJustified}var L=f.getBackingEnumAndArtworkIdForBackingString(t.backing),C=f.getTextLook(t),m=t.wheelUsed,A=t.relativeFontScale,v=P.LockupStyle.init_d158(t.textOpacity,t.backingOpacity,u,n,t.spacing,t.tracking,t.padding,L.backing,L.artworkID,t.shadowAngle,c,p,s,C,t.shadowOffset,t.strokeWeight,d,k,m,A);return v.setCharacterStyles(S.clone(e.characterStyles)),v},f.randomDbl=function(){return S.toDouble(b.CoreRandom.nextInt)/S.toDouble(b.CoreRandom.randMax)},f.getWeightedIndex=function(t,e){for(var o=t.length,r=e*f.randomDbl(),i=0,a=0,n=S.iter(S.range(0,o,!1));!n.done;n.next()){var l=n.value;if((i+=t[l])>=r){a=l;break}}return a},f.selectWeightedValue=function(t,e,o,r,i){var a,n=r,l=S.clone(o);return null!=(a=S.indexOf(e,t))&&o[a]>0&&(l[a]+=n*i,n+=n*i),e[f.getWeightedIndex(S.clone(l),n)]},f.WeightedAttributeSelector=S.defineProtocol("WeightedAttributeSelector",{inertiaRatio:"Double",forma:"Forma",pageData:"InterestingPageData",values:"Array<TypeAlias>",weights:"Array<Double>",weightSum:"Double",scoreValue:"(TypeAlias) -> Double",updateWeights:"(InterestingPageData) -> Void",select:"(LockupStyleAttributes, Boolean, Boolean, Boolean, Boolean) -> TypeAlias"}),f.WeightedFontSelector=(n=function t(e,o){this.inertiaRatio=1,this.weights=[],this.weightSum=0,this.machineRecommend=!0;var r=this;this.forma=e,this.pageData=o,this.listOfFonts=E.Host.fontProvider.getIncludedFonts(e.page.document),this.values=S.toArray(S.range(0,this.listOfFonts.count,!1));var i=this.listOfFonts.revisionNumber,a=this.listOfFonts.fontSetID;i==t.cacheRevisionNumber&&a==t.cacheFontSetID?this.fontPairingMatrix=S.clone(t.fontPairingMatrixCache):(this.fontPairingMatrix={},t.fontPairingMatrixCache={},S.each(f.getFontPairingMatrix(this.listOfFonts),(function(e,o){r.fontPairingMatrix[e]=S.clone(o),t.fontPairingMatrixCache[e]=S.clone(o)})),t.cacheRevisionNumber=i,t.cacheFontSetID=a)},S.defineClass({name:"WeightedFontSelector",ctor:n,statics:{cacheRevisionNumber:0,cacheFontSetID:"charlie",_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t;var e=!1;if(this.values.length!=E.Host.fontProvider.getIncludedFonts(this.forma.page.document).count&&(this.listOfFonts=E.Host.fontProvider.getIncludedFonts(this.forma.page.document),this.values=S.toArray(S.range(0,this.listOfFonts.count,!1)),e=!0),this.machineRecommend){var o,r=new B.FontSuggester;(o=r.getFontFeatures(t,this.forma))?(e&&r.clearCache(),this.weights=S.clone(r.getScores(this.listOfFonts,o))):this.weights=this.values.map(this.scoreValue,this)}0!=this.machineRecommend&&1!=(new G.SuggestionUtils).weightsEqualNaNOrEmpty(S.clone(this.weights))||(this.weights=this.values.map(this.scoreValue,this)),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},getTopFonts:function(t){I.LegacyCoreAssert.isTrue(t<this.listOfFonts.count,"cannot get top fonts more than total number",void 0,"WeightedFontSelector.getTopFonts","LockupStyleController.swift",1011);for(var e=[],o=S.iter(S.toSequence(this.weights));!o.done;o.next()){var r=o.value,i=r.offset,a=r.element;e.push([a,i])}e=S.sort(e,(function(t,e){return t[0]>e[0]}));for(var n=[],l=0,s=S.iter(e);!s.done;s.next()){var c=s.value;if(!(l<t))break;n.push(this.listOfFonts.fontAt(c[1])),l+=1}return n},scoreValue:function(t){return this.manuallyScoreValue(t)},manuallyScoreValue:function(t){var e=this.listOfFonts.fontAt(t),o=e.postScriptName,r=E.Host.fontProvider.descriptorForPostScriptName(o,F.ANY_DOCUMENT),i=this.pageData.selectedLockup.lineHeight;if(!E.Host.fontProvider.getSuggestableFonts(S.opt(this.forma,(function(t){return t.page.document}))).contains(e))return 0;for(var a=.1,n=S.iter(this.pageData.lockups);!n.done;n.next()){var l=n.value;if(l.id!=this.pageData.selectedLockup.id){var s=W.MathUtils.absDouble(i-l.lineHeight)/i,c=l.lineHeight>i,u=c?l.font:o,h=c?o:l.font;a+=f.getFontPairScore(S.clone(this.fontPairingMatrix),u,h),o==l.font&&(a*=2,s<.5&&(a*=2))}}return a*=r.popularity,j.TypeLockupUtils.createTheoFont(e,E.Host.brandkitManager.brandkitForDocument(this.forma.page.document)).isSparkFont()&&(a*=2),i<40&&0==r.bodyAllowed&&(a=0),i>150&&0==r.displayAllowed&&(a=0),a},select:function(t,e,o,r,i){void 0===r&&(r=!1),void 0===i&&(i=!0);var a=t.font,n=o?this.inertiaRatio:0;return f.selectWeightedValue(a,S.clone(this.values),S.clone(this.weights),this.weightSum,n)}}}),n),f.WeightedLayoutSelector=(l=function(t,e){this.inertiaRatio=0,this.values=f.ALLOWED_LAYOUT_VALUES,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=e},S.defineClass({name:"WeightedLayoutSelector",ctor:l,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t,this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){var e=1,o=this.pageData.selectedLockup.aspectRatio,r=this.pageData.selectedLockup.wordCount,i=this.pageData.selectedLockup.id;"left"!=t&&"right"!=t||(r<=1||o>4?e=0:e*=.05),0==this.pageData.lockups.length&&("fill"==t&&(e*=5),"center"==t&&(e*=4)),"fill"==t&&this.pageData.selectedLockup.wordCount>10&&(e*=4/S.toDouble(this.pageData.selectedLockup.wordCount));var a=[];Y.TheoDocumentUtils.enableFastHeuristicsForComplexPage(this.forma.page)||(a=S.clone(L.AlignmentDetector.init_a05b(this.forma).detectFormaAlignments(20)));for(var n=!1,l=!1,s=S.iter(a);!s.done;s.next()){var c=s.value;c.line.type==L.AlignmentType.Left&&(n=!0),c.line.type==L.AlignmentType.Right&&(l=!0)}n&&!l&&"left"==t&&(e=2.5),l&&!n&&"right"==t&&(e=2.5);for(var u=S.iter(this.pageData.lockups);!u.done;u.next()){var h=u.value;h.id!=i&&t==h.styleAttributes.layout&&(e*=f.LAYOUT_COUNT_SCALE/2)}return e},select:function(t,e,o,r,i){void 0===r&&(r=!1),void 0===i&&(i=!0);var a=t.layout,n=o?this.inertiaRatio:0;return f.selectWeightedValue(a,S.clone(this.values),S.clone(this.weights),this.weightSum,n)}}}),l),f.WeightedBackingSelector=(s=function(t,e){this.inertiaRatio=1,this.values=f.ALLOWED_BACKING_VALUES,this.weights=[],this.weightSum=0,this.machineRecommend=!0,this.forma=t,this.pageData=e},S.defineClass({name:"WeightedBackingSelector",ctor:s,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){if(this.pageData=t,m.CoreAssertDebugOnly.isTrue(null!=this.forma,"nil forma in WeightedBackingSelector.updateWeights",void 0,"WeightedBackingSelector.updateWeights","LockupStyleController.swift",1349),1==this.machineRecommend&&null!=this.forma){var e=new V.ShapeSuggester,o=S.clone(e.getShapeSuggesterFeatures(t,this.forma));this.weights=S.clone(e.getScores(S.clone(this.values),S.clone(o)))}0!=this.machineRecommend&&1!=(new G.SuggestionUtils).weightsEqualNaNOrEmpty(S.clone(this.weights))||(this.weights=this.values.map(this.scoreValue,this)),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){var e=this.pageData.selectedLockup,o=this.pageData.largestLineHeightLockup,r=e.lineHeight,i=o.id==e.id,a=N.ShapeLibrary.shapeDictionary[t]||N.ShapeLibrary.shapeDictionary.none,n=1;if(a.premium)return 0;if(N.ShapeLibrary.NonSuggestableBackingShapes.includes(t))return 0;this.pageData.lockups.length>0&&f.BACKING_SHAPES_SVG.includes(t)&&(n*=.1);for(var l=S.iter(this.pageData.lockups);!l.done;l.next()){var s,c=l.value;c.id!=e.id&&(W.MathUtils.absDouble(r-c.lineHeight)/r<.4&&(n*=3),(s=N.ShapeLibrary.shapeDictionary[c.styleAttributes.backing])&&(n*=(11-S.toDouble(W.MathUtils.absInt(a.formality-s.formality)))/2,n*=(11-S.toDouble(W.MathUtils.absInt(a.drama-s.drama)))/2))}var u,h=W.MathUtils.maxDouble(e.width/this.pageData.width,e.height/this.pageData.height);if(a.maxScale<1&&h>a.maxScale&&(n=0),(a.maxAspect<e.aspectRatio||a.minAspect>e.aspectRatio)&&(n=0),0==i&&(u=N.ShapeLibrary.shapeDictionary[o.styleAttributes.backing])){var g=u.drama;a.drama<g&&(n*=2)}return"none"==t&&(n*=10),"row"==t&&(n*=10),this.pageData.lightnessSpreadBehindSelectedLockup>=20&&0==a.filled&&(n*=.01),n},select:function(t,e,o,r,i){void 0===r&&(r=!1),void 0===i&&(i=!0);var a=this.values.length,n=S.clone(this.weights),l=t.layout,s="center"==l||"fill"==l,c=!1,u=E.Host.fontProvider.getIncludedFonts(this.forma.page.document).fontAt(t.font),h=this.pageData.selectedLockup.width/this.pageData.selectedLockup.height,g=!0,p=this.pageData.selectedLockup.originalBacking;"none"!=p&&"shadow"!=p&&"row"!=p||(g=!1),"knockout"==t.backing&&(g=!1);for(var d=S.iter(this.pageData.lockups);!d.done;d.next()){var k,y=d.value,L=y.styleAttributes.backing;y.id!=this.pageData.selectedLockup.id&&("none"!=L&&(c=!0),t.font==y.styleAttributes.font&&null!=(k=S.indexOf(f.ALLOWED_BACKING_VALUES,L))&&(n[k]*=5))}for(var C=S.iter(S.range(0,a,!1));!C.done;C.next()){var m,A=C.value,v=this.values[A];if(m=N.ShapeLibrary.shapeDictionary[v]){s&&1==m.centered&&(n[A]*=5),h>4&&m.category==N.ShapeCategory.Circle&&(n[A]*=0),h<4&&m.category==N.ShapeCategory.Banner&&(n[A]*=0),m.category!=N.ShapeCategory.Cutout&&m.category!=N.ShapeCategory.Avoid||(n[A]*=0),"knockoutOnly"!=t.textLook||"none"!=v&&"shadow"!=v||(n[A]*=0);var b=S.toDouble(10-W.MathUtils.absInt(u.formality-m.formality));n[A]*=b/5;var D=S.toDouble(10-W.MathUtils.absInt(u.drama-m.drama));n[A]*=D/5,c&&"row"!=v&&"none"!=v&&(n[A]/=5)}}var T=t.backing,w=o?this.inertiaRatio:0,O=n.reduce((function(t,e){return t+e}),0);return T=1==g?f.selectWeightedValue(T,S.clone(this.values),S.clone(n),O,w):p}}}),s),f.WeightedShadowAngleSelector=(c=function(t,e){this.inertiaRatio=1,this.values=f.ALLOWED_SHADOWANGLE_VALUES,this.weights=[],this.weightSum=0,this.foo=4,this.forma=t,this.pageData=e},S.defineClass({name:"WeightedShadowAngleSelector",ctor:c,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t,this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){return 1},select:function(t,e,o,r,i){void 0===r&&(r=!1),void 0===i&&(i=!0);var a=t.shadowAngle,n=o?this.inertiaRatio:0;return f.selectWeightedValue(a,S.clone(this.values),S.clone(this.weights),this.weightSum,n)}}}),c),f.WeightedOpacitySelector=(u=function(t,e){this.inertiaRatio=1,this.values=f.ALLOWED_OPACITY_VALUES,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=e},S.defineClass({name:"WeightedOpacitySelector",ctor:u,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t,this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){var e=1,o=this.pageData.selectedLockup.width*this.pageData.selectedLockup.height,r=this.pageData.width*this.pageData.height;return"full"==t&&o>.5*r&&(e*=.1),"faint"==t&&(o<.5*r?e=0:e*=.5),e},select:function(t,e,o,r,i){void 0===r&&(r=!1),void 0===i&&(i=!0);var a=t.opacity,n=S.clone(this.weights);(N.ShapeLibrary.shapeDictionary[t.backing]||N.ShapeLibrary.shapeDictionary.none).filled?(n[S.indexOf(f.ALLOWED_OPACITY_VALUES,"faint")]=0,n[S.indexOf(f.ALLOWED_OPACITY_VALUES,"medium")]=0):(n[S.indexOf(f.ALLOWED_OPACITY_VALUES,"faintBacking")]=0,n[S.indexOf(f.ALLOWED_OPACITY_VALUES,"mediumBacking")]=0);var l=o?this.inertiaRatio:0,s=n.reduce((function(t,e){return t+e}),0);return f.selectWeightedValue(a,S.clone(this.values),S.clone(n),s,l)}}}),u),f.WeightedPaddingSelector=(h=function(t,e){this.inertiaRatio=1,this.values=f.ALLOWED_PADDING_VALUES,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=e},S.defineClass({name:"WeightedPaddingSelector",ctor:h,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t,this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){var e=this.pageData.selectedLockup,o=1,r=1;if(0==this.pageData.lockups.length)r=W.MathUtils.absDouble(t-P.LockupStyle.DEFAULT_PADDING);else for(var i=S.iter(this.pageData.lockups);!i.done;i.next()){var a=i.value;r=W.MathUtils.minDouble(r,W.MathUtils.absDouble(t-a.styleAttributes.padding))}o*=W.MathUtils.maxDouble(1/(r+.1),.05);var n=W.MathUtils.maxDouble(e.width/this.pageData.width,e.height/this.pageData.height)+t;return o/=4*W.MathUtils.absDouble(n-1)},select:function(t,e,o,r,i){void 0===r&&(r=!1),void 0===i&&(i=!0);var a=t.padding,n=o?this.inertiaRatio:0;return f.selectWeightedValue(a,S.clone(this.values),S.clone(this.weights),this.weightSum,n)}}}),h),f.WeightedSpacingSelector=(g=function(t,e){this.inertiaRatio=1,this.values=f.ALLOWED_SPACING_VALUES,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=e},S.defineClass({name:"WeightedSpacingSelector",ctor:g,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t,this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){var e=1,o=1;if(0==this.pageData.lockups.length)o=W.MathUtils.absDouble(t-P.LockupStyle.DEFAULT_SPACING);else for(var r=S.iter(this.pageData.lockups);!r.done;r.next()){var i=r.value;o=W.MathUtils.minDouble(o,W.MathUtils.absDouble(t-i.styleAttributes.spacing))}return e*=W.MathUtils.maxDouble(1/(o+.1),.05)},select:function(t,e,o,r,i){void 0===r&&(r=!1),void 0===i&&(i=!0);var a=t.spacing,n=o?this.inertiaRatio:0;return f.selectWeightedValue(a,S.clone(this.values),S.clone(this.weights),this.weightSum,n)}}}),g),f.PrimaryColorSelector=(p=function t(e,o){this.inertiaRatio=1,this.weights=[],this.weightSum=0,this.forma=e,this.pageData=o,this.values=S.clone(t.updateColorValues(e))},S.defineClass({name:"PrimaryColorSelector",ctor:p,statics:{updateColorValues:function(t){var e;return(e=t)?e.page.colorLibraryController.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS).concat(e.page.colorLibraryController.getProfilingColorKeys()):[]},_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t,this.values=S.clone(p.updateColorValues(this.forma)),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){return"themeDerivedDark"==t?.1:1},select:function(t,e,o,r,i){void 0===r&&(r=!1),void 0===i&&(i=!0);var a=(N.ShapeLibrary.shapeDictionary[t.backing]||N.ShapeLibrary.shapeDictionary.none).filled||"fill"!=t.textLook;this.updateWeights(this.pageData);for(var n=this.values.length,l=t.primaryColor,s=S.clone(this.weights),c=new D.ColorRankSuggester,u=[],h=S.iter(S.range(0,n,!1));!h.done;h.next()){var g,p=h.value;(g=this.forma.page.colorLibraryController.getSolidColorForKey(this.values[p]))&&u.push(g)}if(I.LegacyCoreAssert.isTrue(n==u.length,"not all value colors were added.",void 0,"PrimaryColorSelector.select","LockupStyleController.swift",2096),n!=u.length)return l;var d=[];if(0==a){this.pageData.ensureCorrectBackgroundColors(this.forma);for(var k=S.iter(this.pageData.colorsBehindSelectedLockup);!k.done;k.next()){var y=k.value;d.push(S.clone(D.ColorForComparison.init_c063(y,1)))}}else{var L;(L=this.forma.page.colorLibraryController.getSolidColorForKey(t.secondaryColor))&&d.push(S.clone(D.ColorForComparison.init_c063(L,1)))}r&&(L=this.forma.page.colorLibraryController.getSolidColorForKey(t.primaryColor))&&d.push(S.clone(D.ColorForComparison.init_c063(L,.33))),s=S.clone(c.weightedColorContrastRanker(S.clone(d),S.clone(u),i));var C=(s=S.clone((new G.SuggestionUtils).normalizedWeights(S.clone(s)))).reduce((function(t,e){return t+e}),0),m=o?this.inertiaRatio:0;return f.selectWeightedValue(l,S.clone(this.values),S.clone(s),C,m)}}}),p),f.SecondaryColorSelector=(d=function t(e,o){this.inertiaRatio=0,this.weights=[],this.weightSum=0,this.forma=e,this.pageData=o,this.values=S.clone(t.updateColorValues(e))},S.defineClass({name:"SecondaryColorSelector",ctor:d,statics:{updateColorValues:function(t){var e,o=[];if(e=t)for(var r=e.page.colorLibraryController.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS),i=S.iter(r);!i.done;i.next()){var a=i.value;null!=e.page.colorLibraryController.getSolidColorForKey(a)?o.push(a):m.CoreAssertDebugOnly.fail("library has missing color",{key:a},"SecondaryColorSelector.updateColorValues","LockupStyleController.swift",2182)}return o},_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t,this.values=S.clone(d.updateColorValues(this.forma)),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){return 1},select:function(t,e,o,r,i){void 0===r&&(r=!1),void 0===i&&(i=!0);var a=t.secondaryColor,n=(N.ShapeLibrary.shapeDictionary[t.backing]||N.ShapeLibrary.shapeDictionary.none).filled;this.updateWeights(this.pageData);for(var l=this.values.length,s=S.clone(this.weights),c=new D.ColorRankSuggester,u=[],h=S.iter(S.range(0,l,!1));!h.done;h.next()){var g,p=h.value;(g=this.forma.page.colorLibraryController.getSolidColorForKey(this.values[p]))?u.push(g):m.CoreAssertDebugOnly.fail("failed to get SolidColor",{key:this.values[p],colorCount:l,numColorKeys:this.forma.page.colorLibraryController.getNumThemeColorKeys()},"SecondaryColorSelector.select","LockupStyleController.swift",2230)}if(I.LegacyCoreAssert.isTrue(l==u.length,"not all value colors were added.",void 0,"SecondaryColorSelector.select","LockupStyleController.swift",2237),l!=u.length)return a;var d=[];if(r&&n){var k;(k=this.forma.page.colorLibraryController.getSolidColorForKey(t.secondaryColor))&&d.push(S.clone(D.ColorForComparison.init_c063(k,1)))}else{this.pageData.ensureCorrectBackgroundColors(this.forma);for(var y=S.iter(this.pageData.colorsBehindSelectedLockup);!y.done;y.next()){var L=y.value;d.push(S.clone(D.ColorForComparison.init_c063(L,1)))}}s=S.clone(c.weightedColorContrastRanker(S.clone(d),S.clone(u),i));var C=(s=S.clone((new G.SuggestionUtils).normalizedWeights(S.clone(s)))).reduce((function(t,e){return t+e}),0),A=o?this.inertiaRatio:0;return f.selectWeightedValue(a,S.clone(this.values),S.clone(s),C,A)}}}),d),f.LockupStyleController=(k=function(t){this._sessionAttrs=new f.SessionAttrs,this.hasScoresForAttributes=!1,this.forma=t,this.targetedLockupStyleName_="",this.pageData=new f.InterestingPageData(t),this.fontSelector=new f.WeightedFontSelector(t,this.pageData),this.layoutSelector=new f.WeightedLayoutSelector(t,this.pageData),this.backingSelector=new f.WeightedBackingSelector(t,this.pageData),this.opacitySelector=new f.WeightedOpacitySelector(t,this.pageData),this.primaryColorSelector=new f.PrimaryColorSelector(t,this.pageData),this.profilingBackgroundColorSelector=new T.ProfilingBackgroundColorSelector(t,!0),this.profilingPrimaryColorSelector=new T.ProfilingPrimaryColorSelector(t,!1),this.secondaryColorSelector=new f.SecondaryColorSelector(t,this.pageData),this.shadowAngleSelector=new f.WeightedShadowAngleSelector(t,this.pageData),this.spacingSelector=new f.WeightedSpacingSelector(t,this.pageData),this.paddingSelector=new f.WeightedPaddingSelector(t,this.pageData),v.CoreObject.call(this)},S.defineClass({name:"LockupStyleController",ctor:k,superName:"CoreObject",props:{targetedLockupStyleName:{get:function(){var t;return((t=S.opt(S.opt(S.opt(this.forma,(function(t){return t.page.document})),(function(t){return t.controller})),(function(t){return t.selection.inCharStyleMode})))||null!=t)&&t?z.TypeLockupController.HIGHLIGHT_STYLE:""}},targetedLockupStyle:{get:function(){return""!=this.targetedLockupStyleName?this.forma.controller.getCharacterStyle(this.targetedLockupStyleName):this.forma.style}},targetedFont:{get:function(){var t;return(t=this.targetedLockupStyle.font)?t:this.forma.style.font}},targetedShadowAngle:{get:function(){return this.forma.style.shadowAngle},set:function(t){this.forma.style.shadowAngle=t}},targetedShadowOffset:{get:function(){return this.forma.style.shadowOffset},set:function(t){this.forma.style.shadowOffset=t}},targetedStrokeWeight:{get:function(){return this.forma.style.strokeWeight},set:function(t){this.forma.style.strokeWeight=t}},targetedTextLook:{get:function(){return this.targetedLockupStyle.textLook!=P.LockupTextLook.UNSET?this.targetedLockupStyle.textLook:this.forma.style.textLook}},updateScoring:function(){this.pageData=new f.InterestingPageData(this.forma),this.fontSelector.updateWeights(this.pageData),this.layoutSelector.updateWeights(this.pageData),this.backingSelector.updateWeights(this.pageData),this.opacitySelector.updateWeights(this.pageData),this.primaryColorSelector.updateWeights(this.pageData),this.secondaryColorSelector.updateWeights(this.pageData),this.shadowAngleSelector.updateWeights(this.pageData),this.spacingSelector.updateWeights(this.pageData),this.paddingSelector.updateWeights(this.pageData),this.profilingPrimaryColorSelector.updateBackgroundColors(S.clone(this.pageData.colorsBehindSelectedLockup)),this.profilingBackgroundColorSelector.updateBackgroundColors(S.clone(this.pageData.colorsBehindSelectedLockup)),this.hasScoresForAttributes=!0},getRecommendedFonts:function(){return this.fontSelector.getTopFonts(10)},onlineLearning:function(t){var e,o=new B.FontSuggester;(e=o.getFontFeatures(this.pageData,this.forma))&&o.onlineLearning(t,e)},getDominantColorRole:function(){var t,e=f.lockupStyleToLockupStyleAttributes(this.targetedLockupStyle,this.forma.page.document).backing,o=w.ColorRole.FieldPrimary;return(t=N.ShapeLibrary.shapeDictionary[e])&&1==t.filled&&(o=w.ColorRole.FieldSecondary),o},fixUpSecondaryColor:function(){var t;if((t=S.as(this.forma.controller,z.TypeLockupController))&&t.secondaryColorVisible()&&this.targetedLockupStyle.textBacked&&this.targetedLockupStyle.backing!=P.LockupBacking.UNSET){var e=this.targetedLockupStyle.colors.colorID(w.ColorRole.FieldPrimary),o=this.targetedLockupStyle.colors.colorID(w.ColorRole.FieldSecondary),r=this.calculateContrastingSecondaryColorID();null!=r&&r!=o&&r!=e&&null!=this.forma.page.colorLibraryController.getSolidColorForKey(r)&&this.targetedLockupStyle.colors.setColorId(w.ColorRole.FieldSecondary,r)}},calculateContrastingSecondaryColorID:function(){var t,e=this.targetedLockupStyle.colors.colorID(w.ColorRole.FieldPrimary),o=this.targetedLockupStyle.colors.colorID(w.ColorRole.FieldSecondary);if(null!=e&&e==o&&(t=this.forma.page.colorLibraryController.getSolidColorForKey(e)))for(var r=S.iter(this.forma.page.colorLibraryController.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS));!r.done;r.next()){var i,a=r.value;if(a!=e&&(i=this.forma.page.colorLibraryController.getSolidColorForKey(a))&&i.contrasts(t,!1)){o=a;break}}return o},fixUpBackingShape:function(){var t,e,o=this.forma.style;if((t=N.ShapeLibrary.shapeDictionary[f.getBackingStringForBackingEnumAndArtworkId(o.backing,o.backingArtworkID)])&&(e=N.ShapeLibrary.shapeDictionary[f.getBackingStringForBackingEnumAndArtworkId(this.targetedLockupStyle.backing,this.targetedLockupStyle.backingArtworkID)])){if(P.LockupStyle.isKnockoutLook(this.targetedLockupStyle.textLook)){(this.targetedLockupStyle===this.forma.style?t.filled:P.LockupStyle.isLetterGrid(o.layout)?(this.targetedLockupStyle.backing!=P.LockupBacking.None?e:t).filled:t.filled||e.filled)||(S.opt(S.as(this.forma.controller,z.TypeLockupController),(function(t){return t.beginBlockedUpdate()})),this.targetedLockupStyle.backing=P.LockupBacking.SVGBackground,this.targetedLockupStyle.backingArtworkID="square_001",S.opt(S.as(this.forma.controller,z.TypeLockupController),(function(t){return t.endBlockedUpdate()})),S.opt(S.as(this.forma.controller,z.TypeLockupController),(function(t){return t.styleChanged()})))}!e.filled||this.targetedLockupStyle.textLook!=P.LockupTextLook.Shadow&&this.targetedLockupStyle.textLook!=P.LockupTextLook.ShadowAndOutline&&this.targetedLockupStyle.textLook!=P.LockupTextLook.FillAndOutline&&this.targetedLockupStyle.textLook!=P.LockupTextLook.FillAndOutline2&&this.targetedLockupStyle.textLook!=P.LockupTextLook.OutlineOnly||1!=this.targetedLockupStyle.backingOpacity||(this.targetedLockupStyle.opacityRule=P.OpacityRule.UseLockupOpacities,this.targetedLockupStyle.backingOpacity=.5)}},getKnockoutColor:function(){var t,e,o=this.forma.style;return this.targetedLockupStyle!==this.forma.style&&(t=N.ShapeLibrary.shapeDictionary[f.getBackingStringForBackingEnumAndArtworkId(o.backing,o.backingArtworkID)])&&(e=N.ShapeLibrary.shapeDictionary[f.getBackingStringForBackingEnumAndArtworkId(this.targetedLockupStyle.backing,this.targetedLockupStyle.backingArtworkID)])&&(e.filled||!t.filled)?this.targetedLockupStyle.colors.fieldSecondary:o.colors.fieldSecondary},getTextLookForUI:function(){return this.targetedTextLook==P.LockupTextLook.FillAndOutline2||this.targetedTextLook==P.LockupTextLook.OutlineOnly?P.LockupTextLook.FillAndOutline:this.targetedTextLook},getStrokeWeightPercentForUI:function(){return 99*this.targetedStrokeWeight+1},getShadowOffsetPercentForUI:function(){return 99*this.targetedShadowOffset+1},setTextLook:function(t){this.targetedLockupStyle!==this.forma.style&&t==this.forma.style.textLook?this.targetedLockupStyle.textLook=P.LockupTextLook.UNSET:(this.targetedLockupStyle.textLook=t,this.targetedLockupStyle.textLook==P.LockupTextLook.KnockoutAndShadow&&(135==this.targetedShadowAngle&&225==this.targetedShadowAngle||(this.targetedShadowAngle=135)),this.targetedLockupStyle.textLook==P.LockupTextLook.ShadowAndOutline?this.targetedShadowOffset=P.LockupStyle.DEFAULT_SHADOWOFFSET/2:this.targetedShadowOffset=P.LockupStyle.DEFAULT_SHADOWOFFSET,this.targetedLockupStyle.textLook==P.LockupTextLook.KnockoutAndOutline?this.targetedStrokeWeight=0:this.targetedStrokeWeight=P.LockupStyle.DEFAULT_STROKEWEIGHT),this.fixUpSecondaryColor(),this.fixUpBackingShape(),this.forma.controller.styleChanged()},applyBacking:function(t,e){var o,r,i,a,n,l;if((o=this.forma)&&(r=o.parent)&&(i=o.root)&&(a=o.page.document)&&(n=S.as(o.style,P.LockupStyle))&&(l=S.as(o.controller,z.TypeLockupController))){l.beginBlockedUpdate();var s=f.getBackingStringForBackingEnumAndArtworkId(t,e);C.BadgeFacade.logBackingShapeChange(o.source,s);var c,u=f.lockupStyleToLockupStyleAttributes(this.targetedLockupStyle,a),h=!1,g=!1,p=this.targetedLockupStyle.currentBackingOpacity,d=this.targetedLockupStyle.textLook;if(t==P.LockupBacking.Knockout){P.LockupStyle.isKnockoutLook(d)||(d=P.LockupTextLook.KnockoutOnly,u.textLook="knockoutOnly"),i.visitAll(O.FormaTraversal.PreOrder,(function(t){var e;(e=S.as(t.style,P.LockupStyle))&&e.backing==P.LockupBacking.Knockout&&(e.backing=P.LockupBacking.None,e.textLook=P.LockupTextLook.Fill)}));var k=S.clone(r.filterWithCallback((function(t){return(t.isBackgroundImage()||t.isShape())&&S.opt(t.controller,(function(t){return 0==t.floating}))}),O.FormaTraversal.JustChildren));r.insertChildAt(o,k.length)}this.targetedLockupStyle!==n&&((E=this.targetedLockupStyle).backing==P.LockupBacking.UNSET&&(I.LegacyCoreAssert.isTrue(P.LockupStyle.isLetterGrid(n.layout),"LockupBacking.UNSET in secondary styles for non-letter-grid layouts?",void 0,"LockupStyleController.applyBacking","LockupStyleController.swift",2851),E.padding=n.padding),t==P.LockupBacking.None||t==P.LockupBacking.Rows||t==P.LockupBacking.SVGBackground?(E.backing=t,E.backingArtworkID=e):t==P.LockupBacking.Knockout&&(E.backing=P.LockupBacking.UNSET,d=P.LockupTextLook.KnockoutOnly),u=f.lockupStyleToLockupStyleAttributes(E,a),s=f.getBackingStringForBackingEnumAndArtworkId(E.backing,E.backingArtworkID),d=E.textLook),u.backing!=s&&(c=N.ShapeLibrary.shapeDictionary[s])&&(h=f.needsContrastingColor(s,d,c.filled),c.filled||d==P.LockupTextLook.FillAndOutline||d==P.LockupTextLook.FillAndOutline2||(g=!0),c.filled||(p=1)),u.backing=s,t!=P.LockupBacking.None||d!=P.LockupTextLook.KnockoutOnly&&d!=P.LockupTextLook.KnockoutAndOutline||(u.textLook="none");var y=this.updateOpacityAttributes(p,u);if(h&&(T=o.page.colorLibraryController.getSolidColorForKey(u.secondaryColor))&&(D=o.page.colorLibraryController.getSolidColorForKey(u.primaryColor))){var L=f.getBackingOpacity(u);L==P.LockupStyle.OPACITY_UNSET&&(L=f.getBackingOpacity(f.lockupStyleToLockupStyleAttributes(n,a)));for(var m=!0,A=S.iter(this.pageData.colorsBehindSelectedLockup);!A.done;A.next()){var v=A.value.blend(T,L);if(!f.hasSufficientLegibilityContrast(D,v)){m=!1;break}}if(!m){var b=this.getContrastingColorKey(u.secondaryColor,u.primaryColor);y.secondaryColor=b}}if(g){var D,T,w,x=u.primaryColor,B=u.secondaryColor;(D=o.page.colorLibraryController.getSolidColorForKey(x))&&(this.pageData.isColorVisibleAgainstBackground(D)||(T=o.page.colorLibraryController.getSolidColorForKey(B))&&(this.pageData.isColorVisibleAgainstBackground(T)&&!S.opt(N.ShapeLibrary.shapeDictionary[s],(function(t){return t.category==N.ShapeCategory.Cutout}))?(y.primaryColor=B,y.secondaryColor=x):null!=(w=this.getThemeColorContrastingWithBackground())&&(y.primaryColor=w)))}if(this.targetedLockupStyle!==n){var E;(E=this.targetedLockupStyle).textOpacity!=P.LockupStyle.OPACITY_UNSET&&(E.textOpacity=y.textOpacity),E.backingOpacity!=P.LockupStyle.OPACITY_UNSET&&(E.backingOpacity=y.backingOpacity),this.pickVisibleColorsForCharStyle()}else{var F=f.lockupStyleAttributesToLockupStyle(y,n,a);if(F.shapeSupportsKnockout)P.LockupStyle.doesLookColorMatchShapeColor(F.textLook)&&1==F.backingOpacity&&(F.backingOpacity=.5);else{P.LockupStyle.isKnockoutLook(F.textLook)&&(F.textLook=P.LockupTextLook.Fill);for(var _=S.iter(F.characterStyles);!_.done;_.next()){var R=_.value;!R.shapeSupportsKnockout&&P.LockupStyle.isKnockoutLook(R.textLook)&&(R.textLook=P.LockupTextLook.UNSET)}}o.applyStyle(F)}l.endBlockedUpdate(),l.styleChanged(),this.onBackingShapeChanged()}},switchPrimaryColorAndSecondaryColor:function(){var t,e=!1;if(t=S.as(S.opt(this.forma,(function(t){return t.style})),P.LockupStyle)){var o=f.lockupStyleToLockupStyleAttributes(t,this.forma.page.document),r=this.forma.page.colorLibraryController.getSolidColorForKey(o.primaryColor),i=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);if(null!=r&&null!=i){var a=o.primaryColor;o.primaryColor=o.secondaryColor,o.secondaryColor=a;var n=f.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document);this.forma.applyStyle(n),e=!0}}return e},getContrastingThemeColorBasedOnSolidColor:function(t,e){if(void 0===e&&(e=null),null==t)return null;for(var o=this.forma.page.colorLibraryController,r=S.iter(o.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS));!r.done;r.next()){var i,a=r.value;if((i=o.getSolidColorForKey(a))&&i.contrasts(t,!1)&&!i.isEqual(e))return a}return null},getThemeColorContrastingWithBackground:function(t){void 0===t&&(t=null);for(var e=this.forma.page.colorLibraryController,o=S.iter(e.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS));!o.done;o.next()){var r,i=o.value;if((r=e.getSolidColorForKey(i))&&(null==t||!r.isEqual(t))){for(var a=!0,n=S.iter(this.pageData.colorsBehindSelectedLockup);!n.done;n.next()){var l=n.value;if(!r.contrasts(l,!1)){a=!1;break}}if(a)return i}}return null},doesLockupContrastWithBackground:function(){var t,e=!0;if(t=S.as(S.opt(this.forma,(function(t){return t.style})),P.LockupStyle)){var o=f.lockupStyleToLockupStyleAttributes(t,this.forma.page.document),r=this.forma.page.colorLibraryController.getSolidColorForKey(o.primaryColor),i=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);t.secondaryColorVisible?t.textBacked?null!=r&&null!=i&&(e=this.pageData.isColorVisibleAgainstBackground(i)&&r.contrasts(i,!1)):null!=r&&null!=i&&(e=this.pageData.isColorVisibleAgainstBackground(r)&&this.pageData.isColorVisibleAgainstBackground(i)):null!=r&&(e=this.pageData.isColorVisibleAgainstBackground(r))}return e},pickVisibleColorsForLockup:function(){var t=this.pickVisibleColorsForTextAndShape(),e=this.pickVisibleColorsForCharStyle(),o=t||e;return o&&this.forma.controller.styleChanged(),o},pickVisibleColorsForTextAndShape:function(){if(this.doesLockupContrastWithBackground())return!1;if(this.switchPrimaryColorAndSecondaryColor()){if(this.doesLockupContrastWithBackground())return!0;this.switchPrimaryColorAndSecondaryColor()}var t,e=!1;if(t=S.as(S.opt(this.forma,(function(t){return t.style})),P.LockupStyle)){var o=f.lockupStyleToLockupStyleAttributes(t,this.forma.page.document),r=this.forma.page.colorLibraryController.getSolidColorForKey(o.primaryColor),i=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);if(t.secondaryColorVisible){if(t.textBacked){if(null!=r&&null!=i)if(this.pageData.isColorVisibleAgainstBackground(i))r.contrasts(i,!1)||null!=(a=this.getContrastingThemeColorBasedOnSolidColor(i))&&(o.primaryColor=a,e=!0);else if(null!=(l=this.getThemeColorContrastingWithBackground())){o.secondaryColor=l;var a,n=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);e=!0,f.hasSufficientLegibilityContrast(r,n)||null!=(a=this.getContrastingThemeColorBasedOnSolidColor(n))&&(o.primaryColor=a)}}else if(null!=r&&null!=i){var l;this.pageData.isColorVisibleAgainstBackground(r)||null!=(l=this.getThemeColorContrastingWithBackground())&&(o.primaryColor=l,e=!0),this.pageData.isColorVisibleAgainstBackground(i)||(r.isEqual(i)?(o.secondaryColor=o.primaryColor,e=!0):null!=(l=this.getThemeColorContrastingWithBackground(r))?(o.secondaryColor=l,e=!0):(o.secondaryColor=o.primaryColor,e=!0))}}else null!=r&&(this.pageData.isColorVisibleAgainstBackground(r)||null!=(l=this.getThemeColorContrastingWithBackground())&&(o.primaryColor=l,e=!0));if(e){var s=f.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document);this.forma.applyStyle(s)}}return e},pickVisibleColorsForCharStyle:function(){var t,e=!1;if(t=S.as(S.opt(this.forma,(function(t){return t.style})),P.LockupStyle)){if(0==S.count(t.characterStyles))return e;for(var o=P.LockupStyle.isKnockoutLook(t.textLook)?"":t.colors.colorID(w.ColorRole.FieldPrimary),r=t.textBacked?t.colors.colorID(w.ColorRole.FieldSecondary):"",i=this.forma.page.colorLibraryController,a=[],n=S.iter(i.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS));!n.done;n.next()){var l,s=n.value;(l=i.getSolidColorForKey(s))&&this.pageData.isColorVisibleAgainstBackground(l)&&a.push(s)}for(var c=S.iter(t.characterStyles);!c.done;c.next()){var u=c.value,h=u.colors.colorID(w.ColorRole.FieldPrimary),g=u.secondaryColorVisible?u.colors.colorID(w.ColorRole.FieldSecondary):"";if(u.secondaryColorVisible&&u.backing!=P.LockupBacking.UNSET){var p,d=!1;if(""==r&&(p=i.getSolidColorForKey(g))&&(this.pageData.isColorVisibleAgainstBackground(p)||(d=!0)),d)for(var k=S.iter(a);!k.done;k.next())(T=k.value)!=r&&(u.colors.setColorId(w.ColorRole.FieldSecondary,T),e=!0);else if(g==r)for(var y=S.iter(i.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS));!y.done;y.next())(s=y.value)!=r&&(u.colors.setColorId(w.ColorRole.FieldSecondary,s),e=!0)}var f=!1,L=h!=o,C=i.getSolidColorForKey(t.colors.colorID(w.ColorRole.FieldPrimary));if(null==C)return e;if(!u.textBacked){var m=i.getSolidColorForKey(h);L&&""!=o&&(L=m.contrasts(C,!1)),""!=r||this.pageData.isColorVisibleAgainstBackground(m)||(f=!0)}if((u.backing!=P.LockupBacking.None&&u.backing!=P.LockupBacking.UNSET||L&&h!=r)&&!f){if(u.textBacked&&h==u.colors.colorID(w.ColorRole.FieldSecondary))for(var v=S.iter(i.getThemeColorKeys());!v.done;v.next())if((s=v.value)!=u.colors.colorID(w.ColorRole.FieldSecondary)){u.colors.setColorId(w.ColorRole.FieldPrimary,s),e=!0;break}}else for(var b=S.iter(a);!b.done;b.next()){var D=b.value,T=i.getSolidColorForKey(D),O=""==o||T.contrasts(C,!1);if(D!=o&&D!=r&&(!O&&e||u.colors.setColorId(w.ColorRole.FieldPrimary,D),e=!0,O))break}}}return e},getBrandkitColorsInUse:function(){for(var t=[],e=this.forma.page.colorLibraryController,o=S.iter(e.getColorThemeAsArrayOfTheoColors());!o.done;o.next()){var r=o.value;r.isBrandkitColor()&&t.push(r)}return t},getAllColorsFromDocumentBrandkit:function(){var t=[],e=E.Host.brandkitManager.brandkitForDocument(this.forma.page.document);if(null!=e)for(var o=S.iter(e.colors);!o.done;o.next()){var r=o.value,i=H.TheoColor.init_bb45(r);t.push(i)}return t},getBaseSuggestableColors:function(){for(var t=this.forma.page.colorLibraryController,e=S.clone(t.getColorThemeAsArrayOfTheoColors()),o=S.clone(t.getThemeDerivedColorsAsArrayOfTheoColors()),r=S.clone(t.getSuggestedColorsAsArraysOfTheoColors()),i=e.concat(r).concat(o),a=[],n=S.clone(this.getAllColorsFromDocumentBrandkit()),l=S.iter(i);!l.done;l.next()){var s=l.value;if(!s.isBrandkitColor()){for(var c=!0,u=S.iter(a);!u.done;u.next()){var h=u.value;if(s.rgbColor.distanceTo(h)<20){c=!1;break}}for(var g=S.iter(n);!g.done;g.next()){var p=g.value;if(s.rgbColor.distanceTo(p.rgbColor)<20){c=!1;break}}if(c&&a.push(s.rgbColor),a.length>=10)break}}return a},getSuggestableSingleColors:function(){for(var t=S.clone(this.getBaseSuggestableColors()),e=f.getTextOpacity(this.pageData.selectedLockup.styleAttributes),o=[],r=S.iter(t);!r.done;r.next()){for(var i=r.value,a=i.withAlphaOf(e),n=!0,l=S.iter(this.pageData.colorsBehindSelectedLockup);!l.done;l.next()){var s=l.value;if(!f.hasSufficientLegibilityContrast(a,s)){n=!1;break}}n&&o.push(i)}return o},getSuggestableColors:function(){var t=S.clone(this.getSuggestableColorPairs());if(0==t.length)for(var e=S.clone(this.getSuggestableSingleColors()),o=S.iter(e);!o.done;o.next()){var r=o.value;t.push([r])}for(var i=[],a=S.iter(t);!a.done;a.next()){for(var n=a.value,l=[],s=S.iter(n);!s.done;s.next()){var c=s.value;l.push(this.forma.page.colorLibraryController.getTheoColorForSolidColor(c))}i.push(S.clone(l))}return i},isCurrentlyShowingMultipleColors:function(){var t;return!((t=S.as(this.forma.controller,z.TypeLockupController))&&(!t.secondaryColorVisible()||this.targetedLockupStyle.textLook==P.LockupTextLook.KnockoutOnly||this.targetedLockupStyle.textLook==P.LockupTextLook.OutlineOnly))},getSuggestableColorPairs:function(){var t=[];if(!this.isCurrentlyShowingMultipleColors())return t;var e=this.targetedLockupStyle,o=f.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),r=(N.ShapeLibrary.shapeDictionary[o.backing]||N.ShapeLibrary.shapeDictionary.none).filled,i=f.getBackingOpacity(o);i==P.LockupStyle.OPACITY_UNSET&&(i=f.getBackingOpacity(f.lockupStyleToLockupStyleAttributes(this.forma.style,this.forma.page.document)));var a=S.clone(this.getBaseSuggestableColors()),n=a.length;if(0==n)return t;for(var l={},s=S.toArray(S.range(0,n,!1)),c=S.clone(S.shuffle(s)),u=S.iter(this.pageData.lockups);!u.done;u.next()){var h=u.value;if(h.id!=this.forma.formaID&&"none"!=h.styleAttributes.backing){var g=this.forma.page.colorLibraryController.getSolidColorForKey(h.styleAttributes.primaryColor),p=this.forma.page.colorLibraryController.getSolidColorForKey(h.styleAttributes.secondaryColor);if(null!=g&&null!=p&&f.hasSufficientLegibilityContrast(g,p)){for(var d=-1,k=-1,y=S.iter(S.range(0,a.length,!1));!y.done;y.next()){var L=y.value;a[L].distanceTo(g)<.1&&(d=L),a[L].distanceTo(p)<.1&&(k=L)}null==l[b=S.toString(W.MathUtils.maxInt(d,k))+" "+S.toString(W.MathUtils.minInt(d,k))]&&(t.push([g,p]),l[b]=!0)}}}for(var C=S.iter(S.range(0,2,!0));!C.done;C.next()){for(var m=S.iter(c);!m.done;m.next()){d=m.value;for(var A=S.clone(S.shuffle(s)),v=S.iter(A);!v.done;v.next()){var b;if(k=v.value,t.length>=10)break;if(null==l[b=S.toString(W.MathUtils.maxInt(d,k))+" "+S.toString(W.MathUtils.minInt(d,k))]){var D=a[d],T=a[k],w=D,O=T;D.lightness<T.lightness&&(w=T,O=D);var x=[];x=this.pageData.colorsBehindSelectedLockup[0].lightness>w.lightness?[O,w]:[w,O],r&&(x=S.reverse(x));for(var B=x[0],E=!0,F=S.iter(this.pageData.colorsBehindSelectedLockup);!F.done;F.next()){var _=F.value.blend(x[1],i),I=B.distanceTo(x[1]);if(!f.hasSufficientLegibilityContrast(B,_)||I<f.kColorPairDistanceThreshold){E=!1;break}}E&&(l[b]=!0,t.push(S.clone(x)))}}if(t.length>=10)break}if(t.length>=10)break}return t},applyColors:function(t,e){var o=this.targetedLockupStyle,r=this.forma.page.colorLibraryController;if(0!=t.length){C.BadgeFacade.logColorChange(S.opt(this.forma,(function(t){return t.source})));var i=S.clone(r.addColorsToTheme(S.clone(t),this.targetedLockupStyle!==this.forma.style?null:this.forma));if(1==t.length)this.applyColor(e,i[0]);else{var a=e==w.ColorRole.FieldPrimary?w.ColorRole.FieldSecondary:w.ColorRole.FieldPrimary;o.colors.setColorIDs([{key:e,value:i[0]},{key:a,value:i[1]}])}this.targetedLockupStyle!==this.forma.style&&(this.forma.style.colorTableBeforeChanged(),this.forma.style.colorTableAfterChanged(),this.forma.controller.styleChanged())}},applyColor:function(t,e){var o=this.targetedLockupStyle,r=f.lockupStyleToLockupStyleAttributes(o,this.forma.page.document),i=(N.ShapeLibrary.shapeDictionary[r.backing]||N.ShapeLibrary.shapeDictionary.none).filled,a=f.needsContrastingColor(r.backing,o.textLook,i),n=this.getContrastingColorKey(e,null);switch(t){case 1:r.primaryColor=e,r.secondaryColor=a?n:e;break;case 2:r.secondaryColor=e,r.primaryColor=a?n:e;break;default:return}o.colors.setColorIDs([{key:w.ColorRole.FieldPrimary,value:r.primaryColor},{key:w.ColorRole.FieldSecondary,value:r.secondaryColor}])},getContrastingColorKey:function(t,e){var o,r=this.forma.page.colorLibraryController.getTheoColorForKey(t);if(null==r)return"";null!=e&&(o=this.forma.page.colorLibraryController.getTheoColorForKey(e));var i=this.forma.page.colorLibraryController,a="";if(r.isBrandkitColor())for(var n=S.clone(this.getBrandkitColorsInUse()),l=r.getBrandkitShadeRole(),s=S.iter(n);!s.done;s.next()){var c=s.value,u=c.getBrandkitShadeRole();if((null==l&&(u==H.TheoColor.SPARK_COLOR_ROLE_SHADE0||u==H.TheoColor.SPARK_COLOR_ROLE_SHADE6)||null!=l&&(u==H.TheoColor.SPARK_COLOR_ROLE_SHADE1||u==H.TheoColor.SPARK_COLOR_ROLE_SHADE5))&&c.rgbColor.distanceTo(r.rgbColor)>30&&(null==o||c.rgbColor.distanceTo(o.rgbColor)>30)){a=i.getKeyOfColorInTheme(c);break}}return""==a&&null!=r&&(a=i.setLightnessContrastColorAndReturnKey(t,r)),a},setContrastingColor:function(t,e,o,r,i){var a=t.contrastWithColor(e),n=A.ColorLibraryController.getBackgroundContrastKey(r);return this.forma.page.colorLibraryController.setTheoColorToLibrary(H.TheoColor.init_5344(a,null,null),n),i.colors.setColorIDs([{key:o,value:n}]),n},backgroundContrastCheck:function(t){void 0===t&&(t=!0),0==this.hasScoresForAttributes&&this.updateScoring();var e=this.targetedLockupStyle,o=f.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),r=N.ShapeLibrary.shapeDictionary[o.backing],i=S.count(e.characterStyles)>0;if(null!=r){var a=r.filled;if(!a||e.textLook==P.LockupTextLook.KnockoutOnly||i){for(var n,l,s=e.textLook==P.LockupTextLook.KnockoutOnly,c=P.LockupStyle.isShadowLook(e.textLook),u=s||c?w.ColorRole.FieldSecondary:w.ColorRole.FieldPrimary,h=!1,g=S.iter(this.forma.style.characterStyles);!g.done;g.next())(L=g.value).colors.colorID(u)==e.colors.colorID(u)&&(h=!0);if((n=S.as(this.forma.controller,z.TypeLockupController))&&(l=n.getBackgroundColor())){var p=e.colors.color(u);if(null!=p&&!p.contrasts(l,t)){var d=this.getContrastingColorKey(e.colors.colorID(u),null);e.colors.setColorId(u,d),this.forma.controller.styleChanged()}if(i&&!h)for(var k=S.iter(this.forma.style.characterStyles);!k.done;k.next()){var y,L=k.value;if(y=a?e.colors.color(w.ColorRole.FieldSecondary):l){var C=L.colors.color(u);if(null!=C&&!C.contrasts(y,t)){var m=L.colors.colorID(u);d=this.getContrastingColorKey(m,null),L.colors.setColorId(u,d)}}}}}}else I.LegacyCoreAssert.fail("shape is not set up in ShapeLibrary.shapeDictionary",void 0,"LockupStyleController.backgroundContrastCheck","LockupStyleController.swift",3849)},shuffleColorAssignment:function(){this.updateScoring();var t=S.as(this.forma.controller,z.TypeLockupController);null!=t&&t.beginBlockedUpdate();var e=this.targetedLockupStyle,o=f.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),r=P.LockupStyle.isOutlineLook(e.textLook)||P.LockupStyle.isShadowLook(e.textLook),i=!1;r||(i=N.ShapeLibrary.shapeDictionary[o.backing].filled),("none"!=o.backing||r)&&(o.secondaryColor=this.profilingBackgroundColorSelector.selectColorForGlobalRecolor(!0));var a,n=null;(i||r)&&(a=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor))&&(n=S.clone(D.ColorForComparison.init_c063(a,r?.7:1)));var l=!i;l&&this.pageData.lockups.length<=2?o.primaryColor=this.profilingPrimaryColorSelector.selectColorForIndividualRecolor(l,S.clone(n),!1):o.primaryColor=this.profilingPrimaryColorSelector.selectColorForGlobalRecolor(l,S.clone(n),!0),this.setSecondaryMultiStyleLockupColors(e,o),e.colors.setColorIDs([{key:w.ColorRole.FieldPrimary,value:o.primaryColor},{key:w.ColorRole.FieldSecondary,value:o.secondaryColor}]),null!=t&&t.endBlockedUpdate(),this.forma.controller.styleChanged()},shuffleMultiStyleLockupColors:function(){this.pageData=new f.InterestingPageData(this.forma),this.profilingPrimaryColorSelector.updateBackgroundColors(S.clone(this.pageData.colorsBehindSelectedLockup)),this.profilingBackgroundColorSelector.updateBackgroundColors(S.clone(this.pageData.colorsBehindSelectedLockup));var t=this.targetedLockupStyle,e=f.lockupStyleToLockupStyleAttributes(t,this.forma.page.document);this.setSecondaryMultiStyleLockupColors(t,e)},setSecondaryMultiStyleLockupColors:function(t,e,o){void 0===o&&(o=!0);for(var r=S.iter(t.characterStyles);!r.done;r.next()){var i=r.value,a=S.eq(K._equality_SolidColor_SolidColor,t.colors.fieldPrimary,t.colors.fieldSecondary);if(i.backing!=P.LockupBacking.None&&i.backing!=P.LockupBacking.UNSET&&!a&&S.eq(K._equality_SolidColor_SolidColor,i.colors.fieldPrimary,t.colors.fieldSecondary)&&S.eq(K._equality_SolidColor_SolidColor,i.colors.fieldSecondary,t.colors.fieldPrimary)&&o)i.colors.setColorIDs([{key:w.ColorRole.FieldPrimary,value:e.secondaryColor},{key:w.ColorRole.FieldSecondary,value:e.primaryColor}]);else{for(var n=S.clone(this.getStylePrimarySecondaryColorForMSL(e,i,!0)),l=S.iter(S.range(0,5,!0));!l.done&&n[0]==n[1];l.next())n=S.clone(this.getStylePrimarySecondaryColorForMSL(e,i,!0));i.colors.setColorIDs([{key:w.ColorRole.FieldPrimary,value:n[0]},{key:w.ColorRole.FieldSecondary,value:n[1]}])}}},getStylePrimarySecondaryColor:function(t){var e=t.clone();e.secondaryColor=this.secondaryColorSelector.select(e,!1,!0,!1,!1),e.primaryColor=this.primaryColorSelector.select(e,!1,!0,!1,!1);for(var o=S.iter(S.range(0,5,!0));!o.done&&e.primaryColor==e.secondaryColor;o.next())e.secondaryColor=this.secondaryColorSelector.select(e,!1,!0,!1,!1),e.primaryColor=this.primaryColorSelector.select(e,!1,!0,!1,!1);return[e.primaryColor,e.secondaryColor]},getStylePrimarySecondaryColorForMSL:function(t,e,o){var r,i=this.secondaryColorSelector.select(t,!0,!1,!0,o),a=!0;if(e.backing!=P.LockupBacking.None||P.LockupStyle.isOutlineLook(e.textLook)||P.LockupStyle.isShadowLook(e.textLook)){var n=f.lockupStyleToLockupStyleAttributes(e,this.forma.page.document);n.secondaryColor=i,r=this.primaryColorSelector.select(n,!0,!1,!1,o)}else a=!1,r=this.primaryColorSelector.select(t,!1,!1,!0,o);var l,s,c=(new U.ProfilingColorMap).overridePaletteMappingDueToContrast(i,this.forma.formaID+U.ProfilingColorMap.lockupMSLBackingColorKey),u=(new U.ProfilingColorMap).overridePaletteMappingDueToContrast(r,this.forma.formaID+U.ProfilingColorMap.lockupMSLPrimaryColorKey);return(l=this.forma.page.colorLibraryController.getSolidColorForKey(u))&&(s=this.forma.page.colorLibraryController.getSolidColorForKey(c))&&(a&&!s.contrasts(l)||(i=c,r=u)),[r,i]},generateAndApplyInitialStyleAttributes:function(){var t,e,o,r,i;if(0==this.hasScoresForAttributes&&this.updateScoring(),(t=this.forma)&&(e=t.page.document)&&(o=S.as(t.style,P.LockupStyle))&&(r=E.Host.fontProvider)&&(i=E.Host.textModelUtils)){var a,n=f.lockupStyleToLockupStyleAttributes(o,e),l=["Lato-Light","Lora-Regular","Montserrat-Regular","PlayfairDisplay-Regular","CantataOne-Regular","FuturaPT-Medium"].filter((function(t){return r.descriptorForPostScriptName(t,e).availability==x.FontAvailability.LOADED}),this);if(0==l.length)a=i.defaultFont().postScriptName;else{var s=b.CoreRandom.nextIntUniform(l.length);a=l[s]}for(var c=r.getIncludedFonts(e),u=S.iter(S.range(0,c.count,!1));!u.done;u.next()){var h=u.value;S.opt(c.fontAt(h),(function(t){return t.postScriptName==a}))&&(n.font=h)}n.layout=this.layoutSelector.select(n,!1,!1,!1,!1),"fill"!=n.layout&&"right"!=n.layout||(n.layout="center"),n.padding=0,n.textOpacity=1,n.backingOpacity=1,n=this.setNewStyleColors(n,o);var g=f.lockupStyleAttributesToLockupStyle(n,o,e);t.applyStyle(g)}},setNewStyleColors:function(t,e){var o,r=t.clone(),i=N.ShapeLibrary.shapeDictionary[r.backing].filled,a=P.LockupStyle.isOutlineLook(e.textLook)||P.LockupStyle.isShadowLook(e.textLook),n=null,l=!i;return("none"!=r.backing||a)&&(r.secondaryColor=this.profilingBackgroundColorSelector.selectColorForGlobalRecolor(!0,void 0,!0),(o=this.forma.page.colorLibraryController.getSolidColorForKey(r.secondaryColor))&&(n=S.clone(D.ColorForComparison.init_c063(o,a?.7:1)))),r.primaryColor=this.profilingPrimaryColorSelector.selectColorForIndividualRecolor(l,S.clone(n),!0),r},getNewStyleAttributes:function(t,e,o){void 0===t&&(t=!0),0==this.hasScoresForAttributes&&this.updateScoring();var r,i,a=this.forma.style,n=f.lockupStyleToLockupStyleAttributes(a,this.forma.page.document);return n.font=this.fontSelector.select(n,!1,t,!1,!1),n.layout=this.layoutSelector.select(n,!1,t,!1,!1),n.backing=this.backingSelector.select(n,!1,t,!1,!1),o||(n.secondaryColor=this.secondaryColorSelector.select(n,!1,t,!1,!1),n.primaryColor=this.primaryColorSelector.select(n,!1,t,!1,!1),this.setSecondaryMultiStyleLockupColors(a,n,!1)),n.shadowAngle=this.shadowAngleSelector.select(n,!1,t,!1,!1),n.spacing=this.spacingSelector.select(n,!1,t,!1,!1),n.wheelUsed=!0,o?(r=f.lockupStyleAttributesToLockupStyle(n,a,this.forma.page.document),r=this.updateLockupStyleWithNewColors(r),(i=e)&&(r=i.lockupStyleEvaluator.styleEvaluatedWithReadability(r))):(r=f.lockupStyleAttributesToLockupStyle(n,a,this.forma.page.document),(i=e)&&i.lockupStyleEvaluator.initializeReadabilityInformation(r)),r},evaluateLockupStyleWithReadability:function(t){return new R.LockupStyleEvaluator(this.forma).styleEvaluatedWithReadability(t)},updateLockupStyleWithNewColors:function(t){(new U.ProfilingColorMap).eraseCurrentPaletteMappingDictionary();var e=f.lockupStyleToLockupStyleAttributes(t,this.forma.page.document),o=S.clone(this.getStylePrimarySecondaryColor(e));return e.primaryColor=o[0],e.secondaryColor=o[1],t.colors.setColorIDs([{key:w.ColorRole.FieldPrimary,value:o[0]},{key:w.ColorRole.FieldSecondary,value:o[1]}]),this.setSecondaryMultiStyleLockupColors(t,e,!1),t},updateOpacityAttributes:function(t,e){var o=(N.ShapeLibrary.shapeDictionary[e.backing]||N.ShapeLibrary.shapeDictionary.none).filled,r=e.clone();return r.opacity="useLockupOpacities",o?(f.getTextLook(r)==P.LockupTextLook.KnockoutAndOutline?r.textOpacity=t:r.textOpacity=1,r.backingOpacity=t):(r.textOpacity=t,r.backingOpacity=t),r},setOpacity:function(t){var e=this.targetedLockupStyle,o=f.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),r=this.updateOpacityAttributes(t,o);this.targetedLockupStyle===this.forma.style?this.forma.applyStyle(f.lockupStyleAttributesToLockupStyle(r,this.forma.style,this.forma.page.document)):(this.targetedLockupStyle.opacityRule=P.OpacityRule.UseLockupOpacities,this.targetedLockupStyle.textOpacity=r.textOpacity,this.targetedLockupStyle.backingOpacity=r.backingOpacity,this.forma.controller.styleChanged())},getOpacityValue:function(){return this.targetedLockupStyle.opacityRule!=P.OpacityRule.UNSET?this.targetedLockupStyle.currentBackingOpacity:this.forma.style.currentBackingOpacity},hasSpacingOptions:function(){var t,e;return!(!(t=S.opt(S.opt(this.forma,(function(t){return t.controller})),(function(t){return t.enableChildMove})))&&null==t||!t||this.targetedLockupStyle!==this.forma.style||!(e=S.as(this.forma.controller,z.TypeLockupController))||!(e.numLines()>1||0==e.numLines()))},hasPaddingOptions:function(){var t;if(!(t=S.opt(S.opt(this.forma,(function(t){return t.controller})),(function(t){return t.enableChildMove})))&&null==t||!t)return!1;var e=this.targetedLockupStyle;return e.backing!=P.LockupBacking.None&&e.backing!=P.LockupBacking.Knockout&&e.backing!=P.LockupBacking.UNSET},areSpacingAndPaddingOptionsAvailable:function(){return this.hasSpacingOptions()||this.hasPaddingOptions()},setNextSpacingAndPaddingOption:function(){var t,e;if(this.targetedLockupStyle===this.forma.style){var o=this.hasPaddingOptions(),r=this.hasSpacingOptions();if(o||r){var i=this.forma.style,a=f.lockupStyleToLockupStyleAttributes(i,this.forma.page.document),n=f.ALLOWED_PADDING_VALUES.length,l=f.ALLOWED_SPACING_VALUES.length,s=n*l,c=(t=S.indexOf(f.ALLOWED_PADDING_VALUES,a.padding))||null!=t?t:0,u=(e=S.indexOf(f.ALLOWED_SPACING_VALUES,a.spacing))||null!=e?e:0,h=(o?u*n+c:c*l+u)+1;h%=s;var g=o?S.toInt(h/n):h%l,p=o?h%n:S.toInt(h/l);a.padding=f.ALLOWED_PADDING_VALUES[p],a.spacing=f.ALLOWED_SPACING_VALUES[g],this.forma.applyStyle(f.lockupStyleAttributesToLockupStyle(a,this.forma.style,this.forma.page.document))}}else this.setNextPaddingOption()},setNextSpacingOption:function(){var t,e=this.forma.style,o=f.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),r=((t=S.indexOf(f.ALLOWED_SPACING_VALUES,o.spacing))||null!=t?t:0)+1;r>=f.ALLOWED_SPACING_VALUES.length&&(r=0),o.spacing=f.ALLOWED_SPACING_VALUES[r],this.forma.applyStyle(f.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document))},setSpacingFromSlider:function(t){this.setSpacing(Y.TheoDocumentUtils.sliderToSpacingPaddingMapping(t))},setSpacing:function(t){var e,o=this.forma.style,r=f.lockupStyleToLockupStyleAttributes(o,this.forma.page.document),i=((e=S.indexOf(f.ALLOWED_SPACING_VALUES,r.spacing))||null!=e?e:0)+1;i>=f.ALLOWED_SPACING_VALUES.length&&(i=0),r.spacing=t,this.forma.applyStyle(f.lockupStyleAttributesToLockupStyle(r,this.forma.style,this.forma.page.document))},supportsRelativeFontScale:function(){var t;if(!(t=S.opt(S.opt(this.forma,(function(t){return t.controller})),(function(t){return t.enableChildMove})))&&null==t||!t)return!1;var e=this.targetedLockupStyle;return e.layout==P.LockupLayout.Auto&&M.TypographyComposer.supportsRelativeFontScale(e.alignment)},setRelativeFontScale:function(t){var e=this.forma.style,o=f.lockupStyleToLockupStyleAttributes(e,this.forma.page.document);o.relativeFontScale=t,this.forma.applyStyle(f.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document))},setNextPaddingOption:function(){var t;if(this.hasPaddingOptions()){var e=this.targetedLockupStyle;this.targetedLockupStyle!=this.forma.style&&this.targetedLockupStyle.backing==P.LockupBacking.Rows&&this.forma.style.backing==P.LockupBacking.Rows&&(e=this.forma.style);var o=f.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),r=((t=S.indexOf(f.ALLOWED_PADDING_VALUES,o.padding))||null!=t?t:0)+1;r>=f.ALLOWED_PADDING_VALUES.length&&(r=0),o.padding=f.ALLOWED_PADDING_VALUES[r],e===this.forma.style?this.forma.applyStyle(f.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document)):(this.targetedLockupStyle.padding=o.padding,this.forma.controller.styleChanged())}},setPaddingFromSlider:function(t){this.setPadding(Y.TheoDocumentUtils.sliderToSpacingPaddingMapping(t))},setPadding:function(t){if(this.hasPaddingOptions()){var e=this.targetedLockupStyle;this.targetedLockupStyle!=this.forma.style&&this.targetedLockupStyle.backing==P.LockupBacking.Rows&&this.forma.style.backing==P.LockupBacking.Rows&&(e=this.forma.style);var o=f.lockupStyleToLockupStyleAttributes(e,this.forma.page.document);o.padding=t,e===this.forma.style?this.forma.applyStyle(f.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document)):(this.targetedLockupStyle.padding=o.padding,this.forma.controller.styleChanged())}},setNextTrackingOption:function(){var t=this.forma.style,e=f.lockupStyleToLockupStyleAttributes(t,this.forma.page.document);e.tracking+=.2,e.tracking>.9&&(e.tracking=0),this.forma.applyStyle(f.lockupStyleAttributesToLockupStyle(e,this.forma.style,this.forma.page.document))},setTrackingFromSlider:function(t){var e;if(e=S.as(S.opt(this.forma,(function(t){return t.controller})),z.TypeLockupController)){var o=e.getCurrentFontSize();this.targetedLockupStyle.tracking=t;var r=S.opt(e.getPin(!0,!0),(function(t){return t.pinPoint}))||q.TheoPoint.ZERO;e.setSizeSliderValue(o,[],r)}},setNextShadowAngle:function(){var t;if(P.LockupStyle.isShadowLook(this.targetedLockupStyle.textLook)){var e=this.forma.style,o=f.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),r=((t=S.indexOf(f.ALLOWED_SHADOWANGLE_VALUES,o.shadowAngle))||null!=t?t:0)+1;r>=f.ALLOWED_SHADOWANGLE_VALUES.length&&(r=0),o.shadowAngle=f.ALLOWED_SHADOWANGLE_VALUES[r],this.forma.applyStyle(f.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document))}},legacyColorConversion:function(){if(null!=this.forma)for(var t=this.forma.style,e=[w.ColorRole.FieldPrimary,w.ColorRole.FieldSecondary],o=S.iter(e);!o.done;o.next()){var r=o.value,i=t.colors.color(r),a=t.colors.colorID(r),n=null!=a&&A.ColorLibraryController.keyFromImage(a);if(null!=i&&null==a||n){var l=this.forma.page.colorLibraryController.addUnlinkedColor(i);t.colors.setColorId(r,l)}}else I.LegacyCoreAssert.fail("forma has been de-alloc'd",void 0,"LockupStyleController.legacyColorConversion","LockupStyleController.swift",4613)},onTrackingChanged:function(){var t;(t=S.as(S.opt(this.forma,(function(t){return t.style})),P.LockupStyle))&&(this._sessionAttrs.setTracking(t.tracking,t.layout),this.resetSessionContainerSize())},onSpacingChanged:function(){var t;(t=S.as(S.opt(this.forma,(function(t){return t.style})),P.LockupStyle))&&(this._sessionAttrs.setSpacing(t.spacing,t.layout),this.resetSessionContainerSize())},onBackingShapeChanged:function(){var t;if(t=S.as(S.opt(this.forma,(function(t){return t.style})),P.LockupStyle)){var e=f.getBackingStringForBackingEnumAndArtworkId(t.backing,t.backingArtworkID);this._sessionAttrs.setBackingShape(e,t.layout,t.pathID)}},onLayoutChanged:function(t){var e=t.layout,o=t.pathID,r=this.forma.style,i=r.layout,a=r.pathID;if(this._sessionAttrs.needsUpdate(e,t.alignment,o,i,r.alignment,a)){var n,l;this._sessionAttrs.setTracking(r.tracking,e),this._sessionAttrs.setSpacing(r.spacing,e),null!=(n=this._sessionAttrs.getTracking(i))&&(r.tracking=n),null!=(l=this._sessionAttrs.getSpacing(i))&&(r.spacing=l);var s=f.getBackingStringForBackingEnumAndArtworkId(r.backing,r.backingArtworkID);this._sessionAttrs.recordInitialBackingShape(s,e,o);for(var c=!1,u=S.iter(this._sessionAttrs.getPotentialBackingShapes(i,a,s));!u.done;u.next()){var h=u.value,g=f.getBackingEnumAndArtworkIdForBackingString(h),p=g.backing,d=g.artworkID;if(N.ShapeLibrary.isBackingShapeStyleCompatible(r,p,d)){r.backing=p,r.backingArtworkID=d,c=!0;break}}c||(S.opt(N.ShapeLibrary.shapeDictionary[s],(function(t){return 1==t.filled}))?(r.backing=P.LockupBacking.SVGBackground,r.backingArtworkID="square_001"):(r.backing=P.LockupBacking.None,r.backingArtworkID=null))}},endSession:function(){this._sessionAttrs.reset()},getSessionContainerSize:function(){return this._sessionAttrs._containerSize},setSessionContainerSize:function(t){},resetSessionContainerSize:function(){this._sessionAttrs._containerSize=null}}}),k),f.SessionAttrs=(y=function(){this._attrsDict={},this._hasBackingShapeEntry=!1,this._containerSize=null,this.reset()},S.defineClass({name:"SessionAttrs",ctor:y,statics:{TRACKING_KEY:"tracking",SPACING_KEY:"spacing",BACKING_KEY:"backing"},props:{reset:function(){this._attrsDict={},this._hasBackingShapeEntry=!1,this._containerSize=null,this.setTracking(0,P.LockupLayout.Standard),this.setSpacing(.35,P.LockupLayout.Standard),this.setTracking(.35,P.LockupLayout.LetterGrid),this.setSpacing(.35,P.LockupLayout.LetterGrid),this.setTracking(.15,P.LockupLayout.Path),this.setSpacing(.35,P.LockupLayout.Path),this.setTracking(0,P.LockupLayout.Auto),this.setSpacing(.35,P.LockupLayout.Auto)},needsUpdate:function(t,e,o,r,i,a){return t==P.LockupLayout.Auto&&t==r&&e!=i||this.getLayoutClass("",t,o)!=this.getLayoutClass("",r,a)},getTracking:function(t){return S.as(this._attrsDict[this.getSessionAttrsKey(y.TRACKING_KEY,t)],"Double")},setTracking:function(t,e){this._attrsDict[this.getSessionAttrsKey(y.TRACKING_KEY,e)]=t},getSpacing:function(t){return S.as(this._attrsDict[this.getSessionAttrsKey(y.SPACING_KEY,t)],"Double")},setSpacing:function(t,e){this._attrsDict[this.getSessionAttrsKey(y.SPACING_KEY,e)]=t},getBackingShape:function(t,e,o){return void 0===o&&(o=null),S.as(this._attrsDict[this.getSessionAttrsKey(y.BACKING_KEY,e,o)],"String")},setBackingShape:function(t,e,o){void 0===o&&(o=null),this._attrsDict[this.getSessionAttrsKey(y.BACKING_KEY,e,o)]=t,this._hasBackingShapeEntry=!0},recordInitialBackingShape:function(t,e,o){void 0===o&&(o=null),this._hasBackingShapeEntry||this.setBackingShape(t,e,o)},getPotentialBackingShapes:function(t,e,o){void 0===e&&(e=null);for(var r=this,i=[],a=[],n=S.iter(this._attrsDict);!n.done;n.next()){var l=n.key,s=n.value;l.includes(y.BACKING_KEY)&&(S.as(s,"String")==o?i.push(o):a.push(l))}return S.sortInPlace(a,(function(o,i){return r.getBackingShapeKeyDistance(o,t,e)<r.getBackingShapeKeyDistance(i,t,e)})),i.concat(a.map((function(t){return r._attrsDict[t]}),this))},getBackingShapeKeyDistance:function(t,e,o){var r;if(void 0===o&&(o=null),null!=(r=this.extractLayoutClass(y.BACKING_KEY,t))){var i=this.getLayoutClass(y.BACKING_KEY,e,o);return r==i?0:r==f.LayoutClass.PathDefault&&i==f.LayoutClass.PathAsymmetric||r==f.LayoutClass.PathAsymmetric&&i==f.LayoutClass.PathDefault?1:r==f.LayoutClass.Default?2:3+i}return 1e4},getLayoutClass:function(t,e,o){var r;return void 0===o&&(o=null),P.LockupStyle.isLetterGrid(e)?f.LayoutClass.LetterGrid:P.LockupStyle.isAutoLayout(e)?f.LayoutClass.Auto:P.LockupStyle.isPath(e)?t==y.SPACING_KEY||t==y.TRACKING_KEY||J.TextPathLibrary.isPathSymmetric((r=o)||null!=r?r:J.TextPathID.Circle)?f.LayoutClass.PathDefault:f.LayoutClass.PathAsymmetric:f.LayoutClass.Default},extractLayoutClass:function(t,e){if(e.startsWith(t)){var o,r=e.substr(t.length);if(null!=(o=S.toInt(r)))return f.LayoutClass.toCaseValue(o)}return null},getSessionAttrsKey:function(t,e,o){return void 0===o&&(o=null),t+this.getLayoutClass(t,e,o)}}}),y),f.LayoutClass=S.defineEnum("LayoutClass",{Default:0,LetterGrid:1,PathDefault:2,PathAsymmetric:3,Auto:4})}}]);
//# sourceMappingURL=vendors_npm_spark_18b3417f-d14cbca6.js.map