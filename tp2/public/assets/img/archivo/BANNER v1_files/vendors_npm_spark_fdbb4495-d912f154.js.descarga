(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[46],{"+N83":function(e,t,o){var r,n,i,a=t,s=o("oAGj"),l=o("c9Jm"),u=o("yGNn"),c=o("jo4Y"),m=o("lmwz");a.DeleteImagesTest=(r=function(){this.actionSequence_Delete=[],this.page_=null,this.backgroundImages_=[],l.ActionTestBase.call(this)},s.defineClass({name:"DeleteImagesTest",ctor:r,superName:"ActionTestBase",props:{tearDown:function(){this.backgroundImages_=[],l.ActionTestBase.prototype.tearDown.call(this)},canRunActionSequence:function(e,t,o){return m.ImageFacade.getBackgroundImagesFromPage(o.firstPage).length>0},populateActionSequence:function(e,t,o){var r=this,n=s.clone(e);return this.backgroundImages_=s.clone(m.ImageFacade.getBackgroundImagesFromPage(o.firstPage)),this.backgroundImages_.length>0&&(n=n.concat([function(){return new c.DeleteAction(s.clone(r.backgroundImages_))}])),u.CorePromise.resolve(s.clone(n))},setUpActionSequence:function(e,t,o){this.page_=o.firstPage},validateAfterActionSequence:function(e,t){var o=s.clone(m.ImageFacade.getBackgroundImagesFromPage(this.page_));XCTAssertEqual(o.length,0)},validateAfterUndo:function(e,t){var o=s.clone(m.ImageFacade.getBackgroundImagesFromPage(this.page_));XCTAssertEqual(o.length,this.backgroundImages_.length)},validateAfterRedo:function(e,t){var o=s.clone(m.ImageFacade.getBackgroundImagesFromPage(this.page_));XCTAssertEqual(o.length,0)}}}),r),a.DeleteCellsTest=(n=function(){this.actionSequence_Delete=[],this.doc_=null,this.frameCells_=[],this.deleteableCells_=[],this.expectedRemainingCells_=0,l.ActionTestBase.call(this)},s.defineClass({name:"DeleteCellsTest",ctor:n,superName:"ActionTestBase",props:{tearDown:function(){this.frameCells_=[],this.deleteableCells_=[],l.ActionTestBase.prototype.tearDown.call(this)},getFrameCells:function(e){return this.allSelectableFormae(e,(function(e){return e.isGridCell()}))},deleteableFrameCells:function(e){var t;return this.getFrameCells(e).filter((function(e){return!(!(t=s.opt(e.controller,(function(e){return e.deleteable})))&&null==t)&&t}),this)},canRunActionSequence:function(e,t,o){var r=this.getFrameCells(o).length,n=this.deleteableFrameCells(o).length;return r>n&&n>0||n>1},populateActionSequence:function(e,t,o){var r=this,n=s.clone(e);this.frameCells_=s.clone(this.getFrameCells(o)),this.deleteableCells_=s.clone(this.deleteableFrameCells(o)),this.deleteableCells_.length==this.frameCells_.length&&this.deleteableCells_.splice(0,1),this.expectedRemainingCells_=this.frameCells_.length-this.deleteableCells_.length;for(var i=s.iter(s.range(1,this.deleteableCells_.length,!0));!i.done;i.next())n=n.concat([function(){var e=s.clone(r.deleteableFrameCells(r.doc_));return new c.DeleteAction([s.first(e)])}]);return u.CorePromise.resolve(s.clone(n))},setUpActionSequence:function(e,t,o){this.doc_=o},validateAfterActionSequence:function(e,t){var o=s.clone(this.getFrameCells(this.doc_));XCTAssertEqual(o.length,this.expectedRemainingCells_)},validateAfterUndo:function(e,t){var o=s.clone(this.getFrameCells(this.doc_));XCTAssertEqual(o.length,this.frameCells_.length)},validateAfterRedo:function(e,t){var o=s.clone(this.getFrameCells(this.doc_));XCTAssertEqual(o.length,this.expectedRemainingCells_)}}}),n),a.DeleteItemsTest=(i=function(){this.actionSequence_Delete=[],this.doc_=null,this.floatingItems_=[],l.ActionTestBase.call(this)},s.defineClass({name:"DeleteItemsTest",ctor:i,superName:"ActionTestBase",props:{tearDown:function(){this.floatingItems_=[],l.ActionTestBase.prototype.tearDown.call(this)},getDeletableForma:function(e){return s.clone(this.allSelectableFormae(e,(function(e){return e.controller.canMultiSelect})))},populateActionSequence:function(e,t,o){var r=this,n=s.clone(e);return this.floatingItems_=s.clone(this.getDeletableForma(o)),this.floatingItems_.length>0&&(n=n.concat([function(){return new c.DeleteAction(s.clone(r.floatingItems_))}])),u.CorePromise.resolve(s.clone(n))},setUpActionSequence:function(e,t,o){this.doc_=o},validateAfterActionSequence:function(e,t){var o=s.clone(this.getDeletableForma(this.doc_));XCTAssertEqual(o.length,0)},validateAfterUndo:function(e,t){var o=s.clone(this.getDeletableForma(this.doc_));XCTAssertEqual(o.length,this.floatingItems_.length)},validateAfterRedo:function(e,t){var o=s.clone(this.getDeletableForma(this.doc_));XCTAssertEqual(o.length,0)}}}),i)},"1vuF":function(e,t,o){var r,n,i,a,s,l=t,u=o("oAGj"),c=o("c9Jm"),m=o("yGNn"),h=o("sTUO"),f=o("MYNe");l.LayerTest=(r=function(){this.actionSequence_LayerTest=[],this.testDoc_=null,this.initialFormaIndex_=0,this.finalFormaIndex_=0,c.ActionTestBase.call(this)},u.defineClass({name:"LayerTest",ctor:r,superName:"ActionTestBase",props:{tearDown:function(){this.initialLayerItem_=null,c.ActionTestBase.prototype.tearDown.call(this)},canRunActionSequence:function(e,t,o){var r;return this.testDoc_=o,!!(r=this.getLayerItem())&&(this.initialLayerItem_=r,f.LayerFacade.getReorderableLayerCount(this.initialLayerItem_)>1)},populateActionSequence:function(e,t,o){var r=this;this.initialFormaIndex_=f.LayerFacade.getZOrder(this.initialLayerItem_);var n=f.LayerFacade.getMinLayerIndex(this.initialLayerItem_),i=f.LayerFacade.getReorderableLayerCount(this.initialLayerItem_)+n-1;return this.initialFormaIndex_<i?this.finalFormaIndex_=this.initialFormaIndex_+1:this.initialFormaIndex_>n?this.finalFormaIndex_=this.initialFormaIndex_-1:XCTFail("Not enough items to change zorder"),m.CorePromise.resolve([function(){return new h.ChangeZOrderAction(r.finalFormaIndex_)}])},setUpActionSequence:function(e,t,o){o.controller.selection.replaceSelection(this.initialLayerItem_)},validateAfterActionSequence:function(e,t){var o=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(o==this.finalFormaIndex_)},validateAfterUndo:function(e,t){var o=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(o==this.initialFormaIndex_)},validateAfterRedo:function(e,t){var o=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(o==this.finalFormaIndex_)},getLayerItem:function(){var e=null,t=u.clone(this.allSelectableFormae(this.testDoc_,(function(e){return 1==e.controller.floating})));return t.length>0&&(e=u.first(t)),e}}}),r),l.SendForwardTest=(n=function(){this.actionSequence_SendForwardTest=[],this.testDoc_=null,this.initialFormaIndex_=0,this.finalFormaIndex_=0,c.ActionTestBase.call(this)},u.defineClass({name:"SendForwardTest",ctor:n,superName:"ActionTestBase",props:{tearDown:function(){this.initialLayerItem_=null,c.ActionTestBase.prototype.tearDown.call(this)},canRunActionSequence:function(e,t,o){var r;return this.testDoc_=o,!!(r=this.getLayerItem())&&(this.initialLayerItem_=r,f.LayerFacade.getReorderableLayerCount(this.initialLayerItem_)>1)},populateActionSequence:function(e,t,o){var r=this;this.initialFormaIndex_=f.LayerFacade.getZOrder(this.initialLayerItem_);var n=f.LayerFacade.getMinLayerIndex(this.initialLayerItem_),i=f.LayerFacade.getReorderableLayerCount(this.initialLayerItem_)+n-1;this.initialFormaIndex_>i||this.initialFormaIndex_<n?XCTFail("Selected forma index is out-of-bounds for z-order index. Cannot change z-order."):this.initialFormaIndex_==i?this.finalFormaIndex_=this.initialFormaIndex_:this.initialFormaIndex_>=n&&(this.finalFormaIndex_=this.initialFormaIndex_+1);var a=f.ZOrderEnum.Forward;return m.CorePromise.resolve([function(){return new h.SendForwardBackwardAction(a,[r.initialLayerItem_])}])},validateAfterActionSequence:function(e,t){var o=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(o==this.finalFormaIndex_)},validateAfterUndo:function(e,t){var o=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(o==this.initialFormaIndex_)},validateAfterRedo:function(e,t){var o=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(o==this.finalFormaIndex_)},getLayerItem:function(){var e=null,t=u.clone(this.allSelectableFormae(this.testDoc_,(function(e){return 1==e.controller.floating})));return t.length>0&&(e=u.first(t)),e}}}),n),l.SendBackwardTest=(i=function(){this.actionSequence_SendBackwardTest=[],this.testDoc_=null,this.initialFormaIndex_=0,this.finalFormaIndex_=0,c.ActionTestBase.call(this)},u.defineClass({name:"SendBackwardTest",ctor:i,superName:"ActionTestBase",props:{tearDown:function(){this.initialLayerItem_=null,c.ActionTestBase.prototype.tearDown.call(this)},canRunActionSequence:function(e,t,o){var r;return this.testDoc_=o,!!(r=this.getLayerItem())&&(this.initialLayerItem_=r,f.LayerFacade.getReorderableLayerCount(this.initialLayerItem_)>1)},populateActionSequence:function(e,t,o){var r=this;this.initialFormaIndex_=f.LayerFacade.getZOrder(this.initialLayerItem_);var n=f.LayerFacade.getMinLayerIndex(this.initialLayerItem_),i=f.LayerFacade.getReorderableLayerCount(this.initialLayerItem_)+n-1;this.initialFormaIndex_>i||this.initialFormaIndex_<n?XCTFail("Selected forma index is out-of-bounds for z-order index. Cannot change z-order."):this.initialFormaIndex_==n?this.finalFormaIndex_=this.initialFormaIndex_:this.initialFormaIndex_<=i&&(this.finalFormaIndex_=this.initialFormaIndex_-1);var a=f.ZOrderEnum.Backward;return m.CorePromise.resolve([function(){return new h.SendForwardBackwardAction(a,[r.initialLayerItem_])}])},validateAfterActionSequence:function(e,t){var o=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(o==this.finalFormaIndex_)},validateAfterUndo:function(e,t){var o=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(o==this.initialFormaIndex_)},validateAfterRedo:function(e,t){var o=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(o==this.finalFormaIndex_)},getLayerItem:function(){var e=null,t=u.clone(this.allSelectableFormae(this.testDoc_,(function(e){return 1==e.controller.floating})));return t.length>0&&(e=u.first(t)),e}}}),i),l.SendToFrontTest=(a=function(){this.actionSequence_SendToFrontTest=[],this.testDoc_=null,this.initialFormaIndex_=0,this.finalFormaIndex_=0,c.ActionTestBase.call(this)},u.defineClass({name:"SendToFrontTest",ctor:a,superName:"ActionTestBase",props:{tearDown:function(){this.initialLayerItem_=null,c.ActionTestBase.prototype.tearDown.call(this)},canRunActionSequence:function(e,t,o){var r;return this.testDoc_=o,!!(r=this.getLayerItem())&&(this.initialLayerItem_=r,f.LayerFacade.getReorderableLayerCount(this.initialLayerItem_)>1)},populateActionSequence:function(e,t,o){var r=this;this.initialFormaIndex_=f.LayerFacade.getZOrder(this.initialLayerItem_);var n=f.LayerFacade.getMinLayerIndex(this.initialLayerItem_),i=f.LayerFacade.getReorderableLayerCount(this.initialLayerItem_)+n-1;this.initialFormaIndex_>i||this.initialFormaIndex_<n?XCTFail("Selected forma index is out-of-bounds for z-order index. Cannot change z-order."):this.initialFormaIndex_==i?this.finalFormaIndex_=this.initialFormaIndex_:this.initialFormaIndex_>=n&&(this.finalFormaIndex_=i);var a=f.ZOrderEnum.Front;return m.CorePromise.resolve([function(){return new h.SendForwardBackwardAction(a,[r.initialLayerItem_])}])},validateAfterActionSequence:function(e,t){var o=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(o==this.finalFormaIndex_)},validateAfterUndo:function(e,t){var o=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(o==this.initialFormaIndex_)},validateAfterRedo:function(e,t){var o=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(o==this.finalFormaIndex_)},getLayerItem:function(){var e=null,t=u.clone(this.allSelectableFormae(this.testDoc_,(function(e){return 1==e.controller.floating})));return t.length>0&&(e=u.first(t)),e}}}),a),l.SendToBackTest=(s=function(){this.actionSequence_SendToBackTest=[],this.testDoc_=null,this.initialFormaIndex_=0,this.finalFormaIndex_=0,c.ActionTestBase.call(this)},u.defineClass({name:"SendToBackTest",ctor:s,superName:"ActionTestBase",props:{tearDown:function(){this.initialLayerItem_=null,c.ActionTestBase.prototype.tearDown.call(this)},canRunActionSequence:function(e,t,o){var r;return this.testDoc_=o,!!(r=this.getLayerItem())&&(this.initialLayerItem_=r,f.LayerFacade.getReorderableLayerCount(this.initialLayerItem_)>1)},populateActionSequence:function(e,t,o){var r=this;this.initialFormaIndex_=f.LayerFacade.getZOrder(this.initialLayerItem_);var n=f.LayerFacade.getMinLayerIndex(this.initialLayerItem_),i=f.LayerFacade.getReorderableLayerCount(this.initialLayerItem_)+n-1;this.initialFormaIndex_>i||this.initialFormaIndex_<n?XCTFail("Selected forma index is out-of-bounds for z-order index. Cannot change z-order."):this.initialFormaIndex_==n?this.finalFormaIndex_=this.initialFormaIndex_:this.initialFormaIndex_<=i&&(this.finalFormaIndex_=n);var a=f.ZOrderEnum.Back;return m.CorePromise.resolve([function(){return new h.SendForwardBackwardAction(a,[r.initialLayerItem_])}])},validateAfterActionSequence:function(e,t){var o=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(o==this.finalFormaIndex_)},validateAfterUndo:function(e,t){var o=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(o==this.initialFormaIndex_)},validateAfterRedo:function(e,t){var o=f.LayerFacade.getZOrder(this.initialLayerItem_);XCTAssertTrue(o==this.finalFormaIndex_)},getLayerItem:function(){var e=null,t=u.clone(this.allSelectableFormae(this.testDoc_,(function(e){return 1==e.controller.floating})));return t.length>0&&(e=u.first(t)),e}}}),s)},"4zuo":function(e,t,o){var r,n=t,i=o("oAGj"),a=o("c9Jm"),s=o("pnSN"),l=o("434x"),u=o("8t9B"),c=o("oKlP"),m=o("sIWg");n.NudgeTest=(r=function(){this.actionSequence_NudgeUpRight=[function(){return new l.NudgeAction(new c.TheoPoint(10,0),null)},function(){return new l.NudgeAction(new c.TheoPoint(0,-10),null)}],this.formaToNudge_=null,this.initialBounds_=m.TheoRect.Zero,this.postNudgeBounds_=m.TheoRect.Zero,a.ActionTestBase.call(this)},i.defineClass({name:"NudgeTest",ctor:r,superName:"ActionTestBase",props:{tearDown:function(){this.formaToNudge_=null,a.ActionTestBase.prototype.tearDown.call(this)},setUpActionSequence:function(e,t,o){this.formaToNudge_=i.last(this.allSelectableFormae(o,(function(e){return e instanceof s.GroupForma&&e.controller.kind==u.TypeLockupController.KIND}))),XCTAssertNotNil(this.formaToNudge_),null!=this.formaToNudge_&&(o.controller.selection.replaceSelection(this.formaToNudge_),this.initialBounds_=this.formaToNudge_.finalFrame)},validateAfterActionSequence:function(e,t){this.postNudgeBounds_=this.formaToNudge_.finalFrame,XCTAssertFalse(this.postNudgeBounds_.equal(this.initialBounds_))},validateAfterUndo:function(e,t){var o=this.formaToNudge_.finalFrame;XCTAssertTrue(this.initialBounds_.equal(o))},validateAfterRedo:function(e,t){var o=this.formaToNudge_.finalFrame;XCTAssertTrue(o.equal(this.postNudgeBounds_))}}}),r)},CSb8:function(e,t,o){var r,n=t,i=o("oAGj"),a=o("c9Jm"),s=o("yGNn"),l=o("pjjd"),u=o("FNB+"),c=o("pnSN"),m=o("8t9B");n.DuplicateTest=(r=function(){this.actionSequence_DuplicateAllText=[],this.doc_=null,this.initialCounts_={},a.ActionTestBase.call(this)},i.defineClass({name:"DuplicateTest",ctor:r,superName:"ActionTestBase",props:{tearDown:function(){this.initialCounts_={},a.ActionTestBase.prototype.tearDown.call(this)},countDuplicates:function(e){var t,o=0;return(t=i.as(e.controller,m.TypeLockupController))&&i.opt(this.doc_,(function(e){return e.firstPage.root.visit(u.FormaTraversal.PreOrder,(function(e,r,n){var a,s;return(a=i.as(e,c.GroupForma))&&(s=i.as(a.controller,m.TypeLockupController))&&s.text==t.text&&(o+=1),!1}))})),o},populateActionSequence:function(e,t,o){for(var r=i.clone(this.allSelectableFormae(o,(function(e){return e instanceof c.GroupForma&&e.controller.kind==m.TypeLockupController.KIND}))),n=i.iter(r);!n.done;n.next()){var a=n.value;this.initialCounts_[a]=1}return s.CorePromise.resolve([function(){return new l.DuplicateAction(i.clone(r),!0,!1,!1)}])},setUpActionSequence:function(e,t,o){for(var r=i.iter(i.keys(this.initialCounts_));!r.done;r.next()){var n=r.value;this.initialCounts_[n]=this.countDuplicates(n)}},validateAfterActionSequence:function(e,t){for(var o=i.iter(i.keys(this.initialCounts_));!o.done;o.next()){var r=o.value;XCTAssertTrue(this.countDuplicates(r)==2*this.initialCounts_[r])}},validateAfterUndo:function(e,t){for(var o=i.iter(i.keys(this.initialCounts_));!o.done;o.next()){var r=o.value;XCTAssertTrue(this.countDuplicates(r)==this.initialCounts_[r])}},validateAfterRedo:function(e,t){for(var o=i.iter(i.keys(this.initialCounts_));!o.done;o.next()){var r=o.value;XCTAssertTrue(this.countDuplicates(r)==2*this.initialCounts_[r])}}}}),r)},Jgdj:function(e,t,o){var r,n,i,a,s=t,l=o("oAGj"),u=o("c9Jm"),c=o("yGNn"),m=o("lqhW"),h=o("ylxa"),f=o("cEBg"),d=o("1NAc");s.PageSizeLetterTest=(r=function(){this.actionSequence_PageSizeLetter=[],this.testDoc_=null,this.testPage_=null,this.initialPageSizeID_="",this.initialPageSizePPI_=h.FormaPageExportData.DEFAULT_PPI,this.initialPageSizeFormat_=h.PageExportFormat.PIXELS,u.ActionTestBase.call(this)},l.defineClass({name:"PageSizeLetterTest",ctor:r,superName:"ActionTestBase",props:{setUpActionSequence:function(e,t,o){var r,n,i;this.testDoc_=o,this.testPage_=o.firstPage,this.initialPageSizeID_=(r=l.opt(this.testPage_,(function(e){return e.sizeID})))||null!=r?r:"",this.initialPageSizePPI_=(n=l.opt(this.testPage_,(function(e){return e.customSizePPI})))||null!=n?n:300,this.initialPageSizeFormat_=(i=l.opt(this.testPage_,(function(e){return e.customSizeFormat})))||null!=i?i:h.PageExportFormat.PIXELS},populateActionSequence:function(e,t,o){var r=this,n=m.DesignSizeLibrary.getById("Letter");return c.CorePromise.resolve([function(){return new f.ChangePageSizeAction(r.testPage_,n)}])},validateAfterActionSequence:function(e,t){var o=l.opt(this.testPage_,(function(e){return e.sizeID})),r=l.opt(this.testPage_,(function(e){return e.customSizePPI})),n=l.opt(this.testPage_,(function(e){return e.customSizeFormat}));XCTAssertTrue("Letter"==o),XCTAssertTrue(300==r),XCTAssertTrue(n==h.PageExportFormat.INCHES),XCTAssertTrue(this.testPage_.getPageExportData().pointDimensions.equal(new d.TheoSize(8.5,11).multiply(h.FormaPageExportData.POINTS_PER_INCH)))},validateAfterUndo:function(e,t){var o=l.opt(this.testPage_,(function(e){return e.sizeID})),r=l.opt(this.testPage_,(function(e){return e.customSizePPI})),n=l.opt(this.testPage_,(function(e){return e.customSizeFormat}));XCTAssertTrue(o==this.initialPageSizeID_),XCTAssertTrue(r==this.initialPageSizePPI_),XCTAssertTrue(n==this.initialPageSizeFormat_)},validateAfterRedo:function(e,t){var o=l.opt(this.testPage_,(function(e){return e.sizeID})),r=l.opt(this.testPage_,(function(e){return e.customSizePPI})),n=l.opt(this.testPage_,(function(e){return e.customSizeFormat}));XCTAssertTrue("Letter"==o),XCTAssertTrue(300==r),XCTAssertTrue(n==h.PageExportFormat.INCHES),XCTAssertTrue(this.testPage_.getPageExportData().pointDimensions.equal(new d.TheoSize(8.5,11).multiply(h.FormaPageExportData.POINTS_PER_INCH)))}}}),r),s.PageSizeCustomTest=(n=function(){this.actionSequence_PageSizeCustom=[],this.testDoc_=null,this.testPage_=null,this.initialPageSizeID_="",this.initialPageSizePPI_=h.FormaPageExportData.DEFAULT_PPI,this.initialPageSizeFormat_=h.PageExportFormat.PIXELS,u.ActionTestBase.call(this)},l.defineClass({name:"PageSizeCustomTest",ctor:n,superName:"ActionTestBase",props:{setUpActionSequence:function(e,t,o){var r,n,i;this.testDoc_=o,this.testPage_=o.firstPage,this.initialPageSizeID_=(r=l.opt(this.testPage_,(function(e){return e.sizeID})))||null!=r?r:"",this.initialPageSizePPI_=(n=l.opt(this.testPage_,(function(e){return e.customSizePPI})))||null!=n?n:300,this.initialPageSizeFormat_=(i=l.opt(this.testPage_,(function(e){return e.customSizeFormat})))||null!=i?i:h.PageExportFormat.PIXELS},populateActionSequence:function(e,t,o){var r=this,n=m.DesignSizeLibrary.getCustomSize(1011,990,h.PageExportFormat.PIXELS,h.FormaPageExportData.DEFAULT_PPI);return c.CorePromise.resolve([function(){return new f.ChangePageSizeAction(r.testPage_,n)}])},validateAfterActionSequence:function(e,t){var o=l.opt(this.testPage_,(function(e){return e.sizeID})),r=l.opt(this.testPage_,(function(e){return e.customSizePPI})),n=l.opt(this.testPage_,(function(e){return e.customSizeFormat}));XCTAssertTrue("Custom"==o),XCTAssertTrue(300==r),XCTAssertTrue(n==h.PageExportFormat.PIXELS),XCTAssertTrue(this.testPage_.getPageExportData().pixelDimensions.equal(new d.TheoSize(1011,990)))},validateAfterUndo:function(e,t){var o=l.opt(this.testPage_,(function(e){return e.sizeID})),r=l.opt(this.testPage_,(function(e){return e.customSizePPI})),n=l.opt(this.testPage_,(function(e){return e.customSizeFormat}));XCTAssertTrue(o==this.initialPageSizeID_),XCTAssertTrue(r==this.initialPageSizePPI_),XCTAssertTrue(n==this.initialPageSizeFormat_)},validateAfterRedo:function(e,t){var o=l.opt(this.testPage_,(function(e){return e.sizeID})),r=l.opt(this.testPage_,(function(e){return e.customSizePPI})),n=l.opt(this.testPage_,(function(e){return e.customSizeFormat}));XCTAssertTrue("Custom"==o),XCTAssertTrue(300==r),XCTAssertTrue(n==h.PageExportFormat.PIXELS),XCTAssertTrue(this.testPage_.getPageExportData().pixelDimensions.equal(new d.TheoSize(1011,990)))}}}),n),s.PageSizeA4Test=(i=function(){this.actionSequence_PageSizeA4=[],this.testDoc_=null,this.testPage_=null,this.initialPageSizeID_="",this.initialPageSizePPI_=h.FormaPageExportData.DEFAULT_PPI,this.initialPageSizeFormat_=h.PageExportFormat.PIXELS,u.ActionTestBase.call(this)},l.defineClass({name:"PageSizeA4Test",ctor:i,superName:"ActionTestBase",props:{setUpActionSequence:function(e,t,o){var r,n,i;this.testDoc_=o,this.testPage_=o.firstPage,this.initialPageSizeID_=(r=l.opt(this.testPage_,(function(e){return e.sizeID})))||null!=r?r:"",this.initialPageSizePPI_=(n=l.opt(this.testPage_,(function(e){return e.customSizePPI})))||null!=n?n:300,this.initialPageSizeFormat_=(i=l.opt(this.testPage_,(function(e){return e.customSizeFormat})))||null!=i?i:h.PageExportFormat.PIXELS},populateActionSequence:function(e,t,o){var r=this,n=m.DesignSizeLibrary.getById("A4");return c.CorePromise.resolve([function(){return new f.ChangePageSizeAction(r.testPage_,n)}])},validateAfterActionSequence:function(e,t){var o=l.opt(this.testPage_,(function(e){return e.sizeID})),r=l.opt(this.testPage_,(function(e){return e.customSizePPI})),n=l.opt(this.testPage_,(function(e){return e.customSizeFormat}));XCTAssertTrue("A4"==o),XCTAssertTrue(300==r),XCTAssertTrue(n==h.PageExportFormat.MILLIMETERS),XCTAssertTrue(this.testPage_.getPageExportData().pointDimensions.equal(new d.TheoSize(210,297).multiply(h.FormaPageExportData.POINTS_PER_INCH*h.FormaPageExportData.MM_TO_INCHES)))},validateAfterUndo:function(e,t){var o=l.opt(this.testPage_,(function(e){return e.sizeID})),r=l.opt(this.testPage_,(function(e){return e.customSizePPI})),n=l.opt(this.testPage_,(function(e){return e.customSizeFormat}));XCTAssertTrue(o==this.initialPageSizeID_),XCTAssertTrue(r==this.initialPageSizePPI_),XCTAssertTrue(n==this.initialPageSizeFormat_)},validateAfterRedo:function(e,t){var o=l.opt(this.testPage_,(function(e){return e.sizeID})),r=l.opt(this.testPage_,(function(e){return e.customSizePPI})),n=l.opt(this.testPage_,(function(e){return e.customSizeFormat}));XCTAssertTrue("A4"==o),XCTAssertTrue(300==r),XCTAssertTrue(n==h.PageExportFormat.MILLIMETERS),XCTAssertTrue(this.testPage_.getPageExportData().pointDimensions.equal(new d.TheoSize(210,297).multiply(h.FormaPageExportData.POINTS_PER_INCH*h.FormaPageExportData.MM_TO_INCHES)))}}}),i),s.PageSizePhoneTest=(a=function(){this.actionSequence_PageSizePhone=[],this.testDoc_=null,this.testPage_=null,this.initialPageSizeID_="",this.initialPageSizePPI_=h.FormaPageExportData.DEFAULT_PPI,this.initialPageSizeFormat_=h.PageExportFormat.PIXELS,u.ActionTestBase.call(this)},l.defineClass({name:"PageSizePhoneTest",ctor:a,superName:"ActionTestBase",props:{setUpActionSequence:function(e,t,o){var r,n,i;this.testDoc_=o,this.testPage_=o.firstPage,this.initialPageSizeID_=(r=l.opt(this.testPage_,(function(e){return e.sizeID})))||null!=r?r:"",this.initialPageSizePPI_=(n=l.opt(this.testPage_,(function(e){return e.customSizePPI})))||null!=n?n:300,this.initialPageSizeFormat_=(i=l.opt(this.testPage_,(function(e){return e.customSizeFormat})))||null!=i?i:h.PageExportFormat.PIXELS},populateActionSequence:function(e,t,o){var r=this,n=m.DesignSizeLibrary.getById("iPhone");return c.CorePromise.resolve([function(){return new f.ChangePageSizeAction(r.testPage_,n)}])},validateAfterActionSequence:function(e,t){var o=l.opt(this.testPage_,(function(e){return e.sizeID})),r=l.opt(this.testPage_,(function(e){return e.customSizePPI})),n=l.opt(this.testPage_,(function(e){return e.customSizeFormat}));XCTAssertTrue("iPhone"==o),XCTAssertTrue(300==r),XCTAssertTrue(n==h.PageExportFormat.PIXELS),XCTAssertTrue(this.testPage_.getPageExportData().pixelDimensions.equal(new d.TheoSize(1080,1920)))},validateAfterUndo:function(e,t){var o=l.opt(this.testPage_,(function(e){return e.sizeID})),r=l.opt(this.testPage_,(function(e){return e.customSizePPI})),n=l.opt(this.testPage_,(function(e){return e.customSizeFormat}));XCTAssertTrue(o==this.initialPageSizeID_),XCTAssertTrue(r==this.initialPageSizePPI_),XCTAssertTrue(n==this.initialPageSizeFormat_)},validateAfterRedo:function(e,t){var o=l.opt(this.testPage_,(function(e){return e.sizeID})),r=l.opt(this.testPage_,(function(e){return e.customSizePPI})),n=l.opt(this.testPage_,(function(e){return e.customSizeFormat}));XCTAssertTrue("iPhone"==o),XCTAssertTrue(300==r),XCTAssertTrue(n==h.PageExportFormat.PIXELS),XCTAssertTrue(this.testPage_.getPageExportData().pixelDimensions.equal(new d.TheoSize(1080,1920)))}}}),a)},WR9q:function(e,t,o){var r,n,i=t,a=o("oAGj"),s=o("O8XL"),l=o("lbYW"),u=o("c9Jm"),c=o("FNB+"),m=o("6Rk9"),h=o("sIWg");i.DistributeTest=(r=function(){this.actionSequence_Distribute=[function(){return new l.DistributeFormaeAction(s.DistributeType.LeftEdge)},function(){return new l.DistributeFormaeAction(s.DistributeType.TopEdge)}],this.formaeToDistribute_=[],this.initialBounds_=h.TheoRect.Zero,this.postDistributeBounds_=h.TheoRect.Zero,this.epsilon=.001,u.ActionTestBase.call(this)},a.defineClass({name:"DistributeTest",ctor:r,superName:"ActionTestBase",props:{canRunActionSequence:function(e,t,o){var r=m.GeometryFacade.getFormaeBounds([o.firstPage.root],!0);return this.allSelectableFormae(o,(function(e){return 1==e.controller.floating&&r.contains(m.GeometryFacade.getFormaeBounds([e],!0))})).length>2},setUpActionSequence:function(e,t,o){var r=m.GeometryFacade.getFormaeBounds([o.firstPage.root],!0);this.formaeToDistribute_=a.clone(this.allSelectableFormae(o,(function(e){return 1==e.controller.floating&&r.contains(m.GeometryFacade.getFormaeBounds([e],!0))}))),XCTAssertNotNil(a.clone(this.formaeToDistribute_)),this.formaeToDistribute_.length>0&&(o.controller.selection.replaceSelectionWithFormae(a.clone(this.formaeToDistribute_)),this.initialBounds_=m.GeometryFacade.getFormaeBounds(a.clone(this.formaeToDistribute_),!0))},validateAfterActionSequence:function(e,t){this.postDistributeBounds_=m.GeometryFacade.getFormaeBounds(a.clone(this.formaeToDistribute_),!0),this.validatePostDistributeLeftAndTop()},validateAfterUndo:function(e,t){var o=m.GeometryFacade.getFormaeBounds(a.clone(this.formaeToDistribute_),!0);XCTAssertTrue(this.initialBounds_.equal(o))},validateAfterRedo:function(e,t){this.postDistributeBounds_=m.GeometryFacade.getFormaeBounds(a.clone(this.formaeToDistribute_),!0),this.validatePostDistributeLeftAndTop()},validatePostDistributeLeftAndTop:function(){for(var e=a.iter(this.formaeToDistribute_);!e.done;e.next()){var t=e.value,o=m.GeometryFacade.getFormaeBounds([t],!0).evalXY(0,0);XCTAssertTrue(this.postDistributeBounds_.containsPoint(o))}},tearDown:function(){this.formaeToDistribute_=[],u.ActionTestBase.prototype.tearDown.call(this)}}}),r),i.ArrangeTest=(n=function(){this.actionSequence_Distribute=[function(){return new l.ArrangeFormaeAction(!0)}],this.formaeToArrange_=[],this.initialBounds_=h.TheoRect.Zero,this.postArrangeBounds_=h.TheoRect.Zero,u.ActionTestBase.call(this)},a.defineClass({name:"ArrangeTest",ctor:n,superName:"ActionTestBase",props:{setUpActionSequence:function(e,t,o){var r=m.GeometryFacade.getFormaeBounds([o.firstPage.root],!0);this.formaeToArrange_=a.clone(this.allSelectableFormae(o,(function(e){return 1==e.controller.floating&&r.contains(m.GeometryFacade.getFormaeBounds([e],!0))}))),XCTAssertNotNil(a.clone(this.formaeToArrange_)),this.formaeToArrange_.length>0&&(o.controller.selection.replaceSelectionWithFormae(a.clone(this.formaeToArrange_)),this.initialBounds_=m.GeometryFacade.getFormaeBounds(a.clone(this.formaeToArrange_),!0))},validateAfterActionSequence:function(e,t){this.postArrangeBounds_=m.GeometryFacade.getFormaeBounds(a.clone(this.formaeToArrange_),!0),this.validatePostArrangeRow()},validateAfterUndo:function(e,t){var o=m.GeometryFacade.getFormaeBounds(a.clone(this.formaeToArrange_),!0);XCTAssertTrue(this.initialBounds_.equal(o))},validateAfterRedo:function(e,t){this.postArrangeBounds_=m.GeometryFacade.getFormaeBounds(a.clone(this.formaeToArrange_),!0),this.validatePostArrangeRow()},validatePostArrangeRow:function(){var e=a.clone(this.sortInRowOrder(a.clone(this.formaeToArrange_)));if(e.length>0){var t=a.first(e),o=m.GeometryFacade.getFormaeBounds([t],!0).evalXY(0,0).x;XCTAssertTrue(this.postArrangeBounds_.minX==o);for(var r=a.iter(e);!r.done;r.next()){var n=r.value,i=m.GeometryFacade.getFormaeBounds([n],!0).evalXY(0,0);XCTAssertTrue(i.x>o||a.eq(c._equality_Forma_Forma,n,t))}}},sortInRowOrder:function(e){var t=a.clone(e);return a.sortInPlace(t,(function(e,t){var o=m.GeometryFacade.getFormaeBounds([e],!0),r=m.GeometryFacade.getFormaeBounds([t],!0);return o.minX<r.minX})),t},tearDown:function(){this.formaeToArrange_=[],u.ActionTestBase.prototype.tearDown.call(this)}}}),n)},YX5m:function(e,t,o){var r,n,i,a,s=t,l=o("oAGj"),u=o("c9Jm"),c=o("yGNn"),m=o("quOg"),h=o("FNB+"),f=o("x6FH"),d=o("9Lk3"),p=o("x35w");s.CreatePaddedCollageTest=(r=function(){this.actionSequence_CreatePaddedCollage=[function(){return new f.CreatePaddedCollageAction}],u.ActionTestBase.call(this)},l.defineClass({name:"CreatePaddedCollageTest",ctor:r,superName:"ActionTestBase",props:{validateAfterActionSequence:function(e,t){},validateAfterUndo:function(e,t){},validateAfterRedo:function(e,t){}}}),r),s.SetGridParametersTest=(n=function e(){this.actionSequence_SetGridParameters=[function(){return new f.EnterGridLayoutModeAction},function(){return new f.SetGridParametersAction(e.spacing_,e.margin_)}],this.gridForma_=null,this.oldMargin_=0,this.oldSpacing_=0,u.ActionTestBase.call(this)},l.defineClass({name:"SetGridParametersTest",ctor:n,superName:"ActionTestBase",statics:{margin_:10,spacing_:5},props:{canRunActionSequence:function(e,t,o){return this.gridForma_=l.first(o.firstPage.root.filterByControllerKind(d.GridController.KIND)),null!=this.gridForma_},setUpActionSequence:function(e,t,o){var r;(r=l.as(l.opt(this.gridForma_,(function(e){return e.controller})),d.GridController))&&(this.oldMargin_=r.margin,this.oldSpacing_=r.spacing)},validateAfterActionSequence:function(e,t){var o;(o=l.as(l.opt(this.gridForma_,(function(e){return e.controller})),d.GridController))&&(XCTAssertEqual(o.margin,n.margin_),XCTAssertEqual(o.spacing,n.spacing_))},validateAfterUndo:function(e,t){var o;(o=l.as(l.opt(this.gridForma_,(function(e){return e.controller})),d.GridController))&&(XCTAssertEqual(o.margin,this.oldMargin_),XCTAssertEqual(o.spacing,this.oldSpacing_))},validateAfterRedo:function(e,t){var o;(o=l.as(l.opt(this.gridForma_,(function(e){return e.controller})),d.GridController))&&(XCTAssertEqual(o.margin,n.margin_),XCTAssertEqual(o.spacing,n.spacing_))}}}),n),s.SetGridStyleTest=(i=function(){this.actionSequence_SetGridStyle=[function(){return new f.EnterGridLayoutModeAction}],this.actionSequence_SetGridStyleMovableShift=[function(){return new f.EnterGridLayoutModeAction}],this.gridForma_=null,this.gridLayouts_=null,this.oldGridStyle_=null,this.newGridStyle_=null,u.ActionTestBase.call(this)},l.defineClass({name:"SetGridStyleTest",ctor:i,superName:"ActionTestBase",props:{tearDown:function(){this.gridLayouts_=null,this.oldGridStyle_=null,this.newGridStyle_=null,u.ActionTestBase.prototype.tearDown.call(this)},canRunActionSequence:function(e,t,o){var r;if(this.gridForma_=l.first(o.firstPage.root.filterByControllerKind(d.GridController.KIND)),r=l.as(l.opt(this.gridForma_,(function(e){return e.controller})),d.GridController)){var n=r.numCells;this.gridLayouts_=l.clone(o.gridLibrary.getGridsByCellNumber(n,!0))}return null!=this.gridForma_&&null!=this.gridLayouts_&&this.gridLayouts_.length>0},populateActionSequence:function(e,t,o){var r=this;return this.newGridStyle_=l.last(this.gridLayouts_),c.CorePromise.resolve(e.concat([function(){return new f.SetGridStyleAction(r.newGridStyle_,0)}]))},setUpActionSequence:function(e,t,o){var r,n,i="actionSequence_SetGridStyleMovableShift"==t;l.opt(this.newGridStyle_,(function(e){return e.moveableShift=i})),l.opt(this.oldGridStyle_,(function(e){return e.moveableShift=i})),(r=o.controller)&&(r.interactionMode=m.InteractionMode.AutomaticGrid),(n=l.as(l.opt(this.gridForma_,(function(e){return e.controller})),d.GridController))&&(this.oldGridStyle_=n.gridStyle)},validateAfterActionSequence:function(e,t){var o;(o=l.as(l.opt(this.gridForma_,(function(e){return e.controller})),d.GridController))&&XCTAssertEqual(l.opt(o.gridStyle,(function(e){return e.asString})),l.opt(this.newGridStyle_,(function(e){return e.asString})))},validateAfterUndo:function(e,t){var o;(o=l.as(l.opt(this.gridForma_,(function(e){return e.controller})),d.GridController))&&XCTAssertEqual(l.opt(o.gridStyle,(function(e){return e.asString})),l.opt(this.oldGridStyle_,(function(e){return e.asString})))},validateAfterRedo:function(e,t){var o;(o=l.as(l.opt(this.gridForma_,(function(e){return e.controller})),d.GridController))&&XCTAssertEqual(l.opt(o.gridStyle,(function(e){return e.asString})),l.opt(this.newGridStyle_,(function(e){return e.asString})))}}}),i),s.SwapGridFormaTest=(a=function(){this.actionSequence_SwapGridForma=[function(){return new f.EnterGridLayoutModeAction}],this.gridForma_=null,this.childA_=null,this.childB_=null,this.oldChildACell_=-1,this.oldChildBCell_=-1,u.ActionTestBase.call(this)},l.defineClass({name:"SwapGridFormaTest",ctor:a,superName:"ActionTestBase",statics:{margin_:10,spacing_:5},props:{canRunActionSequence:function(e,t,o){var r,n=this;return this.gridForma_=l.first(o.firstPage.root.filterByControllerKind(d.GridController.KIND)),(r=l.as(l.opt(this.gridForma_,(function(e){return e.controller})),d.GridController))&&l.opt(this.gridForma_,(function(e){return e.visit(h.FormaTraversal.PreOrder,(function(e,t,o){if(p.GridFacade.isChildSwappable(e))if(null==n.childA_)l.opt(r.gridStyle,(function(t){return null!=t.cellForForma(e)}))&&(n.childA_=e);else{var i,a=l.opt(r.gridStyle,(function(e){return e.cellForForma(n.childA_)}));null!=(i=l.opt(r.gridStyle,(function(t){return t.cellForForma(e)})))&&l.opt(a,(function(e){return e[0]!=i[0]}))&&(n.childB_=e)}return null!=n.childA_&&null!=n.childB_}))})),null!=this.gridForma_&&null!=this.childA_&&null!=this.childB_},populateActionSequence:function(e,t,o){var r=this;return c.CorePromise.resolve(e.concat([function(){return new f.SwapGridFormaAction(r.childA_,r.childB_)}]))},setUpActionSequence:function(e,t,o){var r,n;(r=l.as(l.opt(this.gridForma_,(function(e){return e.controller})),d.GridController))&&(n=r.gridStyle)&&(this.oldChildACell_=n.cellForForma(this.childA_)[0],this.oldChildBCell_=n.cellForForma(this.childB_)[0])},validateAfterActionSequence:function(e,t){var o,r;(o=l.as(l.opt(this.gridForma_,(function(e){return e.controller})),d.GridController))&&(r=o.gridStyle)&&(XCTAssertEqual(r.cellForForma(this.childA_)[0],this.oldChildBCell_),XCTAssertEqual(r.cellForForma(this.childB_)[0],this.oldChildACell_))},validateAfterUndo:function(e,t){var o,r;(o=l.as(l.opt(this.gridForma_,(function(e){return e.controller})),d.GridController))&&(r=o.gridStyle)&&(XCTAssertEqual(r.cellForForma(this.childA_)[0],this.oldChildACell_),XCTAssertEqual(r.cellForForma(this.childB_)[0],this.oldChildBCell_))},validateAfterRedo:function(e,t){var o,r;(o=l.as(l.opt(this.gridForma_,(function(e){return e.controller})),d.GridController))&&(r=o.gridStyle)&&(XCTAssertEqual(r.cellForForma(this.childA_)[0],this.oldChildBCell_),XCTAssertEqual(r.cellForForma(this.childB_)[0],this.oldChildACell_))}}}),a)},Ztps:function(e,t,o){var r,n,i=t,a=o("oAGj"),s=o("c9Jm"),l=o("yGNn"),u=o("9Lk3"),c=o("j89o"),m=o("T8w7"),h=o("uxH+");i.OpacityTest=(r=function(){this.actionSequence_SetOpacity=[function(){return new c.SetOpacityAction(.55)}],this.formaeToChangeOpacity_=[],this.initialOpacities_=[],s.ActionTestBase.call(this)},a.defineClass({name:"OpacityTest",ctor:r,superName:"ActionTestBase",props:{tearDown:function(){this.formaeToChangeOpacity_=[],s.ActionTestBase.prototype.tearDown.call(this)},setUpActionSequence:function(e,t,o){var r;this.formaeToChangeOpacity_=a.clone(this.allSelectableFormae(o,(function(e){return!(!(r=a.opt(e.controller,(function(e){return e.opacityChangeable})))&&null==r)&&r}))),this.initialOpacities_=this.formaeToChangeOpacity_.map((function(e){return m.OpacityFacade.getOpacityForForma(e)}),this),o.controller.selection.replaceSelectionWithFormae(a.clone(this.formaeToChangeOpacity_))},validateAfterActionSequence:function(e,t){for(var o=a.iter(this.formaeToChangeOpacity_);!o.done;o.next()){var r=o.value,n=m.OpacityFacade.getOpacityForForma(r);XCTAssertEqual(n,.55)}},validateAfterUndo:function(e,t){for(var o=a.iter(a.range(0,this.formaeToChangeOpacity_.length,!1));!o.done;o.next()){var r=o.value,n=this.formaeToChangeOpacity_[r],i=m.OpacityFacade.getOpacityForForma(n),s=this.initialOpacities_[r];XCTAssertEqual(i,s)}},validateAfterRedo:function(e,t){for(var o=a.iter(this.formaeToChangeOpacity_);!o.done;o.next()){var r=o.value,n=m.OpacityFacade.getOpacityForForma(r);XCTAssertEqual(n,.55)}}}}),r),i.BackgroundOpacityTest=(n=function(){this.testDoc_=null,this.rootForma_=null,this.actionSequence_SetBackgroundOpacity=[],s.ActionTestBase.call(this)},a.defineClass({name:"BackgroundOpacityTest",ctor:n,superName:"ActionTestBase",props:{canRunActionSequence:function(e,t,o){var r;return this.rootForma_=o.firstPage.root,this.testDoc_=o,!!(r=a.as(a.opt(this.rootForma_,(function(e){return e.controller})),h.RootController))&&r.suggestTransparentBackground()},populateActionSequence:function(e,t,o){return l.CorePromise.resolve([function(){return new c.SetBackgroundOpacityAction(0,o.firstPage)}])},setUpActionSequence:function(e,t,o){var r;if(r=a.as(a.opt(this.rootForma_,(function(e){return e.controller})),h.RootController)){XCTAssertTrue(r.suggestTransparentBackground());var n=m.OpacityFacade.getBackgroundOpacity(o.firstPage);XCTAssertTrue(1==n);for(var i=a.iter(this.rootForma_.filterWithCallback((function(e){return u.GridController.isBackgroundColoredCell(e)})));!i.done;i.next()){var s=i.value;XCTAssertTrue(1==s.style.opacity)}}else XCTFail("no root controller?")},validateAfterActionSequence:function(e,t){var o;if(o=a.as(a.opt(this.rootForma_,(function(e){return e.controller})),h.RootController)){XCTAssertTrue(o.suggestTransparentBackground());var r=m.OpacityFacade.getBackgroundOpacity(this.testDoc_.firstPage);XCTAssertTrue(0==r);for(var n=a.iter(this.rootForma_.filterWithCallback((function(e){return u.GridController.isBackgroundColoredCell(e)})));!n.done;n.next()){var i=n.value;XCTAssertTrue(0==i.style.opacity)}}else XCTFail("no root controller?")},validateAfterUndo:function(e,t){var o;if(o=a.as(a.opt(this.rootForma_,(function(e){return e.controller})),h.RootController)){XCTAssertTrue(o.suggestTransparentBackground());var r=m.OpacityFacade.getBackgroundOpacity(this.testDoc_.firstPage);XCTAssertTrue(1==r);for(var n=a.iter(this.rootForma_.filterWithCallback((function(e){return u.GridController.isBackgroundColoredCell(e)})));!n.done;n.next()){var i=n.value;XCTAssertTrue(1==i.style.opacity)}}else XCTFail("no root controller?")},validateAfterRedo:function(e,t){var o;if(o=a.as(a.opt(this.rootForma_,(function(e){return e.controller})),h.RootController)){XCTAssertTrue(o.suggestTransparentBackground());var r=m.OpacityFacade.getBackgroundOpacity(this.testDoc_.firstPage);XCTAssertTrue(0==r);for(var n=a.iter(this.rootForma_.filterWithCallback((function(e){return u.GridController.isBackgroundColoredCell(e)})));!n.done;n.next()){var i=n.value;XCTAssertTrue(0==i.style.opacity)}}else XCTFail("no root controller?")}}}),n)},bpSr:function(e,t,o){var r,n,i,a,s,l,u,c,m,h,f,d,p,_,T,g=t,A=o("oAGj"),F=o("Tq01"),C=o("c9Jm"),v=o("yGNn"),S=o("FNB+"),y=o("6ZWm"),P=o("cmoc"),I=o("bqbo"),B=o("U010"),q=o("fdtz"),X=o("lmwz"),R=o("uWOl"),D=o("j89o"),w=o("Zifs"),N=o("djAF"),L=o("umUn");g.ReplaceImagesWithColorsTest=(r=function e(){this.actionSequence_ReplaceImagesWithColors=[function(){return new I.ReplaceImagesWithColorsAction(null,[e.green_])}],this.formaToReplace_=null,C.ActionTestBase.call(this)},n={},A.defineClass({name:"ReplaceImagesWithColorsTest",ctor:r,superName:"ActionTestBase",statics:{green_:{get:function(){return void 0===n.green_&&(n.green_=L.TheoColor.init_5344(new w.SolidColor(0,1,0,1))),n.green_}}},props:{replacementForma:{get:function(){return A.first(A.opt(A.as(this.getActionResult(0),F.FormaActionResult),(function(e){return e.formae})))}},tearDown:function(){this.formaToReplace_=null,C.ActionTestBase.prototype.tearDown.call(this)},canRunActionSequence:function(e,t,o){return this.formaToReplace_=A.as(A.last(this.allSelectableFormae(o,(function(e){return e instanceof P.FrameForma&&A.opt(A.as(e,P.FrameForma),(function(e){return e.childAt(0)instanceof q.ImageForma}))}))),P.FrameForma),null!=this.formaToReplace_},setUpActionSequence:function(e,t,o){XCTAssertNotNil(this.formaToReplace_),null!=this.formaToReplace_&&o.controller.selection.replaceSelection(this.formaToReplace_)},validateAfterActionSequence:function(e,t){var o;if(XCTAssertNotNil(this.replacementForma),XCTAssertTrue(this.replacementForma instanceof N.ShapeForma),XCTAssertNil(A.opt(this.formaToReplace_,(function(e){return e.parent}))),o=A.as(this.replacementForma,N.ShapeForma)){var n=o.style.colors.fieldPrimary;XCTAssertNotNil(n),XCTAssertEqual(n,r.green_.rgbColor)}},validateAfterUndo:function(e,t){XCTAssertNil(A.opt(this.replacementForma,(function(e){return e.parent}))),XCTAssertNotNil(A.opt(this.formaToReplace_,(function(e){return e.parent})))},validateAfterRedo:function(e,t){var o;if(XCTAssertNotNil(this.replacementForma),XCTAssertTrue(this.replacementForma instanceof N.ShapeForma),XCTAssertNil(A.opt(this.formaToReplace_,(function(e){return e.parent}))),o=A.as(this.replacementForma,N.ShapeForma)){var n=o.style.colors.fieldPrimary;XCTAssertNotNil(n),XCTAssertEqual(n,r.green_.rgbColor)}this.formaToReplace_=null}}}),r),g.SetImageFilterTest=(i=function(){this.actionSequence_SetImageFilter=[],this.formaToChange_=null,this.originalStyleName_=null,C.ActionTestBase.call(this)},A.defineClass({name:"SetImageFilterTest",ctor:i,superName:"ActionTestBase",props:{tearDown:function(){this.formaToChange_=null,C.ActionTestBase.prototype.tearDown.call(this)},canRunActionSequence:function(e,t,o){return this.formaToChange_=A.as(A.last(this.allSelectableFormae(o,(function(e){return e instanceof P.FrameForma&&A.opt(A.as(e,P.FrameForma),(function(e){return e.childAt(0)instanceof q.ImageForma}))}))),P.FrameForma),null!=this.formaToChange_},populateActionSequence:function(e,t,o){return v.CorePromise.resolve([function(){return new I.SetImageFilterAction(o.firstPage.imageFilterLibrary.getImageStyle("Greyscale"))}])},setUpActionSequence:function(e,t,o){XCTAssertNotNil(this.formaToChange_),null!=this.formaToChange_&&(this.originalStyleName_=A.opt(A.as(A.opt(A.as(A.opt(this.formaToChange_,(function(e){return e.childAt(0)})),q.ImageForma),(function(e){return e.style})),R.ImageStyle),(function(e){return e.name})),o.controller.selection.replaceSelection(this.formaToChange_))},validateAfterActionSequence:function(e,t){if(null!=this.formaToChange_){var o=A.as(A.opt(this.formaToChange_,(function(e){return e.childAt(0)})),q.ImageForma);XCTAssertNotNil(o);var r=A.as(A.opt(o,(function(e){return e.style})),R.ImageStyle);XCTAssertNotNil(r),XCTAssertTrue(A.opt(r,(function(e){return"Greyscale"==e.name})))}},validateAfterUndo:function(e,t){if(null!=this.formaToChange_){var o=A.as(A.opt(this.formaToChange_,(function(e){return e.childAt(0)})),q.ImageForma);XCTAssertNotNil(o),XCTAssertEqual(this.originalStyleName_,A.opt(A.as(A.opt(o,(function(e){return e.style})),R.ImageStyle),(function(e){return e.name})))}},validateAfterRedo:function(e,t){if(null!=this.formaToChange_){var o=A.as(A.opt(this.formaToChange_,(function(e){return e.childAt(0)})),q.ImageForma);XCTAssertNotNil(o);var r=A.as(A.opt(o,(function(e){return e.style})),R.ImageStyle);XCTAssertNotNil(r),XCTAssertTrue(A.opt(r,(function(e){return"Greyscale"==e.name}))),this.formaToChange_=null}}}}),i),g.ShuffleImageFilterTest=(a=function(){this.actionSequence_ShuffleImageFilter=[],this.page_=null,this.formaToChange_=null,this.styleToShuffle_=null,this.originalStyleName_=null,C.ActionTestBase.call(this)},A.defineClass({name:"ShuffleImageFilterTest",ctor:a,superName:"ActionTestBase",props:{tearDown:function(){this.page_=null,this.formaToChange_=null,this.styleToShuffle_=null,C.ActionTestBase.prototype.tearDown.call(this)},canRunActionSequence:function(e,t,o){return this.formaToChange_=A.as(A.last(this.allSelectableFormae(o,(function(e){return e instanceof P.FrameForma&&A.opt(A.as(e,P.FrameForma),(function(e){return e.childAt(0)instanceof q.ImageForma}))}))),P.FrameForma),null!=this.formaToChange_},prepareDocument:function(e,t){var o=this;return this.page_=e.firstPage,this.styleToShuffle_=this.page_.imageFilterLibrary.getImageStyle("Multiply"),null!=this.formaToChange_&&e.controller.selection.replaceSelection(this.formaToChange_),v.CorePromise.resolve([function(){return new I.SetImageFilterAction(o.styleToShuffle_)}])},populateActionSequence:function(e,t,o){var r=this;return v.CorePromise.resolve([function(){return new I.ShuffleImageFilterAction(r.styleToShuffle_,r.page_)}])},setUpActionSequence:function(e,t,o){XCTAssertNotNil(this.formaToChange_),null!=this.formaToChange_&&(this.originalStyleName_=A.opt(A.as(A.opt(A.as(A.opt(this.formaToChange_,(function(e){return e.childAt(0)})),q.ImageForma),(function(e){return e.style})),R.ImageStyle),(function(e){return e.name})),o.controller.selection.replaceSelection(this.formaToChange_))},validateAfterActionSequence:function(e,t){if(null!=this.formaToChange_){var o=A.as(A.opt(this.formaToChange_,(function(e){return e.childAt(0)})),q.ImageForma);XCTAssertNotNil(o);var r=A.as(A.opt(o,(function(e){return e.style})),R.ImageStyle);XCTAssertNotNil(r),XCTAssertTrue(A.opt(r,(function(e){return"Multiply"==e.name})))}},validateAfterUndo:function(e,t){if(null!=this.formaToChange_){var o=A.as(A.opt(this.formaToChange_,(function(e){return e.childAt(0)})),q.ImageForma);XCTAssertNotNil(o),XCTAssertEqual(this.originalStyleName_,A.opt(A.as(A.opt(o,(function(e){return e.style})),R.ImageStyle),(function(e){return e.name})))}},validateAfterRedo:function(e,t){if(null!=this.formaToChange_){var o=A.as(A.opt(this.formaToChange_,(function(e){return e.childAt(0)})),q.ImageForma);XCTAssertNotNil(o);var r=A.as(A.opt(o,(function(e){return e.style})),R.ImageStyle);XCTAssertNotNil(r),XCTAssertTrue(A.opt(r,(function(e){return"Multiply"==e.name}))),this.formaToChange_=null}}}}),a),g.ChangeImageAdjustmentsTest=(s=function(){this.actionSequence_ChangeImageAdjustments=[function(){return I.ChangeImageAdjustmentsAction.init_dd66("saturation",100)}],this.formaToAdjust_=null,this.oldValue_=null,C.ActionTestBase.call(this)},A.defineClass({name:"ChangeImageAdjustmentsTest",ctor:s,superName:"ActionTestBase",props:{tearDown:function(){this.formaToAdjust_=null,C.ActionTestBase.prototype.tearDown.call(this)},canRunActionSequence:function(e,t,o){return this.formaToAdjust_=A.as(A.last(this.allSelectableFormae(o,(function(e){return e instanceof P.FrameForma&&A.opt(A.as(e,P.FrameForma),(function(e){return e.childAt(0)instanceof q.ImageForma}))}))),P.FrameForma),null!=this.formaToAdjust_},setUpActionSequence:function(e,t,o){if(XCTAssertNotNil(this.formaToAdjust_),null!=this.formaToAdjust_){var r=A.as(A.opt(this.formaToAdjust_,(function(e){return e.childAt(0)})),q.ImageForma);this.oldValue_=A.opt(A.opt(r,(function(e){return e.style.adjustments})),(function(e){return e.saturation})),o.controller.selection.replaceSelection(this.formaToAdjust_)}},validateAfterActionSequence:function(e,t){var o;if(null!=this.formaToAdjust_){var r=A.as(A.opt(this.formaToAdjust_,(function(e){return e.childAt(0)})),q.ImageForma);XCTAssertNotNil(r);var n=A.as(A.opt(r,(function(e){return e.style})),R.ImageStyle);XCTAssertNotNil(n),XCTAssertEqual(100,(o=A.opt(A.opt(n,(function(e){return e.adjustments})),(function(e){return e.saturation})))||null!=o?o:0)}},validateAfterUndo:function(e,t){var o,r;if(null!=this.formaToAdjust_){var n=A.as(A.opt(this.formaToAdjust_,(function(e){return e.childAt(0)})),q.ImageForma);XCTAssertNotNil(n);var i=A.as(A.opt(n,(function(e){return e.style})),R.ImageStyle);XCTAssertNotNil(i),XCTAssertEqual((o=this.oldValue_)||null!=o?o:0,(r=A.opt(A.opt(i,(function(e){return e.adjustments})),(function(e){return e.saturation})))||null!=r?r:0)}},validateAfterRedo:function(e,t){var o;if(null!=this.formaToAdjust_){var r=A.as(A.opt(this.formaToAdjust_,(function(e){return e.childAt(0)})),q.ImageForma);XCTAssertNotNil(r);var n=A.as(A.opt(r,(function(e){return e.style})),R.ImageStyle);XCTAssertNotNil(n),XCTAssertEqual(100,(o=A.opt(A.opt(n,(function(e){return e.adjustments})),(function(e){return e.saturation})))||null!=o?o:0),this.formaToAdjust_=null}}}}),s),g.SetImageAsFloatingTest=(l=function(){this.actionSequence_SetAsFloating=[function(){return new I.SetImageAsFloatingAction}],this.frameForma_=null,C.ActionTestBase.call(this)},A.defineClass({name:"SetImageAsFloatingTest",ctor:l,superName:"ActionTestBase",props:{tearDown:function(){this.frameForma_=null,C.ActionTestBase.prototype.tearDown.call(this)},canRunActionSequence:function(e,t,o){return this.frameForma_=A.as(A.last(this.allSelectableFormae(o,(function(e){return e.isBackgroundImage()}))),P.FrameForma),null!=this.frameForma_},setUpActionSequence:function(e,t,o){XCTAssertFalse(this.frameForma_.controller.floating),o.controller.selection.replaceSelection(this.frameForma_)},validateAfterActionSequence:function(e,t){XCTAssertTrue(this.frameForma_.controller.floating)},validateAfterUndo:function(e,t){XCTAssertFalse(this.frameForma_.controller.floating)},validateAfterRedo:function(e,t){XCTAssertTrue(this.frameForma_.controller.floating)}}}),l),g.SetImageAsBackgroundTest=(u=function(){this.actionSequence_SetAsBackground=[function(){return new I.SetImageAsBackgroundAction}],this.oneFrameForma_=null,this.frameForma_=null,C.ActionTestBase.call(this)},A.defineClass({name:"SetImageAsBackgroundTest",ctor:u,superName:"ActionTestBase",props:{tearDown:function(){this.oneFrameForma_=null,this.frameForma_=null,C.ActionTestBase.prototype.tearDown.call(this)},canRunActionSequence:function(e,t,o){return this.oneFrameForma_=A.as(A.last(this.allSelectableFormae(o,(function(e){return e.isImage()}))),P.FrameForma),null!=this.oneFrameForma_},prepareDocument:function(e,t){var o=[];return this.frameForma_=A.as(A.last(this.allSelectableFormae(e,(function(e){return e.isImage()&&!e.isBackgroundImage()}))),P.FrameForma),null==this.frameForma_&&(this.frameForma_=this.oneFrameForma_,e.controller.selection.replaceSelection(this.frameForma_),o.push((function(){return new I.SetImageAsFloatingAction}))),v.CorePromise.resolve(A.clone(o))},setUpActionSequence:function(e,t,o){XCTAssertTrue(this.frameForma_.controller.floating),o.controller.selection.replaceSelection(this.frameForma_)},validateAfterActionSequence:function(e,t){XCTAssertFalse(this.frameForma_.controller.floating)},validateAfterUndo:function(e,t){XCTAssertTrue(this.frameForma_.controller.floating)},validateAfterRedo:function(e,t){XCTAssertFalse(this.frameForma_.controller.floating)}}}),u),g.CropToRatioTest=(c=function(){this.actionSequence_CropToRatio=[],this.oneFrameForma_=null,this.frameForma_=null,this.imageForma_=null,this.initialRatio_=1,this.cropRatio_=1,C.ActionTestBase.call(this)},A.defineClass({name:"CropToRatioTest",ctor:c,superName:"ActionTestBase",props:{tearDown:function(){this.oneFrameForma_=null,this.frameForma_=null,this.imageForma_=null,C.ActionTestBase.prototype.tearDown.call(this)},canRunActionSequence:function(e,t,o){return this.oneFrameForma_=A.as(A.last(this.allSelectableFormae(o,(function(e){return e.isImage()}))),P.FrameForma),null!=this.oneFrameForma_},populateActionSequence:function(e,t,o){var r=this;return v.CorePromise.resolve([function(){return r.initialRatio_=r.frameForma_.bounds.aspectRatio,r.cropRatio_=r.initialRatio_<1?4/3:3/4,new I.CropImageToRatioAction(r.imageForma_,r.cropRatio_,null)}])},prepareDocument:function(e,t){var o=[];return this.frameForma_=A.as(A.last(this.allSelectableFormae(e,(function(e){return e.isImage()&&!e.isBackgroundImage()}))),P.FrameForma),null==this.frameForma_&&(this.frameForma_=this.oneFrameForma_,e.controller.selection.replaceSelection(this.frameForma_),o.push((function(){return new I.SetImageAsFloatingAction}))),this.imageForma_=X.ImageFacade.getImageFormaForForma(this.frameForma_),v.CorePromise.resolve(A.clone(o))},validateAfterActionSequence:function(e,t){var o=this.frameForma_.bounds.aspectRatio;XCTAssertEqual(o,this.cropRatio_,.001)},validateAfterUndo:function(e,t){var o=this.frameForma_.bounds.aspectRatio;XCTAssertEqual(o,this.initialRatio_,.001)},validateAfterRedo:function(e,t){var o=this.frameForma_.bounds.aspectRatio;XCTAssertEqual(o,this.cropRatio_,.001)}}}),c),g.ApplyShapeMaskTest=(m=function(){this.actionSequence_ApplyShapeMask=[],this.oneFrameForma_=null,this.frameForma_=null,C.ActionTestBase.call(this)},A.defineClass({name:"ApplyShapeMaskTest",ctor:m,superName:"ActionTestBase",props:{tearDown:function(){this.oneFrameForma_=null,this.frameForma_=null,C.ActionTestBase.prototype.tearDown.call(this)},canRunActionSequence:function(e,t,o){return this.oneFrameForma_=A.as(A.last(this.allSelectableFormae(o,(function(e){return e.isImage()}))),P.FrameForma),null!=this.oneFrameForma_},populateActionSequence:function(e,t,o){var r=this;return v.CorePromise.resolve([function(){return new I.ApplyShapeMaskToImageAction(r.frameForma_,"diamond")}])},prepareDocument:function(e,t){var o=this,r=[];return this.frameForma_=A.as(A.last(this.allSelectableFormae(e,(function(e){return e.isImage()&&!e.isBackgroundImage()}))),P.FrameForma),null==this.frameForma_&&(this.frameForma_=this.oneFrameForma_,e.controller.selection.replaceSelection(this.frameForma_),r.push((function(){return new I.SetImageAsFloatingAction}))),X.ImageFacade.formaHasMask(this.frameForma_)&&r.push((function(){return new I.ApplyShapeMaskToImageAction(o.frameForma_)})),v.CorePromise.resolve(A.clone(r))},validateAfterActionSequence:function(e,t){var o;if(o=A.as(A.opt(this.frameForma_,(function(e){return e.controller})),y.FrameController)){var r=A.as(o.mask,N.ShapeForma);XCTAssertNotNil(r),XCTAssertEqual(r.shapeLibraryID,"diamond")}},validateAfterUndo:function(e,t){var o;(o=A.as(A.opt(this.frameForma_,(function(e){return e.controller})),y.FrameController))&&XCTAssertNil(o.mask)},validateAfterRedo:function(e,t){var o;if(o=A.as(A.opt(this.frameForma_,(function(e){return e.controller})),y.FrameController)){var r=A.as(o.mask,N.ShapeForma);XCTAssertNotNil(r),XCTAssertEqual(r.shapeLibraryID,"diamond")}}}}),m),g.ApplyCutoutTest=(h=function(){this.actionSequence_ApplyCutout=[],this.oneFrameForma_=null,this.frameForma_=null,C.ActionTestBase.call(this)},A.defineClass({name:"ApplyCutoutTest",ctor:h,superName:"ActionTestBase",props:{tearDown:function(){this.oneFrameForma_=null,this.frameForma_=null,C.ActionTestBase.prototype.tearDown.call(this)},canRunActionSequence:function(e,t,o){return this.oneFrameForma_=A.as(A.last(this.allSelectableFormae(o,(function(e){return e.isImage()}))),P.FrameForma),null!=this.oneFrameForma_},populateActionSequence:function(e,t,o){var r=this,n=B.ImageCutoutLibrary.getImageCutout(B.CutoutMode.BackgroundRemoval);return v.CorePromise.resolve([function(){return new I.SetImageCutoutAction(r.frameForma_,n,B.ImageCutoutModelLibrary.CURRENT_MODEL)}])},prepareDocument:function(e,t){var o=this,r=[];return this.frameForma_=A.as(A.last(this.allSelectableFormae(e,(function(e){return e.isImage()&&!e.isBackgroundImage()}))),P.FrameForma),null==this.frameForma_&&(this.frameForma_=this.oneFrameForma_,e.controller.selection.replaceSelection(this.frameForma_),r.push((function(){return new I.SetImageAsFloatingAction}))),X.ImageFacade.getCutoutModeForForma(this.frameForma_)!=B.CutoutMode.Off&&r.push((function(){return new I.SetImageCutoutAction(o.frameForma_,new B.CutoutStyle(B.CutoutMode.Off),void 0,void 0,60)})),v.CorePromise.resolve(A.clone(r))},validateAfterActionSequence:function(e,t){var o;(o=A.as(A.opt(this.frameForma_,(function(e){return e.controller})),y.FrameController))&&(XCTAssertNotNil(o.cutout),XCTAssertEqual(X.ImageFacade.getCutoutModeForForma(this.frameForma_),B.CutoutMode.BackgroundRemoval))},validateAfterUndo:function(e,t){var o;(o=A.as(A.opt(this.frameForma_,(function(e){return e.controller})),y.FrameController))&&XCTAssertNil(o.cutout)},validateAfterRedo:function(e,t){var o;(o=A.as(A.opt(this.frameForma_,(function(e){return e.controller})),y.FrameController))&&(XCTAssertNotNil(o.cutout),XCTAssertEqual(X.ImageFacade.getCutoutModeForForma(this.frameForma_),B.CutoutMode.BackgroundRemoval))}}}),h),g.RemoveCutoutTest=(f=function(){this.actionSequence_RemoveCutout=[],this.oneFrameForma_=null,this.frameForma_=null,C.ActionTestBase.call(this)},A.defineClass({name:"RemoveCutoutTest",ctor:f,superName:"ActionTestBase",props:{tearDown:function(){this.oneFrameForma_=null,this.frameForma_=null,C.ActionTestBase.prototype.tearDown.call(this)},canRunActionSequence:function(e,t,o){return this.oneFrameForma_=A.as(A.last(this.allSelectableFormae(o,(function(e){return e.isImage()}))),P.FrameForma),null!=this.oneFrameForma_},populateActionSequence:function(e,t,o){var r=this;return v.CorePromise.resolve([function(){return new I.SetImageCutoutAction(r.frameForma_,new B.CutoutStyle(B.CutoutMode.Off))}])},prepareDocument:function(e,t){var o=this,r=[];if(this.frameForma_=A.as(A.last(this.allSelectableFormae(e,(function(e){return e.isImage()&&!e.isBackgroundImage()}))),P.FrameForma),null==this.frameForma_&&(this.frameForma_=this.oneFrameForma_,e.controller.selection.replaceSelection(this.frameForma_),r.push((function(){return new I.SetImageAsFloatingAction}))),X.ImageFacade.getCutoutModeForForma(this.frameForma_)!=B.CutoutMode.BackgroundRemoval){var n=B.ImageCutoutLibrary.getImageCutout(B.CutoutMode.BackgroundRemoval);r.push((function(){return new I.SetImageCutoutAction(o.frameForma_,n)}))}return v.CorePromise.resolve(A.clone(r))},validateAfterActionSequence:function(e,t){var o;(o=A.as(A.opt(this.frameForma_,(function(e){return e.controller})),y.FrameController))&&(XCTAssertNil(o.cutout),XCTAssertNotNil(X.ImageFacade.getCutoutMaskFormaForForma(this.frameForma_)))},validateAfterUndo:function(e,t){var o;(o=A.as(A.opt(this.frameForma_,(function(e){return e.controller})),y.FrameController))&&(XCTAssertNotNil(o.cutout),XCTAssertEqual(X.ImageFacade.getCutoutModeForForma(this.frameForma_),B.CutoutMode.BackgroundRemoval))},validateAfterRedo:function(e,t){var o;(o=A.as(A.opt(this.frameForma_,(function(e){return e.controller})),y.FrameController))&&(XCTAssertNil(o.cutout),XCTAssertNotNil(X.ImageFacade.getCutoutMaskFormaForForma(this.frameForma_)))}}}),f),g.AllowFreeformCropTest=(d=function(){this.actionSequence_AllowFreeformCrop=[],this.oneFrameForma_=null,this.frameForma_=null,C.ActionTestBase.call(this)},A.defineClass({name:"AllowFreeformCropTest",ctor:d,superName:"ActionTestBase",props:{tearDown:function(){this.oneFrameForma_=null,this.frameForma_=null,C.ActionTestBase.prototype.tearDown.call(this)},canRunActionSequence:function(e,t,o){return this.oneFrameForma_=A.as(A.last(this.allSelectableFormae(o,(function(e){return e.isImage()}))),P.FrameForma),null!=this.oneFrameForma_},populateActionSequence:function(e,t,o){var r=this;return v.CorePromise.resolve([function(){return new I.SetImageCropToFreeformAction(r.frameForma_)}])},prepareDocument:function(e,t){var o=this,r=[];return this.frameForma_=A.as(A.last(this.allSelectableFormae(e,(function(e){return e.isImage()&&!e.isBackgroundImage()}))),P.FrameForma),null==this.frameForma_&&(this.frameForma_=this.oneFrameForma_,e.controller.selection.replaceSelection(this.frameForma_),r.push((function(){return new I.SetImageAsFloatingAction}))),X.ImageFacade.formaHasMask(this.frameForma_)||r.push((function(){return new I.ApplyShapeMaskToImageAction(o.frameForma_,"diamond")})),v.CorePromise.resolve(A.clone(r))},validateAfterActionSequence:function(e,t){XCTAssertTrue(X.ImageFacade.usesFreeformCropPreset(this.frameForma_)),XCTAssertFalse(X.ImageFacade.formaHasShapeMask(this.frameForma_))},validateAfterUndo:function(e,t){XCTAssertFalse(X.ImageFacade.usesFreeformCropPreset(this.frameForma_)),XCTAssertTrue(X.ImageFacade.formaHasShapeMask(this.frameForma_))},validateAfterRedo:function(e,t){XCTAssertTrue(X.ImageFacade.usesFreeformCropPreset(this.frameForma_)),XCTAssertFalse(X.ImageFacade.formaHasShapeMask(this.frameForma_))}}}),d),g.EnterCropModeTest=(p=function(){this.actionSequence_EnterCropMode=[],this.oneFrameForma_=null,this.frameForma_=null,C.ActionTestBase.call(this)},A.defineClass({name:"EnterCropModeTest",ctor:p,superName:"ActionTestBase",props:{tearDown:function(){this.oneFrameForma_=null,this.frameForma_=null,C.ActionTestBase.prototype.tearDown.call(this)},canRunActionSequence:function(e,t,o){return this.oneFrameForma_=A.as(A.last(this.allSelectableFormae(o,(function(e){return e.isImage()}))),P.FrameForma),null!=this.oneFrameForma_},populateActionSequence:function(e,t,o){var r=this;return v.CorePromise.resolve([function(){return new I.EnterCropModeAction(r.frameForma_)}])},prepareDocument:function(e,t){var o=this,r=[];return this.frameForma_=A.as(A.last(this.allSelectableFormae(e,(function(e){return e.isImage()&&!e.isBackgroundImage()}))),P.FrameForma),null==this.frameForma_&&(this.frameForma_=this.oneFrameForma_,e.controller.selection.replaceSelection(this.frameForma_),r.push((function(){return new I.SetImageAsFloatingAction})),r.push((function(){var e=o.frameForma_.bounds.aspectRatio<1?4/3:3/4;return new I.CropImageToRatioAction(o.frameForma_,e,null)}))),v.CorePromise.resolve(A.clone(r))},validateAfterActionSequence:function(e,t){var o,r=null;if(o=A.opt(this.frameForma_,(function(e){return e.parent})))for(var n=A.iter(o.visitAsArray(S.FormaTraversal.JustChildren));!n.done;n.next()){var i=n.value;i.hasIntent(S.Forma.INTENT_TEMP_IMAGE_CROP)&&(r=i)}XCTAssertNotNil(r)},validateAfterUndo:function(e,t){var o,r=null;if(o=A.opt(this.frameForma_,(function(e){return e.parent})))for(var n=A.iter(o.visitAsArray(S.FormaTraversal.JustChildren));!n.done;n.next()){var i=n.value;i.hasIntent(S.Forma.INTENT_TEMP_IMAGE_CROP)&&(r=i)}XCTAssertNil(r)},validateAfterRedo:function(e,t){var o,r=null;if(o=A.opt(this.frameForma_,(function(e){return e.parent})))for(var n=A.iter(o.visitAsArray(S.FormaTraversal.JustChildren));!n.done;n.next()){var i=n.value;i.hasIntent(S.Forma.INTENT_TEMP_IMAGE_CROP)&&(r=i)}XCTAssertNotNil(r)}}}),p),g.ExitCropModeTest=(_=function(){this.actionSequence_ExitCropMode=[],this.oneFrameForma_=null,this.frameForma_=null,C.ActionTestBase.call(this)},A.defineClass({name:"ExitCropModeTest",ctor:_,superName:"ActionTestBase",props:{tearDown:function(){this.oneFrameForma_=null,this.frameForma_=null,C.ActionTestBase.prototype.tearDown.call(this)},canRunActionSequence:function(e,t,o){return this.oneFrameForma_=A.as(A.last(this.allSelectableFormae(o,(function(e){return e.isImage()}))),P.FrameForma),null!=this.oneFrameForma_},populateActionSequence:function(e,t,o){return v.CorePromise.resolve([function(){return new I.ExitCropModeAction}])},prepareDocument:function(e,t){var o=this,r=[];return this.frameForma_=A.as(A.last(this.allSelectableFormae(e,(function(e){return e.isImage()&&!e.isBackgroundImage()}))),P.FrameForma),null==this.frameForma_&&(this.frameForma_=this.oneFrameForma_,e.controller.selection.replaceSelection(this.frameForma_),r.push((function(){return new I.SetImageAsFloatingAction})),r.push((function(){var e=o.frameForma_.bounds.aspectRatio<1?4/3:3/4;return new I.CropImageToRatioAction(o.frameForma_,e,null)})),r.push((function(){return new I.EnterCropModeAction(o.frameForma_)}))),v.CorePromise.resolve(A.clone(r))}}}),_),g.AddHiddenImageToGridTest=(T=function(){this.actionSequence_AddHidden=[],this.oneFrameForma_=null,this.frameForma_=null,this.imageForma_=null,C.ActionTestBase.call(this)},A.defineClass({name:"AddHiddenImageToGridTest",ctor:T,superName:"ActionTestBase",props:{tearDown:function(){this.oneFrameForma_=null,this.frameForma_=null,this.imageForma_=null,C.ActionTestBase.prototype.tearDown.call(this)},canRunActionSequence:function(e,t,o){return this.oneFrameForma_=A.as(A.last(this.allSelectableFormae(o,(function(e){return e.isImage()}))),P.FrameForma),null!=this.oneFrameForma_},populateActionSequence:function(e,t,o){var r=this;return v.CorePromise.resolve([function(){return new I.AddHiddenImageToGridAction([r.imageForma_])}])},prepareDocument:function(e,t){var o=this,r=[];return this.frameForma_=A.as(A.last(this.allSelectableFormae(e,(function(e){return e.isImage()&&!e.isBackgroundImage()}))),P.FrameForma),null==this.frameForma_&&(this.frameForma_=this.oneFrameForma_,e.controller.selection.replaceSelection(this.frameForma_),r.push((function(){return new I.SetImageAsFloatingAction}))),this.imageForma_=X.ImageFacade.getImageFormaForForma(this.frameForma_),r.push((function(){return new D.SetOpacityAction(0,[o.imageForma_])})),v.CorePromise.resolve(A.clone(r))},validateAfterActionSequence:function(e,t){XCTAssertFalse(this.frameForma_.controller.floating),XCTAssertEqual(this.imageForma_.style.opacity,1)},validateAfterUndo:function(e,t){XCTAssertTrue(this.frameForma_.controller.floating),XCTAssertEqual(this.imageForma_.style.opacity,0)},validateAfterRedo:function(e,t){XCTAssertFalse(this.frameForma_.controller.floating),XCTAssertEqual(this.imageForma_.style.opacity,1)}}}),T)},jE7t:function(e,t,o){var r,n=t,i=o("oAGj"),a=o("c9Jm"),s=o("o+xL");n.RotateTest=(r=function(){this.actionSequence_Rotate=[function(){return new s.RotateAction(Math.PI/2,null,null,!1)}],this.formaeToRotate_=[],this.formaeToTest_=[],this.initialTransforms_=[],a.ActionTestBase.call(this)},i.defineClass({name:"RotateTest",ctor:r,superName:"ActionTestBase",props:{setUpActionSequence:function(e,t,o){var r;this.formaeToRotate_=i.clone(this.allSelectableFormae(o,(function(e){return!(!(r=i.opt(e.controller,(function(e){return e.rotateable})))&&null==r)&&r}))),this.initialTransforms_=this.formaeToTest_.map((function(e){return e.placement}),this),o.controller.selection.replaceSelectionWithFormae(i.clone(this.formaeToRotate_))},validateAfterActionSequence:function(e,t){for(var o=i.iter(i.range(0,this.formaeToTest_.length,!1));!o.done;o.next()){var r=o.value,n=this.initialTransforms_[r].rotate(0,1);XCTAssertEqual(this.formaeToTest_[r].placement.transformValues.rotSine,n.transformValues.rotSine,.001),XCTAssertEqual(this.formaeToTest_[r].placement.transformValues.rotCosine,n.transformValues.rotCosine,.001)}},validateAfterUndo:function(e,t){for(var o=i.iter(i.range(0,this.formaeToTest_.length,!1));!o.done;o.next()){var r=o.value;XCTAssertEqual(this.formaeToTest_[r].placement.transformValues.rotSine,this.initialTransforms_[r].transformValues.rotSine),XCTAssertEqual(this.formaeToTest_[r].placement.transformValues.rotCosine,this.initialTransforms_[r].transformValues.rotCosine)}},validateAfterRedo:function(e,t){for(var o=i.iter(i.range(0,this.formaeToTest_.length,!1));!o.done;o.next()){var r=o.value,n=this.initialTransforms_[r].rotate(0,1);XCTAssertEqual(this.formaeToTest_[r].placement.transformValues.rotSine,n.transformValues.rotSine,.001),XCTAssertEqual(this.formaeToTest_[r].placement.transformValues.rotCosine,n.transformValues.rotCosine,.001)}},tearDown:function(){this.formaeToRotate_=[],this.formaeToTest_=[],a.ActionTestBase.prototype.tearDown.call(this)}}}),r)},mSLX:function(e,t,o){var r,n,i,a,s,l=t,u=o("oAGj"),c=o("Tq01"),m=o("4mEG"),h=o("c9Jm"),f=o("kYI4"),d=o("70fJ"),p=o("yGNn"),_=o("ascj"),T=o("rsKm"),g=o("FNB+"),A=o("x6FH"),F=o("iCxV"),C=o("VkKB"),v=o("JO5d"),S=o("Zifs"),y=o("umUn"),P=o("8t9B");l.ApplyColorIconTest=(r=function e(){this.actionSequence_ApplyColorIcon=[function(){return new m.AddIconContentAction(e.originalIconURL_,C.MediaMetadata.init_5f01(),null)}],this.testDoc_=null,this.testPage_=null,this.testColor_=null,this.oldIconColor_=null,h.ActionTestBase.call(this)},n={},u.defineClass({name:"ApplyColorIconTest",ctor:r,superName:"ActionTestBase",statics:{originalIconURL_:"",purple_:{get:function(){return void 0===n.purple_&&(n.purple_=new S.SolidColor(.4,.2,.6,1)),n.purple_}}},props:{iconForma:{get:function(){return u.first(u.opt(u.as(this.getActionResult(0),c.FormaActionResult),(function(e){return e.formae})))}},populateActionSequence:function(e,t,o){var n=this;return p.CorePromise.resolve(e.concat([function(){return n.oldIconColor_=u.opt(u.opt(n.iconForma,(function(e){return e.style})),(function(e){return e.colors.theoColor(_.ColorRole.FieldPrimary)})),n.testColor_=y.TheoColor.init_5344(r.purple_),new d.ApplyColorAction([n.iconForma],[n.testColor_],!1,0)}]))},setUpActionSequence:function(e,t,o){var n;this.testDoc_=o,this.testPage_=o.firstPage,null!=(n=this.urlForAsset("dog1.svg"))&&(r.originalIconURL_=n)},validateAfterActionSequence:function(e,t){var o=u.opt(u.opt(this.iconForma,(function(e){return e.style})),(function(e){return e.colors.theoColor(_.ColorRole.FieldPrimary)}));XCTAssertEqual(o,this.testColor_)},validateAfterUndo:function(e,t){var o=u.opt(u.opt(this.iconForma,(function(e){return e.style})),(function(e){return e.colors.theoColor(_.ColorRole.FieldPrimary)}));XCTAssertEqual(o,this.oldIconColor_)},validateAfterRedo:function(e,t){var o=u.opt(u.opt(this.iconForma,(function(e){return e.style})),(function(e){return e.colors.theoColor(_.ColorRole.FieldPrimary)}));XCTAssertEqual(o,this.testColor_)}}}),r),l.ApplyColorRootTest=function(){var e=function(){this.actionSequence_ApplyColorRoot=[],this.testDoc_=null,this.testPage_=null,this.rootForma_=null,this.testColor_=null,this.oldColor_=null,h.ActionTestBase.call(this)},t={};return u.defineClass({name:"ApplyColorRootTest",ctor:e,superName:"ActionTestBase",statics:{purple_:{get:function(){return void 0===t.purple_&&(t.purple_=new S.SolidColor(.4,.2,.6,1)),t.purple_}}},props:{populateActionSequence:function(t,o,r){var n=this;return p.CorePromise.resolve(t.concat([function(){return n.oldColor_=u.opt(n.rootForma_,(function(e){return e.style.colors.theoColor(_.ColorRole.FieldPrimary)})),n.testColor_=y.TheoColor.init_5344(e.purple_),new A.EnterGridLayoutModeAction},function(){return new A.SetGridParametersAction(NaN,8)},function(){return new d.ApplyColorAction([n.rootForma_],[n.testColor_],!1,0)}]))},setUpActionSequence:function(e,t,o){this.testDoc_=o,this.testPage_=o.firstPage,this.rootForma_=u.opt(this.testPage_,(function(e){return e.root}))},validateAfterActionSequence:function(e,t){var o=u.opt(this.rootForma_,(function(e){return e.style.colors.theoColor(_.ColorRole.FieldPrimary)}));XCTAssertEqual(o,this.testColor_)},validateAfterUndo:function(e,t){var o=u.opt(this.rootForma_,(function(e){return e.style.colors.theoColor(_.ColorRole.FieldPrimary)}));XCTAssertEqual(o,this.oldColor_)},validateAfterRedo:function(e,t){var o=u.opt(this.rootForma_,(function(e){return e.style.colors.theoColor(_.ColorRole.FieldPrimary)}));XCTAssertEqual(o,this.testColor_)}}}),e}(),l.ApplyColorThemeTest=(i=function(){this.actionSequence_ApplyColorTheme=[],this.testDoc_=null,this.page_=null,this.themeColors_=[],h.ActionTestBase.call(this)},u.defineClass({name:"ApplyColorThemeTest",ctor:i,superName:"ActionTestBase",props:{verifyColors:function(e){for(var t=0,o=u.clone(this.page_.colorLibraryController.getTheoColorsUsedInDocument()),r=u.iter(o);!r.done;r.next()){var n=r.value;(n.isBrandkitPrimaryColor()||n.isBrandkitSecondaryColor()||n.isBrandkitShade())&&(t+=1)}e?XCTAssertTrue(t>0):XCTAssertEqual(t,0)},populateActionSequence:function(e,t,o){var r=this;this.installBrandkit(o);for(var n=F.Host.brandkitManager.fakeBrandkitForElementsForTesting,i=u.clone(f.BrandingFacade.getBrandkitColorsForUI(n,null)),a=u.iter(i);!a.done;a.next()){var s=a.value[0];this.themeColors_.push(s)}return p.CorePromise.resolve(e.concat([function(){return new T.ApplyColorThemeAction(u.clone(r.themeColors_),"brandkit-for-actions",r.page_,!0)}]))},setUpActionSequence:function(e,t,o){this.testDoc_=o,this.page_=o.firstPage},validateAfterActionSequence:function(e,t){this.verifyColors(!0)},validateAfterUndo:function(e,t){this.verifyColors(!1)},validateAfterRedo:function(e,t){this.verifyColors(!0)},shutdown:function(e,t,o){h.ActionTestBase.prototype.shutdown.call(this,u.clone(e),t,o),this.removeBrandkit(o)}}}),i),l.ApplyColorThemeWithShuffleTest=(a=function(){this.actionSequence_ApplyColorThemeWithShuffle=[],this.testDoc_=null,this.page_=null,this.themeColors_=[],this.colorDictionary_={},this.colorRelationshipTestUtils_=new l.ColorRelationshipTestUtils,this.colorPaletteRelationshipBefore_=null,this.colorPaletteRelationshipAfter_=null,h.ActionTestBase.call(this)},u.defineClass({name:"ApplyColorThemeWithShuffleTest",ctor:a,superName:"ActionTestBase",props:{gatherColors:function(){var e={},t=u.opt(this.page_,(function(e){return e.root}));return u.opt(t,(function(t){return t.visitAll(g.FormaTraversal.PreOrder,(function(t){if(null!=t.style.colors.colorID(_.ColorRole.FieldPrimary)){var o,r=null;u.as(t.controller,P.TypeLockupController)&&(r=t.style.colors.theoColor(_.ColorRole.FieldPrimary)),u.as(t.controller,v.ShapeController)&&(r=t.style.colors.theoColor(_.ColorRole.FieldPrimary)),null!=(o=u.opt(r,(function(e){return e.asString})))&&(e[t.formaID]=o)}}))})),e},gatherSparkColors:function(){var e={},t=u.opt(this.page_,(function(e){return e.root}));return u.opt(t,(function(t){return t.visitAll(g.FormaTraversal.PreOrder,(function(t){var o;null!=t.style.colors.colorID(_.ColorRole.FieldPrimary)&&null!=u.opt(t.style.colors.theoColor(_.ColorRole.FieldPrimary),(function(e){return e.sparkElementID}))&&null!=(o=u.opt(t.style.colors.theoColor(_.ColorRole.FieldPrimary),(function(e){return e.asString})))&&(e[t.formaID]=o)}))})),e},verifyShuffledColors:function(e,t){for(var o=0,r=u.iter(e);!r.done;r.next()){var n,i=r.key,a=r.value;null!=(n=t[i])&&a!=n&&(o+=1)}u.toDouble(o)/u.toDouble(u.count(e))<=.15&&F.Host.logging.info("verifyShuffledColors diffCount "+o+" and count "+u.count(e)),XCTAssertTrue(u.toDouble(o)/u.toDouble(u.count(e))>.15)},verifyColorBeforeAfterPreservation:function(){var e,t,o,r;(e=this.testDoc_)&&(this.colorPaletteRelationshipAfter_=u.clone(this.colorRelationshipTestUtils_.getCurrentPaletteMapping(e)),(t=this.colorPaletteRelationshipBefore_)&&(o=this.colorPaletteRelationshipAfter_)&&null!=(r=this.colorRelationshipTestUtils_.checkOverlapBetweenTwoPaletteMappings(u.clone(t),u.clone(o)))?XCTAssertTrue(r>=.8,"score: "+u.toString(r)+" below threshold:"+u.toString(.8)):XCTFail("Unknown error, value was nil"))},populateActionSequence:function(e,t,o){var r=this;this.installBrandkit(o);for(var n=F.Host.brandkitManager.fakeBrandkitForElementsForTesting,i=u.iter(n.colors);!i.done;i.next()){var a=i.value;this.themeColors_.push(y.TheoColor.init_bb45(a))}return p.CorePromise.resolve(e.concat([function(){return new T.ApplyColorThemeAction(u.clone(r.themeColors_),"brandkit-for-actions",r.page_,!0)},function(){return r.colorDictionary_=u.clone(r.gatherColors()),new T.ApplyColorThemeAction(u.clone(r.themeColors_),"brandkit-for-actions",r.page_,!0)}]))},setUpActionSequence:function(e,t,o){var r;this.testDoc_=o,this.page_=o.firstPage,(r=this.testDoc_)&&(this.colorPaletteRelationshipBefore_=u.clone(this.colorRelationshipTestUtils_.getCurrentPaletteMapping(r)))},validateAfterActionSequence:function(e,t){var o=u.clone(this.gatherColors());this.verifyShuffledColors(u.clone(this.colorDictionary_),u.clone(o)),this.verifyColorBeforeAfterPreservation()},validateAfterUndo:function(e,t){var o=u.clone(this.gatherSparkColors());XCTAssertEqual(u.count(o),0),this.verifyColorBeforeAfterPreservation()},validateAfterRedo:function(e,t){var o=u.clone(this.gatherColors());this.verifyShuffledColors(u.clone(this.colorDictionary_),u.clone(o)),this.verifyColorBeforeAfterPreservation()},shutdown:function(e,t,o){h.ActionTestBase.prototype.shutdown.call(this,u.clone(e),t,o),this.removeBrandkit(o)}}}),a),l.ModifyColorThemeTest=function(){var e=function e(){this.actionSequence_ModifyColorTheme=[function(){return new m.AddIconContentAction(e.originalIconURL_,C.MediaMetadata.init_5f01(),null)}],this.testDoc_=null,this.testPage_=null,this.testColor_=null,this.oldIconColor_=null,this.iconColorKey_="",this.themeColors_=[],h.ActionTestBase.call(this)},t={};return u.defineClass({name:"ModifyColorThemeTest",ctor:e,superName:"ActionTestBase",statics:{originalIconURL_:"",darkBlue_:{get:function(){return void 0===t.darkBlue_&&(t.darkBlue_=new S.SolidColor(1/255,1/255,164/255,1)),t.darkBlue_}}},props:{iconForma:{get:function(){return u.first(u.opt(u.as(this.getActionResult(0),c.FormaActionResult),(function(e){return e.formae})))}},populateActionSequence:function(t,o,r){var n=this;this.installBrandkit(r);for(var i=F.Host.brandkitManager.fakeBrandkitForElementsForTesting,a=u.iter(i.colors);!a.done;a.next()){var s=a.value;this.themeColors_.push(y.TheoColor.init_bb45(s))}return p.CorePromise.resolve(t.concat([function(){return new T.ApplyColorThemeAction(u.clone(n.themeColors_),"brandkit-for-actions",n.testPage_,!1)},function(){return n.oldIconColor_=u.opt(u.opt(n.iconForma,(function(e){return e.style})),(function(e){return e.colors.theoColor(_.ColorRole.FieldPrimary)})),n.iconColorKey_=u.opt(u.opt(n.iconForma,(function(e){return e.style})),(function(e){return e.colors.colorID(_.ColorRole.FieldPrimary)})),n.testColor_=y.TheoColor.init_5344(e.darkBlue_),new T.ModifyColorThemeAction(n.testColor_,n.iconColorKey_,n.testPage_)}]))},setUpActionSequence:function(t,o,r){var n;this.testDoc_=r,this.testPage_=r.firstPage,null!=(n=this.urlForAsset("dog1.svg"))&&(e.originalIconURL_=n)},validateAfterActionSequence:function(e,t){var o=u.opt(u.opt(this.iconForma,(function(e){return e.style})),(function(e){return e.colors.theoColor(_.ColorRole.FieldPrimary)}));XCTAssertEqual(o,this.testColor_);var r=u.opt(u.opt(this.iconForma,(function(e){return e.style})),(function(e){return e.colors.colorID(_.ColorRole.FieldPrimary)}));XCTAssertEqual(r,this.iconColorKey_)},validateAfterUndo:function(e,t){XCTAssertEqual(u.opt(this.iconForma,(function(e){return e.parent})),null)},validateAfterRedo:function(e,t){var o=u.opt(u.opt(this.iconForma,(function(e){return e.style})),(function(e){return e.colors.theoColor(_.ColorRole.FieldPrimary)}));XCTAssertEqual(o,this.testColor_);var r=u.opt(u.opt(this.iconForma,(function(e){return e.style})),(function(e){return e.colors.colorID(_.ColorRole.FieldPrimary)}));XCTAssertEqual(r,this.iconColorKey_)},shutdown:function(e,t,o){h.ActionTestBase.prototype.shutdown.call(this,u.clone(e),t,o),this.removeBrandkit(o)}}}),e}(),l.ColorRelationshipTestUtils=(s=function(){},u.defineClass({name:"ColorRelationshipTestUtils",ctor:s,props:{getCurrentPaletteMapping:function(e){return e.firstPage.colorLibraryController.enteredPalettePicker(),e.firstPage.colorLibraryController.returnCurrentPaletteMapping()},checkOverlapBetweenTwoPaletteMappings:function(e,t){for(var o=null,r=0,n=0,i=u.iter(u.keys(e));!i.done;i.next()){var a,s=i.value;if(null!=(a=this.findCorrespondingMappingKey(u.clone(e[s]),u.clone(t))))for(var l=u.iter(e[s]);!l.done;l.next()){var c=l.value;c.length>1&&(t[a].includes(c)?(r+=1,n+=1):r+=1)}else r+=e[s].length}return r>0&&(o=u.toDouble(n)/u.toDouble(r)),o},getAverageArrayDouble:function(e){for(var t=0,o=0,r=0,n=u.iter(e);!n.done;n.next()){var i=n.value;isNaN(i)||(t+=i,o+=1)}return u.opt(F.Host.logging,(function(e){return e.info("Sum: "+u.toString(t))})),u.opt(F.Host.logging,(function(e){return e.info("Count: "+u.toString(o))})),o>0&&(r=t/u.toDouble(o)),r},printPaletteMapping:function(e){for(var t=[],o=u.iter(u.keys(e));!o.done;o.next()){for(var r=o.value,n=r+":",i=u.iter(e[r]);!i.done;i.next())n+=i.value+"\n";t.push(n)}for(var a=u.iter(t);!a.done;a.next()){var s=a.value;u.opt(F.Host.logging,(function(e){return e.info(s)}))}},findCorrespondingMappingKey:function(e,t){for(var o=null,r={},n=u.iter(u.keys(t));!n.done;n.next())for(var i=n.value,a=u.iter(e);!a.done;a.next()){var s=a.value;t[i].includes(s)&&(u.keys(r).includes(i)?r[i]=r[i]+1:r[i]=1)}for(var l=0,c=u.iter(u.keys(r));!c.done;c.next())r[i=c.value]>l&&(o=i,l=r[i]);return o}}}),s)},md5b:function(e,t,o){var r,n,i,a,s=t,l=o("oAGj"),u=o("c9Jm"),c=o("yGNn"),m=o("Pil/"),h=o("pnSN"),f=o("H1Z2"),d=o("c+uM"),p=o("tGKA"),_=o("cRpU"),T=o("Vm85"),g=o("8t9B"),A=o("oKlP"),F=o("sIWg");s.MoveHandleTest=(r=function(){this.actionSequence_MoveHandle=[],this.formaToMove_=null,this.delta_=new A.TheoPoint(5,-5),this.initialBounds_=F.TheoRect.Zero,this.postMoveBounds_=F.TheoRect.Zero,u.ActionTestBase.call(this)},l.defineClass({name:"MoveHandleTest",ctor:r,superName:"ActionTestBase",props:{tearDown:function(){this.formaToMove_=null,u.ActionTestBase.prototype.tearDown.call(this)},findFormaToMove:function(e){return l.last(this.allSelectableFormae(e,(function(e){return e instanceof h.GroupForma&&e.controller.kind==g.TypeLockupController.KIND})))},canRunActionSequence:function(e,t,o){return null!=this.findFormaToMove(o)},populateActionSequence:function(e,t,o){var r=this;return this.formaToMove_=this.findFormaToMove(o),XCTAssertNotNil(this.formaToMove_),null!=this.formaToMove_&&(o.controller.selection.replaceSelection(this.formaToMove_),this.initialBounds_=this.formaToMove_.finalFrame),c.CorePromise.resolve([function(){return new f.MoveHandleAction(r.formaToMove_,r.delta_,r.initialBounds_.center,1)}])},validateAfterActionSequence:function(e,t){this.postMoveBounds_=this.formaToMove_.finalFrame,XCTAssertFalse(this.postMoveBounds_.equal(this.initialBounds_))},validateAfterUndo:function(e,t){var o=this.formaToMove_.finalFrame;XCTAssertTrue(this.initialBounds_.equal(o))},validateAfterRedo:function(e,t){var o=this.formaToMove_.finalFrame;XCTAssertTrue(o.equal(this.postMoveBounds_))}}}),r),s.ResizeHandleTest=(n=function(){this.actionSequence_ResizeHandleTracking=[],this.actionSequence_ResizeHandleLeading=[],this.actionSequence_ResizeHandleCorner=[],this.formaToResize_=null,this.trackingSpot_=new A.TheoPoint(1,.5),this.leadingSpot_=new A.TheoPoint(.5,1),this.cornerSpot_=new A.TheoPoint(1,1),this.initialBounds_=F.TheoRect.Zero,this.postResizeBounds_=F.TheoRect.Zero,u.ActionTestBase.call(this)},l.defineClass({name:"ResizeHandleTest",ctor:n,superName:"ActionTestBase",props:{tearDown:function(){this.formaToResize_=null,u.ActionTestBase.prototype.tearDown.call(this)},findFormaToResize:function(e){return l.last(this.allSelectableFormae(e,(function(e){return e instanceof h.GroupForma&&e.controller.kind==g.TypeLockupController.KIND})))},canRunActionSequence:function(e,t,o){return null!=this.findFormaToResize(o)},populateActionSequence:function(e,t,o){var r=this;this.formaToResize_=this.findFormaToResize(o),XCTAssertNotNil(this.formaToResize_),null!=this.formaToResize_&&(o.controller.selection.replaceSelection(this.formaToResize_),this.initialBounds_=this.formaToResize_.finalFrame);var n=!1,i=this.cornerSpot_,a=new F.TheoRect(this.initialBounds_.minX,this.initialBounds_.minY,this.initialBounds_.minX+100,this.initialBounds_.minY+100);return"actionSequence_ResizeHandleTracking"==t?(i=this.trackingSpot_,n=!0):"actionSequence_ResizeHandleLeading"==t&&(i=this.leadingSpot_,n=!0),c.CorePromise.resolve([function(){return new f.ResizeHandleAction(r.formaToResize_,i,A.TheoPoint.ZERO,a,n)}])}}}),n),s.ResizeLockupHorizontallyTest=(i=function(){this.actionSequence_ResizeLockupWider_Right=[],this.actionSequence_ResizeLockupNarrower_Right=[],this.actionSequence_ResizeLockupWider_Left=[],this.actionSequence_ResizeLockupNarrower_Left=[],this.lockupForma_=null,this.initialFontSize_=0,this.initialBounds_=F.TheoRect.Zero,u.ActionTestBase.call(this)},l.defineClass({name:"ResizeLockupHorizontallyTest",ctor:i,superName:"ActionTestBase",props:{tearDown:function(){this.lockupForma_=null,u.ActionTestBase.prototype.tearDown.call(this)},canRunActionSequence:function(e,t,o){return this.lockupForma_=l.last(this.allSelectableFormae(o,(function(e){return T.TextFacade.getLayoutForForma(e)==d.LockupLayout.Standard}))),null!=this.lockupForma_},prepareDocument:function(e,t){var o,r,n=[];if((o=this.lockupForma_)&&(r=e.controller)){var i=T.TextFacade.getAlignmentForForma(o),a=i==d.LockupAlignment.Right?d.LockupAlignment.Left:d.LockupAlignment.Right;r.selection.replaceSelection(o),n.push((function(){return new _.ChangeTextLayoutAndAlignmentAction(d.LockupLayout.Standard,a)})),n.push((function(){return new _.ChangeTextLayoutAndAlignmentAction(d.LockupLayout.Standard,i)}))}return c.CorePromise.resolve(l.clone(n))},populateActionSequence:function(e,t,o){var r,n,i;if((r=this.lockupForma_)&&(n=r.bounds)&&(i=o.controller)){this.initialFontSize_=this.getFontSize();var a=t.includes("Right")?new A.TheoPoint(1,.5):new A.TheoPoint(0,.5),s=t.includes("Right")?new A.TheoPoint(0,.5):new A.TheoPoint(1,.5),u=t.includes("Wider")?n.width+100:Math.max(n.width-100,20),h=F.TheoRect.fromXYWH(n.minX,n.minY,u,n.height);return this.initialBounds_=n,i.selection.replaceSelection(r),l.opt(r.controller,(function(e){return e.onEvent(new m.BeginFormaResizeEvent(r,a))})),c.CorePromise.resolve([function(){return new f.ResizeHandleAction(r,a,s,h)}])}return XCTAssertFalse(!0),c.CorePromise.reject(null)},getFontSize:function(){var e;return(e=l.opt(l.as(l.opt(this.lockupForma_,(function(e){return e.controller})),g.TypeLockupController),(function(e){return e.getCurrentFontSize()})))||null!=e?e:0},validateAfterActionSequence:function(e,t){var o;(o=l.opt(this.lockupForma_,(function(e){return e.bounds})))?(t.includes("Wider")?XCTAssertTrue(o.width>=this.initialBounds_.width-.01):XCTAssertTrue(o.width<=this.initialBounds_.width+.01),XCTAssertEqual(this.getFontSize(),this.initialFontSize_,.01)):XCTAssertFalse(!0)},validateAfterUndo:function(e,t){var o;(o=l.opt(this.lockupForma_,(function(e){return e.bounds})))?(XCTAssertEqual(o.width,this.initialBounds_.width),XCTAssertEqual(this.getFontSize(),this.initialFontSize_,.01)):XCTAssertFalse(!0)},validateAfterRedo:function(e,t){var o;(o=l.opt(this.lockupForma_,(function(e){return e.bounds})))?(t.includes("Wider")?XCTAssertTrue(o.width>=this.initialBounds_.width-.01):XCTAssertTrue(o.width<=this.initialBounds_.width+.01),XCTAssertEqual(this.getFontSize(),this.initialFontSize_,.01)):XCTAssertFalse(!0)}}}),i),s.RotateHandleTest=(a=function(){this.actionSequence_RotateHandle=[],this.formaToRotate_=null,this.delta_=new A.TheoPoint(5,-5),this.initialPlacement_=p.Matrix2D.Identity,this.postRotatePlacement_=p.Matrix2D.Identity,u.ActionTestBase.call(this)},l.defineClass({name:"RotateHandleTest",ctor:a,superName:"ActionTestBase",props:{tearDown:function(){this.formaToRotate_=null,u.ActionTestBase.prototype.tearDown.call(this)},findFormaToRotate:function(e){return l.last(this.allSelectableFormae(e,(function(e){return e instanceof h.GroupForma&&e.controller.kind==g.TypeLockupController.KIND&&1==e.placement.transformValues.rotCosine})))},canRunActionSequence:function(e,t,o){return null!=this.findFormaToRotate(o)},populateActionSequence:function(e,t,o){var r=this;this.formaToRotate_=this.findFormaToRotate(o),XCTAssertNotNil(this.formaToRotate_);var n=A.TheoPoint.ZERO;return null!=this.formaToRotate_&&(o.controller.selection.replaceSelection(this.formaToRotate_),this.initialPlacement_=this.formaToRotate_.placement,n=this.formaToRotate_.frame.center),c.CorePromise.resolve([function(){return new f.RotateHandleAction(r.formaToRotate_,Math.PI/4,n,r.initialPlacement_,!0)}])},validateAfterActionSequence:function(e,t){this.postRotatePlacement_=this.formaToRotate_.placement,XCTAssertTrue(Math.abs(this.postRotatePlacement_.transformValues.rotCosine-.707)<.01),XCTAssertTrue(Math.abs(this.postRotatePlacement_.transformValues.rotSine-.707)<.01)},validateAfterUndo:function(e,t){var o=this.formaToRotate_.placement;XCTAssertTrue(this.initialPlacement_.equal(o))},validateAfterRedo:function(e,t){var o=this.formaToRotate_.placement;XCTAssertTrue(o.equal(this.postRotatePlacement_))}}}),a)},oTkQ:function(e,t,o){var r,n=t,i=o("oAGj"),a=o("c9Jm"),s=o("vV1H");n.FlipTest=(r=function(){this.actionSequence_FlipVertical=[function(){return new s.FlipAction(!0)}],this.actionSequence_FlipHorizontal=[function(){return new s.FlipAction(!1)}],this.formaeToFlip_=[],this.initialTransforms_=[],this.vertical_=!1,a.ActionTestBase.call(this)},i.defineClass({name:"FlipTest",ctor:r,superName:"ActionTestBase",props:{setUpActionSequence:function(e,t,o){var r;this.formaeToFlip_=i.clone(this.allSelectableFormae(o,(function(e){return!(!(r=i.opt(e.controller,(function(e){return e.flippable})))&&null==r)&&r}))),this.vertical_="actionSequence_FlipVertical"==t,this.initialTransforms_=this.formaeToFlip_.map((function(e){return e.totalPlacement}),this),o.controller.selection.replaceSelectionWithFormae(i.clone(this.formaeToFlip_))},validateAfterActionSequence:function(e,t){for(var o=i.iter(i.range(0,this.formaeToFlip_.length,!1));!o.done;o.next()){var r=o.value;XCTAssertEqual(this.formaeToFlip_[r].totalPlacement.extractedScale.scale,this.initialTransforms_[r].scaleXY(this.vertical_?1:-1,this.vertical_?-1:1).extractedScale.scale)}},validateAfterUndo:function(e,t){for(var o=i.iter(i.range(0,this.formaeToFlip_.length,!1));!o.done;o.next()){var r=o.value;XCTAssertEqual(this.formaeToFlip_[r].totalPlacement.extractedScale.scale,this.initialTransforms_[r].extractedScale.scale)}},validateAfterRedo:function(e,t){for(var o=i.iter(i.range(0,this.formaeToFlip_.length,!1));!o.done;o.next()){var r=o.value;XCTAssertEqual(this.formaeToFlip_[r].totalPlacement.extractedScale.scale,this.initialTransforms_[r].scaleXY(this.vertical_?1:-1,this.vertical_?-1:1).extractedScale.scale)}},tearDown:function(){this.formaeToFlip_=[],a.ActionTestBase.prototype.tearDown.call(this)}}}),r)},qWkq:function(e,t,o){var r,n,i=t,a=o("oAGj"),s=o("c9Jm"),l=o("yGNn"),u=o("FNB+"),c=o("y/On"),m=o("9Lk3"),h=o("6Rk9"),f=o("sIWg");i.GroupTest=(r=function(){this.actionSequence_Group=[function(){return new c.GroupAction}],this.formaeToGroup_=[],this.initialBounds_=f.TheoRect.Zero,this.testDoc_=null,s.ActionTestBase.call(this)},a.defineClass({name:"GroupTest",ctor:r,superName:"ActionTestBase",props:{setUpActionSequence:function(e,t,o){this.formaeToGroup_=a.clone(this.allSelectableFormae(o,(function(e){return 1==e.controller.floating}))),XCTAssertNotNil(a.clone(this.formaeToGroup_)),this.testDoc_=o,this.formaeToGroup_.length>1&&(o.controller.selection.replaceSelectionWithFormae(a.clone(this.formaeToGroup_)),this.initialBounds_=h.GeometryFacade.getFormaeBounds(a.clone(this.formaeToGroup_),!0))},validateAfterActionSequence:function(e,t){this.validateGrouping(!0)},validateAfterUndo:function(e,t){var o,r=h.GeometryFacade.getFormaeBounds(a.clone(this.formaeToGroup_),!0);XCTAssertTrue(this.initialBounds_.equal(r));for(var n=a.iter(this.formaeToGroup_);!n.done;n.next()){var i=n.value;XCTAssertFalse(i.controller.userGroupMember),XCTAssertTrue(i.parent.controller.kind==m.GridController.KIND)}if(this.formaeToGroup_.length>1){var s=!1;a.opt(this.formaeToGroup_[0].root,(function(e){return e.visitAll(u.FormaTraversal.PreOrder,(function(e){((o=a.opt(e.controller,(function(e){return e.userGroupMember})))||null!=o)&&o&&(s=!0)}))})),XCTAssertFalse(s)}},validateAfterRedo:function(e,t){this.validateGrouping(!1)},validateGrouping:function(e){var t=h.GeometryFacade.getFormaeBounds(a.clone(this.formaeToGroup_),!0);if(XCTAssertTrue(this.initialBounds_.equalWithAccuracy(t,.01)),this.formaeToGroup_.length>1){var o=this.formaeToGroup_[0].parent;XCTAssertTrue(o.controller.userGroup);for(var r=a.iter(this.formaeToGroup_);!r.done;r.next()){var n=r.value;XCTAssertTrue(n.controller.userGroupChild),XCTAssertTrue(n.parent==o)}if(e){XCTAssertTrue(1==this.testDoc_.controller.selection.selectedCountInDocument);var i=this.testDoc_.controller.selection.formaAt(0);XCTAssertTrue(i.controller.userGroup)}}},tearDown:function(){this.formaeToGroup_=[],s.ActionTestBase.prototype.tearDown.call(this)}}}),r),i.UngroupTest=(n=function(){this.actionSequence_Ungroup=[function(){return new c.UngroupAction}],this.formaeToGroup_=[],this.initialBounds_=f.TheoRect.Zero,this.root_=null,this.testDoc_=null,s.ActionTestBase.call(this)},a.defineClass({name:"UngroupTest",ctor:n,superName:"ActionTestBase",props:{prepareDocument:function(e,t){this.root_=e.firstPage.root,this.formaeToGroup_=a.clone(this.allSelectableFormae(e,(function(e){return 1==e.controller.floating}))),XCTAssertNotNil(a.clone(this.formaeToGroup_)),this.formaeToGroup_.length>0&&(e.controller.selection.replaceSelectionWithFormae(a.clone(this.formaeToGroup_)),this.initialBounds_=h.GeometryFacade.getFormaeBounds(a.clone(this.formaeToGroup_),!0));var o=[function(){return new c.GroupAction}];return l.CorePromise.resolve(a.clone(o))},setUpActionSequence:function(e,t,o){this.testDoc_=o},validateAfterActionSequence:function(e,t){this.validateNoGrouping(!0)},validateAfterUndo:function(e,t){this.validateGrouping()},validateAfterRedo:function(e,t){this.validateNoGrouping(!1)},validateGrouping:function(){if(this.formaeToGroup_.length>1){var e=this.formaeToGroup_[0].parent;XCTAssertTrue(e.controller.userGroup);for(var t=a.iter(this.formaeToGroup_);!t.done;t.next()){var o=t.value;XCTAssertTrue(o.controller.userGroupChild),XCTAssertTrue(o.parent==e)}}},validateNoGrouping:function(e){var t,o=h.GeometryFacade.getFormaeBounds(a.clone(this.formaeToGroup_),!0);XCTAssertTrue(this.initialBounds_.equalWithAccuracy(o,.01));for(var r=a.iter(this.formaeToGroup_);!r.done;r.next()){var n=r.value;XCTAssertFalse(n.controller.userGroupMember),XCTAssertTrue(n.parent.controller.kind==m.GridController.KIND)}if(this.formaeToGroup_.length>1){var i=!1;a.opt(this.formaeToGroup_[0].root,(function(e){return e.visitAll(u.FormaTraversal.PreOrder,(function(e){((t=a.opt(e.controller,(function(e){return e.userGroupMember})))||null!=t)&&t&&(i=!0)}))})),XCTAssertFalse(i),e&&XCTAssertTrue(this.testDoc_.controller.selection.selectedCountInDocument==this.formaeToGroup_.length)}},tearDown:function(){this.formaeToGroup_=[],this.root_=null,s.ActionTestBase.prototype.tearDown.call(this)}}}),n)}}]);
//# sourceMappingURL=vendors_npm_spark_fdbb4495-d912f154.js.map