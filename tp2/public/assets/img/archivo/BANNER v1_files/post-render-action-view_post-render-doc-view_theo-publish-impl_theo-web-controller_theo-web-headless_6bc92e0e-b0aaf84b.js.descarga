(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[49],{"14LO":function(e,t,n){"use strict";n.r(t),n.d(t,"DCXDocumentComposite",(function(){return i}));var o=n("uTW7");function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class i{constructor(e){r(this,"dcxComposite",void 0),r(this,"current",void 0),r(this,"localStoragePath",void 0),this.dcxComposite=e.composite,this.current=new o.DCXDocumentBranch({branch:e.composite.current,componentURLfn:e.componentURLfn,overrideIDfn:e.overrideIDfn}),this.localStoragePath="local-storage://"}}},"1tmr":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var o=n("UzQk");function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class i{constructor(e,t){r(this,"branch",void 0),r(this,"node",void 0),this.branch=e,this.node=t}reparent(e){if(e!==this.node){const t=this.node.childComponents.indexOf(this);t>=0?(e.childComponents.push(this),this.node.childComponents.splice(t,1),this.node=e,this.attachToNode()):o.LegacyCoreAssert.fail("internal error: component isn't attached to the node we think it is")}}update(e){const t=this.node.childComponents.indexOf(this);t<0?o.LegacyCoreAssert.fail("replaceWith: component isn't attached to the node we think it is"):e.node===this.node?(this.detachFromNode(),this.node.childComponents.splice(t,1,e),e.attachToNode()):o.LegacyCoreAssert.fail("replaceWith: only supports same-node replacement")}}},"2uFU":function(e,t,n){"use strict";function o(e=[],t){const n=e.filter(e=>-1===e.indexOf("_REMIX_"));return[...new Set([...n,...t.getRemixAncestorsCpMachineTags()])]}function r(e){const{width:t,height:n}=e.firstPage.pageSize;return{width:t,height:n}}n.r(t),n.d(t,"getRemixAncestorsIntoMachineTags",(function(){return o})),n.d(t,"getDocumentSize",(function(){return r}))},"3xdQ":function(e,t,n){var o,r;function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const{size:l}=n("YLtl");o=[n("YLtl"),n("UFvF"),n("MGCh"),n("rCSV"),n("a8ov"),n("r3b0"),n("U44B"),n("UzQk"),n("mwMu"),n("qnb0"),n("TdwW"),n("9KYx"),n("ZLL8"),n("WpJZ"),n("hEO4"),n("KpqY"),n("6lgp"),n("2uFU"),n("+Ltv")],void 0===(r=function(e,t,n,o,r,i,c,l,s,u,d,m,g,p,h,f,v,S,y){const C=r.default,F=f.default,b=o.default,I=m.default,T=n.channel("core-wrapper");return function(n){n=n||{};var o={};o.events=new b,o.ActionError=v.default;var r,m=null,p=!1,f=null,k=!1,A=null,w=null,P=null,D=null,x=[],L=null,M=0,O=l.TheoPoint.ZERO,N=!1,E=[],U=null,R=null;o.monitorTransactions=function(){h.monitorTransactionsForDocument(m)},o.validateDoc=function(e){const t=l.TheoDocumentUtils.validateDoc(m,e);t&&T.error("validateDoc: "+t.errorMsg,t)},o.getManifestData=function(){return m.encodeToJSON()},o.getDocumentCCID=function(){return m.uuid||" "},o.bindToSaveManager=function(){m.controller.saveMgr.subscribeWithCallback((function(e){e.message===l.SaveMessage.SAVE_SCHEDULED?o.events.publish("update-save-promise",m.controller.saveMgr.pendingSave):e.message===l.SaveMessage.SAVE_COMPLETED&&o.events.publish("clean-up-after-save")}),l.SaveMessage.TYPE)};var B=function(e){var t=new i({makeComponentUrl:function(){return C.encodeDesignFilterComponentUrl()},trackAbsolutePath:!1,branch:e}),n=l.TheoDocument.newDocumentFromDataObject(t,null);return l.TheoDocumentUtils.createImageFeatures(n),n};o.getTemporaryDocumentWithFontsLoaded=function(e){var t=B(e),n=t.missingFontList;return n.length?I.loadMissingFonts(n).then((function(){return B(e)})):Promise.resolve(t)};var _=[];function W(){_.forEach((function(e){e.unsubscribe()}));var t={};(_=[]).push(m.firstPage.subscribeWithCallback((function(n){0===--M&&(e.each(t,(function(e){(e.transform||e.geometry||e.style)&&o.events.publish("forma-dirty",e)})),o.events.publish("document-in-new-renderable-state"))}),l.FormaEndUpdateMessage.TYPE)),_.push(m.firstPage.subscribeWithCallback((function(e){if(0===M&&(t={}),e.event.forma){var n=e.event.forma.formaID,o=t[n];o||(t[n]=o={formaID:n}),e.event instanceof l.FormaTransformChangedEvent?o.transform=!0:e.event instanceof l.FormaGeometryChangedEvent?o.geometry=!0:e.event instanceof l.FormaStyleChangedEvent&&(o.style=!0)}M++}),l.FormaBeginUpdateMessage.TYPE)),_.push(m.controller.subscribeWithCallback((function(e){o.inCharStyleMode&&o.handleTapped({x:e.state.clickLocation.x,y:e.state.clickLocation.y,forma:e.state.forma})}),l.ClickMessage.TYPE)),_.push(m.controller.subscribeWithCallback((function(e){o.events.publish("layer-double-tapped")}),l.DoubleClickMessage.TYPE)),_.push(m.controller.model.subscribeWithCallback((function(e){e.changes.indexOf(l.EditorModelChangedMessage.CHG_SNAPLINES)>=0&&o.events.publish("update-snap-lines",{lines:m.controller.model.snapLines.getAll()}),e.changes.indexOf(l.EditorModelChangedMessage.CHG_HANDLES)>=0&&o.events.publish("update-handles"),e.changes.indexOf(l.EditorModelChangedMessage.CHG_SWAP_STATE)>=0&&o.events.publish("update-swap-state"),e.changes.indexOf(l.EditorModelChangedMessage.CHG_VIEW_STATE)>=0&&o.events.publish("update-view-state"),e.changes.indexOf(l.EditorModelChangedMessage.CHG_ACTION_FEEDBACK_STATE)>=0&&function(e){if(!e)return;switch(e.showWaiting){case l.ActionFeedbackWaitingType.Loading:o.events.publish("show-app-loading-indicator");break;case l.ActionFeedbackWaitingType.None:o.events.publish("hide-app-loading-indicator");break;default:l.LegacyCoreAssert.fail("Unknown value for showWaiting.")}null!=e.message&&o.events.publish("show-actionfeedback-message-modal",{messageType:e.messageType,messageObj:e.message})}(m.controller.model.actionFeedback.getActionFeedback()),e.changes.indexOf(l.EditorModelChangedMessage.CHG_ANNOTATIONS)>=0&&o.events.publish("update-annotations")}),l.EditorModelChangedMessage.TYPE))}function G(e){return e?e.contentNode&&e.contentNode.url?C.decodeUrl(e.contentNode.url):(T.error("image forma has no contentNode or url"),null):(T.error("image forma is not defined"),null)}function H(){for(var e,t=m.controller.model.handles.getAll(),n=!1,r=null,i=[],a=null,c=null,s=null,u=null,d=null,g=!1,p=null,h=!1,f=0;f<t.length;f++){var v=t[f];if(v instanceof l.BoxTransformHandles){if(v instanceof l.BoxTransformMultipleFormae){r=[];for(var S=0;S<v.formaIDs.length;S++){var y=v.formaIDs[S],C=o.getFormaById(y);null!=C&&r.push({formaID:y,bounds:C.bounds,placement:C.totalPlacement,isGroup:!(!C.controller||!C.controller.userGroup)})}if(0===r.length&&(r=[{formaID:"group",placement:v.reference.placement,bounds:v.reference.bounds,isGroup:!0}]),g=v.displayHints.includes(l.BoxHandleDisplayHint.GroupOutlineColor),d=v.displayHints.includes(l.BoxHandleDisplayHint.WideOutline),null!=a)continue}u=v.displayHints.includes(l.BoxHandleDisplayHint.ThinOutline),g=v.displayHints.includes(l.BoxHandleDisplayHint.GroupOutlineColor),p=v.displayHints.includes(l.BoxHandleDisplayHint.TextFrame),h=v.displayHints.includes(l.BoxHandleDisplayHint.PreferLeftSideHandle);var F=v.allowedTransforms;v.activeTransform===l.TransformType.Translate?(n=!0,F=[]):!p||v.activeTransform!==l.TransformType.LeftSideTranslate&&v.activeTransform!==l.TransformType.RightSideTranslate||(F=[]),F.forEach((function(e){var t=Y(e);t&&i.push(t)})),s=F.includes(l.TransformType.RotateAboutCenter)&&!v.displayHints.includes(l.BoxHandleDisplayHint.SuppressRotationHandle)&&(v.activeTransform===l.TransformType.None||v.activeTransform===l.TransformType.RotateAboutCenter),a=v.reference.placement,c=v.reference.bounds}}return null===a?null:(e=o.canNudge(),{matrix2d:a,bounds:c,enablePips:i.length>0,rotateable:s,nudgeable:e,handlePoints:i,thinOutline:u,wideOutline:d,transparentOutline:n,textFrame:p,preferLeftSideHandle:h,highlightRects:r,groupOutlineColor:g,inCropMode:o.inCropMode()})}function j(e){if(e)return{forma:e,matrix2d:e.totalPlacement,bounds:e.bounds,showLeftLine:e.isRangeStart(),showRightLine:e.isRangeEnd()}}function z(){var t=m.firstPage.colorLibraryController.getColorThemeAsArrayOfSolidColors();return e.map(t,(function(e){return e.red+":"+e.green+":"+e.blue})).join(":")}function V(t){return e.map(t,(function(e){var t=e.sprkElemId||e.id||null,n=e.sprkRoles||e.roles||null,o=d.rgb2SolidColor(e);return d.solidColor2TheoColor(o,t,n)}))}function $(t){return e.map(t,(function(e){var t;return"string"==typeof e?(t=d.hex2SolidColor(e),d.solidColor2TheoColor(t,null,null)):(t=d.hex2SolidColor(e.color),d.solidColor2TheoColor(t,e.id,e.roles))}))}function K(){return t.Promise((function(e){r.invalidatePatches(e)}))}var J=[{type:l.TransformType.TopLeftCornerTranslate,spot:new l.TheoPoint(0,0)},{type:l.TransformType.TopRightCornerTranslate,spot:new l.TheoPoint(1,0)},{type:l.TransformType.BottomLeftCornerTranslate,spot:new l.TheoPoint(0,1)},{type:l.TransformType.BottomRightCornerTranslate,spot:new l.TheoPoint(1,1)},{type:l.TransformType.TopSideTranslate,spot:new l.TheoPoint(.5,0)},{type:l.TransformType.BottomSideTranslate,spot:new l.TheoPoint(.5,1)},{type:l.TransformType.LeftSideTranslate,spot:new l.TheoPoint(0,.5)},{type:l.TransformType.RightSideTranslate,spot:new l.TheoPoint(1,.5)}];function X(e){const t=J.find(t=>t.spot.x===e.x&&t.spot.y===e.y);return t?t.type:null}function Y(e){const t=J.find(t=>t.type===e);return t?t.spot:null}function Q(e){var t=e.getProperty("components"),n=t&&t.arrayValue&&t.arrayValue[0];return n&&n.dictionaryValue&&n.dictionaryValue.url&&n.dictionaryValue.url.stringValue}function Z(e){return e.catch((function(e){let t=e;t.isAllowedError||(e.errorMsg&&(t=e.errorMsg),T.error("doAction",t||"Unknown error!"),o.forceReloadEditor())}))}function q(e,t){let n=F.doAction(m,e);return!t&&o.shouldReloadOnActionFailure()&&(n=Z(n)),n}function ee(e,t,n){let r=F.doActionWithCompletion(m,e,t);return!n&&o.shouldReloadOnActionFailure()&&(r=Z(r)),r}function te(){var e=o.getAllSelectedFormas();!1===m.controller.selection.inCharStyleMode&&!0===o.inCharStyleMode&&o.exitCharStyleMode(),0!==e.length&&e[0].isTypeLockup()||o.events.publish("text-forma-selected",{id:null,forma:null,selectionBoxes:[]}),e.length>0?o.events.publish("forma-selected",{id:e[0].formaID,forma:e[0],selectionBox:H()}):o.events.publish("forma-selected",{id:null,forma:null});R&&e&&e.length===R.length&&e.every((function(e,t){return e.id&&R[t].id&&e.id===R[t].id}))||o.events.publish("selection-changed",{}),R=e}function ne(e,t){e&&o.events.publish("forma-updated",{id:e.formaID,selected:o.getSelectedForma()&&e.formaID===o.getSelectedFormaId(),snapLines:t,selectionBox:H(),data:{forma:e}})}function oe(e){null==e&&(e=!0),o.events.publish("design-updated",{formaAdded:e})}function re(e){return Math.atan2(e.transformValues.rotSine,e.transformValues.rotCosine)}function ie(e){for(var t=e.controller,n=[],r=1;r<t.owner.selection.selectedCount;r++){var i=t.owner.selection.formaAt(r);n.push(j(i))}o.events.publish("text-forma-selected",{id:e.formaID,forma:e,selectionBoxes:n})}function ae(e,t){e&&t&&(e.selectCharStyleForma(),e.updateGroup(),oe(!1),e.selectCharStyleForma(),ie(t))}function ce(t){return t&&"image"===t.kind&&(!t.url||e.startsWith(t.url,"data:"))}function le(e,t,n){return(e-t.min)*(n.max-n.min)/(t.max-t.min)+n.min}return o.inCharStyleMode=!1,o.generateKeyFrames=function(){var e=o.beginTransaction("revertAnimationPlay"),t=l.MotionUtils.getCurrentAnimationStyle(m);l.AnimationFacade.applyAnimationStyle(t,m.firstPage),o.endTransactionAndMergeWithPrevious(e),oe(!1)},o.getGraph=function(e,t){void 0===t&&(t=o.getWatermarkEnabledForDoc());const n=m.firstPage.pgm.getGraph(e?l.PGMExportSettings.DYNAMIC:l.PGMExportSettings.STATIC);return t?l.PGMWatermarkingUtils.addWatermark(n):n},o.validateDBSaveState=function(t){const n=m.database.getState(t);for(var o=0;o<E.length;o++){var r=n.getObjectStateByID(E[o]);if(r){var i=r.object;if("image"===i.kind){const t=Q(r);if(!t||e.startsWith(t,"data:"))return!1}else if("vector"===i.kind){if("uploading svg"===Q(r))return!1}}}return!0},o.saveWithRenditions=function(e,t,n){return D.saveWithRenditions(m,e,t,n)},o.saveCopyWithRenditions=function(e,t,n){return e.saveWithRenditions(m,t,n)},o.saveImageComponent=function(e,t,n,o,r){return D.saveImageComponent(e,t,n,o,r)},o.initializeNewPost=function(n){var r,i=l.TypeLockupUtils.fixUpQuotes(n.text,""),a=n.palette,c=o.imageFormas(),s=t.defer(),u=o.hostImages(),d=e.map(u,(function(e){return e.imgLoadedPromise}));if(c.length>=1)Promise.all(d).then((function(){const e=o.beginTransaction("create_initial_theme_from_image");m.firstPage.colorLibraryController.createInitialThemeFromImage(),s.resolve(),o.endTransaction(e)}));else{if(n.defaultBackgroundColor){var g=m.firstPage.root.filterByKind(l.ShapeForma.KIND),p=g&&g[0];p&&(r={shape:p,color:n.defaultBackgroundColor})}o.setColorPalette({colors:a,id:"0"},{shuffle:!r}).then(s.resolve)}return s.promise.then((function(){if(r){var e=o.beginTransaction("set_color_id");r.shape.style.colors.setColorId(l.ColorRole.FieldPrimary,r.color),o.endTransactionAndMergeWithPrevious(e,!0)}return 0===o.lockupFormas().length?i.length?(o.downloadNewLockupRandomFontsAsync(),o.addNewLockup(i,{silent:!0,select:!!n.selectText})):t.resolve():(T.error("initializeNewPost error. We shouldn't be adding multiple lockups. Probably git issue 2093."),t.resolve())})).then((function(){return c.length>1?q(new l.CreatePaddedCollageAction).then((function(){oe(!1)})):t.resolve()})).then((function(){return o.retrieveAndApplyASuggestedGridStyle()})).then((function(){o.requestSave()}))},o.resetUserActions=function(){r.reset()},o.undoToInitialState=function(){return t.Promise((function(e,t){r.setCurrentTimelineIndex(0,e)}))},o.beginBranch=function(){r.beginBranch()},o.endBranch=function(e){r.endBranch(e)},o.beginGesture=function(){const e=o.getSelectedFormaPlacement();return U=e?e.placement:null,r.beginGesture(),r.gestureScope},o.endGesture=function(e){U=null,r.endGesture(e)},o.gestureInProgress=function(){return null!==r.gestureScope},o.undo=function(){return t.Promise((function(e,t){r.undo((function(){o.events.publish("undo-finished"),e()}))}))},o.redo=function(){return t.Promise((function(e,t){r.redo((function(){o.events.publish("redo-finished"),e()}))}))},o.canUndo=function(){return r.getCurrentTimelineIndex()>0&&0===r.getActionDepth()},o.canRedo=function(){return r.getCurrentTimelineIndex()<r.getTimelineLength()-1&&0===r.getActionDepth()},o.getUndoDescription=function(){return r.getUndoDescription()},o.getRedoDescription=function(){return r.getRedoDescription()},o.getCurrentTimelineIndex=function(){return r.getCurrentTimelineIndex()},o.getCurrentTimelineState=function(){return r.getCurrentTimelineState()},o.documentId=function(){return D.documentId()||P.documentId()},o.backgroundColor=function(){return m.firstPage.root.style.colors.color(l.ColorRole.FieldPrimary)},o.getFormaBackgroundColor=function(e){var t=e.style.colors.fieldPrimary;return t?m.firstPage.colorLibraryController.getTheoColorForSolidColor(t):null},o.getImageFormaBackgroundColor=function(e){if(!(null!==e.controller.cutout))return null;const t=!e.controller.moveable,n=o.getFormaBackgroundColor(e);if(t){if(n)return n;{const t=l.TheoDocumentUtils.getCellBackgroundShape(e);return o.getFormaBackgroundColor(t)}}return n},o.triggerEnteredPalette=function(){m.firstPage.colorLibraryController.enteredPalettePicker()},o.triggerTextSidebarDisplayed=function(){m.firstPage.colorLibraryController.enteredPalettePicker()},o.isBackgroundVisible=function(){var e=o.getGridForma();return e?e.controller.isBackgroundVisible():0===o.imageFormas().length},o.getImageFormaForURL=function(e){for(var t=o.imageFormas(),n=0;n<t.length;n++){var r=t[n];if(null!=r.contentNode&&r.contentNode.url===e)return r}return null},o.getImagePreviewData=function(e){if(e&&e.isImage()){var t=l.ImageFacade.getImageFormaForForma(e);if(t&&t.contentNode)return T.info("image preview placement:",t.placement),{colorThemeKey:z(),formaID:t.formaID,forma:t,url:G(t),styleFilter:t.style,placement:t.placement,width:t.contentNode.pixelWidth,height:t.contentNode.pixelHeight}}return{}},o.getFormaRenderList=function(){var e=[];let t=!1;const n=$(["FF0000"])[0];var r=m.firstPage.root.visitAsArray(l.FormaTraversal.PreOrder);const i=(t,n)=>e.push(a(a({},t),{},{type:n}));for(var c=0;c<r.length;c++){const a=r[c],{controller:s,formaID:u,kind:d}=a;if(s){const r={forma:a,formaID:u};if("Root"===d&&i(r,"background"),"Shape"===d&&i(r,"shape"),"Frame"===d)continue;if(a.isTypeLockup()&&i(r,"lockup"),d===l.ImageForma.KIND||d===l.VideoForma.KIND){const r=G(a);null==r?(T.error("no image url, cleaning up the document",{docId:m.uuid,imageFormaId:a.uuid}),t=!0,o.replaceImagesWithColors([a],[n]).done()):e.push({forma:a.parent,type:"image",formaID:a.parent.formaID,url:r,logo:a.isLogo(),colorThemeKey:z()})}}}return t&&(o.events.publish("show-image-forma-corrupted-modal",{backgroundColor:n.rgbColor.rgbHex}),o.validateDoc("missingContentCleanup")),e},o.imageFormas=function(){return m.firstPage.root.filterByKind(l.ImageForma.KIND)},o.canAddMoreImages=function(e){return o.imageFormas().length+e<=l.GridController.MAX_IMAGE_COUNT},o.hostImages=function(){var e=[];return o.imageFormas().forEach((function(t){void 0!==t.contentNode.image&&e.push(t.contentNode.image)})),e},o.iconFormas=function(){return m.firstPage.root.filterWithCallback((function(e){return e.hasIntent(l.Forma.INTENT_ICON)}))},o.lockupFormas=function(){return m.firstPage.root.filterByControllerKind(l.TypeLockupController.KIND)},o.logoFormas=function(){return o.imageFormas().filter((function(e){return e.isLogo()}))},o.backgroundImageFormas=function(){return m.firstPage.root.filterWithCallback((function(e){return e.kind===l.FrameForma.KIND&&e.isBackgroundImage()}))},o.getLockupWordCount=function(){for(var e=[],t=o.lockupFormas(),n=0;n<t.length;n++)e.push(t[n].controller.text.trim().split(/ |\n/).length);return e},o.getIconCount=function(){return o.iconFormas().length},o.getImageCount=function(){return o.imageFormas().length},o.getBackgroundImageCount=function(){return m.firstPage.root.filterWithCallback(e=>e.isBackgroundImage()).length},o.documentSize=function(){return{width:m.firstPage.pageSize.width,height:m.firstPage.pageSize.height}},o.getDocumentSize=function(){return S.getDocumentSize(m)},o.getImageSizeIfFullBleed=function(){var e=o.imageFormas();if(1===e.length){var t=e[0],n=o.getDocumentSize(),r=t.parent;if(r.finalFrame.width===n.width&&r.finalFrame.height===n.height&&t.contentNode)return{width:t.contentNode.pixelWidth,height:t.contentNode.pixelHeight}}return null},o.forceReloadEditor=function(e){o.events.publish("force-reload-editor",e)},o.shouldReloadOnActionFailure=function(){return c.isFeatureEnabled("post-reload-on-action-failure")},o.doAction=q,o.flipForma=function(e,t){q(new l.FlipAction(e,[t])).then((function(){o.events.publish("forma-flipped",{id:t.formaID,isImage:t.isImage()})}))},o.canDuplicateFormae=function(e){return l.DuplicateAction.canAddImages(e)},o.duplicateFormae=function(e){return r.currentlyExecutingAction()?t.reject():q(new l.DuplicateAction(e,!0,!0)).then((function(t){for(var n=!1,r=0;r<e.length;r++)if(e[r].isImage()){n=!0;break}return o.events.publish("formae-duplicated",{duplicatedImage:n}),t}))},o.inCropMode=function(){return m.controller.selection.inCropMode},o.enterCropMode=function(){return N&&T.error("probable error. cropModeBranchStarted shouldn't be true"),N||r.currentlyExecutingAction()||o.inCropMode()?t():(N=!0,o.beginBranch(),q(new l.EnterCropModeAction(o.getSelectedForma())))},o.exitCropMode=function(e){return"boolean"!=typeof e&&(e=!0),o.events.publish("exit-crop-mode"),r.currentlyExecutingAction()?t():q(new l.ExitCropModeAction).then(()=>{N&&(o.endBranch(e),N=!1)})},o.inSpecialSelectionMode=function(){return!0===o.inCropMode()||!0===o.inCharStyleMode},o.exitSpecialSelectionMode=function(){!0===o.inCropMode()&&o.exitCropMode().done(),!0===o.inCharStyleMode&&o.exitCharStyleMode()},o.setImageAsBackground=function(){return r.currentlyExecutingAction()?t():q(new l.SetImageAsBackgroundAction).then(e=>(o.events.publish("image-set-background",{}),e))},o.setImageAsForeground=function(){return r.currentlyExecutingAction()?t():q(new l.SetImageAsFloatingAction).then(e=>(o.events.publish("image-set-foreground",{}),e))},o.deleteFormae=function(e){for(var t=[],n=o.getSelectedForma(),r=0;r<e.length;r++)t.push(o.getFormaById(e[r].formaID));return e=t,o.inCharStyleMode&&null!=n&&n.isTypeLockup()&&o.exitCharStyleMode(),o.deselect(),q(new l.DeleteAction(e)).then((function(){for(var t=[],n=!1,r=0;r<e.length;r++)t.push(e[r].formaID),n||(n=e[r].isImage());o.events.publish("formae-deleted",{ids:t,deletedImage:n})}))},o.groupItems=function(e,t,n){return q(new l.GroupAction(e,t,n))},o.ungroupItems=function(e,t,n){return q(new l.UngroupAction(e,t,n))},o.cleanupInvalidImageSync=function(e,t){if(e){const n=l.ImageFacade.getFrameFormaForForma(o.getFormaById(e)),r=o.beginTransaction("CleanUpCorruptImage");n&&l.CreationFacade.deleteFormae([n]),o.removeContentForCorruptImageFrame(t),o.endTransactionAndMergeWithPrevious(r),o.events.publish("formae-deleted",{ids:[e],deletedImage:n&&n.isImage()})}},o.cleanupInvalidImageWithColorSync=function(e,t,n){if(e){const r=e&&o.getFormaById(e),i=o.beginTransaction("CleanUpCorruptImageWithColor");r&&l.ImageFacade.replaceImageWithColors(r,n),o.removeContentForCorruptImageFrame(t),o.endTransactionAndMergeWithPrevious(i)}},o.replaceImagesWithColors=function(e,t){return q(new l.ReplaceImagesWithColorsAction(e,t))},o.setImageCutout=function(e,t){return o.suspendSave(),ee(new l.SetImageCutoutAction(e,t),()=>{o.resumeSave()})},o.getDeleteInfo=function(e){for(var t=o.getGridForma(),n=t&&1===t.style.numBackgroundCells,r=!1,i=!0,a=0;a<e.length;a++)if(e[a]&&e[a].isImage()&&e[a].isBackgroundImage()){r=!0,i=t.controller.canDeleteCellForForma(e[a])&&!n;break}return{isDeleteable:i,isBackgroundImage:r}},o.getFirstAnnotation=function(){return m.controller.model.annotations.getFirst()},o.getSelectedBoundingBox=function(){return H()},o.getSwapState=function(){return m.controller.model.activeSwap.getActive()},o.isMultiSelect=function(){return l.SelectionFacade.isMultiSelect(m.controller.selection)},o.isGroupSelect=function(){const e=m.controller.selection.asFormaArray(),t=1===e.length&&e[0];return t&&t.kind===l.GroupForma.KIND&&t.intent===l.Forma.INTENT_USER_GROUP},o.getSelectedForma=function(){const e=m.controller.selection.asFormaArray();return e.length?e[0]:null},o.getAllSelectedFormas=function(){return m.controller.selection.asFormaArray()},o.getSelectedFormaId=function(){var e=o.getSelectedForma();return e?e.formaID:null},o.formaAtPointInSelection=function(e){return m.firstPage.formaAtPointInSelection(e,m.controller.selection)},o.getSelectedFormaType=function(){var e=o.getSelectedForma();return null===e?"no-selection":o.isGroupSelect()?"group":o.isMultiSelect()?"multiselect":e.isTypeLockup&&e.isTypeLockup()?"text":e.isLogo&&e.isLogo()?"logo":o.isIcon()?"icon":e.isImage&&e.isImage()?"image":e.isGridCell&&e.isGridCell()||"Root"===e.kind?"cell":"unkown"},o.getSelectableFormaeIntersectingRect=function(e){return m.firstPage.selectableFormaeIntersectingRect(e)},o.removeStaleSelections=function(){m.controller.selection.removeStaleSelections()},o.getRootForma=function(){return m.firstPage.root},o.getDocument=function(){return m},o.getFormaById=function(e){return m.firstPage.formaByID(e)},o.selectFormaById=function(e){if(e.forma=o.getFormaById(e.formaId),e.forma)return o.selectForma(e),e.forma},o.marqueeSelectFormae=function(e,t){l.SelectionFacade.marqueeSelectFormae(e,t)},o.selectAll=function(){l.SelectionFacade.selectAllOnPage(m.firstPage)},o.deselectAll=function(){l.SelectionFacade.deselectAllOnPage(m.firstPage)},o.canSelectSibling=function(){return!o.inSpecialSelectionMode()&&l.SelectionFacade.canSelectSibling(m.firstPage)},o.selectSibling=function(e){l.SelectionFacade.selectSibling(m.firstPage,e)},o.canSelectParent=function(){return!o.inSpecialSelectionMode()&&l.SelectionFacade.canSelectParent(m.firstPage)},o.selectParent=function(){l.SelectionFacade.selectParent(m.firstPage)},o.canSelectChild=function(){return!o.inSpecialSelectionMode()&&l.SelectionFacade.canSelectChild(m.firstPage)},o.selectChild=function(){l.SelectionFacade.selectChild(m.firstPage)},o.getSelectedCount=function(){return m.controller.selection.selectedCount},o.getSelectionBounds=function(){return l.SelectionFacade.getSelectionBounds(m.firstPage)},o.deselect=function(e){e=e||{};var t=o.getSelectedForma();o.inCharStyleMode&&null!=t&&t.isTypeLockup()&&o.exitCharStyleMode(),o.inCropMode()&&o.exitCropMode().done(),m.controller.selection.clearSelection(!e.silent),R=null},o.deselectForma=function(e){m.controller.selection.deselectForma(e)},o.formaIsSelected=function(e){return m.controller.selection.isSelected(e)},o.formaIsGroupSelected=function(e){return m.controller.selection.isGroupSelected(e)},o.selectForma=function(e){var t=o.getSelectedForma(),n=e.forma,r=e.silent,i=!e.multiselect;if(n&&(e.multiselect||o.getSelectedFormaId()!==n.formaID))if(e.multiselect&&o.formaIsSelected(e.forma))o.deselectForma(e.forma);else{if(o.inCharStyleMode&&null!=t&&t.isTypeLockup()&&o.exitCharStyleMode(),"Root"===n.kind&&!o.isBackgroundVisible())return T.error("error in selection. background is not visible, so don't allow selection"),void o.deselect();i&&o.deselect({silent:!0}),m.controller.selection.selectForma(n,!r)}},o.ensureBackgroundFormaSelected=function(){var e=o.getSelectedForma(),t=e&&!e.isTypeLockup()&&!e.isLogo()&&e.controller.moveable;if(!e||!(e.isBackgroundImage()||e.isShape()||"Root"===e.kind||e.isGridCell()||t)){var n=o.backgroundImageFormas();if(n.length>0)o.selectForma({forma:n[0]});else{var r=m.firstPage.root.filterByControllerKind("shape");r.length>0?o.selectForma({forma:r[0]}):o.selectForma({forma:m.firstPage.root})}}},o.ensureLockupSelected=function(){var e=o.getSelectedForma();if(!e||!e.isTypeLockup()){var t=o.lockupFormas();t.length>0&&o.selectForma({forma:t[0]})}},o.canNudge=function(){var e=o.getSelectedForma();return!!e&&e.controller.nudgeable},o.handleNudge=function(e){var t=e.translate;return q(new l.NudgeAction(new l.TheoPoint(t.x,t.y)))},o.canRotateBox=function(){return!0===H().rotateable},o.handleHandleFeedback=function(e){for(var t=m.controller.model.handles.getAll(),n=null,r=0;r<t.length;r++)!(t[r]instanceof l.BoxTransformHandles)||n&&t[r]instanceof l.BoxTransformMultipleFormae||(n=t[r]);if(n){var i;switch(e.action){case"begin":i=l.HandleTransformStage.Begin;break;case"update":i=l.HandleTransformStage.Update;break;case"end":i=l.HandleTransformStage.End;break;default:return void T.error("handleHandleFeedback: params.action wasn't an expected value; it was "+e.action)}var a,c=null;switch(e.part){case"rotate":if(o.canRotateBox){var s=!e.isShortcut;c=new l.RotateAboutCenterTransformEvent(n,i,e.totalDeltaRadians,s||0)}break;case"corner":a=X(e.spot),c=new l.CornerTranslateTransformEvent(n,i,a,new l.TheoPoint(e.location.x,e.location.y));break;case"side":a=X(e.spot),c=new l.SideTranslateTransformEvent(n,i,a,new l.TheoPoint(e.location.x,e.location.y));break;default:return void T.error("handleHandleFeedback: params.part wasn't an expected value; it was "+e.part)}c.viewportScale=o.getViewScale(),m.controller.designController.handles.handleTransformEvent(c)}},o.getSelectedFormaRotation=function(){var e=o.getSelectedForma();if(!e)return null;var t=e;return"Frame"===e.kind&&(t=t.childAt(0)),180*re(t.placement)/Math.PI},o.getSelectedFormaHasShapeMask=function(){return l.ImageFacade.formaHasShapeMask(o.getSelectedForma())},o.getSelectedFormaScale=function(){var e=o.getSelectedForma();if(!e)return null;var t=e;return"Frame"===e.kind&&(t=t.childAt(0)),t.placement.extractedScale.scale.x},o.getSelectedFormaPlacement=function(){var e=o.getSelectedForma();if(!e)return null;var t=e,n="";return"Frame"===e.kind&&(n=(t=t.childAt(0)).contentNode.pixelWidth+"_"+t.contentNode.pixelHeight),{placement:t.placement,id:n}},o.getSelectedFormaScaleRange=function(){var e={},t=o.getSelectedForma();if(t&&"Frame"===t.kind&&!t.controller.moveable){var n=t.childAt(0),r=.1;if(n.contentNode){var i=t.finalFrame.size,a=n.contentNode.pixelWidth,c=n.contentNode.pixelHeight,l=a/c,s=i.width/i.height,u=i.width/a,d=i.height/c;r=l>s?d:u}n.hasAlpha()?(e.min=.1,e.max=2):(e.min=r,e.max=10*r)}return e},o.scaleSelectedForma=function(e,t){var n=o.getSelectedForma();"Frame"!==n.kind||n.controller.moveable&&!o.inCropMode()||(n=n.childAt(0));var r=e/n.placement.extractedScale.scale.x;return q(new l.ScaleAction(r,[n]))},o.changeImageAdjustments=function(e){var t=o.getSelectedForma(),n=t;return t&&"Frame"===t.kind&&(n=t.childAt(0)),q(l.ChangeImageAdjustmentsAction.ActionWithDictionary(e,[n]))},o.resetImageAdjustments=function(e){return o.changeImageAdjustments(e)},o.getImageAdjustments=function(e){var t=e||o.getSelectedForma();return t&&"Frame"===t.kind&&(t=t.childAt(0)),t.style.adjustments},o.rotateSelectedForma=function(e,t){var n=e/180*Math.PI,r=o.getSelectedForma();return"Frame"!==r.kind||r.controller.moveable&&!o.inCropMode()||(r=r.childAt(0)),q(new l.RotateAction(n,t,[r],!0))},o.handleTextFormaBeginResize=function(e){if(e=e||o.getSelectedForma()){o.beginGesture();null!=e&&e.isTypeLockup()&&(e.controller.beginTouches(null),w=null)}},o.handleTextFormaEndResize=function(e){(e=e||o.getSelectedForma())&&o.endGesture(!0)},o.handleTextFormaResize=function(e,n){if(e&&e.isTypeLockup()&&null!=n.startForma){var o=new l.TheoPoint(n.touchPoint.x,n.touchPoint.y),r=0===n.spot.x&&.5===n.spot.y;return q(new l.CharRangeHandleAction(e,o,n.startForma,r,w)).then((function(){w=o,ie(e)}))}return t.resolve(!1)},o.formaAtPoint=function(e,t){return m.firstPage.formaAtPoint(e,0,null,t)},o.handleTapped=function(e){var t=e.forma||o.getFormaById(e.id);if(o.inCharStyleMode){null!=t&&t.isTypeLockup()&&t.controller.owner.selection.isSelected(t)&&t.controller.selectCharStyleForma();var n=new l.TheoPoint(e.x,e.y),r=m.firstPage.formaAtPointInSelection(n,m.controller.selection);if(null!=r&&null!=r.lockupForma)!function(e){if(!e||!e.lockupForma)return;q(new l.ApplyCharStyleAction(e,l.TypeLockupController.HIGHLIGHT_STYLE,l.CharStyleApplyMode.Toggle,e.rangeInLockup)).done()}(r);else{var i=o.getSelectedForma();i.formaID&&e.forma.formaID!==i.formaID&&(o.exitCharStyleMode(),o.selectForma({forma:t}))}}else void 0!==t&&o.selectForma({forma:t});return!o.inCharStyleMode},o.getOriginalImageSize=function(){if(!o.inVisibleGridLayout()){var e=o.backgroundImageFormas();if(1===e.length){var t=e[0];return{width:t.childAt(0).contentNode.pixelWidth,height:t.childAt(0).contentNode.pixelHeight}}return null}},o.recordOriginalSize=function(){return q(new l.RecordOriginalPageSizeAction(m.firstPage))},o.setPageSizeFromDesignSize=function(e,t){return t=t||{},ee(new l.ChangePageSizeAction(m.firstPage,e),(function(){var e=o.getDocumentSize(),n={width:e.width,height:e.height};return o.events.publish("document-size-changed",n),g.delay(t.delay||100)}))},o.getPageAspectRatio=function(){var e=o.getDocumentSize();return e.width/e.height},o.getDocumentSizeId=function(){return m.firstPage.sizeID},o.getDocumentOriginalSizeId=function(){return m.firstPage.originalSizeID},o.getPageCustomSizeFormat=function(){return m.firstPage.customSizeFormat},o.getPageCustomSizePPI=function(){return m.firstPage.customSizePPI},o.getPageExportData=function(){return m.firstPage.getPageExportData()},o.getExportData=function(){return m.firstPage.getExportData()},o.lockupFormaIDs=function(){var t=o.lockupFormas();return e.map(t,(function(e){return e.formaID}))},o.downloadNewLockupRandomFontsAsync=function(){if(!L){L=t.defer();I.loadMissingFonts(["Lato-Light","Lora-Regular","Montserrat-Regular","PlayfairDisplay-Regular","FuturaPT-Medium"]).then((function(){L.resolve()}))}},o.addNewLockup=function(e,n){T.assert(!!L,"Invalid random fonts loading promise."),n=n||{};var r=o.imageFormas();return(r.length>0?r[0].contentNode.image.getImageLoadedPromise():t.resolve()).then((function(){return o.canPan()&&o.fitToView(),q(new l.AddTextContentAction(e))}))},o.addBadge=function(e,t){return o.canPan()&&o.fitToView(),o.getTemporaryDocumentWithFontsLoaded(e).then((function(e){return q(new l.AddBadgeAction(e,t))}))},o.applyDesignTheme=function(e,n){var r=t.defer();return o.getTemporaryDocumentWithFontsLoaded(e).then((function(e){o.canPan()&&o.fitToView(),n=n||0;var t=m.firstPage.root;q(l.ApplyTemplateAction.createDesignTemplateAction(e,t,n,t,!1)).then((function(){g.delay(40).done(r.resolve)}))})).catch((function(e){T.error("error in getTemporaryDocumentWithFontsLoaded",e),r.resolve()})),r.promise},o.applyRetargetSuggestion=function(e,t){return q(l.ApplyTemplateAction.createDesignTemplateAction(e,m.firstPage.root,t,m.firstPage.root,!1)).then((function(){return g.delay(10)}))},o.getThemeId=function(){return m.content.root.getTag("theme:id")},o.getColorPalette=function(){var t=m.firstPage.colorLibraryController.getColorThemeAsArrayOfTheoColors();return e.map(t,(function(e){return{color:d.rgb2hex({r:255*e.rgbColor.red,g:255*e.rgbColor.green,b:255*e.rgbColor.blue}),roles:e.sparkRoles,id:e.sparkElementID}}))},o.getColorAnimationVariant=function(e){const t=m.firstPage.colorLibraryController.getThemeColorKeys();let n=0;for(let o=0;o<t.length;++o){const r=m.firstPage.colorLibraryController.getTheoColorForKey(t[o]);if(r){if(d.rgb2hex({r:255*r.rgbColor.red,g:255*r.rgbColor.green,b:255*r.rgbColor.blue})===e){n=o;break}}}return n},o.setColorPalette=function(e,t){if(!e||!e.colors)return;t=t||{};const n=$(e.colors);return q(new l.ApplyColorThemeAction(n,e.id,m.firstPage,!!t.shuffle))},o.applyAspectRatioCropToImage=function(e){var t=l.ImageFacade.getImageFormaForForma(o.getSelectedForma());if(e.id===l.CropRatioPresetLibrary.FREEFORM_ID)return q(new l.SetImageCropToFreeformAction(t));var n=e.id===l.CropRatioPresetLibrary.ORIGINAL_ID?0:e.aspectRatio;return q(new l.CropImageToRatioAction(t,n))},o.applyShapeMaskToImage=function(e){return q(new l.ApplyShapeMaskToImageAction(o.getSelectedForma(),e.shapeId))},o.shuffleColorPalette=function(){return q(new l.ShuffleColorThemeAction(m.firstPage))},o.getImageFilters=function(){for(var e=m.firstPage.imageFilterLibrary.getImageStyles(),t=e.length-1;t>=0;t--)e[t].colors.library=m.firstPage.colorLibrary;return e},o.setImageFilterForSelection=function(e,n,r){var i=o.getSelectedForma();if(i&&i.isImage()){const t=e.clone(),o=l.ImageFacade.getImageFormaForForma(i);return o&&(t.opacity=o.style.opacity),q(0===n?new l.SetImageFilterAction(t,r):new l.ShuffleImageFilterAction(t,m.firstPage,r))}return t.resolve(!1)},o.getTextForSelectedLockup=function(){var e=o.getSelectedForma();if(e&&e.isTypeLockup()){var t=e.controller.contentNode;return t?t.text:null}},o.shouldSuggestTransparentBackground=function(){return m.firstPage.root.controller.suggestTransparentBackground()},o.setBackgroundTransparency=function(e){return q(new l.SetBackgroundOpacityAction(e,m.firstPage))},o.getFullCanvasColor=function(){var e=l.TypeLockupUtils.getFullCanvasLockups(m.firstPage.root);return e.length>0&&1===e[0].lockupStyle.backingOpacity?e[0].lockupStyle.colors.fieldSecondary:null},o.setTextForSelectedLockup=function(e,n){var r=o.getSelectedForma();if(!r)return t.resolve();var i=r&&r.formaID;return ee(new l.SetTextAction(e,r,n),(function(){return r=o.getFormaById(i),o.events.publish("forma-text-updated",{forma:r}),g.delay(10)}))},o.getDominantColorRoleOfLockup=function(e){if(!e||!e.isTypeLockup())return l.ColorRole.FieldPrimary;var t=e.controller.styleController.targetedLockupStyle;return t.textLook===l.LockupTextLook.KnockoutOnly||t.textLook===l.LockupTextLook.OutlineOnly?l.ColorRole.FieldSecondary:l.ColorRole.FieldPrimary},o.setColorsForSelectedLockup=function(e,n,r){var i=r||o.getSelectedForma();if(i&&i.isTypeLockup()&&i.formaID){var a=V(e);return q(new l.ApplyColorAction(null,a,o.inCharStyleMode,n))}return t.resolve(!1)},o.getShapeFormaTheoColor=function(e){if((e=e||o.getSelectedForma())&&e.isShape()){var t=e.style.colors.color(l.ColorRole.FieldPrimary);return m.firstPage.colorLibraryController.getTheoColorForSolidColor(t)}},o.getLockupFormaColors=function(e,t){if((e=e||o.getSelectedForma())&&e.isTypeLockup()){t="boolean"!=typeof t||t;var n=e.controller,r=t?n.styleController.targetedLockupStyle.colors:n.lockupStyle.colors,i=r.fieldPrimary||new l.SolidColor(1,1,1,1),a=r.fieldSecondary||new l.SolidColor(1,1,1,1),c=m.firstPage.colorLibraryController.getTheoColorForSolidColor(i),s=m.firstPage.colorLibraryController.getTheoColorForSolidColor(a),u=[{red:Math.round(255*c.rgbColor.red),green:Math.round(255*c.rgbColor.green),blue:Math.round(255*c.rgbColor.blue),alpha:1,id:c.sparkElementID,roles:c.sparkRoles},{red:Math.round(255*s.rgbColor.red),green:Math.round(255*s.rgbColor.green),blue:Math.round(255*s.rgbColor.blue),alpha:1,id:s.sparkElementID,roles:s.sparkRoles}];return o.selectedLockupHasOnlyOneColor(e)&&(o.getDominantColorRoleOfLockup(e)===l.ColorRole.FieldSecondary?u.splice(0,1):u.splice(1)),u}},o.selectedLockupHasOnlyOneColor=function(e){if(!(e=e||o.getSelectedForma())||!e.isTypeLockup())return!0;var t="none"!==o.getShapeOfSelectedLockup(e),n=e.controller.styleController.targetedLockupStyle.textLook;return t?n===l.LockupTextLook.KnockoutOnly||n===l.LockupTextLook.OutlineOnly:n===l.LockupTextLook.OutlineOnly||n===l.LockupTextLook.Fill||l.LockupTextLook.UNSET},o.setFontForSelectedLockup=function(e){var n=c.fontProvider.descriptorForPostScriptName(e.postScriptName);if(n.postScriptName===e.postScriptName){var r=I.getFontData(e.postScriptName),i=l.TheoFont.init_9e5c(n,r.sparkElementId,r.acRoles);return ee(new l.SetFontAction(i,o.inCharStyleMode),(function(){var e=o.getSelectedForma();e&&ne(e)}))}return t.reject("cannot find font with PostScriptName: "+e.postScriptName)},o.updataDocForTypekitFontDeactivated=function(e){m&&e&&(l.TypeLockupUtils.replaceFontsInDocument(m,[e]),oe(!1),o.requestSave())},o.replaceMissingFonts=function(){return ee(new l.ReplaceMissingFontsAction,()=>{o.requestSave(!0)})},o.getLockupFontOfSelectedLockup=function(e,t){if((e=e||o.getSelectedForma())&&e.isTypeLockup()){t="boolean"!=typeof t||t;var n=e.controller;return t?n.styleController.targetedLockupStyle.font:n.lockupStyle.font}},o.setShapeForSelectedLockup=function(e){return o.getSelectedForma()?isNaN(e)?o.applyBackingToLockup(7,e,o.getSelectedFormaId()):o.applyBackingToLockup(e,null,o.getSelectedFormaId()):t.resolve()},o.getEffectForSelectedLockup=function(e){if((e=e||o.getSelectedForma())&&e.isTypeLockup())return e.controller.styleController.getTextLookForUI()},o.setEffectForSelectedLockup=function(e){return o.getSelectedForma()?q(new l.SetTextLookAction(e)):t.resolve()},o.toggleFillOfSelectedLockup=function(e){if(o.getSelectedForma()&&o.getSelectedForma().isTypeLockup()){var t,n=o.getSelectedForma().controller.styleController;return t=e?l.LockupTextLook.OutlineOnly:n.targetedStrokeWeight>.12?l.LockupTextLook.FillAndOutline2:l.LockupTextLook.FillAndOutline,q(new l.SetTextLookAction(t))}},o.isLockupOutlineOnly=function(e){if((e=e||o.getSelectedForma())&&e.isTypeLockup())return e.controller.styleController.targetedLockupStyle.textLook===l.LockupTextLook.OutlineOnly},o.getStrokeWeightOfSelectedLockupForUI=function(e){if((e=e||o.getSelectedForma())&&e.isTypeLockup())return Math.round(e.controller.styleController.getStrokeWeightPercentForUI())},o.setStrokeWeightSelectedLockup=function(e,t){t=t||o.getSelectedForma();var n=function(e){return(e-1)/99}(e);return q(new l.SetTextEffectsAttributesAction(n,NaN,NaN))},o.getShadowOffsetOfSelectedLockupForUI=function(e){if((e=e||o.getSelectedForma())&&e.isTypeLockup())return Math.round(e.controller.styleController.getShadowOffsetPercentForUI())},o.setShadowOffsetOfSelectedLockup=function(e,t){t=t||o.getSelectedForma();var n=function(e){return(e-1)/99}(e);return q(new l.SetTextEffectsAttributesAction(NaN,n,NaN))},o.getShadowAngleOfSelectedLockup=function(e){if((e=e||o.getSelectedForma())&&e.isTypeLockup()){var t=e.controller.styleController.targetedShadowAngle;return t>180?t-360:t}},o.setShadowAngleOfSelectedLockup=function(e,t){return t=t||o.getSelectedForma(),e=e<0?e+360:e,q(new l.SetTextEffectsAttributesAction(NaN,NaN,e))},o.applyBackingToLockup=function(e,t,n){var r=o.getFormaById(n),i=e;if(9===e){var a=r.controller.size;i=a.width>a.height?9:8}return q(new l.ChangeBackgroundShapeAction([r],i,t,o.inCharStyleMode))},o.getShapeOfSelectedLockup=function(e){if((e=e||o.getSelectedForma())&&e.isTypeLockup()){var t=e.controller.styleController.targetedLockupStyle.backing;return 7===t?e.controller.styleController.targetedLockupStyle.backingArtworkID:t}},o.setLetterSpacingForSelectedLockup=function(e){var n=o.getSelectedForma();return n&&n.isTypeLockup()?q(new l.SetTrackingAction(e,O)):t.resolve(!1)},o.setCurrentPin=function(){if(O=l.TheoPoint.ZERO,o.getSelectedForma()&&o.getSelectedForma().isTypeLockup()){var e=o.getSelectedForma().controller.getPin(!0,!0);null!=e&&(O=e.pinPoint)}},o.setSpacingForSelectedLockup=function(e){var n=o.getSelectedForma();return n&&n.isTypeLockup()?q(new l.SetLeadingAction(e,O)):t.resolve(!1)},o.setPaddingForSelectedLockup=function(e){var n=o.getSelectedForma();return n&&n.isTypeLockup()?q(new l.SetPaddingAction(e,O)):t.resolve(!1)},o.getSpacingAndPaddingOfSelectedLockup=function(){var e=o.getSelectedForma();if(e&&e.isTypeLockup()){var t=e.controller.styleController,n=t.targetedLockupStyle.spacing,r=t.targetedLockupStyle.padding;return{spacing:"number"==typeof n?n:parseFloat(n),padding:"number"==typeof r?r:parseFloat(r)}}},o.getLetterSpacingSelectedLockup=function(){var e=o.getSelectedForma();if(e&&e.isTypeLockup())return e.controller.styleController.targetedLockupStyle.tracking},o.areSpacingAndPaddingAvailableForSelectedLockup=function(){var e=o.getSelectedForma();return!(!e||!e.isTypeLockup())&&e.controller.styleController.areSpacingAndPaddingOptionsAvailable()},o.isSpacingAvailableForSelectedLockup=function(){var e=o.getSelectedForma();return!(!e||!e.isTypeLockup())&&e.controller.styleController.hasSpacingOptions()},o.isPaddingAvailableForSelectedLockup=function(){var e=o.getSelectedForma();return!(!e||!e.isTypeLockup())&&e.controller.styleController.hasPaddingOptions()},o.setLayoutAndAlignmentForSelectedLockup=function(e,n,r){var i=o.getSelectedForma();return i&&i.isTypeLockup()&&i.formaID?(M++,q(new l.ChangeTextLayoutAndAlignmentAction(e,n,!1,r)).then((function(){M--}))):t.resolve(!1)},o.getSuggestedColorsForLockup=function(t){if((t=t||o.getSelectedForma())&&t.isTypeLockup()){var n=t.controller.styleController.getSuggestableColors();return e.map(n,(function(t){return e.map(t,(function(e){return{red:255*e.rgbColor.red,green:255*e.rgbColor.green,blue:255*e.rgbColor.blue,id:e.sparkElementID,roles:e.sparkRoles}}))}))}},o.getSuggestedColors=function(t){if(t=t||o.getSelectedForma()){var n=t.controller.getSuggestableColors();return e.map(n,(function(t){return e.map(t,(function(e){return{red:255*e.rgbColor.red,green:255*e.rgbColor.green,blue:255*e.rgbColor.blue,id:e.sparkElementID,roles:e.sparkRoles}}))}))}},o.getBrandKitColorsPalettesForSelectedLockup=function(t){if(!o.getSelectedForma()||!o.getSelectedForma().isTypeLockup()||!t)return{colors:[]};var n=l.TheoBrandkitUtils.getBrandkitColorsForUI(t,o.getSelectedForma()),r=e.map(n,(function(t){return e.map(t,(function(e){return{red:255*e.rgbColor.red,green:255*e.rgbColor.green,blue:255*e.rgbColor.blue,id:e.sparkElementID,roles:e.sparkRoles}}))}));return{name:t.name,id:t.id,colors:r}},o.createFormaFromSVG=function(e,t,n){var r=e.original.link,i=new XMLHttpRequest;i.open("GET",r,!0),i.onload=function(a){var s=i.responseText,u=l.SVGParserUtils.theoArtworkFromSVGData(s,!0);c.pathUtils.cacheArtworkForURL(r,u),o.canPan()&&!n&&o.fitToView(),ee(new l.AddIconContentAction(r,t,n),(function(t){var n="";if(!(t.formae&&t.formae.length&&t.formae[0]instanceof l.ShapeForma))throw new Error("AddIconContentAction did not return a shapeForma");{const e=t.formae[0];n=e.contentID,E.push(n);var r=o.beginTransaction("temp_svg_content_node_url");e.contentNode.url="uploading svg",o.suspendSave(),o.endTransactionAndMergeWithPrevious(r)}var i=new Blob([s],{type:e.mimeType});o.saveImageComponent(i,e.mimeType).then((function(e){var t={contentNodeID:n,url:e.encodedUrl,componentID:e.component.id};o.updateVectorContentNodeWithComponent(t)})).catch((function(e){o.resumeSave(),T.error("failed to upload SVG file",e)})).done()})).done()},i.onerror=function(){T.error("failed to download SVG icon file")},i.send()},o.getLayoutOfSelectedLockup=function(){var e=o.getSelectedForma();if(e&&e.isTypeLockup())return l.TextFacade.getLayoutForForma(e)},o.getAlignmentOfSelectedLockup=function(){var e=o.getSelectedForma();if(e&&e.isTypeLockup())return l.TextFacade.getAlignmentForForma(e)},o.getNextValidLetterGridAlignmentOfSelectedLockup=function(e){var t=o.getSelectedForma();return t&&t.isTypeLockup()?l.TextFacade.getNextValidGridAlignment(t,e):e},o.getNextValidPathOfSelectedLockup=function(e){var t=o.getSelectedForma();return t&&t.isTypeLockup()?l.TextFacade.getNextValidPathID(t,e):e},o.getNextValidAutoAlignmentOfSelectedLockup=function(e){var t=o.getSelectedForma();return t&&t.isTypeLockup()?l.TextFacade.getNextValidAutoAlignment(t,e):e},o.setSessionContainerSizeForSelectedLockup=function(){var e=o.getSelectedForma();e&&e.isTypeLockup()&&l.TextFacade.setSessionContainerSizeForForma(e)},o.getAllowedAlignmentStates=function(){var e=o.getSelectedForma();return e?e.controller.styleController.layoutSelector.values:[]},o.getUserFontSizesInDocument=function(){return l.TypeLockupUtils.sizesInDocument(m,void 0,!0).map(e=>l.TextFacade.toUserFontSize(e,m.firstPage))},o.getUserFontSizeOfSelectedForma=function(){var e,t=o.getSelectedForma();if(t&&t.isTypeLockup()){const n=t.controller.getCurrentFontSize();e=l.TextFacade.toUserFontSize(n,t.page)}return e},o.setFontSize=function(e){return q(new l.SetFontSizeAction(e))},o.getOpacitySliderValueOfSelectedForma=function(){var e=o.getSelectedForma();return e&&e.controller?l.OpacityFacade.getOpacityForForma(e):1},o.getSendForwardBackwardFormae=function(e){var t=m.controller.selection.asFormaArray();let n=t;if(t.length>1&&(n=l.LayerFacade.checkForContiguousChunk(e,t)),0===n.length)return[];for(var r=o.getNumLayers(),i=0;i<n.length;i++){var a=n[i];const t=a.controller.getZOrder();if(t<r+a.controller.getMinLayerIndex()-1&&("front"===e||"forward"===e))return n;if(t>a.controller.getMinLayerIndex()&&("back"===e||"backward"===e))return n}return[]},o.sendForwardBackward=function(e){var t=o.getSelectedForma(),n=o.getSendForwardBackwardFormae(e);return q(new l.SendForwardBackwardAction(e,n)).then((function(){o.updateLayers(t)}))},o.setLayerForSelectedForma=function(e){var t=o.getSelectedForma(),n=t.controller.getMinLayerIndex()+e;return q(new l.ChangeZOrderAction(n)).then((function(){o.updateLayers(t)}))},o.getLayerSliderValueOfSelectedForma=function(){var e=o.getSelectedForma();if(e)return"Root"===e.kind?0:e.controller.getZOrder()-e.controller.getMinLayerIndex()},o.getNumLayers=function(){var e=o.getSelectedForma();if(e)return e.controller.getReorderableLayerCount()},o.updateLayers=function(){o.events.publish("forma-layer-changed")},o.canSave=function(){return k},o.setColorForSelection=function(e){var t=o.getSelectedForma();if(t&&t.isTypeLockup())return o.setColorsForSelectedLockup(e,0,t);const n=function(e){if(!e)return!0;if(1===e.length&&e[0]&&"#NONE_COLOR"===e[0].id)return!0;return!1}(e)?null:V(e);return q(new l.ApplyColorAction(null,n))},o.addLogo=function(e){o.canPan()&&o.fitToView();var t=m.content.root.visit(t=>t instanceof l.URLBasedContentNode&&t.sparkElementID===e.id);return q(t?new l.AddContentAction(t):new l.AddLogoContentAction(m.firstPage,e,null,null,e.componentId))},o.addOrReplaceImage=function(n){T.info("adding image. is low res? "+String(n.isLowResImage));var r=n.replacementForma;if(null!=n.replacementFrame&&null==r.parent)for(var i=m.firstPage.root.filterByKind(l.FrameForma.KIND),a=0;a<i.length;a++)i[a].finalFrame.equalWithAccuracy(n.replacementFrame,.001)&&(r=i[a],T.info("matched by frame"));r&&r.isShape()&&r.controller.moveable&&(T.error("Assertion fail. We shouldn't be asking to replace a moveable shape (at this point)."),r=null),c.imageAnalysis.updateHostImageCacheKey(n.metadata.sourceURL,n.url);var s=t.defer();o.canPan()&&!r&&o.fitToView();var u=n.floatingImageStrategy||l.FloatingImageStrategy.IfHasAlphaOrIsLogo,d=new l.AddFormaParams(l.ControllerSettingsBehaviorEnum.IgnoreControllerSettings,!0,r,u);return ee(new l.AddImageContentAction(m.firstPage,n.url,n.mimeType,n.width,n.height,n.hasAlpha,n.metadata,null,null,d,l.ActionUndoability.useDefault,n.id,n.allowSelection),(function(t,r){if(r)s.reject(new o.ActionError(r));else{n.isLowResImage&&o.suspendSave();var i=o.getImageFormaForURL(n.url),a=i.parent.isBackgroundImage()?i.parent:i;n.formaId=a.formaID,n.contentNodeId=a.contentID,E.push(a.contentID),o.events.publish("forma-added",{id:a.contentID,isLowResImage:n.isLowResImage}),e.delay((function(){s.resolve(n)}),10)}})),s.promise},o.replaceImageWithHighRes=function(t){T.assert("string"==typeof t.contentNodeId,"can not patch content node with contentNodeId"),T.assert("string"==typeof t.lowResImageUrl,"can not patch content node without lowResImageUrl");x.push((function(){var n=m.content.nodeByID(t.contentNodeId);if(n&&n.url===t.lowResImageUrl){var i=l.Matrix2D.uniformScaling(t.width>t.height?n.pixelWidth/t.width:n.pixelHeight/t.height),a=!1;if(e.each(o.imageFormas(),(function(e){e.contentNode.id===t.contentNodeId&&(r.beginPatch(),n.mediaMetadata=t.metadata,n.url=t.url,n.pixelWidth=t.width,n.pixelHeight=t.height,n.mimeType=t.mimeType,n.hasAlpha=t.hasAlpha,c.imageAnalysis.updateHostImageCacheKey(t.lowResImageUrl,t.url),e.placement=i.concat(e.placement),e.invalidateCachedBounds(),a=!0,r.endPatch())})),!a)m.firstPage.formaByID(t.id)||(r.beginPatch(),n.mediaMetadata=t.metadata,n.url=t.url,n.pixelWidth=t.width,n.pixelHeight=t.height,n.mimeType=t.mimeType,n.hasAlpha=t.hasAlpha,c.imageAnalysis.updateHostImageCacheKey(t.lowResImageUrl,t.url),a=!0,r.endPatch())}}));var n=K();return o.resumeSave(),n},o.updateVectorContentNodeWithComponent=function(e){x.push((function(){var t=m.content.nodeByID(e.contentNodeID);t&&"uploading svg"===t.url&&"vector"===t.kind&&(r.beginPatch(),t.url=e.url,t.componentID=e.componentID,r.endPatch())}));var t=K();return o.resumeSave(),t},o.textLockupHighlight=function(){const e=o.beginTransaction("apply_lockup_highlight_box");var t=o.getSelectedForma();(new l.FormaCalloutUtils).applyLockupHighlightBox(t),o.endTransaction(e)},o.getStyleServiceMetaDataString=function(e){var t=null;if(null!=e){const{controller:n}=e,{text:o,size:{width:r,height:i}}=n,{tracking:a,spacing:c}=n.lockupStyle,{width:l,height:s}=e.page.pageSize,u=o.replace(/^\W+|\W+$/g,"").split(/\W+/g).length,d=n.numLines();t=`trng:${a},spng:${c},w:${Math.round(r)},h:${Math.round(i)},page_w:${Math.round(l)},page_h:${Math.round(s)},words:${u},lines:${d}`}return t},o.getCurrentDocumentSynthesizedName=function(){return m.getSynthesizedTitle()},o.getCurrentDocumentDescription=function(){return m.getSynthesizedDescription()},o.getDesignVariationsMetadata=function(){const e=m.firstPage.root;return{documentMetadata:{retargetDocumentData:l.RetargetCompatibilitySuggester.createRetargetDocumentData(e).encodeJson(),rootFrame:e.frame.encodeJson()}}},o.getGridForma=function(e){var t=m.firstPage.root.filterByControllerKind(l.GridController.KIND);return t.length>0?t[0]:e?m.firstPage.root.controller.createGridControllerIfNone().forma:null},o.getAllGridStyles=function(){var e=t.defer();return setTimeout((function(){try{var t=m.firstPage.layoutLibrary.getLayoutsForRoot(m.firstPage.root);e.resolve(t)}catch(t){e.reject(t)}}),0),e.promise},o.retrieveAndApplyASuggestedGridStyle=function(){var e=l.LayoutSuggester.createContentAwareSuggestions(m.firstPage.root);return e.length?o.applyGridStyle({name:e[0].name,gridStyle:e[0].gridStyle,silent:!1},0):t.resolve()},o.applyGridStyle=function(e,t){return o.canPan()&&o.fitToView(),q(new l.SetGridStyleAction(e.gridStyle,t))},o.inAutomaticLayoutMode=function(){return m.controller.inAutomaticLayoutInteractionMode},o.enableAutomaticLayoutMode=function(){m.controller.setAutomaticLayoutInteractionMode();var e=o.getGridForma();if(e){var t=o.beginTransaction("inferGridCellAssignment");e.controller.inferGridCellAssignment(),o.endTransactionAndMergeWithPrevious(t),e.style.moveableShift=!0}},o.disableAutomaticLayoutMode=function(){m.controller.setDefaultInteractionMode()},o.enterCharStyleMode=function(){var e=o.getSelectedForma();e&&e.isTypeLockup()&&(o.inCharStyleMode=!0,ee(new l.EnterCharStyleModeAction(e),(function(){ie(e),o.events.publish("enter-char-style-mode")})).done())},o.exitCharStyleMode=function(){if(o.inCharStyleMode){var e=o.getSelectedForma();e&&e.isTypeLockup()&&(o.inCharStyleMode=!1,ee(new l.ExitCharStyleModeAction(e),(function(){o.events.publish("text-forma-selected",{id:e.formaID,forma:e,selectionBoxes:[]}),o.events.publish("exit-char-style-mode")})).done())}},o.exitCharStyleModeAndSelect=function(){if(o.inCharStyleMode){var e=o.getAllSelectedFormas();0!==e.length&&e[0].isTypeLockup()&&(o.exitCharStyleMode(),o.deselect({silent:!0}),o.selectForma({forma:e[0]}),o.events.publish("forma-selected",{id:e[0].formaID,forma:e[0],selectionBox:H()}))}},o.toggleCharStyleLinesMethods=function(){var e=o.getSelectedForma();if(e&&e.isTypeLockup()){var t=e.controller;switch(t.highlightMethod){case l.HighlightMethod.EvenRows:t.highlightMethod=l.HighlightMethod.OddRows;break;case l.HighlightMethod.OddRows:t.highlightMethod=l.HighlightMethod.Bracket;break;case l.HighlightMethod.Bracket:t.highlightMethod=l.HighlightMethod.InsideBracket;break;default:t.highlightMethod=l.HighlightMethod.EvenRows}ae(t,e)}},o.toggleCharStyleWordsMethods=function(){var e=o.getSelectedForma();if(e&&e.isTypeLockup()){var t=e.controller;t.highlightMethod===l.HighlightMethod.EvenWords?t.highlightMethod=l.HighlightMethod.OddWords:t.highlightMethod=l.HighlightMethod.EvenWords,ae(t,e)}},o.clearStyleRanges=function(){var e=o.getSelectedForma();if(e&&e.isTypeLockup())return q(new l.SetHighlightMethodAction(l.HighlightMethod.Manual))},o.getLayoutMargin=function(){var e=o.getGridForma();return null!=e?e.controller.margin:0},o.getLayoutSpacing=function(){var e=o.getGridForma();return null!=e?e.controller.spacing:0},o.setLayoutSpacing=function(e){return q(new l.SetGridParametersAction(e,NaN))},o.setLayoutMargin=function(e){return q(new l.SetGridParametersAction(NaN,e))},o.setLayoutSpacingAndMargin=function(e,t){var n=NaN,o=NaN;return e>=0&&(n=e),t>=0&&(o=t),q(new l.SetGridParametersAction(n,o))},o.prepareForGridLayouts=function(){q(new l.EnterGridLayoutModeAction)},o.inVisibleGridLayout=function(){var e=o.getGridForma();return null!=e&&e.style.gridCells.length>1},o.spacingChangesVisible=function(){var e=o.getGridForma();return null!=e&&e.controller.spacingChangesVisible},o.allowFlip=function(e){return e.controller.flippable},o.allowDuplication=function(e){return e.controller.duplicatable},o.allowCrop=function(e){return l.ImageFacade.canCropImage(e)},o.allowSetForeground=function(e){return l.ImageFacade.canSetFloatingImage(e)},o.allowSetBackground=function(e){return l.ImageFacade.canSetBackgroundImage(e)},o.allowDeletion=function(e){for(var t=!0,n=0;n<e.length;n++)if(!e[n].controller.deleteable){t=!1;break}return t},o.hasImageAttribution=function(t){if((t=t||o.getSelectedForma()).hasIntent(l.Forma.INTENT_ICON)||t.isImage()&&!t.isLogo()){var n=o.getImageFormaAttributionInfo(t);if(e.isEmpty(n))return!1;var r=n.sourceName;if(r&&-1!==["unsplash","pixabay","flickr","adobe stock","the noun project","giphy"].indexOf(r.toLowerCase()))return!0}return!1},o.isIcon=function(e){return!!(e=e||o.getSelectedForma()).hasIntent(l.Forma.INTENT_ICON)},o.isGiphy=function(e){return o.getImageFormaAttributionInfo(e).sourceName===l.MediaMetadata.kMediaGiphySourceName},o.formaOpacityChangeable=function(){var e=o.getSelectedForma();return!!e&&e.controller.opacityChangeable},o.getFormaOpacity=function(){return o.getSelectedForma().style.opacity},o.setFormaOpacity=function(e){return q(new l.SetOpacityAction(e))},o.isFormaSwappable=function(e){return!!o.getGridForma()&&(e.controller&&!e.controller.moveable&&"Root"!==e.kind)},o.getSwappableForma=function(){for(var e=[],t=m.firstPage.root.visitAsArray(l.FormaTraversal.PreOrder),n=0;n<t.length;n++){var r=t[n];if(o.isFormaSwappable(r)){var i={forma:r,formaID:r.formaID};"Shape"===r.kind&&(i.type="shape",e.push(i)),"Frame"===r.kind&&(i.type="frame",e.push(i))}}return e},o.setSwapMode=function(e,t){p=e;var n=o.getSelectedForma();if(n&&"Frame"===n.kind){var r=n.childAt(0);!p&&t&&f&&(T.info("disable swap mode ",f),r.placement=f,f=null)}},o.getPointInDocumentSpace=function(e,t){var n=o.getDocumentSize(),r=n.width*e,i=n.height*t;return new l.TheoPoint(r,i)},o.getDesignHeight=function(){return o.getSelectedForma().root.finalFrame.height},o.getDocumentMetadataEvents=function(){return l.TheoDocumentUtils.getMetadataEvents(m,!1)},o.getMaxGridCells=function(){return l.GridController.MAX_CELL_COUNT},o.setPersistSave=function(e){return(D=e).initialize()},o.whenInitialized=function(){return A},o.updateColorInTheme=function(e,t){var n=d.solidColor2TheoColor(d.hex2SolidColor(e.color),e.id,e.roles),o=d.solidColor2TheoColor(d.hex2SolidColor(t.color),t.id,t.roles),r=m.firstPage.colorLibraryController.getKeyOfColorInTheme(n);return q(new l.ModifyColorThemeAction(o,r))},o.isSparkColorInUse=function(e){return m.firstPage.colorLibraryController.isSparkColorInUse(e)},o.updateSparkColor=function(e){if(m.firstPage.colorLibraryController.isSparkColorInUse(e.sparkElementID)){const t=o.beginTransaction("update_spark_color");m.firstPage.colorLibraryController.updateSparkColor(e),o.endTransaction(t)}return t.resolve()},o.areSparkFontsInUse=function(e){return l.TheoBrandkitUtils.areSparkFontsInUse(m,e)},o.updateSparkFont=function(e){if(l.TheoBrandkitUtils.areSparkFontsInUse(m,[e.id])){const t=o.beginTransaction("update_spark_font");l.TheoBrandkitUtils.updateSparkFont(m,e),o.endTransaction(t)}return t.resolve()},o.relinkSparkFont=function(e,n){if(l.TheoBrandkitUtils.areSparkFontsInUse(m,[e])){const t=o.beginTransaction("relink_spark_font");l.TheoBrandkitUtils.relinkSparkFont(m,e,n),o.endTransaction(t)}return t.resolve()},o.areSparkLogosInUse=function(e){return l.TheoBrandkitUtils.areSparkLogosInUse(m,e)},o.updateSparkLogo=function(e){if(l.TheoBrandkitUtils.areSparkLogosInUse(m,[e.id])){const t=o.beginTransaction("update_spark_logo");l.TheoBrandkitUtils.updateSparkLogo(m,e),o.endTransaction(t)}return t.resolve()},o.relinkSparkLogo=function(e,n){if(l.TheoBrandkitUtils.areSparkLogosInUse(m,e)){const t=o.beginTransaction("relink_spark_logo");l.TheoBrandkitUtils.relinkSparkLogo(m,e,n),o.endTransaction(t)}return t.resolve()},o.brandDocument=function(e){o.canPan()&&o.fitToView();var t=e.fonts&&e.fonts.length,n=e.logos&&e.logos.length,r=e.colors&&e.colors.length;return q(new l.BrandifyAction(e,t,n,r))},o.changeBranding=function(e){const t=m.authoringContextID,n=l.MultiBrandFacade.activeBrandkitID;return q(new l.ChangeBrandingAction(e,t,n))},o.handleCurrentBrandChanged=function(e){o.events.publish("current-brand-changed",e)},o.addBranding=function(e){return c.setCoreWrapper(this),q(new l.AddBrandingAction(e))},o.stripBranding=function(){return q(new l.RemoveBrandingAction)},o.getBrandedElementsUsage=function(){return l.TheoBrandkitUtils.getDocumentBrandedElementsUsage(m,!0,!1)},o.includesUploadedFonts=function(){return o.getBrandedElementsUsage().indexOf(l.TheoBrandkitUtils.kBrandUsageCustomFont)>-1},o.getFontsUsed=function(){return l.TheoDocumentUtils.getFontsUsed(m)},o.getDocFontSourceUsage=function(){return l.TheoDocumentUtils.getFontSourceUsage(m)},o.getWatermarkEnabledForDoc=function(){return m?!("watermarkEnabled"in m)||m.watermarkEnabled:(T.error("Attempting to set watermarkEnabled with no document loaded."),!1)},o.setWatermarkEnabledForDoc=function(e){m?q(new l.SetWatermarkAction(e)).done():T.error("Attempting to set watermarkEnabled with no document loaded.")},o.getImageFormaAttributionInfo=function(e){return e&&(t=e.kind===l.ImageForma.KIND||e.hasIntent(l.Forma.INTENT_ICON)?e.contentNode:e.childAt(0).contentNode)&&t.mediaMetadata||{};var t},o.setAuthoringContextThemeId=function(e){const t=o.beginTransaction("set branded template ID");m.authoringContextThemeID=e,o.endTransactionAndMergeWithPrevious(t)},o.getAuthoringContextThemeId=function(){return m.authoringContextThemeID},o.updateConstrainedImages=function(){l.TheoDocumentUtils.updateConstrainedImageInfo(m)},o.getConstrainedImages=function(){return m.constrainedImages},o.getHighlightMethodEnum=function(){return l.HighlightMethod},o.synthesizeEmptyImages=function(){m.content.root.visitAll((function(e){if("image"===e.kind&&null==e.url){var t=document.createElement("canvas"),n=t.getContext("2d");t.width=e.pixelWidth,t.height=e.pixelHeight;var o=n.createLinearGradient(0,0,t.width,t.height),r=e.imageColorData;r.sort((function(e,t){return e.coverage<t.coverage?1:e.coverage>t.coverage?-1:0})),r.length>1?(o.addColorStop(0,"#"+r[0].rgbColor.hex.substring(0,6)),o.addColorStop(1,"#"+r[1].rgbColor.hex.substring(0,6))):(o.addColorStop(0,"#000"),o.addColorStop(1,"#fff")),n.fillStyle=o,n.fillRect(0,0,t.width,t.height),e.componentID=l.GUIDUtils.makeGUID(),e.url=t.toDataURL()}}))},o.setRemixParentCpId=function(e){m.setRemixParentCpId(e)},o.getRemixParentsCpIds=function(){return m.remixAncestorsCpAssetIDs},o.getRemixAncestorsIntoMachineTags=function(e){return S.getRemixAncestorsIntoMachineTags(e,m)},o.getEditorModelColorSelection=function(){var e=m.controller.model.attributes.find(l.ColorAttribute.KEY);return e?e.colors:[]},o.handlePointerChanged=function(e){var t=new l.TheoPoint(e.x,e.y),n="touch"===e.pointerType?1:0,o=c.async.getSystemUptimeInSeconds(),r=new l.PointerUpdate(""+e.pointerId,n,m.firstPage,t,o);r.tapCount=e.tapCount,r.modifierKeys=e.modifierKeys,"pointerDown"===e.updateType?m.controller.pointers.onPointersDown([r]):"pointerMove"===e.updateType?m.controller.pointers.onPointersMoved([r]):"pointerUp"===e.updateType&&m.controller.pointers.onPointersUp([r])},o.getZoomLevels=function(e){if(!0===e){var t=[8,6,4,3,2,1.5,1.25,1,.75,.5,.33,.25,.16,.1];const e=o.getFitScale();-1===t.indexOf(e)&&t.push(e);const n=o.getFillScale();return-1===t.indexOf(n)&&t.push(n),t.sort((function(e,t){return t-e})),t}return[4,2,1.5,1,.75,.5,.25,.1]},o.getMinZoom=function(){return o.getZoomLevels(!0).pop()},o.getMaxZoom=function(){return o.getZoomLevels(!0).shift()},o.getNextZoomLevel=function(e){const t=m.controller.model.view.getScale(),n=o.getZoomLevels(!0),r=n.length;var i;var a=t;if(e){const e=o.getMaxZoom();if(t>=e)return e;for(i=r-1;i>=0;i--){const e=n[i];if(e>t+.05||0==i){a=e;break}}}else{const e=o.getMinZoom();if(t<=e)return e;for(i=0;i<r;i++){const e=n[i];if(e<t-.05||i==r-1){a=e;break}}}return a},o.getFit=function(){return m.controller.model.view.getFit()},o.getFill=function(){return m.controller.model.view.getFill()},o.getFitScale=function(){return m.controller.designController.view.getFitScale()},o.getFillScale=function(){return m.controller.designController.view.getFillScale()},o.getViewScale=function(){return m.controller.model.view.getScale()},o.getViewSize=function(){return m.controller.model.view.getViewSize()},o.getMargin=function(){return m.controller.model.view.getMargin()},o.getViewToDocMatrix=function(){return m.controller.designController.view.getViewToDocMatrix()},o.getFullCanvasGraph=function(e,t){void 0===t&&(t=o.getWatermarkEnabledForDoc());return m.controller.designController.view.getFullCanvasGraph(e,t)},o.setViewSize=function(e){m.controller.designController.view.setViewSize(e)},o.fitToView=function(){m.controller.designController.view.fitToView()},o.fillToView=function(){m.controller.designController.view.fillToView()},o.zoomTo=function(e){const t=m.controller.designController.view,n=Math.max(Math.min(e,o.getMaxZoom()),o.getMinZoom());t.zoomTo(n)},o.zoomToPoint=function(e,t,n){const r=m.controller.designController.view,i=Math.max(Math.min(e,o.getMaxZoom()),o.getMinZoom());r.zoomToPoint(i,t,n)},o.canPan=function(){return m.controller.designController.view.canPan()},o.panBy=function(e){m.controller.designController.view.panBy(e)},o.getGroupFeatures=function(){var e=m.controller.model.featureSets.find(l.FormaEditFeature.KEY);return{canGroup:e&&e.canGroup,canUngroup:e&&e.canUngroup}},o.getSettableFeatures=function(){var e={},t=m.controller.model.featureSets.find(l.AlignSpacingAttributesFeature.KEY);e.canAlign=t&&t.canAlign,e.canDistribute=t&&t.canDistribute;var n=m.controller.model.featureSets.find(l.OpacityAttributesFeature.KEY);e.opacity=!!n;var o=m.controller.model.featureSets.find(l.ImageFeature.KEY);return e.imageFilter=!!o&&o.canApplyFilter,e},o.getAlignmentTypes=function(){return l.AlignmentType},o.getDistributeTypes=function(){return l.DistributeType},o.setOpacityForSelectedFormae=function(e){return q(new l.SetOpacityAction(e))},o.getOpacityValuesForSelectedFormae=function(){return m.controller.model.attributes.find(l.OpacityAttribute.KEY).opacities},o.setAlignmentForSelectedFormae=function(e){return q(new l.AlignFormaeAction(e))},o.distributeSelectedFormae=function(e){return q(new l.DistributeFormaeAction(e))},o.animate=function(){o.events.publish("animate")},o.downloadAnimation=function(){o.events.publish("download-animation")},o.beginTransaction=function(e){if(e)return F.beginTransaction(m,e);T.error("no name provided for transaction.")},o.endTransactionAndMergeWithPrevious=function(e){F.endTransaction(e,!0)},o.endTransaction=function(e){F.endTransaction(e,!1)},o.containsBrandedContent=function(){return l.BrandingFacade.doesDocumentContainBrandedElements(m,!1)},o.updateCharStyleRanges=function(e,t,n){const r=o.getSelectedForma();if(r)return l.TextFacade.adjustCharStyleRanges(r,e,t,n);T.warn("updateCharStyleRanges called when there is no selection?")},o.missingFontListInDoc=function(){return m.missingFontList},o.setCPProjectID=function(e){if(m){const t=o.beginTransaction("setCPProjectID");m.publishedResourcePath=e,o.endTransactionAndMergeWithPrevious(t)}},o.setCommunityPlatformAlias=function(e){if(m){const t=o.beginTransaction("setCommunityPlatformAlias");m.communityPlatformAlias=e,o.endTransactionAndMergeWithPrevious(t)}},o.setCommunityPlatformAssetID=function(e){if(m){const t=o.beginTransaction("setCommunityPlatformAssetID");m.communityPlatformAssetID=e,o.endTransactionAndMergeWithPrevious(t)}},o.setPublishedEtag=function(e){if(m){const t=o.beginTransaction("setPublishedEtag");m.publishedEtag=e,o.endTransactionAndMergeWithPrevious(t)}},o.updatePublishData=function(e){const{cPProjectID:t,cPAlias:n,cPAssetID:r,cPublishedEtag:i}=e;if(m){const e=o.beginTransaction("updatePublishData");m.publishedResourcePath=t,m.communityPlatformAlias=n,m.communityPlatformAssetID=r,m.publishedEtag=i,o.endTransactionAndMergeWithPrevious(e)}},o.getIsExported=function(){return m?m.isExported:null},o.setIsExported=function(e){if(m){const t=o.beginTransaction("setIsExported");m.isExported=e,o.endTransactionAndMergeWithPrevious(t)}},o.getDisplayableAnimationStyles=function(){return l.AnimationLibrary.getDisplayableAnimationStyles(m.firstPage.root)},o.hasAnimationStyle=function(){const e=m.firstPage.animationController.animationStyle;return null!==e&&e.name!==l.AnimationStyle.NAME_NO_STYLE},o.getCurrentAnimationStyle=function(){return m.firstPage.animationController.animationStyle},o.getCoreAnimationStyle=function(){return l.AnimationStyle},o.setAnimationStyle=function(e,n){const r=m.firstPage.animationLibrary.getAnimationStyle(e);if(r){if(n>0){var i=r.clone();return i.variant=n,o.applyAnimationStyleAction(i)}return o.applyAnimationStyleAction(r)}return t.reject()},o.applyAnimationStyleAction=function(e){return q(new l.ApplyAnimationStyleAction(e,m.firstPage))},o.removeContentForCorruptImageFrame=function(e){const t=m.content.root.nodeByID(e);if(ce(t)){const e=o.beginTransaction("removeCorruptContentNode");t.parent&&t.parent.removeChild(t),t.releaseResources(),o.endTransactionAndMergeWithPrevious(e)}},o.replaceCorruptImageFrames=function(){const e=[];let t;m.content.root.visitAll(n=>{ce(n)&&(t||(t=o.beginTransaction("removeCorruptContentNodes")),e.push(n.id),n.parent&&n.parent.removeChild(n),n.releaseResources())});const n=e.length>0;if(0===e.length)return n;const r=o.imageFormas().filter(t=>e.indexOf(t.contentID)>=0);if(r.length){const e=d.solidColor2TheoColor(d.hex2SolidColor("FF0000"),null,null);l.ImageFacade.replaceImagesWithColors(r,[e])}return t&&(t=o.endTransactionAndMergeWithPrevious(t)),n},o.willCloseDocument=function(){m.willCloseDocument()},o.requestSave=function(e,t){e=!!e,t=!!t,m.controller.saveMgr.requestSave(e,t)},o.triggerPlatformSave=function(e){var t=new l.DeferredPromise;return o.events.publish("trigger-save",{coreDeferred:t,stateID:e}),t.promise},o.cancelPendingSaves=function(){m.controller.saveMgr.cancelPendingSave()},o.executePendingSaves=function(){m.controller.saveMgr.flushPendingSave()},o.suspendSave=function(){m.controller.saveMgr.suspend()},o.resumeSave=function(){m.controller.saveMgr.resume()},o.saveManager=function(){return m.controller.saveMgr},o.triggerAssert=function(e){l.LegacyCoreAssert.fail(e)},o.removeImageBackground=function(){return o.setImageCutout(o.getSelectedForma(),new l.CutoutStyle(l.CutoutMode.BackgroundRemoval))},o.restoreImageBackground=function(){return o.setImageCutout(o.getSelectedForma(),new l.CutoutStyle(l.CutoutMode.Off))},o.getLockupAlignments=function(){return l.LockupAlignment},o.getLockupLayouts=function(){return l.LockupLayout},o.getTextPathIDs=function(){return l.TextPathID},o.getSelectedFormaScaleAsScalar=function(){const e=o.getSelectedFormaScale(),t=o.getSelectedFormaScaleRange(),n=t.max-t.min;return(e-t.min)/n},o.setSelectedFormaScaleAsScalar=function(e){let t=o.getSelectedForma();"Frame"!==t.kind||t.controller.moveable&&!o.inCropMode()||(t=t.childAt(0));const n=o.getSelectedFormaScaleRange(),r=n.max-n.min,i=(n.min+e*r)/t.placement.extractedScale.scale.x;return q(new l.ScaleAction(i,[t]))},o.getSelectedFormaRotationAsScalar=function(){return(((o.getSelectedFormaRotation()+179)%360+360)%360+1)/360},o.setSelectedFormaRotationAsScalar=function(e){const n=o.getSelectedForma(),r=360*(e-.5)*Math.PI/180,i=o.getSelectedFormaPlacement(),a=i&&i.placement;if(!a)return l.LegacyCoreAssert.fail("Trying to rotate image, but could not get current placement of image"),t.resolve();const c=r-re(a),s=U||a;return q(new l.RotateAction(c,s,[n],!0))},o.getOpacityValueOfSelectedFormaAsScalar=function(){var e=o.getSelectedForma();return e&&e.controller?l.OpacityFacade.getOpacityForForma(e):1},o.setOpacityValueOfSelectedFormaAsScalar=function(e){return o.setOpacityForSelectedFormae(e)},o.getSelectedFormaLetterSpacingAsScalar=function(){return o.getLetterSpacingSelectedLockup()||0},o.setSelectedFormaLetterSpacingAsScalar=function(e){return o.setLetterSpacingForSelectedLockup(e)},o.getSelectedFormaLineHeightAsScalar=function(){return o.getSpacingAndPaddingOfSelectedLockup().spacing},o.setSelectedFormaLineHeightAsScalar=function(e){return o.setSpacingForSelectedLockup(e)},o.getSelectedFormaShapePaddingAsScalar=function(){return o.getSpacingAndPaddingOfSelectedLockup().padding},o.setSelectedFormaShapePaddingAsScalar=function(e){return o.setPaddingForSelectedLockup(e)},o.getSelectedFormaShadowDistanceAsScalar=function(){return le(o.getShadowOffsetOfSelectedLockupForUI(),{min:1,max:100},{min:0,max:1})},o.setSelectedFormaShadowDistanceAsScalar=function(e){const t=le(e,{min:0,max:1},{min:1,max:100});return o.setShadowOffsetOfSelectedLockup(t)},o.getSelectedFormaShadowAngleAsScalar=function(){return le(o.getShadowAngleOfSelectedLockup(),{min:-179,max:180},{min:0,max:1})},o.setSelectedFormaShadowAngleAsScalar=function(e){const t=le(e,{min:0,max:1},{min:-179,max:180});return o.setShadowAngleOfSelectedLockup(t)},o.getSelectedFormaOutlineThicknessAsScalar=function(){return le(o.getStrokeWeightOfSelectedLockupForUI(),{min:1,max:100},{min:0,max:1})},o.setSelectedFormaOutlineThicknessAsScalar=function(e){const t=le(e,{min:0,max:1},{min:1,max:100});return o.setStrokeWeightSelectedLockup(t)},o.getSelectedFormaImageAdjustmentsAsScalars=function(){const e=o.getImageAdjustments(),t={min:-100,max:100},n={min:0,max:100},r={min:0,max:1};return{blur:le(e.blur,n,r),sharpness:le(e.sharpness,n,r),contrast:le(e.contrast,t,r),saturation:le(e.saturation,t,r),brightness:le(e.brightness,t,r),shadows:le(e.shadows,t,r),highlights:le(e.highlights,t,r),warmth:le(e.warmth,t,r)}},o.setSelectedFormaImageAdjustmentAsScalar=function(e,t){let n={min:-100,max:100};"sharpness"!==e&&"blur"!==e||(n={min:0,max:100});const r=le(t,{min:0,max:1},n),i={};return i[e]=r,o.changeImageAdjustments(i)},o.getMinFontSize=function(){var e=l.TextFacade.getStandardFontSizes(),t=o.getUserFontSizesInDocument(),n=l.TextFacade.getMinimumFontSize();return Math.min(...t,...e,n)},o.getMaxFontSize=function(){var e=l.TextFacade.getStandardFontSizes(),t=o.getUserFontSizesInDocument(),n=l.TextFacade.getMaximumFontSize();return Math.max(...t,...e,n)},function(){P=n.persistSource||s.fromDocument(n.dcxDoc),D=n.persistSave||u.toDocument(n.dcxDoc);var t=!1;A=P.open().then((function(e){return(t=e.hadMissingFontsWhenOpened)?I.loadMissingFonts(e.missingFontList):e})).then((function(e){return t?P.open():e})).then((function(e){return t=e.hadMissingFontsWhenOpened,m=e,o.suspendSave(),m.controller.selection.subscribeWithCallback(te,l.SelectionStateChangedMessage.TYPE),D.initialize()})).then((function(){const t=o.beginTransaction("create-grid-controller");return m.firstPage.root.controller.createGridControllerIfNone(),o.endTransactionAndMergeWithPrevious(t),r=m.controller.undoRedoMgr,m.controller.designControllerHandlesPointers=!0,m.controller.enableMoveableChildren=!0,r.subscribeWithCallback((function(e){if(e.changeType===l.UndoRedoMessage.UNDO_REDO_GESTURE_BEGIN?y.disableCustomKeyboardShortcuts=!0:e.changeType===l.UndoRedoMessage.UNDO_REDO_GESTURE_END&&(y.disableCustomKeyboardShortcuts=!1),e.changeType===l.UndoRedoMessage.UNDO_REDO_CHANGE||e.changeType===l.UndoRedoMessage.UNDO_REDO_STATE_CLEAN){if(!r.gestureScope){oe();var t=o.getSelectedForma(),n=o.getSelectedFormaId();n&&(o.inCharStyleMode&&t.isTypeLockup()?(t.controller.selectCharStyleForma(),ie(t)):(o.exitCharStyleMode(),o.events.publish("forma-selected",{id:n,forma:t,selectionBox:H()}))),l.MultiBrandFacade.handleUndoRedoMessage(e),o.events.publish("undo-redo-state-changed",{changeType:e.changeType}),W()}}else"state-updated"===e.changeType?oe(!1):"timeline-changed"===e.changeType&&o.events.publish("undo-redo-state-changed",{changeType:e.changeType})}),l.UndoRedoMessage.TYPE),r.registerPatch((function(t){e.each(x,(function(e){e()})),t()})),o.events.publish("undo-redo-state-changed"),k=!0,W(),!0}))}(),o}}.apply(t,o))||(e.exports=r)},"6lgp":function(e,t,n){"use strict";n.r(t),n.d(t,"ActionError",(function(){return o}));class o extends Error{constructor(...e){var t,n,o;super(...e),o=!1,(n="isAllowedError")in(t=this)?Object.defineProperty(t,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[n]=o}}t.default=o},"7the":function(e,t,n){var o,r;o=[n("xeH2"),n("YLtl"),n("UFvF"),n("MOGj"),n("a8ov")],void 0===(r=function(e,t,n,o,r){var i=r.default,a={},c=window.location.protocol+"//"+window.location.host;return a.loadFile=function(e,t){var r=n.defer();return o.dcxService.invoke("GET",c+i.decodeUrl(e),{},null,t,(function(e,t){e?r.reject(e):r.resolve(t.response)})),r.promise},a}.apply(t,o))||(e.exports=r)},"8VGm":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return p}));var o=n("UzQk"),r=n("UFvF"),i=n.n(r),a=n("14LO"),c=n("b3Wv"),l=n.n(c),s=n("MGCh"),u=n.n(s),d=n("a8ov");function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const g=u.a.channel("SourceCPAsset");class p{constructor(e){m(this,"assetId",void 0),m(this,"cpServiceDomain",void 0),this.assetId=e.assetId,this.cpServiceDomain=e.cpServiceDomain}documentId(){return this.assetId}open(){return i()(this.openAsync())}async openAsync(){const e=await l.a.loadComposite(this.assetId,this.cpServiceDomain);e.name="";const t=new a.DCXDocumentComposite({composite:e,componentURLfn:e=>d.default.encodeCPUrl(this.assetId,e.absolutePath),overrideIDfn:e=>o.GUIDUtils.makeGUID()}),n=t.current;if(o.DocumentPersistenceFactory.usesJsonDocumentEncoding(n)){const e=o.JSONDocumentDecoder.getRequiredSynchronousComponents(n);await Promise.all(e.map(async e=>{const t=d.default.encodeCPUrl(this.assetId,e),o=await l.a.loadFile(t,{}),r=JSON.parse(o);n.registerContentForComponent(e,r)}))}let r;try{r=o.TheoDocument.decodeDocument(t,e=>{throw n.releaseRegisteredContent(),new Error(e.join(";"))}),o.TheoDocumentUtils.createImageFeatures(r),n.releaseRegisteredContent()}catch(e){throw g.error("decoding from CP",e),r=o.TheoDocument.createDefault(),e}return r.history.postEntry("open,src=CP,was-vers="+r.versionDecoded.rawValue),r}}},FGv1:function(e,t,n){"use strict";n.r(t),n.d(t,"DCXDocumentComponentDeferred",(function(){return a}));var o=n("1tmr"),r=n("UzQk"),i=n("nNj6");class a extends o.a{constructor(e,t,n){var o,r,i;super(e,t),i=void 0,(r="params")in(o=this)?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i,this.params=n}attachToNode(){}detachFromNode(){}get absolutePath(){return""}get componentId(){return this.params.componentId||""}get content(){return this.params.content||""}get name(){return this.params.name}get path(){return this.params.path}get type(){return this.params.type}get etag(){return""}get relationship(){return this.params.relationship}get sourceHref(){return this.params.sourceHref}get mutableCopy(){return new a(this.branch,this.node,this.params)}setValue(e,t){}replaceWithReal(e){if(!e||!e.etag)return r.LegacyCoreAssert.fail("replaceWithReal: you need to pass an AdobeDCXComponent"),null;const t=new i.a(this.branch,this.node,e);return this.update(t),t}}},KpqY:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return c}));var o=n("UzQk"),r=n("6lgp"),i=n("UFvF"),a=n.n(i);class c{static doAction(e,t){return c.doActionWithCompletion(e,t)}static doActionWithCompletion(e,t,n){if(!e||!e.controller)return a.a.reject("No document or controller");const i=a.a.defer();return e.controller.doActionWithCompletion(t,(e,t)=>{if(n)try{n(e,t)}catch(e){t||(t=e)}if(t){if(!(t instanceof r.default)){const e=t instanceof o.CoreErrorObject&&t.isAllowedError;(t=new r.default(t)).isAllowedError=e}i.reject(t)}else i.resolve(e)}),i.promise}static beginTransaction(e,t){return e.beginTransaction(t)}static endTransaction(e,t){t?e.mergeWithPrevious():e.end()}}},LI3u:function(e,t,n){var o,r=n("MOGj"),i=n("YLtl"),a=n("MGCh").channel("ManifestEncoder");function c(e,t){for(var n=0;n<e.length;n++){var o=e[n];if(o.id===t)return o}}(o=function(e,t){if(this.config=i.extend({},e),this.branch=e.branch,this.rootNode=e.rootNode||this.branch.rootNode,this.node=t||this.rootNode,this.componentBranch=e.componentBranch||this.branch,this.componentRootNode=e.componentRootNode||this.componentBranch.rootNode,this.componentNode=e.componentNode||this.node,this.isRoot=this.node==this.rootNode,this._nodes=[],this._components=[],this._stashedComponents=[],this.isRoot){var n=this.componentBranch.getComponentsOf(this.componentRootNode),o=function e(t,n,o){if(!n)return t.allComponents();o=o||[];var r=t.getComponentsOf(n);return r&&r.length>0&&(o=o.concat(r)),t.getChildrenOf(n).forEach((function(n){o=e(t,n,o)})),o}(this.componentBranch,this.componentRootNode);a.info(`stashing: begin (${o.length} components, ${o.length-n.length} not at root)`);for(var r=0;r<o.length;r++){var l=o[r];if(!c(n,l.id)){this._stashedComponents.push(l),a.info(`stashing: moving component ${l.id} to node ${this.componentRootNode.absolutePath}`);try{this.componentBranch.moveComponent(l,this.componentRootNode)}catch(e){e&&e.message.indexOf("Component not found in this branch.")>=0?this._stashedComponents.pop():a.warn(e)}}}a.info("stashing: complete"),this.config.stashedComponents=this._stashedComponents;var s=this.branch.getChildrenOf(this.node);for(a.info(`removing all ${s.length} root nodes`),r=0;r<s.length;r++){var u=s[r];this.branch.removeChild(u)}}else this._stashedComponents=this.config.stashedComponents})._implements=function(e){return"IExportDataObject"==e},o.prototype=Object.create(Object.prototype,{_implements:{value:function(e){return"IExportDataObject"===e}},setName:{value:function(e){this.node?this.node.name=e:this.branch.name=e}},setType:{value:function(e){this.node.setValue("type",e)}},setPath:{value:function(e){this.node.setValue("path",e)}},setProperty:{value:function(e,t){e.indexOf("#")<0&&(e="theo#"+e),this.node.setValue(e,t)}},setOptionalStringProperty:{value:function(e,t){t&&this.setProperty(e,t)}},setStringProperty:{value:function(e,t){this.setProperty(e,t)}},setNumberProperty:{value:function(e,t){this.setProperty(e,t)}},setIntProperty:{value:function(e,t){this.setProperty(e,t)}},setBooleanProperty:{value:function(e,t){this.setProperty(e,t)}},setOptionalBooleanProperty:{value:function(e,t){this.setProperty(e,t)}},appendChild:{value:function(e){var t=(new r.AdobeDCXBranch).addChild(null,e),n=new o(this.config,t);return this._nodes.push(n),n}},appendComponent:{value:function(e,t,n){var o={id:e,url:t,mimeType:n,confirmed:!0};this._components.push(o)}},setManifestProperty:{value:function(e,t){this.setProperty(e,t)}},setDocumentSize:{value:function(e,t){}},setCompositeID:{value:function(e){}},prepareForAttachment:{value:function(){}},finalizeAfterAttachment:{value:function(e){this.isRoot&&a.info("unstashing: begin");for(var t=0;t<this._components.length;t++){var n=this._components[t];a.assert(n.id,"finalizeAfterAttachment: A recorded component has no ID.");var o=c(this._stashedComponents,n.id),r=!1;if(this.config.finalizingComponent&&(r=this.config.finalizingComponent(e,n)),o)if(this.componentNode==this.componentRootNode);else try{var i=this.node==this.componentNode?e:this.componentNode;a.info(`unstashing: moving stashed component ${o.id} to node ${i.absolutePath}`),this.componentBranch.moveComponent(o,i)}catch(e){a.warn("moveComponent to node failed: "+e)}else a.assert(r,"finalizeAfterAttachment: no existing component, and finalizingComponent not provided or did not indicate that's OK.")}for(t=0;t<this._nodes.length;t++){var l=this._nodes[t];l.prepareForAttachment();try{var s=l.node,u=this.branch.copyChild(s,e||this.node,t,s.path,s.id);l.finalizeAfterAttachment(u)}catch(e){a.warn("addChild to node failed: "+e)}}if(this.isRoot){a.info("unstashing: complete");var d=this.componentBranch.getComponentsOf(this.componentRootNode);for(t=0;t<this._stashedComponents.length;t++){var m=c(d,(n=this._stashedComponents[t]).id);m&&(a.info("dumping unused component "+m.path),this.config.removeUnusedComponent?this.config.removeUnusedComponent(n,m):this.componentBranch.removeComponent(m))}}}}}),o.prototype.constructor=o,e.exports=o},WpJZ:function(e,t,n){"use strict";n.r(t),n.d(t,"getLockupStyleStringWithRole",(function(){return i})),n.d(t,"getAllStringForFormaUsedWheelSuggestions",(function(){return a})),n.d(t,"getUnreportedNounProjectIds",(function(){return c})),n.d(t,"setNounProjectIdsReported",(function(){return l}));var o=n("UzQk"),r=n("KpqY");function i(e,t){let n="";const r=e&&e.style;if(!r||!r.wheelUsed)return n;n=r.getCompressedStringOfFeatures();return n=`${n}{role:${(new o.RoleSuggester).getRole(e).role}|id:${e.formaID}|docId:${t.uuid}}`,n}function a(e){return e.firstPage.root.filterByControllerKind(o.TypeLockupController.KIND).map(t=>i(t,e)).filter(e=>e.length>0)}function c(e){return o.TheoDocumentUtils.getUnreportedUsedIcons(e)||[]}function l(e,t){if(!t)return;const n=r.default.beginTransaction(t,"setNounProjectIdsReported");o.TheoDocumentUtils.reportedIconUsage(t,e),r.default.endTransaction(n,!0)}},b2xK:function(e,t,n){var o,r;o=[n("YLtl"),n("UFvF")],void 0===(r=function(e,t){var n=function(e){e=e||{};var n={initialize:function(){return t.resolve(!0)},saveWithRenditions:function(e,n,o,r){return t.resolve(!0)},saveImageComponent:async function(e){let t=e;if(!(e instanceof Blob)&&e.assetId){const n=await window.fetch(e.assetId);t=await n.blob()}const n=(window.URL||window.webkitURL).createObjectURL(t);return Promise.resolve({component:{id:"d34f9c8e-7789-4909-a810-7c9937cdce9e"},encodedUrl:n})},documentId:function(){return null}};return n};return n.toBlackHole=function(){return new n({})},n}.apply(t,o))||(e.exports=r)},b3Wv:function(e,t,n){var o,r;o=[n("xeH2"),n("YLtl"),n("UFvF"),n("MOGj"),n("a8ov")],void 0===(r=function(e,t,n,o,r){var i,a,c=r.default,l={},s=window.location.protocol+"//"+window.location.host,u=s+"/api/post/v1/cp/";function d(){!i&&o.dcx&&(i=o.dcx.createHTTPService()),!a&&o.dcx&&(a=o.dcx.createCommunitySession(i,u))}return d(),l.loadComposite=function(e,t){var r=n.defer(),i=`${u}${t?`host/${t}/`:""}dcx/${e}/`,c=o.dcx.newCompositeWithAssetId(i);return d(),o.dcx.compositeXfer.pullCompositeManifestOnly(c,a,(function(e,t){!e&&t?(c.resolvePullWithBranch(t),r.resolve(c)):r.reject(e)})),r.promise},l.loadFile=function(e,t){var o=n.defer(),r=c.decodeUrl(e);return i.invoke("GET",s+r,{},null,t,(function(e,t){e?o.reject(e):o.resolve(t.response)})),o.promise},l}.apply(t,o))||(e.exports=r)},btxu:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return l}));var o=n("wHG3"),r=n("UzQk"),i=n("lulf"),a=n("yBTN");function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class l{static getImageQueue(){return this.pixiRenderer||(this.pixiRenderer=new o.PixiJSRenderer),this.imageQueue||(this.imageQueue=this.pixiRenderer.imageService.createQueue()),Promise.resolve(this.imageQueue)}static initialize(e){const t=!!(e=e||{}).skipLoadingAuthenticatedFeatures;if(!l.initializePromise){const e=new i.default;l.initializePromise=e.loadFeatures({skipLoadingAuthenticatedFeatures:t}).then(()=>{r.Host.setFeatureController(e)})}return l.initializePromise}static calculateTarget(e,t){let n,o;if("number"==typeof t.width&&"number"==typeof t.height)n=t.width,o=t.height;else{if("number"!=typeof t.longestSide)throw new Error("renderToCanvas missing one or more key parameters");{const r=e.bounds.width,i=e.bounds.height;n=r>i?t.longestSide:Math.round(t.longestSide*r/i),o=r>i?Math.round(t.longestSide*i/r):t.longestSide}}return{width:n,height:o}}constructor(e){c(this,"coreWrapper",void 0),c(this,"assetLoader",void 0),this.coreWrapper=e,this.assetLoader=new a.default(this.coreWrapper)}async renderToCanvas(e,t){const n=await this.commonRender(t,o.PixiJSApp.RawEncoding.AsUint8Array());e.canvas.width=n.width,e.canvas.height=n.height;const r=e.createImageData(n.width,n.height);r.data.set(n.data),e.putImageData(r,0,0)}async renderToBlob(e){const t=await this.commonRender(e,"image/png"===e.outputFormat?o.PixiJSApp.PNGEncoding.AsUint8Array():o.PixiJSApp.JPGEncoding.AsUint8Array(e.imageQuality||.75));return new Blob([t.data])}async render(e){return(await this.commonRender(e,"image/png"===e.outputFormat?o.PixiJSApp.PNGEncoding.AsDataURL():o.PixiJSApp.JPGEncoding.AsDataURL(e.imageQuality||.75))).data}async renderStack(e){return null}async commonRender(e,t){const n=e.honorDocWatermarkProp&&this.coreWrapper.getWatermarkEnabledForDoc();let r=!1,i=0;"number"==typeof e.animTime&&(i=e.animTime,r=!0);const a=this.coreWrapper.getGraph(r,n);let c;if("number"==typeof e.longestSide)c=o.PixiJSApp.TargetRenderParameters.forGraphAtSize(a,e.longestSide,t);else{if("number"!=typeof e.width||"number"!=typeof e.height)throw new Error("render params missing one or more parameters");c=o.PixiJSApp.TargetRenderParameters.fit(e.width,e.height,t)}const s=await l.getImageQueue();return await s.render(a,c,i,this.assetLoader)}}c(l,"pixiRenderer",void 0),c(l,"imageQueue",void 0),c(l,"initializePromise",void 0)},hEO4:function(e,t,n){var o,r;o=[n("MGCh"),n("UzQk")],void 0===(r=function(e,t){const n=e.channel("Diagnostics"),o={truncateEncodedDOM:function(e){const t=["theo#placement","theo#bounds","theo#style","theo#color-library","theo#saliency-data","theo#artwork","theo#image-color-data","theo#edge-data"],n=["type-lockup"];return function e(o){const r={},i=o["theo#controller-kind"];try{Object.keys(o).forEach(a=>{let c=o[a];t.indexOf(a)>=0?c=`${JSON.stringify(c).length}`:"children"===a?c=i&&n.indexOf(i)>=0?`${JSON.stringify(c).length}`:c.map(t=>e(t)):"string"==typeof c&&(c=c.replace(/(.{8})-.{4}-.{4}-.{4}-.{12}/g,"$1")),r[a]=c})}catch(e){r.error="threw "+e}return r}(e)},validateDOM:function(e){try{if(!e.children)return"no root children";4!==e.children.length&&n.warn("expected 4 root children");const t=e.children.find(e=>"forma-document"===e.path);if(!t)return"no forma document";if("application/vnd.adobe.theo.forma+dcx"!==t.type&&n.warn("forma doc did not have correct type",t.type),!t.children||1!==t.children.length)return"expected exactly one forma root";const o=t.children[0];if("Root"!==o["theo#kind"])return"root forma did not have kind Root";if("root"!==o["theo#controller-kind"])return"root forma did not have controller kind root";if(!o.children||0===o.children.length)return"root forma did not have children";if(window.simulate_bad_dom){delete o.children.find(e=>"group"===e["theo#kind"]&&"grid"===e["theo#controller-kind"])["theo#controller-kind"]}const r=o.children.find(e=>"group"===e["theo#kind"]&&"grid"===e["theo#controller-kind"]);if(!r)return"root forma did not have a grid child";if(!r.path)return"grid is missing path property"}catch(e){return"validation threw: "+e}return null},findGrid:function(e){if(!e)return n.error("findGrid: document is null"),null;const t=e.firstPage.root;if(!t||0===t.childCount)return n.error("findGrid: root has no children"),null;const o=t.children_.find(e=>"group"===e.kind&&e.controller&&"grid"===e.controller.kind);return o||(1===t.children_.length?(n.error("findGrid: assuming the sole child of the root is the grid; it's not the correct kind"),t.children_[0]):(n.error("findGrid: root unexpectedly had more than one child and none looked like a grid"),null))},dumpPostDOM:function(e){return function e(n){try{const o={id:n.formaID,kind:n.kind},r=n.controller;if(r&&(o.ckind=r.kind),n instanceof t.GroupForma){const r=n.visitAsArray(t.FormaTraversal.JustChildren);o.children=r.map(t=>e(t))}return o}catch(e){return{error:"threw"+e}}}(e.firstPage.root)},dumpStateDelta:function(e,t,n){t=t||10,n=n||1e4;const o=[];try{const r=e.database;let i=0,a=r.currentState.state;for(;a&&i<t;){const e={guid:a.guid,gen:a.generation_};try{e.deltas=Object.keys(a.objectStates).map(e=>{const t=a.objectStates[e];return{id:e,cls:t.className,props:Object.keys(t.properties||{}).join(",")}})}catch(t){e.error="threw "+t}if(o.push(e),JSON.stringify(o).length>n&&(e.summary=e.deltas.length+" objects mutated",delete e.deltas,JSON.stringify(o).length>n)){o.pop();break}a=a.basedOn,i++}}catch(e){o.push({error:"state enumeration threw "+e})}return o},dumpUndoRedo:(e,t)=>{t=t||80;const n={states:[]};try{e.controller.undoRedoMgr.timeline.states.forEach(e=>{const o={};e.action&&(o.action=e.action.description),e.state&&e.state.state&&(o.guid=e.state.state.guid),e.beginSelectedFormaIDs&&(o.bfids=e.beginSelectedFormaIDs.concat()),e.endSelectedFormaIDs&&(o.efids=e.endSelectedFormaIDs.concat()),n.states.push(o),n.states.length>t&&n.states.shift()})}catch(e){n.error="throw: "+e}return n},snapshotFormaHistory:(e,t)=>{if(!t)return{error:"nil object"};const n=[];try{let o=t.state;for(;o;){const r={};Object.keys(o.properties).forEach(e=>{const t=o.properties[e];t.isArray?r[e]=`array(${t.value.length})`:t.isDictionary?r[e]=`object(${Object.keys(t.value).join(",")})`:r[e]=`${t.schemaType}(${t.value})`});const i=[];let a=e.database.currentState.state;for(;a;)a.objectStates[t.id]===o&&i.push(a),a=a.basedOn;n.push({props:r,dbStates:i.map(e=>e.guid)}),o=o.basedOn}}catch(e){n.push("throw "+e)}return{kind:t.kind,id:t.formaID,ckind:t.controller?t.controller.kind:"no controller",states:n}},monitorTransactionsForDocument:function(e){const t=[];let r=!1;const i=(e,o)=>{try{r=!0;const i={msg:e,recent:t.concat()};void 0!==o&&(i.err=o);try{throw new Error}catch(e){i.stack=e.stack}n.error("grid validation failed",i)}catch(e){n.error("monitorTransactionsForDocument throw",e)}},a=n=>{try{if(r)return;if(t.push({event:n,history:o.snapshotFormaHistory(e,e.firstPage.root.childAt(0))}),t.length>10&&t.shift(),window.simulate_db_validation_failure)i("simulated failure"),r=!1;else if(1!==e.firstPage.root.childCount)i(`root has ${e.firstPage.root.childCount} children`);else{const t=e.firstPage.root.childAt(0);"group"!==t.kind?i("grid has kind "+t.kind):t.controller?"grid"!==t.controller.kind&&i("grid has controller kind "+t.controller.kind):i("grid has kind "+t.kind)}}catch(n){i("throw validating",n)}};e.database.addListener({onBeginTransaction:(e,t)=>a("beginT "+t.name),onEndTransaction:(e,t)=>a("endT "+t.name),onStateChanged:(e,t)=>{},onObjectStateChanged:(e,t)=>{}})}};return o}.apply(t,o))||(e.exports=r)},mwMu:function(e,t,n){var o,r;o=[n("YLtl"),n("UFvF"),n("2ofD"),n("MGCh"),n("a8ov"),n("UzQk"),n("r3b0"),n("14LO")],void 0===(r=function(e,t,n,o,r,i,a,c){var l=r.default,s=c.DCXDocumentComposite,u=o.channel("SourceCCStorage"),d=["id","local","manifest-format-version","name","projectContext#npwMethod","state","type","authctx#ctxid"],m=function(e){var o={},r=(e=e||{}).dcxDoc||n.currentDoc,c=e.branch||r.getDCXComposite().current,m=e.rootNode||c.root,g=e.domComponentPath;return o.open=function(){return(g?r.getComponent(m.absolutePath+"/"+g).then((function(e){var t,n=JSON.parse(e),o=new a({makeComponentUrl:function(e){return l.encodeComponentUrl(r.id,e.id,e.type)},manufactureComponentsForNode:function(e){var t=e&&e["theo#external-url"];return t?[{id:i.GUIDUtils.makeGUID(),url:t,mimeType:e["theo#mimetype"]}]:null},trackAbsolutePath:!0,branch:n});try{t=new i.TheoDocument.newDocumentFromDataObject(o,(function(e){const t=e&&"function"==typeof e.join?e.join(";"):"No error array found for err: "+e;throw new Error(t)})),i.TheoDocumentUtils.createImageFeatures(t),t.history.postEntry("open,src=AC,was-vers="+t.versionDecoded.rawValue),m.name&&(t.documentName=m.name)}catch(e){throw u.error("acOpen",e),t=i.TheoDocument.createDefault(r.id),e}return t})):c===r.getDCXComposite().current?function(){var e,n,o=r.getDCXRoot();if(o._data.children)e=new s({composite:r.getDCXComposite()});else{for(var a in o._data)o._data.hasOwnProperty(a)&&-1===d.indexOf(a)&&console.error("unexpecte property: "+a+" found when creating a new doc.");e=null}n=e&&e.current;let c=t.resolve();return n&&i.DocumentPersistenceFactory.usesJsonDocumentEncoding(n)&&(c=c.then(()=>{const e=i.JSONDocumentDecoder.getRequiredSynchronousComponents(n);return t.all(e.map(e=>r.getComponent(e).then((function(t){var o=JSON.parse(t);n.registerContentForComponent(e,o)}))))})),c.then(()=>{var t;try{e?(t=i.TheoDocument.decodeDocument(e,(function(e){throw n.releaseRegisteredContent(),new Error(e.join(";"))})),i.TheoDocumentUtils.createImageFeatures(t)):t=i.TheoDocument.createDefault(r.id),n&&n.releaseRegisteredContent(),t.history.postEntry("open,src=CC,was-vers="+t.versionDecoded.rawValue)}catch(e){throw u.error("coreOpen",e),e}return t})}():function(){var e,n=c._data,o=new a({makeComponentUrl:function(e){return l.encodeComponentUrl(r.id,e.id,e.type)},trackAbsolutePath:!1,branch:n,rootNode:m});try{e=new i.TheoDocument.newDocumentFromDataObject(o,(function(e){throw new Error(e.join(";"))})),i.TheoDocumentUtils.createImageFeatures(e)}catch(e){return u.error("decoding from nodes",e),t.reject(e)}return t.resolve(e)}()).then(e=>e)},o.documentId=function(){return r.id},o};return m.fromDocument=function(e){return new m({dcxDoc:e})},m.fromTemplate=function(e,t){return new m({dcxDoc:e.composite,rootNode:t,domComponentPath:"dom.json"})},m}.apply(t,o))||(e.exports=r)},nNj6:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var o=n("UzQk"),r=n("1tmr");class i extends r.a{constructor(e,t,n){var o,r,i;super(e,t),i=void 0,(r="dcxComponent")in(o=this)?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i,this.dcxComponent=n}attachToNode(){if(this.branch.dcxBranch.getComponentsOf(this.node.dcxNode).indexOf(this.dcxComponent)<0)try{this.branch.dcxBranch.moveComponent(this.dcxComponent,this.node.dcxNode)}catch(e){o.LegacyCoreAssert.fail("attachToNode: moveComponent() failed",e)}}detachFromNode(){this.branch.dcxBranch.getComponentsOf(this.node.dcxNode).indexOf(this.dcxComponent)>=0&&this.branch.retireComponent(this.dcxComponent)}get absolutePath(){return this.dcxComponent.absolutePath||""}get componentId(){return this.dcxComponent.id||""}get name(){return this.dcxComponent.name}get path(){return this.dcxComponent.path}get type(){return this.dcxComponent.type}get etag(){return this.dcxComponent.etag}get relationship(){return this.dcxComponent.relationship}get sourceHref(){return null}get mutableCopy(){return new i(this.branch,this.node,this.dcxComponent)}setValue(e,t){this.dcxComponent.setValue(e,t)}}},qnb0:function(e,t,n){var o,r;o=[n("YLtl"),n("UFvF"),n("MOGj"),n("2ofD"),n("MGCh"),n("a8ov"),n("UzQk"),n("b3Wv"),n("7the"),n("LI3u"),n("bBG2"),n("uTW7"),n("FGv1"),n("hEO4")],void 0===(r=function(e,t,n,o,r,i,a,c,l,s,u,d,m,g){const p=i.default,h=u.default;var f=r.channel("SaveCCStorage"),v=function(e,t){var n=e&&e.absolutePath;return n&&"/"!==n?n+"/"+t:"/"+t},S=function r(i){var u={},S=(i=i||{}).dcxDoc||o.currentDoc,y=i.branch||S.getDCXComposite().current,C=i.rootNode||y.rootNode,F=i.domComponentPath,b=i.isAuthoringContext||!!F,I=i.copyExternalImages,T=i.commitChanges||r.CommitChanges.AUTO,k=y.addElement("retirement","foo","retirement"),A=y.getChildWithAbsolutePath("/retirement");y.removeChild(A);var w={};function P(e,t){return`${e}:${t}`}var D=[];function x(e,n){var o=b?e:e+".jpg";f.info("saving rendition "+o);var r=v(C,o);return S.pushComponentWithRetry({name:e,path:o,absolutePath:r,isUpdate:D.indexOf(r)>=0,relationship:"rendition",file:n,type:n.type,parent:C}).then((function(e){return f.info("finished saving rendition "+o),e})).catch((function(e){return f.error("error while saving image rendition",e),h.publish("post:saveCCStorageAttempt",{contextualData1:"path:"+o,contextualData2:"success:"+!1}),t.reject(e)}))}function L(){var e=y.getChildWithAbsolutePath(v(C,"assets"));return e||((e=y.addChild(void 0,void 0,0,C)).path="assets"),e}function M(e,o,i){f.info("legacyACSave: begin"),f.assert(i,"legacyACSave: expected a thumbnail rendition"),f.assert(F,"legacyACSave: expect to get here only with a domComponentPath"),f.assert(b,"legacyACSave: expect to get here only for legacy AC saving");var c,l=[],u=S.getDCXComposite().current,d={finalizingComponent:function(e,t){var n=w[P(t.id,t.url)]||t.url;return p.isEncodedCPUrl(n)||p.isEncodedAuthoringContextUrl(n)||(n.indexOf("theo-web/images")>=0?f.warn("legacyACSave: recording this url as external",n):f.error("legacyACSave: recording this url as external",n)),e.setValue("theo#external-url",n),!0},removeUnusedComponent:function(e,t){k.getComponentWithId(t.id)?f.info(`not retiring component ${t.id} because we already have a`):(f.info("retiring component "+t.id),k.copyComponent(t)),u.removeComponent(t)}};c=new n.AdobeDCXBranch,d.branch=c,d.componentBranch=u,d.componentRootNode=C,d.componentNode=L();try{f.info("encoding composite"),e.history.postEntry("save,dst=AC");var m=new s(d);e.encode(m),m.prepareForAttachment(),m.finalizeAfterAttachment()}catch(e){throw f.error("error during encoding",e),err}const g=[];return o&&l.push(x("preview",o).then((function(e){g.push(e)}))),i&&l.push(x("thumbnail",i).then((function(e){g.push(e)}))),c&&l.push(function(e,n,o){f.info("saving dom "+n);var r=v(C,n);return S.pushComponentWithRetry({name:e,path:n,absolutePath:r,isUpdate:D.indexOf(r)>=0,relationship:"dom",type:"application/vnd.adobe.adobesparkpost.dom+json",file:JSON.stringify(o),parent:C}).then((function(e){return f.info("finished saving dom "+n),e})).catch((function(e){return f.error("error while saving dom",e),h.publish("post:saveCCStorageAttempt",{contextualData1:"path:"+n,contextualData2:"success:"+!1}),t.reject(e)}))}("dom",F,c._data)),t.all(l).then((function(){C.setValue("theo#last-modified",(new Date).toISOString());var n=e.documentName;return C.name=n===a.TheoDocument.DEFAULT_NAME?"":n,O(g),T===r.CommitChanges.NEVER?(f.info("legacyACSave: complete; not saving, per client"),t.resolve()):(f.info("legacyACSave: saving changes"),S.saveChanges((function(){})).then(()=>f.info("legacyACSave: complete")))}))}function O(t){e.each(e.filter(S.getDCXComposite().current.getComponentsOf(C),(function(e){return"rendition"===e.relationship&&t.indexOf(e)<0})),(function(e){f.info("removing stale rendition component",e.id),S.getDCXComposite().current.removeComponent(e)}))}function N(e,o,i,c){f.info("coreSave() begin");var l=new d.DCXDocumentBranch({branch:S.getDCXComposite().current,retiredElement:k}),s=a.DocumentPersistenceFactory.encoderFor(l);try{"string"==typeof c?e.encodeStateByID(c,s):e.encode(s),s.finish()}catch(e){throw f.error("coreSave() threw during encoding process",e),e}const u=[],p=[],y=l.getDeferredComponents(),C=y.find(e=>"dom"===e.relationship);if(C){const n=C.params.content,o=g.validateDOM(n);if(o){f.error(`validation failure '${o}'; encoded=`,g.truncateEncodedDOM(n)),f.error(`validation failure '${o}'; document=`,g.dumpPostDOM(e)),f.error(`validation failure '${o}'; delta=`,g.dumpStateDelta(e)),f.error(`validation failure '${o}'; undoredo=`,g.dumpUndoRedo(e));const r=g.findGrid(e);return f.error(`validation failure '${o}'; gridhist=`,g.snapshotFormaHistory(e,r)),t.reject(o)}}const F=l.root&&l.root.dcxNode;if(F)try{const e=JSON.stringify(F._data);(new n.AdobeDCXBranch).parse(e)}catch(n){return f.error(`manifest validation failure '${n}'; encoded=`,g.truncateEncodedDOM(dom)),f.error(`manifest validation failure '${n}'; document=`,g.dumpPostDOM(e)),f.error(`manifest validation failure '${n}'; delta=`,g.dumpStateDelta(e)),f.error(`manifest validation failure '${n}'; undoredo=`,g.dumpUndoRedo(e)),t.reject(n)}return y.forEach(e=>{u.push(function(e){f.assert(e instanceof m.DCXDocumentComponentDeferred);var n=e.params,o=v(n.node,n.path);return f.info(`saving deferred component ${n.name} at ${o}`),S.pushComponentWithRetry({name:n.name,path:n.path,absolutePath:o,isUpdate:D.indexOf(o)>=0,relationship:n.relationship,file:JSON.stringify(n.content),type:n.type,parent:n.node.dcxNode}).then((function(t){return f.info("finished saving component "+n.path),e.replaceWithReal(t),t})).catch((function(e){return f.error("error while saving component",e),h.publish("post:saveCCStorageAttempt",{contextualData1:"path:"+o,contextualData2:"success:false"}),t.reject(e)}))}(e))}),o&&u.push(x("preview",o).then((function(e){p.push(e)}))),i&&u.push(x("thumbnail",i).then((function(e){p.push(e)}))),f.info(`coreSave waiting on ${u.length} asynchronous operations`),t.all(u).then(()=>(O(p),T==r.CommitChanges.NEVER?t.resolve():(f.info("coreSave: requesting doc.saveChanges()"),S.saveChanges((function(){}))))).then(()=>{f.info("coreSave() finished")})}return u.initialize=function(){return t.resolve(!0)},u.documentId=function(){return S.id},u.saveImageComponent=function(e,n,o,r,i){n=n||"image/jpeg",o=o||L();var c="";"image/jpeg"===n?c=".jpg":"image/png"===n?c=".png":"image/svg"!==n&&"image/svg+xml"!==n||(c=".svg");var l=a.GUIDUtils.makeGUID()+c,s={name:i||"image",relationship:"image",type:n,path:l,absolutePath:v(o,l),parent:o};return r&&(s.id=r),e instanceof Blob?s.file=e:(s.copyFrom={source:e.source,assetId:e.assetId},e.source||f.error("save-ccstorage saveImageComponent imageFile.source is falsy, assetId:  "+e.assetId)),f.info("pushing component "+l),S.pushComponentWithRetry(s).then((function(e){return f.info("pushed component "+l),{component:e,encodedUrl:b?p.encodeAuthoringContextUrl(S.id,e.id,null,n):p.encodeComponentUrl(S.id,e.id,n)}})).catch((function(e){return f.error("save-ccstorage saveImageComponent failed with",e),h.publish("post:saveCCStorageAttempt",{contextualData1:"path:"+l,contextualData2:"success:"+!1}),t.reject(e)}))},u.saveWithRenditions=function(n,o,r,i){var s,d=n.beginTransaction("prune_orphaned_content");return a.TheoDocumentUtils.pruneOrphanedContent(n),d.end(),s=S.getDCXComposite().current.allComponents()||[],D=s.map(e=>e.absolutePath),(I?function(n){const o=[];return n.content.root.visitAll((function(e){e instanceof a.URLBasedContentNode&&o.push(e)})),t.all(e.map(o,(function(e){let t=e.url;if(!t||!e.componentID){const n=e instanceof a.VectorContentNode;return f.assert(n||t,"doCopyExternalImages: should have a valid url"),f.assert(n||e.componentID,"doCopyExternalImages: should have a valid componentID"),null}t=w[P(e.componentID,t)]||t,t!=e.url&&f.info(`doCopyExternalImages: applying domain-map of ${e.url} to ${t}`);let n=null;if(p.isEncodedCPUrl(t))"all"===I?(f.info(`pulling CP image ${t} for componentID ${e.componentID}`),n=c.loadFile(t,{responseType:"blob"})):f.info(`not pulling CP image ${t} because caller didn't ask us to`);else if(p.isEncodedAuthoringContextUrl(t)){p.decodeAuthoringContextUrlParameters(t).assetId!==S.id?(f.info("pulling AC image",t),n=l.loadFile(t,{responseType:"blob"})):f.info(`not pulling AC image ${t} because it's already in this AC`)}else if(p.isEncodedComponentUrl(t)){const e=p.decodeComponentUrlParameters(t);e.docId!==S.id&&(t=p.encodeComponentUrl(e.docId,e.componentId,e.mimeType),f.info("pulling doc image "+t),n=l.loadFile(t,{responseType:"blob"}))}if(n)return n.then((function(n){return f.info("pushing pulled image",t),u.saveImageComponent(n,e.mimeType,L(),e.componentID,e.componentID)})).then((function(t){return f.assert(t.component.id===e.componentID),f.info(`image pushed as component id ${t.component.id}; aliasing from ${e.url} to ${t.encodedUrl}`),w[P(e.componentID,e.url)]=t.encodedUrl,null})).catch((function(e){f.error("error while saving dom",e)}))}))).catch((function(e){throw f.error("error while copying images",e),e}))}(n):t.resolve(null)).then((function(){if(!o){var e=v(C,"preview.jpg"),t=S.getComponentWithAbsolutePath(e);t&&S.removeComponent(t)}return b?M(n,o,r):N(n,o,r,i)}))},u};return S.CommitChanges={AUTO:"AUTO",NEVER:"NEVER"},S.toDocument=function(e){return new S({dcxDoc:e,copyExternalImages:"all",commitChanges:S.CommitChanges.AUTO})},S.toTemplateLocal=function(e,t,n){return new S({dcxDoc:e.composite,rootNode:t,domComponentPath:"dom.json",commitChanges:n})},S.toTemplateExternal=function(e,t,n){return new S({dcxDoc:e.composite,rootNode:t,domComponentPath:"dom.json",copyExternalImages:"template",commitChanges:n})},S}.apply(t,o))||(e.exports=r)},r3b0:function(e,t,n){var o,r;!function(){function e(){for(var e=[],t=0;t<36;t++)e[t]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]="0123456789abcdef".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}function t(e,t){return e=e||"/",t?("/"!=e.substring(e.length-1)&&(e+="/"),e+t):e}(r=function(t,n){this.config=t,this.branch=t.branch,this.node=n,t.remix&&(this.node?this.node.id=e():this.branch.id=e())})._implements=function(e){return"IImportDataObject"==e},r.prototype=Object.create(Object.prototype,{id:{get:function(){return this.node?this.node.id:this.branch.id}},type:{get:function(){return this.node?this.node.type:this.branch.type}},name:{get:function(){return this.node?this.node.name:this.branch.name}},path:{get:function(){return this.node?this.node.path:this.branch.path}},property:{value:function(e){return e.indexOf("#")<0&&(e="theo#"+e),this.node?this.node[e]:this.branch[e]}},stringProperty:{value:function(e,t){var n=this.property(e);return null==n?t:n}},numberProperty:{value:function(e,t){var n=this.property(e);return null==n?t:n}},intProperty:{value:function(e,t){var n=this.property(e);return null==n?t:n}},booleanProperty:{value:function(e,t){var n=this.property(e);return null==n?t:n}},optionalBooleanProperty:{value:function(e){return this.property(e)}},optionalStringProperty:{value:function(e){return this.property(e)}},forEachChild:{value:function(e){var n=this.node?this.node.children:this.branch.children;if(n)for(var o=0;o<n.length;o++){var i=n[o];this.config.trackAbsolutePath&&(i.absolutePath=t(this.node?this.node.absolutePath:null,i.path)),e(new r(this.config,i),o)}}},forEachComponent:{value:function(e){var n=this.node?this.node.components:this.branch.components;if(n)for(var o=0;o<n.length;o++){var r=n[o];this.config.trackAbsolutePath&&(r.absolutePath=t(this.node?this.node.absolutePath:null,r.path)),e({id:r.id,mimeType:r.type,url:this.config.makeComponentUrl(r)},o)}if(this.config.manufactureComponentsForNode){var i=this.config.manufactureComponentsForNode(this.node);if(i)for(o=0;o<i.length;o++)e(i[o],(n?n.length:0)+o)}}}}),r.prototype.constructor=r}(),void 0!==e.exports?e.exports=r:void 0===(o=function(){return r}.apply(t,[]))||(e.exports=o)},uTW7:function(e,t,n){"use strict";n.r(t),n.d(t,"DCXDocumentBranch",(function(){return h}));var o=n("UzQk"),r=n("MGCh"),i=n.n(r),a=n("a8ov"),c=n("A+mC"),l=n("1tmr"),s=n("FGv1"),u=n("nNj6");function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class m{constructor(e,t,n){d(this,"overrideID",void 0),d(this,"dcxNode",void 0),d(this,"parent",void 0),d(this,"branch",void 0),d(this,"childNodes",void 0),d(this,"childComponents",void 0),this.dcxNode=e,this.branch=t,this.parent=n,this.overrideID=t.getOverrideIDForNode(e),this.childNodes=t.dcxBranch.getChildrenOf(this.dcxNode).map(e=>new m(e,t,this)),this.childComponents=t.dcxBranch.getComponentsOf(this.dcxNode).map(e=>new u.a(t,this,e))}get absolutePath(){return this.dcxNode.absolutePath}get nodeId(){return this.overrideID||this.dcxNode.id}get name(){return this.dcxNode.name}set name(e){this.dcxNode.name=e}get path(){return this.dcxNode.path}set path(e){this.dcxNode.path=e}get type(){return this.dcxNode.type}set type(e){this.dcxNode.type=e}getValue(e){return this.dcxNode.getValue(e)}setValue(e,t){e!==o.PROPERTY_KEY_ID&&this.dcxNode.setValue(e,t)}removeValue(e){this.dcxNode.removeValue(e)}visit(e){let t=e(this);if(t)return t;for(let n=0;n<this.childNodes.length;n++)if(t=this.childNodes[n].visit(e),t)return t;return null}findComponent(e){return this.visit(t=>t.childComponents.find(t=>e(t))||null)}findNode(e){return this.visit(t=>e(t)?t:null)}setCompositeID(e){}setManifestProperty(e,t){}setDocumentSize(e,t){}}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const p=i.a.channel("DCXDocumentBranch");class h{constructor(e){g(this,"dcxBranch",void 0),g(this,"_root",void 0),g(this,"_retiredElement",void 0),g(this,"_componentPaths",{}),g(this,"_componentURLfn",void 0),g(this,"_overrideIDfn",void 0),this.dcxBranch=e.branch,this._retiredElement=e.retiredElement||null,this._componentURLfn=e.componentURLfn||null,this._overrideIDfn=e.overrideIDfn||null,this._root=new m(e.branch.rootNode,this,null)}getOverrideIDForNode(e){return this._overrideIDfn&&this._overrideIDfn(e)}registerContentForComponent(e,t){this._componentPaths[e]=o.Host.persistUtils.writeJsonContentToTempFile(t)}releaseRegisteredContent(){if(o.Host.persistUtils instanceof c.HostPersistUtilsImpl)for(const e in this._componentPaths)o.Host.persistUtils.deleteTempFile(this._componentPaths[e]);else o.Host.logging.warning("persist utils is not of a known type; releasing temp files won't happen");this._componentPaths={}}getDeferredComponents(){const e=[];return this._root.visit(t=>e.push.apply(e,t.childComponents.filter(e=>e instanceof s.DCXDocumentComponentDeferred))),e}get root(){return this._root}getValue(e){return this.dcxBranch.rootNode.getValue(e)}setValue(e,t){e===o.PROPERTY_KEY_NAME?this.dcxBranch.name=t:this.dcxBranch.rootNode.setValue(e,t)}get allComponents(){const e=[];return this._root.visit(t=>{e.push.apply(e,t.childComponents)}),e}appendNode(e,t,n){if(e=e||o.GUIDUtils.makeGUID(),!n||n instanceof m){const o=n||this._root,r=this.dcxBranch.addChild("",e,void 0,o.dcxNode);t&&(r.path=t);const i=new m(r,this,o);return o.childNodes.push(i),i}return p.error("appendNode: foreign node"),null}removeNode(e){if(e instanceof m)if(e.branch!==this)p.error("trying to remove a node from a branch it doesn't belong to");else if(e.parent){const t=e.parent.childNodes.indexOf(e);t<0?p.error("trying to remove a node from a parent it doesn't belong to"):(e.visit(e=>e.childComponents.forEach(e=>{e instanceof u.a&&this.retireComponent(e.dcxComponent)})),e.parent.childNodes.splice(t,1),this.dcxBranch.removeChild(e.dcxNode))}else p.error("can't remove the root node");else p.error("trying to remove a node that isn't really a node")}getChildrenOfNode(e){return o.LegacyCoreAssert.isTrue(!e||e instanceof m,"node must be null or a DCX Document node"),e instanceof m?e.childNodes.concat():this._root.childNodes.concat()}getComponentsOfNode(e){return o.LegacyCoreAssert.isTrue(!e||e instanceof m,"node must be null or a DCX Document node"),e instanceof m?e.childComponents.concat():this._root.childComponents.concat()}getComponentWithId(e){return this._root.findComponent(t=>t.componentId===e)}getPathForComponent(e){if(e instanceof l.a){const t=this._componentPaths[e.absolutePath];if(t)return t;if(this._componentURLfn){const t=this._componentURLfn(e);if(null!==t)return t}return o.LegacyCoreAssert.isTrue(!!e.componentId&&!!e.type,"missing component id or type"),a.default.encodeComponentUrl(this.root.nodeId,e.componentId,e.type)}return p.error("passed in component isn't our type of component"),null}getComponentWithAbsolutePath(e){return this._root.findComponent(t=>t.absolutePath===e)}getNodeWithAbsolutePath(e){return this._root.findNode(t=>t.absolutePath===e)}addComponent(e,t,n,r,i,a,c,l,d){const g=a instanceof m?a.dcxNode:this.dcxBranch.rootNode,h=a&&a instanceof m?a:this._root;if(this._retiredElement){const e=this._retiredElement.getComponentsOf(this._retiredElement.rootNode).find(e=>e.id===t);if(e){p.info(`copying component ${e.id} from retirement zone`),this.dcxBranch.copyComponent(e,g);const t=new u.a(this,h,e);return h.childComponents.push(t),t}}if(c&&o.Host.persistUtils&&o.Host.persistUtils.fileExists(c)){p.info(`creating deferred content component for ID ${t} from source ${c}`);const a={name:e,type:n,relationship:r,path:i,sourceFile:c,copy:l,sourceHref:d,componentId:t||"",node:h,content:o.Host.persistUtils.readJsonContentFromFile(c)},u=new s.DCXDocumentComponentDeferred(this,h,a);return h.childComponents.push(u),u}return p.error("addComponent: on web we can't add arbitrary components.."),null}moveComponent(e,t){return e instanceof l.a?(p.info(`moveComponent ${e.componentId} to node ${t instanceof m?t.absolutePath:"root"}`),e.reparent(t||this._root),e):(p.error("updateComponent: requires a DCXDocumentComponent"),null)}retireComponent(e){"rendition"!==e.relationship&&"dom"!==e.relationship?this._retiredElement.allComponents().find(t=>t.id===e.id)?p.info(`not retiring component ${e.id} (already have a copy of it in retirement zone)`):(p.info("retiring "+e.id),this._retiredElement.copyComponent(e)):p.info(`not retiring ${e.id} because it's a rendition or dom component`)}updateComponent(e,t,n){if(!(e instanceof l.a))return p.error("updateComponent: requires a DCXDocumentComponent"),null;const r=this.getComponentWithId(e.componentId);if(!r)return p.error("updateComponent: passed component's ID isn't in the branch; can only update existing components"),null;let i=e;if(t){if(!o.Host.persistUtils||!o.Host.persistUtils.fileExists(t))return p.error("updateComponent: sourceFile can't be used because it's not a faux-temp-file"),null;p.info(`updating component ${e.componentId} with new source file ${t}`),i=new s.DCXDocumentComponentDeferred(this,i.node,{sourceFile:t,copy:n,name:i.name,componentId:i.componentId||"",type:i.type||"",relationship:i.relationship,path:i.path||"",sourceHref:i.sourceHref,node:i.node,content:o.Host.persistUtils.readJsonContentFromFile(t)})}else r!==i?p.info(`updating component ${e.componentId} with new metadata only`):p.warn(`updating component ${e.componentId} but nothing has changed!`);return r!==i&&r.update(i),i}}},yBTN:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return l}));var o=n("UzQk"),r=n("MGCh"),i=n.n(r),a=n("a8ov");const c=i.a.channel("WebAssetLoader");class l{constructor(e){var t,n,o;o=void 0,(n="coreWrapper")in(t=this)?Object.defineProperty(t,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[n]=o,this.coreWrapper=e}getURLforContentID(e,t,n){const r=e.resources.byContentID(t);let i="";if(r)if(r.storage instanceof o.StorageSpecLocalComposite){const e=this.coreWrapper.documentId(),t=r.storage.componentID,o=r.storage.contentType,c=n&&n.explicitDimension;i=a.default.getImageUrl(e,t,o,c)}else if(r.storage instanceof o.StorageSpecApplicationResource)i=o.Host.resourceUtils.urlForResource(r.storage.categoryID,r.storage.resourceID)||"";else if(r.storage instanceof o.StorageSpecContentLiteral){const e=r.storage.content;e instanceof o.CoreContentBase64?i=e.contentType?`data:${e.contentType};base64,${e.data}`:"data:base64,"+e.data:c.error("unimplemented content literal storage type")}else if(r.storage instanceof o.StorageSpecExternalCC){const e=r.storage,t=e.documentID,o=e.componentID,c=e.contentType||r.contentType,l=n&&n.explicitDimension;i=a.default.getAuthoringContextUrl(t,o,e.etag,c,l)}else if(r.storage instanceof o.StorageSpecCommunityPlatform){const e=r.storage;i=a.default.getCPUrl(e.assetID,e.absPath.forceRelative.asString)}else r.storage instanceof o.StorageSpecHTTP?i=r.storage.url:r.storage instanceof o.StorageSpecLocalFile?c.error("unexpected local file storage spec"):c.error("unimplemented storage type "+r.storage.kind);else c.error(`resource provider for content ID ${t} not found`);return i||a.default.decodeUrl(t)||""}}}}]);
//# sourceMappingURL=post-render-action-view_post-render-doc-view_theo-publish-impl_theo-web-controller_theo-web-headless_6bc92e0e-b0aaf84b.js.map