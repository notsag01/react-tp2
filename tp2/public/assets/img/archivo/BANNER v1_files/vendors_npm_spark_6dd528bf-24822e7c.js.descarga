(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[26],{"06HC":function(t,e,n){var o,i=e,r=n("oAGj"),a=n("JgVS"),l=n("cEEQ"),s=n("c+uM"),h=n("tGKA");i.ShadowDecorationStrategy=(o=function(){a.BaseDecorationStrategy.call(this)},r.defineClass({name:"ShadowDecorationStrategy",ctor:o,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{rotatePoint:function(t,e,n){var o=n*Math.PI/180;return{x:Math.cos(o)*(t.x-e.x)-Math.sin(o)*(t.y-e.y)+e.x,y:Math.sin(o)*(t.x-e.x)+Math.cos(o)*(t.y-e.y)+e.y}},supportsConfiguration:function(t){return!1},decorate:function(t,e){for(var n=[],o=e.avgTextPointSize,i=t.style.shadowAngle,u=o/16*t.style.shadowOffset+.02*o,c=this.rotatePoint({x:0,y:-u},{x:0,y:0},i),g=r.iter(r.range(0,e.items.length,!1));!g.done;g.next()){var p=g.value,d=e.items[p];if(d.type==l.LockupItemType.Text){var f,m,y=t.style.textLook;if(null!=(f=d.characterStyle)&&(m=t.style.characterStyles[f])&&(y=m.textLook==s.LockupTextLook.UNSET?y:m.textLook),s.LockupStyle.isShadowLook(y)){u=y==s.LockupTextLook.KnockoutAndShadow?.08*d.pointSize*(1.7*t.style.shadowOffset+.25)/2:y==s.LockupTextLook.ShadowAndOutline?o/8*t.style.shadowOffset+.02*o:o/16*t.style.shadowOffset+.02*o,c=this.rotatePoint({x:0,y:-u},{x:0,y:0},i);var k=d.placement;(d=d.clone()).hasPrimaryColor=!1,d.placement=new h.Matrix2D(k.a,k.b,k.c,k.d,k.tx+c.x,k.ty+c.y),n.push(d)}}}return new a.DecorationResults(r.clone(n))}}}),o)},"3UhB":function(t,e,n){var o,i=e,r=n("oAGj"),a=n("6h7+"),l=n("kYI4"),s=n("gXiO"),h=n("FNB+"),u=n("QgZx"),c=n("6Rk9"),g=n("53P9"),p=n("iCxV"),d=n("8vXU"),f=n("rxGp"),m=n("fNpk"),y=n("c+uM"),k=n("KdeS"),L=n("mGL3"),S=n("enh0"),v=n("VJ9E"),T=n("8t9B"),F=n("uUew"),C=n("sIWg");i.TypeLockupUtils=(o=function(){s.CoreObject.call(this)},r.defineClass({name:"TypeLockupUtils",ctor:o,superName:"CoreObject",statics:{replaceFontsInDocument:function(t,e){var n=p.Host.textModelUtils.defaultFont(),i=o.createTheoFont(n,null);t.firstPage.root.visitAll(h.FormaTraversal.PreOrder,(function(t){if(t.style instanceof y.LockupStyle){var n,o=!1,a=t.style,l=r.opt(a.font,(function(t){return t.fontData.postScriptName}));null!=l&&e.includes(l)&&(a.font=i,o=!0);for(var s=r.iter(a.characterStyles);!s.done;s.next()){var h=s.value;if(null!=h.font){var u=r.opt(h.font,(function(t){return t.fontData.postScriptName}));null!=u&&e.includes(u)&&(h.font=i,o=!0)}}o&&(n=r.as(t.controller,T.TypeLockupController))&&n.styleChanged()}}))},fontsInDocument:function(t){var e=new L.OrderedFontSet;return t.firstPage.root.visitAll(h.FormaTraversal.PreOrder,(function(t){var n;(n=r.as(t,S.TextForma))&&e.append(n.fontDescriptor)})),e},sizesInDocument:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var o=[];return t.firstPage.root.visitAll(h.FormaTraversal.PreOrder,(function(t){var i;if((i=r.as(t,S.TextForma))&&i.lockupForma!=e&&!(n&&i.rowIndex>0)){var a=i.fontSize*i.lockupForma.placement.extractedScale.scale.x;o.includes(a)||o.push(a)}})),r.sortInPlace(o),o},applyFontToController:function(t,e){var n=this,o=t.fontData;o.availability==u.FontAvailability.LOADED?(a.BadgeFacade.logFontChange(r.opt(e.styleController.forma,(function(t){return t.source})),t.fontData.postScriptName),e.styleController.targetedLockupStyle.font=t,null!=t.sparkElementID?l.BrandingFacade.brandDocumentForElement(e.forma.page.document,t.sparkElementID,l.AUTHORING_CONTEXT_TYPE_FONT):l.BrandingFacade.unBrandDocumentIfNoBrandedElements(e.forma.page.document),e.styleController.targetedLockupStyle!==e.styleController.forma.style&&(t.isEqual(e.styleController.forma.style.font)&&(e.styleController.targetedLockupStyle.font=null),e.styleChanged())):o.availability==u.FontAvailability.LOADABLE&&p.Host.fontProvider.loadFont(o,(function(){return n.applyFontToController(t,e)}),(function(){return p.Host.logging.logForCategory(f.LogCategories.kFont,"applyFontToController, Failed to load font",d.LogLevelEnum.WARN_LEVEL)}))},createTheoFont:function(t,e){if(null!=e)for(var n=r.iter(e.fonts);!n.done;n.next()){var o=n.value;if(null!=o.descriptor&&o.descriptor.isEqual(t))return v.TheoFont.init_a314(o)}return v.TheoFont.init_9e5c(t)},getFontDescriptorFromPostScriptName:function(t,e){var n,o;return(n=r.opt(p.Host.fontProvider,(function(e){return e.getIncludedFonts(t.page.document)})))&&null!=(o=n.getIndexOfPostScriptName(e))?n.fontAt(o):null},calculateFontRole:function(t,e){var n,i,a=null;if(null!=t){var l=o.createTheoFont(t,e);a=l.getSparkFontRole(),r.isEmpty((n=a)||null!=n?n:"")&&l.hasSparkFontRole("custom")&&(a="custom")}return r.isEmpty((i=a)||null!=i?i:"")?"":a},calculateFaceWithHighestRole:function(t,e){for(var n=["headline-font","body-font","body-font-italic","body-font-bold","body-font-bold-italic","secondary-font","custom"],i=null,a="",l=r.iter(t);!l.done;l.next()){var s=l.value,h=o.calculateFontRole(s,e);if(0==r.isEmpty(h)){var u=r.indexOf(n,h);null!=u&&(r.isEmpty(a)||u<r.indexOf(n,a))&&(a=h,i=s)}}return i},isLTRCharacter:function(t){return t>="A"&&t<="Z"||t>="a"&&t<="z"||t>="À"&&t<="Ö"||t>="Ø"&&t<="ö"||t>="ø"&&t<="ʻ"||t>="̀"&&t<="֐"||t>="ࠀ"&&t<="῿"||t>="Ⰰ"&&t<="﬜"||t>="﷾"&&t<="﹯"||t>="﻽"&&t<="￿"},isRTLCharacter:function(t){return t>="֑"&&t<="߿"||t>="יִ"&&t<="﷽"||t>="ﹰ"&&t<="ﻼ"},isTextRightToLeft:function(t){for(var e=0,n=0,i=r.iter(r.chars(t));!i.done;i.next()){var a=i.value;o.isLTRCharacter(a)?e+=1:o.isRTLCharacter(a)&&(n+=1)}return n>0&&n>e},canBreakAnywhere:function(t){return t>="ぁ"&&t<="ヿ"||t>="㐀"&&t<="䶵"||t>="一"&&t<="龥"},isWhiteSpace:function(t){for(var e=r.iter(r.chars(t));!e.done;e.next()){var n=e.value;if(!o.isWhiteSpace(n))return!1}return!0},isWhiteSpace:function(t){return t>="\t"&&t<="\r"||" "==t||""==t||" "==t||" "==t||t>=" "&&t<="​"||"\u2028"==t||"\u2029"==t||" "==t||" "==t||"　"==t},iskinsokuBefore:function(t){return"!"==t||")"==t||"."==t||":"==t||";"==t||"?"==t||"’"==t||"”"==t||"、"==t||"。"==t||"々"==t||"〉"==t||"》"==t||"」"==t||"』"==t||"】"==t||"〕"==t||"ゝ"==t||"ゞ"==t||"・"==t||"ヽ"==t||"ヾ"==t||"！"==t||"）"==t||"，"==t||"．"==t||"："==t||"？"==t||"］"==t||"｝"==t},iskinsokuAfter:function(t){return"("==t||"["==t||"{"==t||"£"==t||"§"==t||"‘"==t||"“"==t||"〈"==t||"《"==t||"「"==t||"『"==t||"【"==t||"〒"==t||"〔"==t||"〝"==t||"（"==t},lineBreaks:function(t,e,n){for(var i=0,a=0,l=!1,s=!0,h=r.iter(r.chars(t));!h.done;h.next()){var u=h.value;o.iskinsokuBefore(u)?s=!0:o.iskinsokuAfter(u)?(i!=a&&s&&(e.push(new F.TextRange(i,a)),i=a),l=u.charCodeAt(0)>=12288,s=!1):o.canBreakAnywhere(u)?(i!=a&&s&&(e.push(new F.TextRange(i,a)),i=a),l=!0,s=!0):o.isWhiteSpace(u)?(i!=a&&e.push(new F.TextRange(i,a)),"\n"==u&&n&&e.push(new F.TextRange(a,a+1)),i=a+1,l=!1,s=!0):l&&s?(i!=a&&(e.push(new F.TextRange(i,a)),i=a),l=!1,s=!0):(l=!1,s=!0),a+=1,u.charCodeAt(0)>65535&&(a+=1)}i!=a&&e.push(new F.TextRange(i,a))},getBreakRanges:function(t){var e=[];return o.lineBreaks(t,e,!0),e},getWordRanges:function(t,e){var n=[];if(o.lineBreaks(t,n,!1),F.TextRange.makeRangesContiguous(n),1==n.length){n.splice(0);for(var i=0,a=-1,l=-1,s=-1,h=0,u=!0,c=r.clone(g.GraphemeUtils.splitGraphemes(t)),p=r.iter(c);!p.done;p.next()){var d=p.value,f=d.toLowerCase()!=d;f&&!u&&(n.push(new F.TextRange(h,i)),h=i),u=f,i+=1,"."==d?(n.push(new F.TextRange(h,i)),h=i,-1==a&&(a=i),l=i,s=n.length-1,u=!0):"/"==d&&(n.push(new F.TextRange(h,i-1)),n.push(new F.TextRange(i-1,i)),h=i)}n.push(new F.TextRange(h,c.length)),((e==T.HighlightMethod.Bracket||e==T.HighlightMethod.InsideBracket)&&-1!=a&&-1!=l||-1!=a&&a==l)&&(n[s]=new F.TextRange(n[s].start,l-1),n[s+1]=new F.TextRange(l-1,n[s+1].end))}return n},computeLockupMeasurements:function(t,e,n,i,a,l,s,h,u,c){void 0===u&&(u=1),void 0===c&&(c=!1);for(var d=e,f=32*n,m=32*d.spaceWidthRatio/f,y=a,L=c,S=i?t.toUpperCase():t,v=o.isTextRightToLeft(S),x=o.getBreakRanges(S),R=[],w=null!=h[T.TypeLockupController.HIGHLIGHT_STYLE]&&null!=h[T.TypeLockupController.HIGHLIGHT_STYLE].font,A=r.iter(x);!A.done;A.next()){var _=A.value,M=_,I="",D=!1;y=a,L=c;for(var B=r.iter(s);!B.done;B.next()){var H=B.value;(_.start>=H.start&&_.start<H.end||_.start<=H.start&&_.end>=H.start)&&((H.end<_.end||H.start>_.start)&&(y=!0,L=!0),I=T.TypeLockupController.HIGHLIGHT_STYLE),_.end!=H.end&&_.end!=H.end-1&&_.end!=H.start&&_.end!=H.start-1||(D=!0)}var P=32;d=""!=I&&null!=h[I]&&null!=h[I].font?h[I].font.fontData:e,""!=I&&null!=h[I]&&(P=32*u);var b=t.substr(_.start,_.length);v&&"\n"!=b&&(b="‫"+b);var E=i?b.toUpperCase():b;if(_.end<t.length)for(var z=t.substr(_.end),G=0,O=r.iter(r.chars(z));!O.done;O.next()){var N=O.value;if(!o.isWhiteSpace(N)&&"\n"!=N){0==G&&(m=0);break}if((w||1!=u)&&D){var U=32*u*(r.opt(h[T.TypeLockupController.HIGHLIGHT_STYLE].font,(function(t){return t.fontData}))||e).spaceWidthRatio/f;m=(32*e.spaceWidthRatio/f+U)/2}else m=P*d.spaceWidthRatio/f;G+=1,M=new F.TextRange(_.start,_.end+G)}else m=P*d.spaceWidthRatio/f;if(y&&!v){var Y=0,W=P*l/f,V=r.clone(p.Host.textModelUtils.getGlyphPositions(E,e,32,!L)),X=r.opt(r.opt(h[T.TypeLockupController.HIGHLIGHT_STYLE],(function(t){return t.font})),(function(t){return t.fontData}))||e,K=null;null!=h[T.TypeLockupController.HIGHLIGHT_STYLE]&&(K=r.clone(p.Host.textModelUtils.getGlyphPositions(E,X,32*u,!L)));for(var Q=r.clone(V),q=r.clone(g.GraphemeUtils.splitGraphemes(E)),j=r.iter(q);!j.done;j.next()){var Z=j.value,J=new F.TextRange(Y+_.start,Y+_.start+1);I="";for(var $=r.iter(s);!$.done;$.next())H=$.value,J.start>=H.start&&J.start<H.end&&(I=T.TypeLockupController.HIGHLIGHT_STYLE);""!=I&&null!=h[I]?(P=32*u,Q=r.clone(K)):(P=32,Q=r.clone(V)),""!=I&&null!=h[I]&&null!=h[I].font?d.isEqual(X)||(d=X):d.isEqual(e)||(d=e);var tt=p.Host.textModelUtils.measureBoundsForLayout(Z,d,P,0),et=(U=(Q[Y+1]-Q[Y]-tt.width)/f+W,!1);Y==q.length-1&&(U=m,W>0&&(U+=2*W),et=!0);var nt=""!=I&&null!=h[I]&&-1!=h[I].spacing&&0!=h[I].spacing?u:1,ot=new k.LockupWordInfo(Z,tt.width/f,U,I,nt,b.includes("\n"),et,J);R.push(ot),Y+=1}}else{var it=p.Host.textModelUtils.measureBoundsForLayout(E,d,P,l);0!=l&&(it=new C.TheoRect(it.minX,it.minY,it.maxX-0,it.maxY),W=P*l/f,0==m?m=W:l>0&&(m+=2*W));var rt=""!=I&&null!=h[I]&&-1!=h[I].spacing&&0!=h[I].spacing?u:1;if(ot=new k.LockupWordInfo(b,it.width/f,m,I,rt,b.includes("\n"),!0,M),""!=I&&null!=h[I]&&-1!=h[I].spacing&&0!=h[I].spacing&&h[I].lineBreakAtCharacterStyleSizeChange&&r.opt(r.last(R),(function(t){return""==t.characterStyle}))&&!b.includes("\n")){var at=new k.LockupWordInfo("\n",0,0,I,rt,!0,!0,new F.TextRange(_.start,_.start));R.push(at)}if(R.push(ot),""!=I&&null!=h[I]&&-1!=h[I].spacing&&0!=h[I].spacing&&h[I].lineBreakAtCharacterStyleSizeChange&&D&&!b.includes("\n")){var lt=new k.LockupWordInfo("\n",0,0,I,rt,!0,!0,new F.TextRange(_.end,_.end));R.push(lt)}}}return R},getLockupStringsForRoot:function(t){var e=[];return t.visitAll(h.FormaTraversal.PreOrder,(function(t){var n=r.as(t.controller,T.TypeLockupController);null!=n&&e.push(n.text)})),e},getFullCanvasLockups:function(t){var e=[];return t.visitAll(h.FormaTraversal.PreOrder,(function(t){if(t.style instanceof y.LockupStyle&&t.style.backing==y.LockupBacking.Knockout){var n=r.as(t.controller,T.TypeLockupController);null!=n&&e.push(n)}})),e},getNewCharSelectionRange:function(t,e,n){for(var o=e,i=t,a=new F.TextRange(0,0),l=r.iter(n);!l.done;l.next()){var s=l.value;t.start>=s.start&&t.end<=s.end&&(i=s),e.start>=s.start&&e.end<=s.end&&(a=s)}if(i.start==a.start&&i.end==a.end){if(e.end<=t.start&&0!=a.length)return new F.TextRange(a.start,e.end);if(e.end<=a.end&&t.end<=e.start)return new F.TextRange(e.start,a.end);if(e.start==t.start&&e.end==t.end)return new F.TextRange(a.start,a.end)}return i.start<e.start?o=new F.TextRange(i.start,e.end):i.end>e.end&&(o=new F.TextRange(e.start,i.end)),o},rangesAreEqual:function(t,e){if(t.length!=e.length)return!1;for(var n=r.iter(r.toSequence(t));!n.done;n.next()){var o=n.value,i=o.offset,a=o.element;if(a.start!=e[i].start||a.end!=e[i].end)return!1}return!0},adjustRanges:function(t,e,n){for(var i=0,a=!1,l=r.clone(t),s=r.iter(r.toSequence(t));!s.done;s.next()){var h=s.value,u=h.offset,c=h.element;e.start>=c.start&&e.start<c.end?(i=n-e.length,a=!0,c.end+i<c.start||e.end>c.end?l[u]=new F.TextRange(c.start,c.start):l[u]=new F.TextRange(c.start,c.end+i)):e.start<c.start&&e.end>c.start?(e.end<c.end?l[u]=new F.TextRange(e.start+n,c.end-e.end+e.start+n):l[u]=new F.TextRange(c.start,c.start),a||(i=n-e.length,a=!0)):0!=i&&(l[u]=new F.TextRange(c.start+i,c.end+i)),!a&&e.end<=c.start&&(i=n-e.length,a=!0,l[u]=new F.TextRange(c.start+i,c.end+i))}return a?o.cleanupAndMerge(r.clone(l)):l},cleanupAndMerge:function(t){for(var e=[],n=r.iter(r.toSequence(t));!n.done;n.next()){var o=n.value,i=o.offset,a=o.element;if(0!=a.length){m.LegacyCoreAssert.isTrue(a.start<a.end,"cleanupAndMerge - bad range",void 0,"TypeLockupUtils.cleanupAndMerge","TypeLockupUtils.swift",815);var l=e.length-1;if(e.length>0&&a.start<=e[l].end){var s=Math.max(a.end,e[l].end);e[l]=new F.TextRange(e[l].start,s)}else e.push(t[i])}}return e},invertRanges:function(t,e){for(var n=[],o=0,i=r.iter(t);!i.done;i.next()){var a=i.value;if(0!=a.start&&n.push(new F.TextRange(o,a.start)),(o=a.end)>e){m.LegacyCoreAssert.fail("invertRanges range beyond maxRangeEnd.",{start:a.start,end:a.end,max:e},"TypeLockupUtils.invertRanges","TypeLockupUtils.swift",838);break}}return o<e&&n.push(new F.TextRange(o,e)),n},getCharFontAdjust:function(t,e,n){void 0===n&&(n=!0);var o=1,i=T.TypeLockupController.HIGHLIGHT_STYLE,a=t.font.fontData,l=r.opt(r.opt(t.characterStyles[i],(function(t){return t.font})),(function(t){return t.fontData}));return null!=t.characterStyles[i]&&-1!=t.characterStyles[i].spacing&&0!=t.characterStyles[i].spacing?(o=t.characterStyles[i].spacing,n&&o>1&&(o=1/o)):null!=l&&(o=e||a.capRatio==a.meanRatio||l.capRatio==l.meanRatio?a.capRatio/l.capRatio:a.meanRatio/l.meanRatio),o},getCharFontYAdjust:function(t,e,n){var o=0,i=T.TypeLockupController.HIGHLIGHT_STYLE;if(null==t.characterStyles[i])return m.LegacyCoreAssert.isTrue(e==n,"getCharFontYAdjust - charFontSize should match fontSize if no character style!",void 0,"TypeLockupUtils.getCharFontYAdjust","TypeLockupUtils.swift",882),o;var a=t.font.fontData,l=r.opt(r.opt(t.characterStyles[i],(function(t){return t.font})),(function(t){return t.fontData}));return null!=l?(o=e*a.capRatio-e*a.baselineOffsetRatio-(n*l.capRatio-n*l.baselineOffsetRatio),t.characterStyles[i].alignment==y.LockupAlignment.Center?o-=(a.capRatio*e-l.capRatio*n)/2:t.characterStyles[i].alignment==y.LockupAlignment.Right&&(o-=a.capRatio*e-l.capRatio*n)):e!=n&&(o=e*a.capRatio-e*a.baselineOffsetRatio-(n*a.capRatio-n*a.baselineOffsetRatio),t.characterStyles[i].alignment==y.LockupAlignment.Center?o-=(a.capRatio*e-a.capRatio*n)/2:t.characterStyles[i].alignment==y.LockupAlignment.Right&&(o-=a.capRatio*e-a.capRatio*n)),o},sortTextFormae:function(t){var e,n=r.clone(t);return r.sortInPlace(n,(function(t,n){if(t.lockupForma==n.lockupForma)return t.rangeInLockup.start<n.rangeInLockup.start;var o,i,a,l,s,h,u,g;if((o=t.lockupForma)&&(i=n.lockupForma)&&(a=o.finalFrame)&&(l=i.finalFrame)&&(s=o.parent)&&null!=(h=s.indexOfChild(o))&&(u=i.parent)&&null!=(g=u.indexOfChild(i))){if(o!=i&&c.GeometryFacade.formaBoundsIntersect(o,i))return h<g;var p=.5*((e=r.opt(r.as(o.controller,T.TypeLockupController),(function(t){return t.averageLineHeight})))||null!=e?e:0);return a.minY-l.minY<-p||!(a.minY-l.minY>p)&&a.minX<l.minX}return!1})),n},formaForSameTextRun:function(t,e){return t.lockupForma==e.lockupForma&&t.rangeInLockup.start==e.rangeInLockup.start&&t.text==e.text},padTextFormaeForLetterAnimation:function(t,e){for(var n=[],i=!1,a=r.iter(r.toSequence(t));!a.done;a.next()){var l=a.value,s=l.offset,h=l.element;if(i)i=!1;else{var u,c=h.text.length+1==h.rangeInLockup.length,g=e&&c?1:0,p=h.text.length+g;if((u=r.as(r.opt(h.lockupForma,(function(t){return t.style})),y.LockupStyle))&&y.LockupStyle.isDuplicateFormaLook(u.textLook)&&s+1<t.length){var d=t[s+1];if(o.formaForSameTextRun(h,d)){for(var f=r.iter(r.range(0,p,!0));!f.done;f.next())n.push(h),n.push(d);i=!0;continue}}i=!1;for(var m=r.iter(r.range(0,p,!0));!m.done;m.next())n.push(h)}}return n},leftSingleQuote:"‘",rightSingleQuote:"’",leftDoubleQuote:"“",rightDoubleQuote:"”",doubleStraightQuote:'"',singleStraightQuote:"'",isSingleCurlyQuote:function(t){return t==o.leftSingleQuote||t==o.rightSingleQuote},isDoubleCurlyQuote:function(t){return t==o.leftDoubleQuote||t==o.rightDoubleQuote},isCurlyQuote:function(t){return o.isSingleCurlyQuote(t)||o.isDoubleCurlyQuote(t)},isStraightQuote:function(t){return t==o.doubleStraightQuote||t==o.singleStraightQuote},isInteger:function(t){return t>="0"&&t<="9"},isLetter:function(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"},getLeftCurlyQuoteForStraightQuote:function(t){return t==o.singleStraightQuote?o.leftSingleQuote:o.leftDoubleQuote},getRightCurlyQuoteForStraightQuote:function(t){return t==o.singleStraightQuote?o.rightSingleQuote:o.rightDoubleQuote},fixUpQuotes:function(t,e){if(t.length==e.length){for(var n=r.iter(r.toCharSequence(t));!n.done;n.next()){var i=n.value.element;if(o.isCurlyQuote(i))return t}for(var a=r.iter(r.toCharSequence(e));!a.done;a.next()){var l=a.value.element;if(o.isCurlyQuote(l))return t}}for(var s=r.chars(t),h=!1,u=0,c=r.iter(r.toCharSequence(t));!c.done;c.next()){var g=c.value,p=g.offset,d=g.element,f=" ",m=" ",y=" ",k=" ";if(p-1>=0&&(f=s[p-1]),p+1<s.length&&(m=s[p+1]),p+2<s.length&&(y=s[p+2]),p+3<s.length&&(k=s[p+3]),o.isStraightQuote(d)){if(d==o.singleStraightQuote){if(("s"==m||"S"==m)&&" "==y){s[p]=o.rightSingleQuote;continue}if("s"!=f&&"S"!=f||" "!=m||(s[p]=o.rightSingleQuote),o.isLetter(f)&&o.isLetter(m)&&(" "==y||" "==k)){s[p]=o.rightSingleQuote;continue}if(" "==f&&o.isInteger(m)&&o.isInteger(y)&&" "==k){s[p]=o.leftSingleQuote;continue}}if(!h&&o.isInteger(f))continue;if(!h&&" "==f){h=!0,u=p;continue}if(h&&" "==m){d==s[u]&&(h=!1,s[u]=o.getLeftCurlyQuoteForStraightQuote(s[u]),s[p]=o.getRightCurlyQuoteForStraightQuote(d));continue}}}return s.join("")}}}),o)},"8t9B":function(t,e,n){var o,i,r,a,l=e,s=n("oAGj"),h=n("0wFF"),u=n("cZuM"),c=n("XupS"),g=n("8/a0"),p=n("kYI4"),d=n("SpAV"),f=n("CWW7"),m=n("9WSY"),y=n("yGNn"),k=n("AVHO"),L=n("ascj"),S=n("JEnV"),v=n("UB0O"),T=n("FNB+"),F=n("6ZWm"),C=n("waL6"),x=n("yHU1"),R=n("QgZx"),w=n("Pil/"),A=n("cmoc"),_=n("16hp"),M=n("P83h"),I=n("9Lk3"),D=n("ZK0l"),B=n("pnSN"),H=n("X0GW"),P=n("53P9"),b=n("iCxV"),E=n("fdtz"),z=n("VDg0"),G=n("fNpk"),O=n("PXlJ"),N=n("d3iY"),U=n("cEEQ"),Y=n("c+uM"),W=n("TkOd"),V=n("tGKA"),X=n("3DEm"),K=n("EDIN"),Q=n("X1F6"),q=n("Cj3Q"),j=n("K0Rh"),Z=n("Zifs"),J=n("06HC"),$=n("djAF"),tt=n("35Q0"),et=n("n/CE"),nt=n("JKVa"),ot=n("byfQ"),it=n("lJxM"),rt=n("9YN4"),at=n("enh0"),lt=n("VJ9E"),st=n("3UhB"),ht=n("x4Gy"),ut=n("mL0c"),ct=n("hgLm"),gt=n("oKlP"),pt=n("uUew"),dt=n("sIWg"),ft=n("LCGV"),mt=n("1NAc");l.CharStyleApplyMode=s.defineEnum("CharStyleApplyMode",{SwipeApply:0,Apply:1,Remove:2,Toggle:3}),l.HighlightMethod=s.defineEnum("HighlightMethod",{Manual:0,EvenRows:1,OddRows:2,EvenWords:3,OddWords:4,First:5,Last:6,Bracket:7,InsideBracket:8,Numbers:100,Nouns:101,Verbs:102,Names:103,Adjectives:104,SmallWords:105}),l.ControllerDBListener=(o=function(t,e){this.transactions_=[],this.controller_=e,t.addListener(this)},s.defineClass({name:"ControllerDBListener",ctor:o,statics:{_implements:function(t){return"IDatabaseListener"==t}},props:{onBeginTransaction:function(t,e){this.transactions_.push(e),1==this.transactions_.length&&s.opt(this.controller_,(function(t){return t.shrinkPools=!1}))},onEndTransaction:function(t,e){e===s.last(this.transactions_)&&this.transactions_.pop()},onObjectStateChanged:function(t,e){},onStateChanged:function(t,e){s.opt(this.controller_,(function(t){return t.updateFormaPools()}))}}}),o),l.LockupFormaPool=(i=function(t,e){this.stringsToFormae_={},this.shapeFormae_=[],this.shrinkPools_=!0,this.page_=t,this.createModelFormae_=e},s.defineClass({name:"LockupFormaPool",ctor:i,props:{createForma:function(t){var e=this.page_;return null==e?null:this.createModelFormae_?e.createModelForma(t):e.createForma(t)},clear:function(){this.stringsToFormae_={},this.shapeFormae_=[]},addForma:function(t){var e,n;if(e=s.as(t,$.ShapeForma))this.shapeFormae_.push(e);else if(n=s.as(t,at.TextForma)){var o=n.text.toUpperCase();null==this.stringsToFormae_[o]&&(this.stringsToFormae_[o]=[]),this.stringsToFormae_[o].push(n)}},configureTextFormae:function(t){var e,n=this,o=[],i=[],r=[];if(s.each(this.stringsToFormae_,(function(a,l){var h=(e=t[a])||null!=e?e:0,u=l.length;if(0==h)s.append(o,l),r.push(a);else if(h<u){var c=u-h,g=l.slice(h,u);n.shrinkPools_&&l.splice(h,c),s.append(o,g)}else for(var p=h-u,d=s.iter(s.range(0,p,!1));!d.done;d.next())i.push(a)})),this.shrinkPools_)for(var a=s.iter(r);!a.done;a.next()){var l=a.value;s.removeKey(this.stringsToFormae_,l)}s.each(t,(function(t,e){if(null==n.stringsToFormae_[t]){n.stringsToFormae_[t]=[];for(var o=e,r=s.iter(s.range(0,o,!1));!r.done;r.next())i.push(t)}}));for(var h=s.iter(i);!h.done;h.next()){l=h.value;var u=this.createForma(at.TextForma.KIND);this.stringsToFormae_[s.as(l,"String")].push(u)}return o},configureShapeFormae:function(t){var e=[],n=this.shapeFormae_.length;if(n>t){var o=n-t,i=this.shapeFormae_.slice(t,n);this.shrinkPools_&&this.shapeFormae_.splice(t,o),s.append(e,i)}else if(n<t){var r=t-n;if(r>0)for(var a=s.iter(s.range(1,r,!0));!a.done;a.next()){var l=s.as(this.createForma($.ShapeForma.KIND),$.ShapeForma);null!=l&&this.shapeFormae_.push(l)}}return e},nthTextFormaForString:function(t,e){var n=s.opt(this.stringsToFormae_[e],(function(e){return e[t]}));return null==n?null:n},textFormaCount:function(){return s.keys(this.stringsToFormae_).length},nthShapeForma:function(t){var e=t<this.shapeFormae_.length?this.shapeFormae_[t]:null;return null==e?null:e},shapeFormaCount:function(){return this.shapeFormae_.length}}}),i),l.TypeLockupController=(r=function t(e,n,o){var i,r,a,s;this.changeSubscriptions_=[],this.settings_=null,this.tagsToFormae_={},this.isRightToLeft=!1,this.initialCharStyleRanges_=[],this.bannerRatio_=t.DEFAULT_BANNER_RATIO,this.forceLetterFormaMode=!1,this.currentPrimaryColor=Z.SolidColor.WHITE,this.currentSecondaryColor=Z.SolidColor.BLACK,this.cachedPin_=null,this.shouldCachePin_=!1,this.startSize_=null,this.passedARThreshold_=!1,this.resizePin_=null,this.preferredFontSize_=null,this.expansionSize_=null,this.lockLineBreaks_=!1,this.allowFewerLineBreaks_=!1,this.missingFontCount_=0,this.validDecode_=null,this.layoutStrategy_=null,this.decorationStrategy_=null,this.renderedConfiguration_=null,this.renderedColorLibrary_=null,this.renderedLayoutResults_=null,this.renderedDecorationResults_=null,this.updateQueued_=!1,this.thresholdGroupWidth=0,this.thresholdGroupHeight=0,this.hasFirstUpdateRun=!1,this.formaUpdateEvents_=[],this.sgID=n.formaID,this.layoutFormaePool_=new l.LockupFormaPool(n.page,n.isModel),this.decorationFormaePool_=new l.LockupFormaPool(n.page,n.isModel),this.styleController_=new W.LockupStyleController(n),this.missingFontCount_=0,null!=(i=n.style.colors.colorID(L.ColorRole.FieldPrimary))&&(r=n.page.colorLibraryController.getSolidColorForKey(i))&&(this.currentPrimaryColor=r),null!=(a=n.style.colors.colorID(L.ColorRole.FieldSecondary))&&(s=n.page.colorLibraryController.getSolidColorForKey(a))&&(this.currentSecondaryColor=s),D.GroupController.call(this,e,n,o),n.persisted&&(this.dbListener=new l.ControllerDBListener(n.database,this))},a={},s.defineClass({name:"TypeLockupController",ctor:r,superName:"GroupController",statics:{KIND:{get:function(){return"type-lockup"}},PROPERTY_SIZE_DEPRECATED:"size",PROPERTY_LOCKUPSTYLE_DEPRECATED:"lockup-style",PROPERTY_CONTENT_ID:"content-id",PROPERTY_WRAPPER_ID:"wrapper-id",PROPERTY_HIGHLIGHTMETHOD_ID:"highlightMethod",PROPERTY_CHARSTYLERANGES:"charstyle-ranges",MIN_LINE_HEIGHT:{get:function(){return 20}},DEFAULT_BANNER_RATIO:{get:function(){return 1.5}},HIGHLIGHT_STYLE:"Highlight",FIRST_AUTO_METHOD:{get:function(){return void 0===a.FIRST_AUTO_METHOD&&(a.FIRST_AUTO_METHOD=l.HighlightMethod.EvenRows),a.FIRST_AUTO_METHOD}},MAX_AUTO_METHOD:{get:function(){return void 0===a.MAX_AUTO_METHOD&&(a.MAX_AUTO_METHOD=l.HighlightMethod.InsideBracket),a.MAX_AUTO_METHOD}},FIRST_NLP_METHOD:{get:function(){return void 0===a.FIRST_NLP_METHOD&&(a.FIRST_NLP_METHOD=l.HighlightMethod.Numbers),a.FIRST_NLP_METHOD}},MAX_NLP_METHOD:{get:function(){return void 0===a.MAX_NLP_METHOD&&(a.MAX_NLP_METHOD=l.HighlightMethod.SmallWords),a.MAX_NLP_METHOD}},NUM_HIGHLIGHTMETHODS:14,DelayBetweenUpdates:{get:function(){return 16}},rangesEqual:function(t,e){if(t.length==e.length){for(var n=s.iter(s.range(0,t.length,!1));!n.done;n.next()){var o=n.value;if(t[o].start!=e[o].start||t[o].end!=e[o].end)return!1}return!0}return!1}},props:{contentID_:{get:function(){return s.as(this.controllerMetadata.get(r.PROPERTY_CONTENT_ID),"String")},set:function(t){this.controllerMetadata.set(r.PROPERTY_CONTENT_ID,t)}},wrappingGroupID_:{get:function(){return s.as(this.controllerMetadata.get(r.PROPERTY_WRAPPER_ID),"String")},set:function(t){this.controllerMetadata.set(r.PROPERTY_WRAPPER_ID,t)}},highlightMethod:{get:function(){var t,e;return(t=l.HighlightMethod.toCaseValue((e=s.as(this.controllerMetadata.get(r.PROPERTY_HIGHLIGHTMETHOD_ID),"Int"))||null!=e?e:0))||null!=t?t:l.HighlightMethod.Manual},set:function(t){this.controllerMetadata.set(r.PROPERTY_HIGHLIGHTMETHOD_ID,t)}},charStyleRanges:{get:function(){var t,e=[];if(t=s.as(this.controllerMetadata.get(r.PROPERTY_CHARSTYLERANGES),["Dictionary","String",["Array","Int"]]))for(var n=s.iter(t);!n.done;n.next()){var o=n.key,i=n.value;G.LegacyCoreAssert.isTrue(o==r.HIGHLIGHT_STYLE,"unexpected character style",void 0,"TypeLockupController","TypeLockupController.swift",292);for(var a=s.iter(s.range(0,i.length,!0));!a.done;a.next()){var l=a.value;if(l%2==0&&l<i.length-1){var h=new pt.TextRange(i[l],i[l+1]);e.push(h)}}}return e},set:function(t){for(var e=[],n=s.iter(t);!n.done;n.next()){var o=n.value;e.push(o.start),e.push(o.end)}var i={Highlight:e};this.controllerMetadata.set(r.PROPERTY_CHARSTYLERANGES,s.clone(i))}},processEvent:function(t){var e;return(e=s.as(t,w.BeginPointerTrackingEvent))?(e.trackingResponse=x.BeginPointerTrackingResponseEnum.TrackAsGroup,!1):D.GroupController.prototype.processEvent.call(this,t)},selectable:{get:function(){return!0}},moveable:{get:function(){return null==this.forma.allowUserMove||this.forma.allowUserMove}},duplicatable:{get:function(){return!0}},replaceable:{get:function(){return!0}},flippable:{get:function(){return!1}},copyTo:function(t){void 0===t&&(t=null);var e=this,n=s.opt(t,(function(t){return t.document}))||this.owner.document,o=n.content.createNode(it.TextContentNode.KIND,null);return o.match(this.contentNode),f.CreationFacade.addContent(t||n.firstPage,o,void 0,void 0,new f.AddFormaParams(void 0,!1)).then((function(t){var n,o;return(n=s.as(t,T.Forma))?((o=s.as(n.controller,r))&&o.match(e),n.match(e.forma),s.opt(b.Host.logging,(function(t){return t.logToAnalytics(h.AnalyticsConstants.kAnalyticsDataTextDuplicated,{})})),n):y.CorePromise.reject("didn't get a forma back from addContent?")}))},size:{get:function(){return s.opt(s.opt(this.forma,(function(t){return t.bounds})),(function(t){return t.size}))},set:function(t){var e=dt.TheoRect.fromSize(t),n=s.opt(this.forma,(function(t){return t.bounds}));null!=n&&e.equal(n)||s.opt(this.forma,(function(t){return t.bounds=e}))}},contentDocument:{get:function(){return s.opt(s.opt(this.forma,(function(t){return t.page.document})),(function(t){return t.content}))}},contentID:{get:function(){return this.contentID_},set:function(t){t!=this.contentID_&&(G.LegacyCoreAssert.isFalse(!(null==this.contentID_||""==this.contentID_||null!=t&&""!=t),"Why are we setting a nil/empty text content node id?",void 0,"TypeLockupController","TypeLockupController.swift",480),this.removeListenersFromNode(),this.contentID_=t,this.addListenersToNode(),this.updateGroup())}},lockupForma:{get:function(){return s.as(this.forma,B.GroupForma)}},contentNode:{get:function(){var t=this;return null==this.contentID_?null:s.as(s.opt(this.contentDocument,(function(e){return e.nodeByID(t.contentID_)})),it.TextContentNode)},set:function(t){G.LegacyCoreAssert.isFalse(null==t,"Why are we setting a nil text content node?",void 0,"TypeLockupController","TypeLockupController.swift",499),this.contentID=s.opt(t,(function(t){return t.id})),G.LegacyCoreAssert.isFalse(""==this.contentID,"Why are we setting a text content node with empty id?",void 0,"TypeLockupController","TypeLockupController.swift",501)}},text:{get:function(){var t,e=this;if(null==this.contentNode){var n=s.opt(this.forma,(function(t){return t.formaID!=s.opt(e.forma,(function(t){return t.originalID}))}))?"Forma is a clone":"NOT A CLONE",o=1==this.validDecode_?"VALID DECODE":"Decode not valid";G.LegacyCoreAssert.fail("Why do we have a type lockup with no content node? "+n+" "+o,void 0,"TypeLockupController","TypeLockupController.swift",510)}return(t=s.opt(this.contentNode,(function(t){return t.text})))||null!=t?t:""}},getCurrentMSLPrimaryColor:function(){for(var t=s.iter(this.forma.style.characterStyles);!t.done;t.next()){var e;if(e=t.value.colors.fieldPrimary)return e}return null},getCurrentMSLBackingColor:function(){for(var t=s.iter(this.forma.style.characterStyles);!t.done;t.next()){var e,n=t.value;if((e=n.colors.fieldSecondary)&&n.backing!=Y.LockupBacking.None)return e}return null},settings:{get:function(){return null==this.settings_&&(this.settings_=new k.TypeLockupControllerSettings(this)),this.settings_}},loadFontsForStyle:function(){var t,e=this;(t=s.opt(s.as(s.opt(this.lockupForma,(function(t){return t.style})),Y.LockupStyle),(function(t){return t.font})))&&b.Host.fontProvider.loadFont(t.fontData,(function(){null!=e.lockupForma&&e.updateGroup()}),(function(){return b.Host.logging.warning("Unable to load font "+t.fontData.postScriptName+" for style.")}))},styleChanged:function(){s.opt(s.opt(s.opt(this.forma,(function(t){return t.root})),(function(t){return t.animation})),(function(t){return t.invalidate()})),this.updateGroup()},maintainAspectRatio:{get:function(){var t=s.replaceAll(s.replaceAll(this.text,"\n","")," ","");return this.lockLineBreaks_||this.text==t}},getAlignments:function(t){var e;if(void 0===t&&(t=!1),null==this.localCoordinateAlignmentLines_&&(this.localCoordinateAlignmentLines_=s.clone(this.alignmentsInLocalCoords(t))),e=this.lockupForma){for(var n=[],o=e.totalPlacement,i=this.forma_.visit(T.FormaTraversal.FurthestAncestor,(function(t,e,n){return!0})),r=s.iter(this.localCoordinateAlignmentLines_);!r.done;r.next()){var a=r.value;G.LegacyCoreAssert.isTrue(a.coordinateSpace==e,"alignment line not in lockup coordinate space",void 0,"TypeLockupController.getAlignments","TypeLockupController.swift",597),n.push(new u.AlignmentLine(a.type,a.location,u.AlignmentDetector.ALIGNMENT_FORMA,a.line.transform(o),a.text,i))}return n}return[]},alignmentsInLocalCoords:function(t){void 0===t&&(t=!1);var e,n=[];if(e=this.lockupForma){var o,i,r,a=u.AlignmentEdges.None,l=!1,h=!1,c=!1,g=!1,p=!1,d=!1,f=!1;if(r=this.lockupStyle){if(r.backing!=Y.LockupBacking.None){o=e.childrenBoundsInCoordSpace(V.Matrix2D.Identity);var m=tt.ShapeLibrary.shapeDictionary[r.backingShapeID];null!=m?(a=m.alignmentEdges,l=m.centered):(l=!0,r.backing==Y.LockupBacking.BannerHorizontal?a=u.AlignmentEdges.TopAndBottom:r.backing==Y.LockupBacking.BannerVertical?a=u.AlignmentEdges.LeftAndRight:r.backing==Y.LockupBacking.Knockout?(a=u.AlignmentEdges.None,o=null,l=!1):a=u.AlignmentEdges.All)}null!=o&&(0!=(s.toInt(a)&s.toInt(u.AlignmentEdges.CenterX))&&(n.push(new u.AlignmentLine(u.AlignmentType.CenterX,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,o.verticalLine(.5),!0,e)),d=!0),0!=(s.toInt(a)&s.toInt(u.AlignmentEdges.Left))&&(n.push(new u.AlignmentLine(u.AlignmentType.Left,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,o.verticalLine(0),!1,e)),h=!0),0!=(s.toInt(a)&s.toInt(u.AlignmentEdges.Right))&&(n.push(new u.AlignmentLine(u.AlignmentType.Right,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,o.verticalLine(1),!1,e)),c=!0),0!=(s.toInt(a)&s.toInt(u.AlignmentEdges.CenterY))&&(n.push(new u.AlignmentLine(u.AlignmentType.CenterY,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,o.horizontalLine(.5),!0,e)),f=!0),0!=(s.toInt(a)&s.toInt(u.AlignmentEdges.Top))&&(n.push(new u.AlignmentLine(u.AlignmentType.Top,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,o.horizontalLine(0),!1,e)),p=!0),0!=(s.toInt(a)&s.toInt(u.AlignmentEdges.Bottom))&&(n.push(new u.AlignmentLine(u.AlignmentType.Bottom,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,o.horizontalLine(1),!1,e)),g=!0)),null==(i=this.textBoundsInCoordSpace(V.Matrix2D.Identity))||null!=o&&l&&a==u.AlignmentEdges.All||((null==o||!l||!(h||d||c))&&(this.numLines()<=1||s.opt(this.lockupStyle,(function(t){return t.alignment==Y.LockupAlignment.UNSET}))?(n.push(new u.AlignmentLine(u.AlignmentType.CenterX,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,i.verticalLine(.5),!0,e)),n.push(new u.AlignmentLine(u.AlignmentType.Left,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,i.verticalLine(0),!0,e)),n.push(new u.AlignmentLine(u.AlignmentType.Right,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,i.verticalLine(1),!0,e))):s.opt(this.lockupStyle,(function(t){return t.alignment==Y.LockupAlignment.Center}))?n.push(new u.AlignmentLine(u.AlignmentType.CenterX,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,i.verticalLine(.5),!0,e)):s.opt(this.lockupStyle,(function(t){return t.alignment==Y.LockupAlignment.Left}))?n.push(new u.AlignmentLine(u.AlignmentType.Left,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,i.verticalLine(0),!0,e)):s.opt(this.lockupStyle,(function(t){return t.alignment==Y.LockupAlignment.Right}))&&n.push(new u.AlignmentLine(u.AlignmentType.Right,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,i.verticalLine(1),!0,e))),(null==o||!l||!(p||f||g))&&(s.opt(this.lockupStyle,(function(t){return t.verticalAlignment==Y.VerticalLockupAlignment.UNSET}))?(n.push(new u.AlignmentLine(u.AlignmentType.CenterY,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,i.horizontalLine(.5),!0,e)),n.push(new u.AlignmentLine(u.AlignmentType.Top,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,i.horizontalLine(0),!0,e)),n.push(new u.AlignmentLine(u.AlignmentType.Bottom,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,i.horizontalLine(1),!0,e))):s.opt(this.lockupStyle,(function(t){return t.verticalAlignment==Y.VerticalLockupAlignment.VerticalCenter}))?n.push(new u.AlignmentLine(u.AlignmentType.CenterY,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,i.horizontalLine(.5),!0,e)):s.opt(this.lockupStyle,(function(t){return t.verticalAlignment==Y.VerticalLockupAlignment.Top}))?n.push(new u.AlignmentLine(u.AlignmentType.Top,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,i.horizontalLine(0),!0,e)):s.opt(this.lockupStyle,(function(t){return t.verticalAlignment==Y.VerticalLockupAlignment.Bottom}))&&n.push(new u.AlignmentLine(u.AlignmentType.Bottom,u.AlignmentLocation.Forma,u.AlignmentDetector.ALIGNMENT_FORMA,i.horizontalLine(1),!0,e))))}}return n},processFormaDoubleClick:function(t){this.owner.selection.replaceSelection(t.forma),this.owner.selection.isSelected(t.forma)&&(s.opt(b.Host.logging,(function(t){return t.logToAnalytics(h.AnalyticsConstants.kAnalyticsDataTextDoubleTapEnterTextEditor,{})})),this.owner.controllerSettingsState.settings=this.settings)},isResizing:{get:function(){var t,e=this;return null!=this.startSize_&&!(((t=s.opt(this.owner,(function(t){return t.selection.inSpacingMode})))||null!=t)&&t&&s.opt(this.resizePin_,(function(t){return.5==t.x||s.opt(e.resizePin_,(function(t){return.5==t.y}))})))}},isResizingHorizontally:{get:function(){return this.isResizing&&s.opt(this.resizePin_,(function(t){return.5==t.y}))}},canResizeHorizontally:{get:function(){if(s.opt(this.lockupStyle,(function(t){return t.layout==Y.LockupLayout.Standard}))){var t=s.replaceAll(this.text,"\n","");return st.TypeLockupUtils.getBreakRanges(t).length>1}return!1}},processBeginFormaResize:function(t){D.GroupController.prototype.processBeginFormaResize.call(this,t),this.startSize_=this.size,this.resizePin_=t.spot,this.passedARThreshold_=!1,s.opt(s.opt(s.opt(this.forma,(function(t){return t.root})),(function(t){return t.animation})),(function(t){return t.invalidate()})),this.updateBannerRatio(),this.styleController.resetSessionContainerSize()},processFormaResize:function(t){var e,n,o,i;if((e=this.forma)&&(n=this.size)&&(o=t.newSize)&&(i=e.bounds)){var r,a=null,l=null;if(f=t.pin){var s=this.isResizingHorizontally?0:f.y;a=new gt.TheoPoint(f.x,s),l=e.placement.transformPoint(i.eval(a))}if(this.isResizingHorizontally){var h=e.placement.transformValues,u=Math.abs(h.xscale);if(Math.abs(u-1)>.001){this.beginBlockedUpdate();var c=e.placement.extractedScale;e.placement=c.matrix,this.size=n.multiply(u),this.endBlockedUpdate(),this.renderedLayoutResults_=null,this.renderedConfiguration_=null}null==this.renderedLayoutResults_&&this.internalUpdateGroup(!0)}else if(r=this.startSize_){var g=r.similarity(o);g<.03?(g<.005&&(this.passedARThreshold_=!1),this.passedARThreshold_||(o=r.myAspectRatioClosestCorner(o))):this.passedARThreshold_=!0}this.updateBanner(o);var p,d,f,m,y=new M.FormaTransformChangedEvent(e);if(e.beginUpdate(y),c=e.placement.extractedScale,e.placement=c.matrix,this.size=o,this.isResizingHorizontally&&(p=this.renderedLayoutResults_)){var k=p.size,L=k.height,S=Math.max(o.width,k.width);this.recordSize(new mt.TheoSize(S,L))}if((d=l)&&(f=a)&&(m=e.bounds)){var v=e.placement.transformPoint(m.eval(f));e.move(V.Matrix2D.translation(d.subtract(v)))}e.endUpdate(y),this.updateParentGroup()}},processEndFormaResize:function(t){D.GroupController.prototype.processEndFormaResize.call(this,t),this.snapSizeToBounds();var e=this.isResizingHorizontally?"side":"corner";s.opt(b.Host.logging,(function(t){return t.logToAnalytics(h.AnalyticsConstants.kAnalyticsDataTextFrameEdited,{contextualData1:"handle:"+e})})),this.startSize_=null,this.resizePin_=null,this.invalidateStyleScores()},processEndFormaDrag:function(t){D.GroupController.prototype.processEndFormaDrag.call(this,t)},invalidateStyleScores:function(){this.styleController_.hasScoresForAttributes=!1},addListenersToNode:function(){var t=this;0==this.changeSubscriptions_.length&&null!=this.contentNode&&this.changeSubscriptions_.push(this.contentNode.subscribeWithCallbackToTextModel((function(e){return s.opt(t,(function(t){return t.updateGroup()}))}),ht.TextModelDidInsertMessage.TYPE))},removeListenersFromNode:function(){for(;this.changeSubscriptions_.length>0;)this.changeSubscriptions_.pop().unsubscribe()},bannerRatio:{get:function(){return this.bannerRatio_},set:function(t){this.bannerRatio_=t}},styleController:{get:function(){return this.styleController_}},updateBannerRatio:function(){var t;(t=this.lockupStyle)&&(t.backing!=Y.LockupBacking.Banner&&t.backing!=Y.LockupBacking.BannerHorizontal&&t.backing!=Y.LockupBacking.BannerVertical||(t.backing==Y.LockupBacking.BannerHorizontal&&this.size.width<this.size.height?this.bannerRatio=this.size.height/this.size.width+.1:t.backing==Y.LockupBacking.BannerVertical&&this.size.height<this.size.width?this.bannerRatio=this.size.width/this.size.height+.1:this.bannerRatio=r.DEFAULT_BANNER_RATIO))},updateBanner:function(t){var e;(e=this.lockupStyle)&&(e.backing!=Y.LockupBacking.Banner&&e.backing!=Y.LockupBacking.BannerHorizontal&&e.backing!=Y.LockupBacking.BannerVertical||(e.backing==Y.LockupBacking.BannerVertical&&t.width/t.height>this.bannerRatio?(e.backing=Y.LockupBacking.BannerHorizontal,this.bannerRatio=r.DEFAULT_BANNER_RATIO):e.backing==Y.LockupBacking.BannerHorizontal&&t.height/t.width>this.bannerRatio&&(e.backing=Y.LockupBacking.BannerVertical,this.bannerRatio=r.DEFAULT_BANNER_RATIO)))},shift:function(t,e){return new pt.TextRange(t.start+e,t.end+e)},onStyleApplication:function(){this.loadFontsForStyle(),this.updateGroup()},layoutStrategyForConfiguration:function(t){return null!=this.layoutStrategy_&&this.layoutStrategy_.supportsConfiguration(t)?this.layoutStrategy_:this.layoutStrategyForLayout(t.style.layout,t.style.alignment)},layoutStrategyForLayout:function(t,e){return Y.LockupStyle.isAutoLayout(t)?new c.AutoTextLayoutStrategy:t==Y.LockupLayout.FitJustified?new v.EvenRowWidthsLayoutStrategy:t==Y.LockupLayout.Standard?new S.EvenRowHeightsLayoutStrategy(e):Y.LockupStyle.isLetterGrid(t)?new N.LetterGridLayoutStrategy:Y.LockupStyle.isPath(t)?new Q.PathLayoutStrategy:(G.LegacyCoreAssert.fail("Unknown Layout",{layout:t},"TypeLockupController.layoutStrategyForLayout","TypeLockupController.swift",1102),new S.EvenRowHeightsLayoutStrategy(Y.LockupAlignment.Left))},decorationStrategyForConfiguration:function(t){if(null!=this.decorationStrategy_&&this.decorationStrategy_.supportsConfiguration(t))return this.decorationStrategy_;var e=null,n=t.style.backing;return Y.LockupStyle.isLetterGrid(t.style.layout)?e=new O.LetterDecorationStrategy:n==Y.LockupBacking.None?e=new K.NoDecorationStrategy:n==Y.LockupBacking.Rows?e=new q.RowsDecorationStrategy:n==Y.LockupBacking.Knockout?e=new q.KnockoutDecorationStrategy:n==Y.LockupBacking.Banner||n==Y.LockupBacking.BannerVertical||n==Y.LockupBacking.BannerHorizontal?e=new g.BannerDecorationStrategy:n==Y.LockupBacking.SVGBackground?null!=t.style.backingArtworkID?e=new nt.SVGBackgroundDecorationStrategy(t.style.backingArtworkID):(b.Host.logging.warning("Error in svg background. nil backingArtworkID. defaulting to no backing"),e=new K.NoDecorationStrategy):(G.LegacyCoreAssert.fail("Unimplemented value for lockup layout.",void 0,"TypeLockupController.decorationStrategyForConfiguration","TypeLockupController.swift",1135),e=new K.NoDecorationStrategy),e},styleFontsLoaded:function(){var t;return!(t=s.opt(s.as(s.opt(this.lockupForma,(function(t){return t.style})),Y.LockupStyle),(function(t){return t.font})))||t.fontData.availability==R.FontAvailability.LOADED},updatePoolForItems:function(t,e){for(var n,o=0,i={},r=s.iter(t);!r.done;r.next()){var a=r.value;if(a.type==U.LockupItemType.Text){var l=a.text.toUpperCase(),h=(n=i[l])||null!=n?n:0;i[l]=h+1}else o+=1}for(var u=s.iter(e.configureTextFormae(s.clone(i)));!u.done;u.next()){var c=u.value;s.opt(c.parent,(function(t){return t.removeChild(c)}))}for(var g=s.iter(e.configureShapeFormae(o));!g.done;g.next())c=g.value,s.opt(c.parent,(function(t){return t.removeChild(c)}))},conformFormaeForItems:function(t,e,n,o){var i,r;if(void 0===n&&(n=!1),void 0===o&&(o=!1),r=s.as(s.opt(this.lockupForma,(function(t){return t.root})),j.RootForma)){var a=new M.FormaGeometryChangedEvent(r);r.beginUpdate(a);for(var l={},h=0,u=s.iter(t);!u.done;u.next()){var c,g,p,d=u.value;switch(d.type){case 0:var f,m,y=d.text.toUpperCase(),k=(i=l[y])||null!=i?i:0;c=L=e.nthTextFormaForString(k,y),l[y]=k+1,g=o?0:1,(f=c.parent)&&(m=s.as(s.opt(this.wrappingGroup_,(function(t){return t.childAt(g)})),B.GroupForma))&&f!==m&&f.removeChild(c);break;case 1:var L=e.nthShapeForma(h);this.conformShapeFormaToItem(L,d,!1),c=L,h+=1,g=0;break;case 2:L=e.nthShapeForma(h),this.conformShapeFormaToItem(L,d,!1),c=L,h+=1,g=0}if(c.isFullCanvas=d.isFullCanvas,0==g&&(p=c.parent)){var S=n?e.shapeFormaCount()-h:h-1;p.childCount<=S||S<0?(p.removeChild(c),p.appendChild(c,!1)):s.eq(T._equality_Forma_Forma,p.childAt(S),c)||(p.removeChild(c),p.insertChildAt(c,S,!1))}if(null==c.parent){var v=s.as(s.opt(this.wrappingGroup_,(function(t){return t.childAt(g)})),B.GroupForma);null!=v&&(n?v.insertChildAt(c,0,!1):v.appendChild(c,!1))}d.type==U.LockupItemType.Text&&this.conformTextFormaToItem(c,d)}r.endUpdate(a)}},lockupStyle:{get:function(){return s.as(s.opt(this.lockupForma,(function(t){return t.style})),Y.LockupStyle)}},renderedLayoutResults:{get:function(){return this.renderedLayoutResults_}},annotations:{get:function(){var t,e,n;return(t=this.renderedLayoutResults_)?t.annotations:!this.blockUpdate&&(e=this.size)&&(n=this.lockupStyle)?this.layoutStrategyForLayout(n.layout,n.alignment).annotate(this.text,e,n,this.getTextFormaCount()):null}},layoutStrategyPrivate:{get:function(){return this.layoutStrategy_},set:function(t){this.layoutStrategy_=t}},calculateScalarToFit:function(t,e){var n=t.width,o=t.height,i=n/o,r=e.width,a=e.height,l=r/a,s=(i>=l?o:n/l)/a;return isNaN(s)?1:s},scalarToFitLayoutResultsIntolockupForma:function(){var t=this.renderedLayoutResults_;if(null==t)return 1;var e=t.size,n=this.calculateScalarToFit(this.size,e);return isNaN(n)?1:n},wrappingGroup:{get:function(){var t,e=this;return null!=this.wrappingGroup_?this.wrappingGroup_:null!=this.wrappingGroupID_&&(t=s.as(s.opt(this.lockupForma,(function(t){return t.page.formaByID(e.wrappingGroupID_)})),B.GroupForma))?t:s.opt(this.lockupForma,(function(t){return 1==t.childCount}))?s.as(s.opt(this.lockupForma,(function(t){return t.childAt(0)})),B.GroupForma):null}},onFirstUpdate:function(){var t,e=this,n=!1;null!=(t=this.wrappingGroupID_)&&0==s.isEmpty(t)&&(n=!0);var o=null!=this.wrappingGroup_;if(n&&!o&&(this.wrappingGroup_=s.as(s.opt(this.lockupForma,(function(t){return t.page.formaByID(e.wrappingGroupID_)})),B.GroupForma),null==this.wrappingGroup&&(d.CoreAssertDebugOnly.fail("onFirstUpdate has wrappingGroupID_ but can't get wrappingGroup_",void 0,"TypeLockupController.onFirstUpdate","TypeLockupController.swift",1459),n=!1)),0==n&&(G.LegacyCoreAssert.isTrue(null!=this.lockupForma,"onFirstUpdate no lockupForma",void 0,"TypeLockupController.onFirstUpdate","TypeLockupController.swift",1473),(r=s.as(this.lockupForma.isModel?s.opt(this.lockupForma,(function(t){return t.page.createModelForma(B.GroupForma.KIND)})):s.opt(this.lockupForma,(function(t){return t.page.createForma(B.GroupForma.KIND)})),B.GroupForma))&&(s.opt(this.lockupForma,(function(t){return t.removeAllChildren()})),this.wrappingGroup_=r,this.wrappingGroupID_=r.formaID,s.opt(this.lockupForma,(function(t){return t.appendChild(r)})))),G.LegacyCoreAssert.isTrue(null!=this.wrappingGroup_,"onFirstUpdate no wrappingGroup_",void 0,"TypeLockupController.onFirstUpdate","TypeLockupController.swift",1500),0==this.wrappingGroup_.childCount)for(var i=s.iter(s.range(0,2,!1));!i.done;i.next()){var r;(r=s.as(this.lockupForma.isModel?this.lockupForma.page.createModelForma(B.GroupForma.KIND):this.lockupForma.page.createForma(B.GroupForma.KIND),B.GroupForma))&&s.opt(this.wrappingGroup_,(function(t){return t.appendChild(r)}))}this.updateFormaPools()},updateFormaPools:function(){if(this.decorationFormaePool_.clear(),this.layoutFormaePool_.clear(),this.renderedLayoutResults_=null,this.renderedDecorationResults_=null,this.renderedConfiguration_=null,null!=this.wrappingGroup_&&this.wrappingGroup_.childCount>=2){var t,e,n,o,i=!1;if((e=this.lockupStyle)&&(i=e.backing!=Y.LockupBacking.None&&e.textLook==Y.LockupTextLook.FillAndOutline2||Y.LockupStyle.isShadowLook(e.textLook),t=e.colors.fieldPrimary),n=s.as(this.wrappingGroup_.childAt(0),B.GroupForma))for(var r=s.iter(n.childrenAsArray);!r.done;r.next()){var a=r.value;this.decorationFormaePool_.addForma(a)}if(o=s.as(this.wrappingGroup_.childAt(1),B.GroupForma))for(var l=s.iter(o.childrenAsArray);!l.done;l.next())a=l.value,i&&!s.eq(Z._equality_SolidColor_SolidColor,s.opt(s.as(a.style,ft.TextStyle),(function(t){return t.colors.fieldPrimary})),t)?this.decorationFormaePool_.addForma(a):this.layoutFormaePool_.addForma(a)}},recalculateTracking:function(t){var e=this.lockupForma,n=this.lockupStyle,o=this.text,i=new z.LockupConfiguration(o,n,t,e.placement,s.opt(e.parent,(function(t){return t.bounds}))),r=new mt.TheoSize(this.size.width,this.size.height);null==this.layoutStrategy_&&(this.layoutStrategy_=this.layoutStrategyForConfiguration(i));var a=this.layoutStrategy_.calculateTracking(i,r),l=t;0!=a&&a<1e-4&&(l=new mt.TheoSize(-a,l.height),a=0),this.beginBlockedUpdate(),s.opt(s.as(s.opt(this.lockupForma,(function(t){return t.style})),Y.LockupStyle),(function(t){return t.tracking=a})),this.styleController.onTrackingChanged(),this.size=l,this.endBlockedUpdate(),this.internalUpdateGroup(!1)},recalculateLeading:function(t){var e=this.lockupForma,n=this.lockupStyle,o=this.text,i=new z.LockupConfiguration(o,n,t,e.placement,s.opt(e.parent,(function(t){return t.bounds}))),r=new mt.TheoSize(this.size.width,this.size.height);null==this.layoutStrategy_&&(this.layoutStrategy_=this.layoutStrategyForConfiguration(i));var a=this.layoutStrategy_.calculateLeading(i,r),l=t;a<0&&(l=new mt.TheoSize(l.width,-a),a=0),this.beginBlockedUpdate(),s.opt(this.lockupStyle,(function(t){return t.spacing=a})),this.styleController.onSpacingChanged(),this.size=l,this.endBlockedUpdate(),this.internalUpdateGroup(!1)},setLetterSpacingAndBounds:function(t,e){var n;if(void 0===e&&(e=gt.TheoPoint.ZERO),null==this.renderedLayoutResults_&&this.updateGroup(),n=this.renderedLayoutResults_){var o=this.layoutStrategy_.adjustSizeForTracking(this.text,n,this.lockupStyle.tracking,t),i=s.opt(o,(function(t){return t.width})),r=s.opt(o,(function(t){return t.height}));if(0==i&&0==r)return;var a,l=!1,h=0;null!=(a=i)&&(l=!0,h=a);var u,c=0;null!=(u=r)&&(l=!0,c=u);var g=this.forma.placement.transformValues,p=this.forma.bounds,d=new mt.TheoSize(p.width*g.xscale,p.height*g.xscale),f=new mt.TheoSize(d.width+h,d.height+c);if(f.width<=0||f.height<=0)return;if(l){this.beginBlockedUpdate(),this.lockupStyle.tracking=t,this.endBlockedUpdate();var m=new w.FormaResizeEvent(this.forma,f,e);this.onEvent(m),s.opt(this.lockupStyle,(function(t){return t.layout!=Y.LockupLayout.Auto}))&&this.snapSizeToBounds()}else this.lockupStyle.tracking=t}},setLineSpacingAndBounds:function(t,e){var n;if(void 0===e&&(e=gt.TheoPoint.ZERO),null==this.renderedLayoutResults_&&this.updateGroup(),!(this.numLines()-1<1)&&(n=this.renderedLayoutResults_)){var o=this.layoutStrategy_.adjustSizeForLeading(this.forma.bounds,n,this.lockupStyle.spacing,t),i=o.width,r=o.height,a=this.forma.placement.transformValues,l=this.forma.bounds,h=new mt.TheoSize(l.width*a.xscale,l.height*a.xscale),u=new mt.TheoSize(h.width+i,h.height+r);s.opt(this.lockupStyle,(function(t){return t.layout==Y.LockupLayout.Auto}))?this.lockupStyle.spacing=t:(this.beginBlockedUpdate(),this.lockupStyle.spacing=t,this.endBlockedUpdate());var c=new w.FormaResizeEvent(this.forma,u,e);this.onEvent(c),s.opt(this.lockupStyle,(function(t){return t.layout!=Y.LockupLayout.Auto}))&&this.snapSizeToBounds()}},addLineBreakConstraints:function(){this.allowFewerLineBreaks_=!1;var t=s.replaceAll(s.replaceAll(this.text,"\n"," "),"  "," "),e=s.replaceAll(t," ","");this.lockLineBreaks_=t.split(" ").length==e.length,!this.lockLineBreaks_&&this.text.split("\n").length>1&&(this.allowFewerLineBreaks_=!0)},removeLineBreakConstraints:function(){this.lockLineBreaks_=!1,this.allowFewerLineBreaks_=!1},updateGroup:function(){this.internalUpdateGroup(!0)},updateGroupWithFontSize:function(t,e){void 0===e&&(e=null),(this.lockLineBreaks_||this.allowFewerLineBreaks_)&&null!=t?s.opt(b.Host.logging,(function(t){return t.warning("Can't preserve font size while line breaks are constrainted")})):(this.preferredFontSize_=t,this.expansionSize_=e),this.internalUpdateGroup(!0),this.preferredFontSize_=null,this.expansionSize_=null},internalUpdateGroup:function(t){var e;if(!(e=s.opt(s.opt(this.owner,(function(t){return t.document})),(function(t){return t.inUndoRedo})))&&null==e||!e)if(null!=this.lockupForma){if(!this.blockUpdate&&null!=s.as(s.opt(this.lockupForma,(function(t){return t.root})),j.RootForma)&&null!=this.lockupStyle){0==this.hasFirstUpdateRun&&(this.onFirstUpdate(),this.hasFirstUpdateRun=!0);var n=this.lockupForma,o=this.lockupStyle;if(!(null!=this.size&&null!=o.font&&this.styleFontsLoaded()&&o.colors.count>0&&this.text.length>0))return this.renderedConfiguration_=null,this.renderedColorLibrary_=null,this.renderedDecorationResults_=null,this.renderedLayoutResults_=null,this.clearLockupFormaPool(this.layoutFormaePool_),void this.clearLockupFormaPool(this.decorationFormaePool_);var i,a,l=this.text,h=!this.owner.selection.inCharStyleMode,u=this.forceLetterFormaMode,c=new z.LockupConfiguration(l,o,this.styleController.getSessionContainerSize()||this.size,n.placement,s.opt(n.parent,(function(t){return t.bounds})),h,u,this.preferredFontSize_,this.expansionSize_);if(c.characterStyleRanges=s.clone(this.charStyleRanges),c.highlightMethod=this.highlightMethod,c.rowWordLengths=null,this.lockLineBreaks_||this.allowFewerLineBreaks_){for(var g=s.clone(this.lockupForma.filterByKind(at.TextForma.KIND)),p=0,d=s.iter(g);!d.done;d.next()){var f=d.value;p=Math.max(p,f.rowIndex)}c.rowWordLengths=s.repeat(0,p+1);for(var y=s.iter(g);!y.done;y.next())f=y.value,c.rowWordLengths[f.rowIndex]+=1;c.allowFewerLineBreaks=this.allowFewerLineBreaks_}(i=o.colors.fieldPrimary)&&(this.currentPrimaryColor=i),(a=o.colors.fieldSecondary)&&(this.currentSecondaryColor=a),this.decorationStrategy_=this.decorationStrategyForConfiguration(c),this.layoutStrategy_=this.layoutStrategyForConfiguration(c);var k=s.opt(this.renderedConfiguration_,(function(t){return t.useOptimization==h})),L=null==this.renderedConfiguration_||null==this.renderedLayoutResults_||Math.abs(this.size.height-this.thresholdGroupHeight)>1||Math.abs(this.size.width-this.thresholdGroupWidth)>1||this.renderedConfiguration_.text!=c.text||c.style.needsLayout(this.renderedConfiguration_.style)||!r.rangesEqual(s.clone(this.renderedConfiguration_.characterStyleRanges),s.clone(c.characterStyleRanges))||this.renderedConfiguration_.highlightMethod!=c.highlightMethod||0==this.layoutFormaePool_.textFormaCount()||this.renderedConfiguration_.forceLetterForma!=c.forceLetterForma||!k;if(!L)for(var S=s.iter(c.style.characterStyles);!S.done;S.next()){var v=S.key,T=S.value;if(!(w=this.renderedConfiguration_.style.characterStyles[v])){L=!0;break}if(w.colorLibrary=this.renderedColorLibrary_,G.LegacyCoreAssert.isTrue(T.colorLibrary==o.colorLibrary,"char style library doesnt match lockup style",void 0,"TypeLockupController.internalUpdateGroup","TypeLockupController.swift",1900),T.needsLayout(w)||T.textOpacity!=w.textOpacity||T.backingOpacity!=w.backingOpacity){L=!0;break}}var F=L||!c.style.sameColors(this.renderedConfiguration_.style),C=null==this.renderedConfiguration_||c.style.needsLayout(this.renderedConfiguration_.style),x=null==this.renderedConfiguration_||L||!this.renderedConfiguration_.containerSize.equal(c.containerSize)||!this.renderedConfiguration_.placement.equal(c.placement)||this.renderedConfiguration_.style.backingArtworkID!=c.style.backingArtworkID||this.renderedConfiguration_.style.backing!=c.style.backing||this.renderedConfiguration_.style.textLook!=c.style.textLook||this.renderedConfiguration_.style.shadowAngle!=c.style.shadowAngle||F&&Y.LockupStyle.isShadowLook(c.style.textLook);if(!x)for(var R=s.iter(c.style.characterStyles);!R.done;R.next()){var w;if(v=R.key,T=R.value,x=F&&T.textLook==Y.LockupTextLook.KnockoutAndShadow,(w=this.renderedConfiguration_.style.characterStyles[v])&&(T.backingArtworkID!=w.backingArtworkID||T.shadowAngle!=w.shadowAngle)){x=!0;break}}if(this.isRightToLeft=st.TypeLockupUtils.isTextRightToLeft(l),L){var A,_,M,I;this.isResizing&&k&&(_=this.renderedLayoutResults_)&&(M=this.renderedConfiguration_)&&(I=this.size)&&(A=this.layoutStrategy_.reflow(I,this.resizePin_,M,_));var D=A||this.layoutStrategy_.layout(c);this.isRightToLeft&&D.flipForRightToLeft(),this.updatePoolForItems(s.clone(D.items),this.layoutFormaePool_),this.renderedLayoutResults_=D}var B=c.style.backing==Y.LockupBacking.None,H=!1;if(x){var P=this.decorationStrategy_.decorate(c,this.renderedLayoutResults_);if((T=c.style.characterStyles[r.HIGHLIGHT_STYLE])&&!Y.LockupStyle.isPath(c.style.layout)&&!Y.LockupStyle.isAutoLayout(c.style.layout)){if(Y.LockupStyle.isShadowLook(T.textLook)){var E=(new J.ShadowDecorationStrategy).decorate(c,this.renderedLayoutResults_);s.append(P.items,E.items),B=!0,H=T.textLook==Y.LockupTextLook.KnockoutAndShadow}if(c.style.backing!=Y.LockupBacking.None&&T.textLook==Y.LockupTextLook.FillAndOutline2){var O=(new K.NoDecorationStrategy).decorate(c,this.renderedLayoutResults_);s.append(P.items,O.items),B=!0}if((T.backing==Y.LockupBacking.Rows||T.backing==Y.LockupBacking.SVGBackground)&&c.style.backing!=Y.LockupBacking.Rows&&!Y.LockupStyle.isLetterGrid(c.style.layout)){var N=(new q.RowsDecorationStrategy).decorate(c,this.renderedLayoutResults_);if(B&&P.items.length>1)for(var U=s.iter(N.items);!U.done;U.next()){var W=U.value;P.items.splice(0,0,W)}else s.append(P.items,N.items)}}if(c.style.backing!=Y.LockupBacking.None&&c.style.textLook==Y.LockupTextLook.FillAndOutline2){var X=(new K.NoDecorationStrategy).decorate(c,this.renderedLayoutResults_);s.append(P.items,X.items),B=!0}else if(Y.LockupStyle.isShadowLook(c.style.textLook)){var Q=(new J.ShadowDecorationStrategy).decorate(c,this.renderedLayoutResults_);s.append(P.items,Q.items),B=!0,H=c.style.textLook==Y.LockupTextLook.KnockoutAndShadow}this.updatePoolForItems(s.clone(P.items),this.decorationFormaePool_),this.renderedDecorationResults_=P}(F||L)&&this.conformFormaeForItems(s.clone(this.renderedLayoutResults_.items),this.layoutFormaePool_),(F||x)&&this.conformFormaeForItems(s.clone(this.renderedDecorationResults_.items),this.decorationFormaePool_,B,H);var Z=this.renderedLayoutResults_.size.width,$=this.renderedLayoutResults_.size.height;this.thresholdGroupHeight=this.size.height,this.thresholdGroupWidth=this.size.width,this.setLayerOpacities(o);var tt=this.findInternalOffset(o,this.size,new mt.TheoSize(Z,$));this.updateChildGroupBounds(),t&&s.opt(this.wrappingGroup,(function(t){return t.placement=V.Matrix2D.Identity.translate(tt)})),this.localCoordinateAlignmentLines_=s.clone(this.alignmentsInLocalCoords(!0)),(L||x)&&s.opt(s.opt(this.lockupForma,(function(t){return t.animation})),(function(t){return t.invalidate()})),c.style=o.clone(),this.renderedColorLibrary_=m.ColorLibrary.init_fcb1(o.colorLibrary),this.renderedConfiguration_=c,this.renderedConfiguration_.style.colorLibrary=this.renderedColorLibrary_,L&&this.highlightMethod>=r.FIRST_AUTO_METHOD&&this.highlightMethod<=r.MAX_AUTO_METHOD&&(this.autoApplyCharStyle(!0,!1,!0),C&&this.updateGroup())}}else s.opt(b.Host.logging,(function(t){return t.warning("TypeLockupController.updateGroup() after detachment")}))},setLayerOpacities:function(t){var e=t.currentTextOpacity,n=t.currentBackingOpacity,o=s.as(s.opt(this.wrappingGroup_,(function(t){return t.childAt(1)})),B.GroupForma);s.opt(o,(function(t){return t.style.opacity=e})),o=s.as(s.opt(this.wrappingGroup_,(function(t){return t.childAt(0)})),B.GroupForma),s.opt(o,(function(t){return t.style.opacity=n}))},updateChildGroupBounds:function(){var t,e;if(t=this.wrappingGroup_){var n=new M.FormaGeometryChangedEvent(t);t.beginUpdate(n),t.endUpdate(n)}(e=s.as(s.opt(this.wrappingGroup_,(function(t){return t.childAt(1)})),B.GroupForma))&&(n=new M.FormaGeometryChangedEvent(e),e.beginUpdate(n),e.endUpdate(n)),(e=s.as(s.opt(this.wrappingGroup_,(function(t){return t.childAt(0)})),B.GroupForma))&&(n=new M.FormaGeometryChangedEvent(e),e.beginUpdate(n),e.endUpdate(n))},findInternalOffset:function(t,e,n){var o=0,i=0,r=(e.width-n.width)/2,a=(e.height-n.height)/2,l=t.alignment,h=t.verticalAlignment;return this.isResizingHorizontally&&(l=s.opt(this.resizePin_,(function(t){return 0==t.x?Y.LockupAlignment.Right:Y.LockupAlignment.Left})),h=Y.VerticalLockupAlignment.Top),l==Y.LockupAlignment.UNSET||l==Y.LockupAlignment.Center?o=r:l==Y.LockupAlignment.Right&&(o=e.width-n.width),h==Y.VerticalLockupAlignment.UNSET||h==Y.VerticalLockupAlignment.VerticalCenter?i=a:h==Y.VerticalLockupAlignment.Bottom&&(i=e.height-n.height),new gt.TheoPoint(o,i)},conformTextFormaToItem:function(t,e){var n,o,i=this;if(e.type==U.LockupItemType.Text){var r,a,l=e.font,h=e.hasPrimaryColor?this.currentPrimaryColor:this.currentSecondaryColor,u=this.currentSecondaryColor,c=this.lockupStyle.textLook;t.style.opacity=1,null!=e.characterStyle&&(f=s.opt(this.lockupStyle,(function(t){return t.characterStyles[e.characterStyle]})))&&(f.textLook!=Y.LockupTextLook.UNSET&&(c=f.textLook),G.LegacyCoreAssert.isTrue(f.colorLibrary==this.lockupStyle.colorLibrary,"char style library doesnt match lockup style",void 0,"TypeLockupController.conformTextFormaToItem","TypeLockupController.swift",2223),(r=e.hasPrimaryColor?f.colors.fieldPrimary:f.colors.fieldSecondary)&&(h=r),(a=f.colors.fieldSecondary)&&(u=a),f.opacityRule!=Y.OpacityRule.UNSET&&(t.style.opacity=f.textOpacity),f.textLook==Y.LockupTextLook.Fill&&Y.LockupStyle.isKnockoutLook(this.lockupStyle.textLook)&&f.textOpacity<1&&f.textOpacity!=Y.LockupStyle.OPACITY_UNSET&&(c=Y.LockupTextLook.KnockoutAndFill));var g=(n=s.opt(this.renderedLayoutResults_,(function(t){return t.avgTextPointSize})))||null!=n?n:e.pointSize,p=0,d=this.lockupStyle.strokeWeight+.04;if(c==Y.LockupTextLook.OutlineOnly)p=.5*g*d;else if(c==Y.LockupTextLook.KnockoutAndOutline)p=.5*g*d,u=h;else if(c==Y.LockupTextLook.FillAndOutline)p=.5*g*d;else if(c==Y.LockupTextLook.ShadowAndOutline)p=.08*g*(d+.25);else if(c==Y.LockupTextLook.KnockoutAndShadow){var f;e.hasPrimaryColor||(p=.08*e.pointSize*(1.7*this.lockupStyle.shadowOffset+.25),t.style.opacity=.75,h=this.currentPrimaryColor,u=this.currentPrimaryColor,null!=e.characterStyle&&(f=s.opt(this.lockupStyle,(function(t){return t.characterStyles[e.characterStyle]})))&&(h=f.colors.fieldPrimary||this.currentPrimaryColor,u=f.colors.fieldPrimary||this.currentPrimaryColor))}else c==Y.LockupTextLook.FillAndOutline2?e.hasPrimaryColor||(p=.5*g*d):c==Y.LockupTextLook.KnockoutAndFill&&s.opt(this.lockupStyle,(function(t){return t.colors.colorID(L.ColorRole.FieldPrimary)==s.opt(i.lockupStyle,(function(t){return t.colors.colorID(L.ColorRole.FieldSecondary)}))}))&&(p=((o=s.opt(this.lockupStyle,(function(t){return t.backingOpacity})))||null!=o?o:1)>.8?6:1);e.hasPrimaryColor&&Y.LockupStyle.isKnockoutLook(c)&&c!=Y.LockupTextLook.KnockoutAndFill&&(h=Z.SolidColor.BLACK);var m=p==at.TextForma.STROKEWIDTH_ZERO?null:p,y=c==Y.LockupTextLook.Fill?null:c,k=s.opt(this.lockupStyle,(function(t){return t.tracking==at.TextForma.TRACKING_ZERO}))?null:s.opt(this.lockupStyle,(function(t){return t.tracking}));t.setTextProperties(e.text,l,e.pointSize,h,u,m,y,k,e.rangeInLockup,e.rowIndex),t.placement=e.placement}else G.LegacyCoreAssert.fail("Expected text item",void 0,"TypeLockupController.conformTextFormaToItem","TypeLockupController.swift",2206)},conformShapeFormaToItem:function(t,e,n){var o=null;n&&((o=new M.FormaAnimationTransactionEvent(t)).duration=0,t.beginUpdate(o)),t.style.opacity=1;var i,r,a=e.hasPrimaryColor?this.currentPrimaryColor:this.currentSecondaryColor;switch(null!=e.characterStyle&&(i=s.opt(this.lockupStyle,(function(t){return t.characterStyles[e.characterStyle]})))&&(G.LegacyCoreAssert.isTrue(i.colorLibrary==this.lockupStyle.colorLibrary,"char style library doesnt match lockup style",void 0,"TypeLockupController.conformShapeFormaToItem","TypeLockupController.swift",2332),(r=e.hasPrimaryColor?i.colors.fieldPrimary:i.colors.fieldSecondary)&&(a=r),i.opacityRule!=Y.OpacityRule.UNSET&&(t.style.opacity=i.backingOpacity)),e.type){case 0:G.LegacyCoreAssert.fail("Text item cannot be associated with a shape forma",void 0,"TypeLockupController.conformShapeFormaToItem","TypeLockupController.swift",2345);break;case 1:t.contentID=null,t.preScale=null,t.size=e.size,t.sliceBox=null,t.shapeLibraryID=null,t.canonicalArtwork=ot.TheoArtworkShape.fromPath(e.path),t.style.colors.fieldPrimary=a,t.placement=e.placement;break;case 2:if(t.shapeLibraryID!=e.artworkID&&tt.ShapeLibrary.applyToShapeForma(t,e.artworkID),null==t.sliceBox){var l=t.canonicalArtwork.bounds,h=l.width,u=l.height,c=e.size,g=c.width<=c.height?c.width/h:c.height/u;h*=g,u*=g,t.size=new mt.TheoSize(h,u)}else t.size=e.size;t.preScale=e.preScale,t.placement=e.placement,t.style.colors.fieldPrimary=a}n&&t.endUpdate(o)},decodeMetadata:function(){var t,e;this.beginBlockedUpdate(),(t=s.as(this.controllerMetadata.get(r.PROPERTY_LOCKUPSTYLE_DEPRECATED),Y.LockupStyle))&&(t.backing==Y.LockupBacking.Banner&&(t.backing=this.size.width>this.size.height?Y.LockupBacking.BannerHorizontal:Y.LockupBacking.BannerVertical),s.opt(this.lockupForma,(function(e){return e.applyStyle(t)}))),(e=s.as(this.controllerMetadata.get(r.PROPERTY_SIZE_DEPRECATED),mt.TheoSize))&&(this.size=e),this.endBlockedUpdate()},postDecode:function(){var t,e,n;this.validDecode_=null!=this.contentNode,this.beginBlockedUpdate(),this.styleController_.legacyColorConversion(),this.endBlockedUpdate();var o,i=(t=s.opt(s.opt(this.lockupForma,(function(t){return t.page.document})),(function(t){return t.versionDecoded.vers})))||null!=t?t:0,a=!1;if(G.LegacyCoreAssert.isTrue(this.lockupForma.controller===this,"Controller-forma mismatch",void 0,"TypeLockupController.postDecode","TypeLockupController.swift",2443),o=s.as(s.opt(this.lockupForma,(function(t){return t.style})),Y.LockupStyle)){var l,h;if(o.backing==Y.LockupBacking.SVGBackground&&(null==o.backingArtworkID&&(G.LegacyCoreAssert.fail("postDecode - style.backingArtworkID is nil.",{version:(e=s.opt(s.opt(this.lockupForma,(function(t){return t.page.document})),(function(t){return t.versionDecoded.description})))||null!=e?e:"nil"},"TypeLockupController.postDecode","TypeLockupController.swift",2451),o.backingArtworkID="square_001"),null!=(l=o.backingArtworkID)&&(h=this.contentDocument.nodeWithTag(tt.TAG_SHAPE_ID,l))&&h.removeFromParent()),i<rt.TheoDocumentVersion.Knockouts&&o.backing==Y.LockupBacking.None&&1!=o.textOpacity){var u=o.textOpacity,c=o.backingOpacity;o.textOpacity=u,o.backingOpacity=c}var g,p=Y.LockupStyle.isKnockoutLook(o.textLook);if((g=o.characterStyles[r.HIGHLIGHT_STYLE])&&(p=p||Y.LockupStyle.isKnockoutLook(g.textLook)),p){var d=o.backing;o.backing=Y.LockupBacking.None,o.backing=d}var f=(n=s.opt(s.opt(this.forma,(function(t){return t.page.document})),(function(t){return t.missingFontList.length})))||null!=n?n:0;if(f>this.missingFontCount_?(a=!0,this.missingFontCount_=f):i<rt.TheoDocumentVersion.LetterSpacing&&s.opt(o.font,(function(t){return"Pacifico-Regular"==t.fontData.postScriptName||s.opt(o.font,(function(t){return"Montserrat-Regular"==t.fontData.postScriptName}))}))&&(a=!0),i<rt.TheoDocumentVersion.NewTextAnimations&&(this.text.includes("–")||this.text.includes("—"))&&0==o.spacing&&(o.spacing=.5,a=!0),i<rt.TheoDocumentVersion.TextEffects&&null!=this.contentNode){var m=ht.ContentTextModel.init_d41d();m.match(this.contentNode.textModel),this.contentNode.textModel=m}this.text.trim().length>0&&!this.hasTextFormae()&&(null==o.font?o.font=lt.TheoFont.init_9e5c(b.Host.textModelUtils.defaultFont()):a=!0)}var y,k=!1;null!=(y=this.wrappingGroupID_)&&0==s.isEmpty(y)&&(k=!0),this.removeListenersFromNode(),this.addListenersToNode(),a?this.styleChanged():k||this.updateGroup()},replaceFonts:function(t,e){this.beginBlockedUpdate();var n=this.replaceFontInStyle(this.lockupStyle,s.clone(t),e),o=this.replaceFontInStyle(s.opt(this.lockupStyle,(function(t){return t.characterStyles[r.HIGHLIGHT_STYLE]})),s.clone(t),e);this.endBlockedUpdate(),(n||o)&&(this.clearLockupFormaPool(this.layoutFormaePool_),this.styleChanged())},replaceFontInStyle:function(t,e,n){var o;return!(null==(o=s.opt(s.opt(t,(function(t){return t.font})),(function(t){return t.fontData.postScriptName})))||!e.includes(o)||(s.opt(t,(function(t){return t.font=n})),0))},clone:function(t){var e=new C.FormaControllerFactory(this.owner).createController(this.kind,t);return e.beginBlockedUpdate(),e.controllerMetadata=t.controllerMetadata,e.size=this.size,e.highlightMethod=this.highlightMethod,e.charStyleRanges=s.clone(this.charStyleRanges),e.contentID=this.contentID,e.validDecode_=this.validDecode_,e.removeListenersFromNode(),e.endBlockedUpdate(),e},match:function(t){var e;(e=s.as(t,r))?(this.size=e.size,this.highlightMethod=e.highlightMethod,0==s.count(s.opt(this.lockupStyle,(function(t){return t.characterStyles})))&&0==!this.charStyleRanges.length?this.charStyleRanges=[]:st.TypeLockupUtils.rangesAreEqual(s.clone(this.charStyleRanges),s.clone(e.charStyleRanges))||this.text==e.text&&(this.charStyleRanges=s.clone(e.charStyleRanges)),this.updateGroup()):D.GroupController.prototype.match.call(this,t)},formaWillChangeState:function(t,e){var n=this;if(null!=e[B.GroupForma.PROPERTY_BOUNDS]||null!=e[T.Forma.PROPERTY_STYLE]||null!=e[T.Forma.PROPERTY_PLACEMENT]){t.visitAll(T.FormaTraversal.PreOrder,(function(t){(t instanceof $.ShapeForma||t instanceof at.TextForma)&&(n.formaUpdateEvents_.push(new M.FormaGeometryChangedEvent(t)),null!=e[T.Forma.PROPERTY_STYLE]&&n.formaUpdateEvents_.push(new M.FormaStyleChangedEvent(t)))}));for(var o=s.iter(this.formaUpdateEvents_);!o.done;o.next()){var i=o.value;i.forma.beginUpdate(i)}}},formaDidChangeState:function(t,e){if(null!=e[B.GroupForma.PROPERTY_BOUNDS]||null!=e[T.Forma.PROPERTY_STYLE]||null!=e[T.Forma.PROPERTY_PLACEMENT]){for(var n=s.iter(this.formaUpdateEvents_);!n.done;n.next()){var o=n.value;o.forma.endUpdate(o)}this.formaUpdateEvents_.splice(0)}},formaWillCommitState:function(t){D.GroupController.prototype.formaWillCommitState.call(this,t),this.shrinkPools=!0},shrinkPools:{get:function(){return this.layoutFormaePool_.shrinkPools_},set:function(t){this.layoutFormaePool_.shrinkPools_=t,this.decorationFormaePool_.shrinkPools_=t,t&&(null!=this.renderedLayoutResults_&&this.updatePoolForItems(s.clone(this.renderedLayoutResults_.items),this.layoutFormaePool_),null!=this.renderedDecorationResults_&&this.updatePoolForItems(s.clone(this.renderedDecorationResults_.items),this.decorationFormaePool_))}},textBacked:{get:function(){var t;return!!(t=this.lockupStyle)&&t.textBacked}},maxLineLengthDifference:{get:function(){var t=this.numLines(),e=s.repeat(1/0,t),n=s.repeat(-1/0,t);this.lockupForma.visit(T.FormaTraversal.PreOrder,(function(t,o,i){var r,a;return(r=s.as(t,at.TextForma))&&0!=r.rangeInLockup.length&&(a=r.finalFrame)&&(e[r.rowIndex]=Math.min(e[r.rowIndex],a.minY),n[r.rowIndex]=Math.max(n[r.rowIndex],a.maxY)),!1}));for(var o=[],i=s.iter(s.range(0,t,!1));!i.done;i.next()){var r=i.value;isFinite(e[r])&&isFinite(n[r])&&o.push(n[r]-e[r])}return o.length>0?s.max(o)-s.min(o):0}},doesContrast:function(){return this.styleController.doesLockupContrastWithBackground()},contrastCheck:function(t){void 0===t&&(t=!0),this.styleController_.backgroundContrastCheck(t)},getBackgroundEdge:function(){var t,e;return(t=s.as(this.visualParent.controller,F.FrameController))&&(e=s.opt(this.forma,(function(t){return t.finalFrame})))?t.getAverageEdge(e):null},getBackgroundLightnessSpread:function(t){for(var e=100,n=0,o=s.iter(t);!o.done;o.next()){var i=o.value;e=Math.min(e,i.lightness),n=Math.max(n,i.lightness)}return X.MathUtils.absDouble(n-e)},recordSize:function(t){this.thresholdGroupHeight=t.height,this.thresholdGroupWidth=t.width,this.size=t},snapSizeToBounds:function(){var t=new M.FormaTransformChangedEvent(this.lockupForma);if(null!=this.lockupForma.frame&&null!=this.renderedLayoutResults_){this.lockupForma.beginUpdate(t),this.lockupForma.placement=this.wrappingGroup_.placement.concat(this.lockupForma.placement);var e,n=this.renderedLayoutResults_.size;this.recordSize(n),this.lockupForma.endUpdate(t),(e=this.lockupForma.parent)&&H.GroupFacade.updateUserGroupHierarchy(e)}},isTypeLockup:{get:function(){return!0}},avgLineHeight:{get:function(){var t;return null!=(t=this.averageLineHeight)?t:-1}},averageLineHeight:{get:function(){var t;if(t=this.renderedLayoutResults_){var e=this.lockupForma.placement.transformValues.yscale;if(isFinite(t.avgTextItemHeight))return t.avgTextItemHeight*e}return null}},currentHeightScale:{get:function(){return this.getAverageFontSize()}},getSizeHeightScales:function(){return null==this.sizeHeightScales_&&this.calculateSizeHeightScales(),this.sizeHeightScales_},calculateSizeHeightScales:function(){var t=[];this.forma.placement=V.Matrix2D.Identity;for(var e=[this.size.aspectRatio,.1,.2,.3,.4,.5,.6,.8,1,1.4,2,3,5,12],n=s.iter(e);!n.done;n.next()){for(var o=n.value,i=s.opt(this.renderedLayoutResults_,(function(t){return t.size}))||new mt.TheoSize(100*o,100),r=!1,a=s.iter(t);!a.done;a.next()){var l=a.value;Math.abs(l.size.aspectRatio-i.aspectRatio)<.01&&(r=!0)}r||t.push({size:i,scale:this.avgLineHeight})}this.sizeHeightScales_=s.clone(t)},numLines:function(){var t,e=0;if(null!=(t=s.opt(this.renderedLayoutResults_,(function(t){return t.numberOfLines}))))e=t;else{var n=-1;this.lockupForma.visit(T.FormaTraversal.PreOrder,(function(t,e,o){var i;return(i=s.as(t,at.TextForma))&&0!=i.rangeInLockup.length&&(n=Math.max(n,i.rowIndex)),!1})),n>-1&&(e=n+1)}return e},textFrame:{get:function(){return this.textBoundsInCoordSpace(this.lockupForma.placement)}},textFinalFrame:{get:function(){var t,e=null;return(t=this.lockupForma)&&t.visitAll(T.FormaTraversal.PreOrder,(function(t){t.kind==at.TextForma.KIND&&(e=dt.TheoRect.unionOf(e,t.finalFrame))})),e}},getKnockoutOutlines:function(t){var e,n=ct.TheoPathBuilder.init_d41d(),o=!0;if(null!=(e=t.shapeLibraryID)){var i=tt.ShapeLibrary.shapeDictionary[e];if(!i.filled)return null;o=i.clockwise}var r,a=t.boundsInCoordSpace(t.placement);return(r=this.lockupForma)&&r.visit(T.FormaTraversal.PreOrder,(function(t,e,i){var r;if(r=s.as(t,at.TextForma)){var l=r.boundsInCoordSpace(r.placement).evalXY(.5,.5);if(!a.containsPoint(l))return!1;var h=r.fontDescriptor,u=r.fontSize,c=r.textLook,g=Y.LockupStyle.isKnockoutLook(c);if(c==Y.LockupTextLook.KnockoutAndShadow&&(g=0==r.fontStrokeWidth),g){var p=r.tracking,d=b.Host.textModelUtils.textOutlines(r.text,h,u,p);null!=d&&(o==b.Host.textModelUtils.fontHasClockwiseOutlines(h)&&(d=b.Host.textModelUtils.rewindPath(d)||d),n.addPath(d,r.placement))}}return!1})),null==n.path.bounds?null:n.path},textBoundsInCoordSpace:function(t){var e,n=null;if(e=this.lockupForma){var o=[];e.visit(T.FormaTraversal.PreOrder,(function(e,i,r){var a;return 0==i?o=[t]:(o=o.slice(0,i)).push(e.placement.concat(s.last(o))),(a=s.as(e,at.TextForma))&&(n=dt.TheoRect.unionOf(n,a.boundsInCoordSpace(s.last(o)))),!1}))}return n},textBoundsInCoordSpace2:function(t){var e,n=null;return(e=this.lockupForma)&&e.visitPlaced(t,(function(t,e,o,i){var r;return(r=s.as(t,at.TextForma))&&(n=dt.TheoRect.unionOf(n,r.boundsInCoordSpace(e))),!1})),n},shapeCount:function(){return s.as(this.lockupForma.root,j.RootForma).filterByControllerKind(I.GridController.KIND).length},wordCount:function(){return this.text.length>0?this.text.split(" ").length:0},updateScoring:function(){this.styleController_.updateScoring()},shuffleColorAssignment:function(){var t;if(t=this.lockupForma){var e=new M.FormaStyleChangedEvent(t);t.beginUpdate(e),this.styleController_.shuffleColorAssignment(),t.endUpdate(e)}},applyTextStyleSuggestion:function(t,e,n){var o;if(void 0===e&&(e=null),void 0===n&&(n=!0),!((o=t)&&(i=e)&&i.lockupStyleEvaluator.styleEvaluatedWithReadability(o))){var i,a=null;(i=e)&&(a=i.getTextStyleSuggestion(e)),null==a&&(a=this.getNewStyleAttributes(!0,e,n));var l=s.as(this.forma.style,Y.LockupStyle);return this.forma.applyStyle(a),null!=a.font&&a.font.isSparkFont()?p.BrandingFacade.brandDocumentForElement(this.forma.page.document,a.font.sparkElementID,p.AUTHORING_CONTEXT_TYPE_FONT):s.opt(l,(function(t){return null!=t.font}))&&l.font.isSparkFont()&&p.BrandingFacade.unBrandDocumentIfNoBrandedElements(this.forma.page.document),a}return this.forma.applyStyle(o),this.charStyleRanges.length>0&&0==s.count(o.characterStyles)?(this.getCharacterStyle(r.HIGHLIGHT_STYLE),this.updateGroup()):this.styleController.pickVisibleColorsForCharStyle()&&this.updateGroup(),null},applyNextTextEmphasisSuggestion:function(t){var e;return(e=t.postTextStylesServiceInterface.getNextTextEmphasisSuggestion())?(this.applyCharStyleFromRangeListWithoutUI(s.clone(this.charStyleRanges),l.CharStyleApplyMode.Remove),s.clone(this.applyCharStyleFromRangeListWithoutUI(s.clone(e),l.CharStyleApplyMode.Toggle))):[]},getNewStyleAttributes:function(t,e,n){for(var o=s.iter(s.range(0,5,!1));!o.done;o.next()){var i;if(i=this.styleController_.getNewStyleAttributes(t,e,n))return i}return s.opt(b.Host.logging,(function(t){return t.info("unable to find a suitable style using the evaluator, return a potential bad style")})),this.styleController_.getNewStyleAttributes(t,e,!1)},generateAndApplyInitialStyleAttributes:function(){this.styleController_.generateAndApplyInitialStyleAttributes(),s.isEmpty(this.text)||this.snapSizeToBounds()},clearLockupFormaPool:function(t){for(var e=s.iter(t.configureTextFormae({}));!e.done;e.next()){var n=e.value;s.opt(n.parent,(function(t){return t.removeChild(n)}))}for(var o=s.iter(t.configureShapeFormae(0));!o.done;o.next())n=o.value,s.opt(n.parent,(function(t){return t.removeChild(n)}))},preferredXAlignment:{get:function(){return this.lockupStyle.alignment==Y.LockupAlignment.Left?u.AlignmentType.Left:this.lockupStyle.alignment==Y.LockupAlignment.Right?u.AlignmentType.Right:u.AlignmentType.CenterX}},setAlignmentType:function(t){this.numLines()>1&&(t==u.AlignmentType.Left&&s.opt(this.lockupStyle,(function(t){return t.alignment!=Y.LockupAlignment.UNSET}))&&s.opt(this.lockupStyle,(function(t){return t.alignment!=Y.LockupAlignment.Left}))&&(this.lockupStyle.alignment=Y.LockupAlignment.Left),t==u.AlignmentType.Right&&s.opt(this.lockupStyle,(function(t){return t.alignment!=Y.LockupAlignment.UNSET}))&&s.opt(this.lockupStyle,(function(t){return t.alignment!=Y.LockupAlignment.Right}))&&(this.lockupStyle.alignment=Y.LockupAlignment.Right),t==u.AlignmentType.CenterX&&s.opt(this.lockupStyle,(function(t){return t.alignment!=Y.LockupAlignment.UNSET}))&&s.opt(this.lockupStyle,(function(t){return t.alignment!=Y.LockupAlignment.Center}))&&(this.lockupStyle.alignment=Y.LockupAlignment.Center))},canClaimForma:function(t){return!1},getPinBounds:function(t){var e,n=s.opt(this.lockupForma,(function(t){return t.bounds}));return(e=this.lockupStyle)&&(n=t==ut.PinBoundsType.Bounds||e.backing==Y.LockupBacking.Banner||e.backing==Y.LockupBacking.BannerHorizontal||e.backing==Y.LockupBacking.BannerVertical?this.textBoundsInCoordSpace(V.Matrix2D.Identity):this.lockupForma.childrenBoundsInCoordSpace(V.Matrix2D.Identity)),n},centerAlignmentIfSingleLine:function(){var t=this,e=s.opt(s.opt(this.wrappingGroup_,(function(t){return t.bounds})),(function(e){return e.equalWithAccuracy(t.forma.bounds,.01)}));1!=this.numLines()||null==e||!e||this.lockupStyle.alignment!=Y.LockupAlignment.Left&&this.lockupStyle.alignment!=Y.LockupAlignment.Right||(this.lockupStyle.alignment=Y.LockupAlignment.Center)},preventOutofBoundsOrOverlap:function(t){var e,n;(e=this.textFinalFrame)&&(n=this.lockupForma)&&!t.contains(e)&&(e.minX<t.minX&&n.move(V.Matrix2D.translationXY(-1*(e.minX-t.minX)+10,0)),e.maxX>t.maxX&&n.move(V.Matrix2D.translationXY(t.maxX-e.maxX-10,0)),e.minY<t.minY&&n.move(V.Matrix2D.translationXY(0,-1*(e.minY-t.minY)+10)),e.maxY>t.maxY&&n.move(V.Matrix2D.translationXY(0,t.maxY-e.maxY-10)))},addForma:function(t,e,n){var o,i,a,l=this;if((o=s.as(t.root,j.RootForma))&&(i=s.as(e,B.GroupForma))&&(a=s.as(e.controller,r))){this.beginBlockedUpdate(),n.suggestPlacement||e.controller.fit(o.frame.insetRel(.25,.25,.25,.25)),e.applyStyle(Y.LockupStyle.createDefault());var h=!1,u=s.clone(o.filterWithCallback((function(t){return t instanceof E.ImageForma&&t.parent instanceof A.FrameForma}))),c=null;u.length>0&&(c=s.as(u[0],E.ImageForma)),o.visitAll(T.FormaTraversal.PreOrder,(function(t){var n,o;if((n=s.as(t.controller,r))&&s.opt(n.lockupStyle,(function(t){return t.backing!=Y.LockupBacking.Knockout}))&&(o=s.as(s.opt(n.lockupStyle,(function(t){return t.clone()})),Y.LockupStyle))){var i=Y.LockupStyle.isLetterGrid(o.layout),a=Y.LockupStyle.isPath(o.layout);if(i||a){if(o.layout=Y.LockupLayout.Standard,a)o.alignment=Y.LockupAlignment.Center;else for(var l=s.iter(o.characterStyles);!l.done;l.next()){var u=l.value;u.backing==Y.LockupBacking.UNSET&&(u.backing=Y.LockupBacking.None)}o.tracking=Y.LockupStyle.DEFAULT_TRACKING}e.applyStyle(o),h=!0}}));var g=s.clone(o.filterByControllerKind(I.GridController.KIND));if(1==g.length?g[0].appendChild(e):o.appendChild(e),this.endBlockedUpdate(),this.updateGroup(),n.suggestPlacement){var p,d=y.CorePromise.resolve(null);return(p=s.opt(s.opt(c,(function(t){return t.contentNode})),(function(t){return t.image})))&&(p.loaded()||(e.moveCenterToPoint(new gt.TheoPoint(-o.frame.center.x,o.frame.center.y)),d=p.whenLoaded())),d.then((function(t){return l.placeStyleLockup(i,o,a,h),y.CorePromise.resolve(null)}))}return y.CorePromise.resolve(null)}return y.CorePromise.reject("TypeLockupController.addFormaToRoot: no lockup forma")},getBackingContrastRole:function(){var t;if(t=this.lockupStyle){var e=t.textLook==Y.LockupTextLook.KnockoutOnly||t.textLook==Y.LockupTextLook.OutlineOnly,n=t.strokeWeight>.15;return e||n||t.textBacked?L.ColorRole.FieldSecondary:L.ColorRole.FieldPrimary}return L.ColorRole.FieldPrimary},getSuggestableColors:function(){return this.styleController_.getSuggestableColors()},applyColors:function(t,e){this.styleController_.applyColors(s.clone(t),e)},primaryColorVisible:function(){return this.styleController.targetedTextLook!=Y.LockupTextLook.KnockoutOnly&&this.styleController.targetedTextLook!=Y.LockupTextLook.OutlineOnly},secondaryColorVisible:function(){var t,e,n=this.styleController.targetedLockupStyle.backing;return n==Y.LockupBacking.UNSET&&(G.LegacyCoreAssert.isTrue(Y.LockupStyle.isLetterGrid((t=s.opt(this.lockupStyle,(function(t){return t.layout})))||null!=t?t:Y.LockupLayout.Standard),"LockupBacking.UNSET in secondary styles for non-letter-grid layouts?",void 0,"TypeLockupController.secondaryColorVisible","TypeLockupController.swift",3715),n=(e=s.opt(this.lockupStyle,(function(t){return t.backing})))||null!=e?e:Y.LockupBacking.None),n!=Y.LockupBacking.None||Y.LockupStyle.isOutlineLook(this.styleController.targetedTextLook)||this.styleController.targetedTextLook==Y.LockupTextLook.Shadow},applyOpacity:function(t){this.styleController_.setOpacity(t)},currentOpacity:{get:function(){return this.styleController.getOpacityValue()}},getHighlightMethodName:function(t){return t==l.HighlightMethod.Manual?"k_HighlightMethod_None":t==l.HighlightMethod.Numbers?"k_HighlightMethod_Numbers":t==l.HighlightMethod.Nouns?"k_HighlightMethod_Nouns":t==l.HighlightMethod.Verbs?"k_HighlightMethod_Verbs":t==l.HighlightMethod.Names?"k_HighlightMethod_Names":t==l.HighlightMethod.Adjectives?"k_HighlightMethod_Adjectives":t==l.HighlightMethod.SmallWords?"k_HighlightMethod_SmallWords":t==l.HighlightMethod.EvenRows||t==l.HighlightMethod.OddRows||t==l.HighlightMethod.Bracket||t==l.HighlightMethod.InsideBracket?"k_HighlightMethod_Lines":t==l.HighlightMethod.EvenWords||t==l.HighlightMethod.OddWords?this.text.includes(" ")?"k_HighlightMethod_Words":"k_HighlightMethod_Letters":t==l.HighlightMethod.First?"k_HighlightMethod_First":t==l.HighlightMethod.Last?"k_HighlightMethod_Last":s.toString(this.highlightMethod)},placeStyleLockup:function(t,e,n,o){var i;if(i=new _.FormaPlacementSuggester(t,e).fastPlacement()){var r=new M.FormaTransformChangedEvent(t);r.duration=0,t.beginUpdate(r),i.apply(),n.text.length>0&&this.snapSizeToBounds(),n.updateScoring(),o?n.styleController.doesLockupContrastWithBackground()||n.styleController.pickVisibleColorsForLockup():n.generateAndApplyInitialStyleAttributes(),t.endUpdate(r)}},incrementHighlightMethod:function(){this.highlightMethod==l.HighlightMethod.Manual?this.highlightMethod=l.HighlightMethod.Numbers:this.highlightMethod==l.HighlightMethod.Numbers?this.highlightMethod=l.HighlightMethod.Nouns:this.highlightMethod==l.HighlightMethod.Nouns?this.highlightMethod=l.HighlightMethod.Verbs:this.highlightMethod==l.HighlightMethod.Verbs?this.highlightMethod=l.HighlightMethod.Names:this.highlightMethod==l.HighlightMethod.Names?this.highlightMethod=l.HighlightMethod.Adjectives:this.highlightMethod==l.HighlightMethod.Adjectives?this.highlightMethod=l.HighlightMethod.SmallWords:this.highlightMethod==l.HighlightMethod.SmallWords?this.highlightMethod=l.HighlightMethod.EvenRows:this.highlightMethod==l.HighlightMethod.EvenRows||this.highlightMethod==l.HighlightMethod.OddRows?this.highlightMethod=l.HighlightMethod.EvenWords:this.highlightMethod==l.HighlightMethod.EvenWords||this.highlightMethod==l.HighlightMethod.OddWords?this.highlightMethod=l.HighlightMethod.InsideBracket:this.highlightMethod==l.HighlightMethod.First||this.highlightMethod==l.HighlightMethod.Last?this.highlightMethod=l.HighlightMethod.Numbers:this.highlightMethod!=l.HighlightMethod.Bracket&&this.highlightMethod!=l.HighlightMethod.InsideBracket||(this.highlightMethod=l.HighlightMethod.Numbers)},getNextRanges:function(t,e){var n=this,o=[],i=st.TypeLockupUtils.getWordRanges(t,this.highlightMethod);if(0==i.length||t.length<2)return o;var a=s.chars(t),h=P.GraphemeUtils.countGraphemes(t),u=1==i.length&&0==i[0].start&&i[0].end==h;if(e&&t.includes(" ")&&this.highlightMethod==l.HighlightMethod.Manual)return o.push(i[0]),o;if(this.highlightMethod>=r.FIRST_NLP_METHOD&&this.highlightMethod<=r.MAX_NLP_METHOD){var c=t;c==c.toUpperCase()&&(c=c.toLowerCase()),c=s.replaceAll(c,"\n"," ");var g=s.clone(b.Host.textModelUtils.getWordClassRanges(c,this.highlightMethod-r.FIRST_NLP_METHOD));if(u)for(var p=s.iter(g);!p.done;p.next()){var d=p.value;o.push(d)}else this.lockupForma.visit(T.FormaTraversal.PreOrder,(function(t,e,n){var i;if(i=s.as(t,at.TextForma))for(var r=i.rangeInLockup,a=s.iter(g);!a.done;a.next()){var l=a.value;l.start>=r.start&&l.end<=r.end&&o.push(r)}return!1}));e&&this.highlightMethod==l.HighlightMethod.Numbers&&0==!o.length&&0!=o[0].start&&o.splice(0)}else if(this.highlightMethod==l.HighlightMethod.EvenWords||this.highlightMethod==l.HighlightMethod.OddWords){for(var f=s.iter(s.toSequence(i));!f.done;f.next()){var m=f.value,y=m.offset,k=m.element;(this.highlightMethod==l.HighlightMethod.EvenWords&&y%2==0||this.highlightMethod==l.HighlightMethod.OddWords&&y%2!=0)&&o.push(k)}if((this.highlightMethod==l.HighlightMethod.EvenWords||this.highlightMethod==l.HighlightMethod.OddWords)&&u){o.splice(0);for(var L=s.iter(s.range(0,h,!1));!L.done;L.next()){var S=L.value;(this.highlightMethod==l.HighlightMethod.EvenWords&&S%2==0||this.highlightMethod==l.HighlightMethod.OddWords&&S%2!=0)&&o.push(new pt.TextRange(S,S+1))}}}else if(this.highlightMethod!=l.HighlightMethod.Bracket&&this.highlightMethod!=l.HighlightMethod.InsideBracket||!(i.length<3)||!st.TypeLockupUtils.isCurlyQuote(a[0])&&"("!=a[0]||!st.TypeLockupUtils.isCurlyQuote(a[a.length-1])&&")"!=a[a.length-1]){var v=0;this.lockupForma.visit(T.FormaTraversal.PreOrder,(function(t,e,i){var r;if(r=s.as(t,at.TextForma)){var a=r.rangeInLockup;(n.highlightMethod==l.HighlightMethod.EvenRows&&r.rowIndex%2==0||n.highlightMethod==l.HighlightMethod.OddRows&&r.rowIndex%2!=0)&&o.push(a),v=Math.max(v,r.rowIndex)}return!1})),this.highlightMethod!=l.HighlightMethod.EvenRows&&this.highlightMethod!=l.HighlightMethod.OddRows||0!=v||o.splice(0),(this.highlightMethod==l.HighlightMethod.First||this.highlightMethod==l.HighlightMethod.Last)&&0!=v||(this.highlightMethod==l.HighlightMethod.Bracket||this.highlightMethod==l.HighlightMethod.InsideBracket)&&v>1?(o.splice(0),this.lockupForma.visit(T.FormaTraversal.PreOrder,(function(t,e,i){var r;if(r=s.as(t,at.TextForma)){var a=r.rangeInLockup;(n.highlightMethod!=l.HighlightMethod.First&&n.highlightMethod!=l.HighlightMethod.Bracket||0!=r.rowIndex)&&(n.highlightMethod!=l.HighlightMethod.Last&&n.highlightMethod!=l.HighlightMethod.Bracket||r.rowIndex!=v)?n.highlightMethod==l.HighlightMethod.InsideBracket&&0!=r.rowIndex&&r.rowIndex!=v&&o.push(a):o.push(a)}return!1}))):this.highlightMethod==l.HighlightMethod.First||this.highlightMethod==l.HighlightMethod.Last||this.highlightMethod==l.HighlightMethod.Bracket?(this.highlightMethod!=l.HighlightMethod.First&&this.highlightMethod!=l.HighlightMethod.Bracket||o.push(i[0]),this.highlightMethod!=l.HighlightMethod.Last&&this.highlightMethod!=l.HighlightMethod.Bracket||o.push(i[i.length-1])):this.highlightMethod==l.HighlightMethod.InsideBracket&&i.length>1&&o.push(new pt.TextRange(i[0].end,i[i.length-1].start))}else{o.splice(0);var F=u?h:s.chars(t).length;this.highlightMethod==l.HighlightMethod.Bracket?(o.push(new pt.TextRange(0,1)),o.push(new pt.TextRange(F-1,F))):this.highlightMethod==l.HighlightMethod.InsideBracket&&o.push(new pt.TextRange(1,F-1))}return s.sortInPlace(o,(function(t,e){return t.start<e.start})),o=s.clone(st.TypeLockupUtils.cleanupAndMerge(s.clone(o)))},hasTextFormae:function(){var t;return!!(t=this.lockupForma)&&null!=t.findDescendant((function(t){return t instanceof at.TextForma}))},getTextFormaCount:function(){var t=0;return s.opt(this.lockupForma,(function(e){return e.visit(T.FormaTraversal.PreOrder,(function(e,n,o){return e instanceof at.TextForma&&(t+=1),!1}))})),t},getAllTextFormae:function(){var t=[];return this.lockupForma.visit(T.FormaTraversal.PreOrder,(function(e,n,o){var i;return(i=s.as(e,at.TextForma))&&t.push(i),!1})),t},groupLetterFormaeByWord:function(){var t=this,e=s.clone(this.getAllTextFormae()),n=st.TypeLockupUtils.getBreakRanges(this.text);return pt.TextRange.makeRangesContiguous(n),n.map((function(n){return e.filter((function(t){return n.contains(t.rangeInLockup)}),t)}),this).filter((function(t){return 0==!t.length}),this)},updateMethodToMatchCharStyleRange:function(t){var e=s.clone(this.charStyleRanges);if(0==!e.length&&this.highlightMethod==l.HighlightMethod.Manual){G.LegacyCoreAssert.isTrue(!s.isEmpty(t),"Asked to update highlight method to match char style range when there is no text",void 0,"TypeLockupController.updateMethodToMatchCharStyleRange","TypeLockupController.swift",4082),this.incrementHighlightMethod();for(var n=s.clone(this.getNextRanges(t,!1)),o=0;!r.rangesEqual(s.clone(n),s.clone(e));)if(this.incrementHighlightMethod(),n=s.clone(this.getNextRanges(t,!1)),(o+=1)>r.NUM_HIGHLIGHTMETHODS){this.highlightMethod=l.HighlightMethod.Manual;break}}},autoApplyCharStyle:function(t,e,n){var o;if(void 0===n&&(n=!1),!n){if(0==this.charStyleRanges.length&&t&&!e)return;if(0==!this.charStyleRanges.length&&!t&&!e)return}var i=s.clone(this.charStyleRanges);e&&this.incrementHighlightMethod();var a=(o=s.opt(this.lockupStyle,(function(t){return t.layout})))||null!=o?o:Y.LockupLayout.Standard;0==i.length&&this.highlightMethod==l.HighlightMethod.Manual&&Y.LockupStyle.doesPerLetterLayout(a)&&(this.highlightMethod=l.HighlightMethod.OddWords);var h=s.clone(this.getNextRanges(this.text,0==i.length));if(0!=!h.length||e||!r.rangesEqual(s.clone(h),s.clone(i))){var u=new M.FormaAnimationTransactionEvent(this.forma);if(u.duration=0,this.forma.beginUpdate(u),this.lockupForma.style.notifyBefore(),this.charStyleRanges=[],!n)for(var c=0;0==h.length||e&&r.rangesEqual(s.clone(h),s.clone(i))||0==h[0].start&&h[0].end==this.text.length;)if(this.incrementHighlightMethod(),h=s.clone(this.getNextRanges(this.text,!1)),(c+=1)>r.NUM_HIGHLIGHTMETHODS){h.splice(0),this.highlightMethod=l.HighlightMethod.Manual;break}this.charStyleRanges=s.clone(h),this.lockupForma.style.notifyAfter(),this.forma.endUpdate(u)}},applyCharStyle:function(t,e,n,o,i){var r;void 0===i&&(i=!0);var a=new pt.TextRange(0,0);if(t.lockupForma!=this.lockupForma)return this.selectCharStyleForma(),a;a=t.rangeInLockup;var l=(r=s.opt(this.lockupStyle,(function(t){return t.layout})))||null!=r?r:Y.LockupLayout.Standard;if(Y.LockupStyle.doesPerLetterLayout(l)){var h,u=st.TypeLockupUtils.getWordRanges(this.text,this.highlightMethod);u.length>1&&(h=u.find((function(t){return t.contains(a)}),this))&&(a=h)}var c=new M.FormaAnimationTransactionEvent(this.forma);c.duration=0,this.forma.beginUpdate(c),this.lockupForma.style.notifyBefore();var g=this.applyCharStyleDirectly(a,o,n);return 1==i&&this.selectCharStyleForma(),this.lockupForma.style.notifyAfter(),this.forma.endUpdate(c),g},applyCharStyleFromRangeListWithoutUI:function(t,e){var n=new M.FormaAnimationTransactionEvent(this.forma);n.duration=0,this.forma.beginUpdate(n),this.lockupForma.style.notifyBefore();for(var o=[],i=s.iter(t);!i.done;i.next()){var r=i.value;o.push(this.applyCharStyleDirectly(r,r,e))}return this.lockupForma.style.notifyAfter(),this.forma.endUpdate(n),o},applyCharStyleDirectly:function(t,e,n,o){void 0===o&&(o=!0);var i=t;this.highlightMethod=l.HighlightMethod.Manual;var a=!1,h=i;n==l.CharStyleApplyMode.Apply&&0!=e.length&&(i=st.TypeLockupUtils.getNewCharSelectionRange(e,i,s.clone(this.initialCharStyleRanges_)));for(var u=-1,c=s.iter(s.toSequence(this.charStyleRanges));!c.done;c.next()){var g=c.value,p=g.offset,d=g.element;i.start>=d.start&&i.start<d.end&&(u=p)}var f=s.clone(this.charStyleRanges);if(u>-1){var m=f[u];n==l.CharStyleApplyMode.SwipeApply?f[u]=new pt.TextRange(Math.min(i.start,m.start),Math.max(i.end,m.end)):n!=l.CharStyleApplyMode.Apply?m.length!=i.length?(i.end>=m.end?f.splice(u,1):f[u]=new pt.TextRange(i.end,m.end),m.start<i.start&&f.splice(u,0,new pt.TextRange(m.start,i.start))):f.splice(u,1):n!=l.CharStyleApplyMode.Remove&&(a=!0,f[u]=i),this.charStyleRanges=s.clone(f)}else n!=l.CharStyleApplyMode.Remove&&(a=!0,f.push(i),s.sortInPlace(f,(function(t,e){return t.start<e.start})),this.charStyleRanges=s.clone(f),0==s.count(this.lockupStyle.characterStyles)&&this.getCharacterStyle(r.HIGHLIGHT_STYLE));o&&(this.charStyleRanges=s.clone(st.TypeLockupUtils.cleanupAndMerge(s.clone(this.charStyleRanges))));var y=new pt.TextRange(0,0);if(a)for(var k=s.iter(this.charStyleRanges);!k.done;k.next())d=k.value,h.start>=d.start&&h.end<=d.end&&(y=d);return y},getCharacterStyle:function(t){var e=this.lockupStyle.characterStyles[t];return null==e&&(e=Y.LockupStyle.createDefaultCharacterStyle(this.lockupStyle),this.lockupStyle.setCharacterStyle(t,e),this.styleController.pickVisibleColorsForCharStyle()),e},getCharacterStyleRanges:function(){return this.charStyleRanges},clearCharStyle:function(){this.highlightMethod=l.HighlightMethod.Manual,0!=this.charStyleRanges.length&&(this.lockupForma.style.notifyBefore(),this.charStyleRanges=[],this.lockupForma.style.notifyAfter())},selectCharStyleForma:function(){var t=this;this.owner.selection.clearSelectionNoUpdate(),this.owner.selection.selectForma(this.lockupForma,!1),this.lockupForma.visit(T.FormaTraversal.PreOrder,(function(e,n,o){var i;if(i=s.as(e,at.TextForma))for(var r=i.rangeInLockup,a=s.iter(t.charStyleRanges);!a.done;a.next()){var l=a.value;if(r.start>=l.start&&r.start<l.end){if(Y.LockupStyle.isShadowLook(t.styleController.targetedLockupStyle.textLook)&&i.fontColor.isEqual(t.styleController.targetedLockupStyle.colors.fieldSecondary))continue;t.owner.selection.selectForma(i,!1)}}return!1})),this.owner.selection.publish(new et.SelectionStateChangedMessage(this.owner.selection))},beginTouches:function(){this.initialCharStyleRanges_=s.clone(this.charStyleRanges)},clearInitialCharStyleRanges:function(){this.initialCharStyleRanges_=[]},updateTouches:function(t,e,n,o){void 0===o&&(o=null);var i=s.opt(this.lockupForma,(function(e){return e.page.formaAtPoint(t,void 0,[at.TextForma.KIND])}));null!=i&&i instanceof at.TextForma&&i.lockupForma!=this.lockupForma&&(i=null);var a,h=n?100:-100;if(null==i||!(i instanceof at.TextForma)){var u=new gt.TheoPoint(t.x+h,t.y);i=s.opt(this.lockupForma,(function(t){return t.page.formaAtPoint(u,void 0,[at.TextForma.KIND])}))}if(a=s.as(i,at.TextForma)){if(null!=o&&0!=s.count(this.lockupStyle.characterStyles)&&s.opt(this.lockupStyle.characterStyles[r.HIGHLIGHT_STYLE],(function(t){return null!=t.font}))){var c,g=s.opt(this.lockupForma,(function(t){return t.page.formaAtPoint(o,void 0,[at.TextForma.KIND])}));if(null==g||!(g instanceof at.TextForma)){var p=new gt.TheoPoint(o.x+h,o.y);g=s.opt(this.lockupForma,(function(t){return t.page.formaAtPoint(p,void 0,[at.TextForma.KIND])}))}if((c=s.as(g,at.TextForma))&&c.rowIndex==a.rowIndex)for(var d=s.opt(s.opt(this.lockupForma,(function(t){return t.totalPlacement.inverse})),(function(e){return e.transformPoint(t)}))||t,f=s.opt(s.opt(this.lockupForma,(function(t){return t.totalPlacement.inverse})),(function(t){return t.transformPoint(o)}))||o,m=d.x>=f.x,y=d.x<=f.x,k=s.iter(this.charStyleRanges);!k.done;k.next()){var L=k.value;if(n){if(y&&a.rangeInLockup.start>=L.start&&a.rangeInLockup.start<L.end){if(a.rangeInLockup.end<L.end)return;break}if(m&&a.rangeInLockup.end==L.start)return}else{if(m&&a.rangeInLockup.start>=L.start&&a.rangeInLockup.start<L.end){if(a.rangeInLockup.end<L.end)return;break}if(y&&a.rangeInLockup.start==L.end)return}}}this.applyCharStyle(a,r.HIGHLIGHT_STYLE,l.CharStyleApplyMode.Apply,e.rangeInLockup)}},enterCharStyleModeWithTextForma:function(t,e){if(this.owner.allowSelectionChanges){var n=0==this.charStyleRanges.length;if(0==t.rangeInLockup.length){this.lockupForma.style.notifyBefore(),this.getCharacterStyle(r.HIGHLIGHT_STYLE),this.lockupForma.style.notifyAfter();var o=s.opt(this.lockupForma,(function(t){return t.page.formaAtPoint(e,void 0,[at.TextForma.KIND])}));null!=o&&o instanceof at.TextForma&&(s.opt(s.opt(t.page.document,(function(t){return t.controller})),(function(t){return t.selection.inCharStyleMode=!0})),this.styleController.pickVisibleColorsForCharStyle(),this.selectCharStyleForma(),this.applyCharStyle(o,r.HIGHLIGHT_STYLE,l.CharStyleApplyMode.SwipeApply,new pt.TextRange(0,0)))}else s.opt(s.opt(t.page.document,(function(t){return t.controller})),(function(t){return t.selection.inCharStyleMode=!0})),0==this.charStyleRanges.length&&this.styleController.pickVisibleColorsForCharStyle(),this.selectCharStyleForma(),this.applyCharStyle(t,r.HIGHLIGHT_STYLE,l.CharStyleApplyMode.SwipeApply,new pt.TextRange(0,0));n&&1==this.charStyleRanges.length&&0==this.charStyleRanges[0].start&&this.charStyleRanges[0].end==this.text.length&&(this.charStyleRanges=[],this.autoApplyCharStyle(!1,!1,!1),this.selectCharStyleForma())}},applyPredefinedCharStyle:function(t){var e=this.highlightMethod==t;if(this.highlightMethod=t,t==l.HighlightMethod.SmallWords){this.styleController.applyBacking(Y.LockupBacking.None,null),e||this.lockupStyle.setCharacterStyles({});var n=this.getCharacterStyle(r.HIGHLIGHT_STYLE);n.spacing=.5,n.colors.setColorId(L.ColorRole.FieldPrimary,this.lockupStyle.colors.colorID(L.ColorRole.FieldPrimary)),n.colors.setColorId(L.ColorRole.FieldSecondary,this.lockupStyle.colors.colorID(L.ColorRole.FieldSecondary)),e?n.layout==Y.LockupLayout.Standard&&n.alignment==Y.LockupAlignment.Center&&0==n.lineBreakAtCharacterStyleSizeChange?(n.alignment=Y.LockupAlignment.Right,n.lineBreakAtCharacterStyleSizeChange=!1):n.layout==Y.LockupLayout.Standard&&n.alignment==Y.LockupAlignment.Right?(n.alignment=Y.LockupAlignment.Center,n.lineBreakAtCharacterStyleSizeChange=!0):n.layout==Y.LockupLayout.UNSET&&0==n.lineBreakAtCharacterStyleSizeChange?(n.alignment=Y.LockupAlignment.Center,n.layout=Y.LockupLayout.Standard,n.lineBreakAtCharacterStyleSizeChange=!1):(n.alignment=Y.LockupAlignment.UNSET,n.layout=Y.LockupLayout.UNSET,n.lineBreakAtCharacterStyleSizeChange=!1):n.lineBreakAtCharacterStyleSizeChange=!1,this.autoApplyCharStyle(!0,!1,!0)}else this.highlightMethod==l.HighlightMethod.Manual?this.clearCharStyle():t==l.HighlightMethod.Nouns?(this.styleController.applyBacking(Y.LockupBacking.Rows,null),this.lockupStyle.setCharacterStyles({}),this.getCharacterStyle(r.HIGHLIGHT_STYLE),this.autoApplyCharStyle(!0,!1,!0)):(e&&(this.highlightMethod==l.HighlightMethod.EvenRows?this.highlightMethod=l.HighlightMethod.OddRows:this.highlightMethod==l.HighlightMethod.OddRows?this.highlightMethod=l.HighlightMethod.Bracket:this.highlightMethod==l.HighlightMethod.Bracket?this.highlightMethod=l.HighlightMethod.InsideBracket:this.highlightMethod==l.HighlightMethod.InsideBracket&&(this.highlightMethod=l.HighlightMethod.EvenRows)),this.lockupStyle.setCharacterStyles({}),this.getCharacterStyle(r.HIGHLIGHT_STYLE));this.forma.controller.styleChanged()},snapToClosestExistingSize:function(t){var e=this;if(!s.opt(this.lockupStyle,(function(t){return t.layout==Y.LockupLayout.FitJustified&&1!=e.numLines()}))){var n=s.clone(st.TypeLockupUtils.sizesInDocument(this.forma.page.document)),o=this.getCurrentFontSize();if(0!=o){for(var i=t,r=s.iter(n);!r.done;r.next()){var a=r.value;(o!=a||t==o)&&Math.abs(o-a)<Math.abs(o-i)&&(i=a)}var l=i/o;if(!(0==i||l>1.2||l<(t==i?.2:.8))){var h=new mt.TheoSize(this.forma.bounds.width*l,this.forma.bounds.height*l),u=new w.FormaResizeEvent(this.forma,h,gt.TheoPoint.ZERO);this.onEvent(u)}}}},getCurrentFontSize:function(){var t,e,n=0,o=!1;if((e=this.lockupForma)&&(e.visit(T.FormaTraversal.PreOrder,(function(t,e,i){var r;return!!(r=s.as(t,at.TextForma))&&(n=r.fontSize,o=!0,!0)})),n*=this.lockupForma.placement.extractedScale.scale.x),0==n&&this.text.length>0){var i=null==this.lockupForma?" - no lockup":"",r=o?i:" - no text forma",a=(t=s.opt(this.lockupStyle,(function(t){return t.layoutType})))||null!=t?t:"nilStyle";return d.CoreAssertDebugOnly.fail("tried to return a font size of 0.0 "+r,{layoutType:a},"TypeLockupController.getCurrentFontSize","TypeLockupController.swift",4571),1}return n},getAverageFontSize:function(){var t,e=this;if(t=this.lockupForma){var n=[];if(t.visit(T.FormaTraversal.PreOrder,(function(t,o,i){var r;if(r=s.as(t,at.TextForma)){var a=r.fontSize;if(n.push(a*e.lockupForma.placement.extractedScale.scale.x),s.opt(e.lockupStyle,(function(t){return t.layout!=Y.LockupLayout.FitJustified})))return!0}return!1})),n.length>0)return n.reduce((function(t,e){return t+e}),0)/s.toDouble(n.length)}return 0},getFontSizeSnapValues:function(){var t=[];if(this.styleController.targetedLockupStyle!==this.lockupStyle)return t.push(100),t;var e=s.clone(st.TypeLockupUtils.sizesInDocument(this.forma.page.document,this.forma));s.sortInPlace(e);var n=this.getCurrentFontSize(),o=0;if(0!=n)for(var i=s.iter(e);!i.done;i.next()){var r=i.value;Math.round(r)==o&&r!=n||(o=Math.round(r),t.push(r))}return t},scale:function(t,e){void 0===e&&(e=new gt.TheoPoint(.5,.5));var n=this.forma.placement.transformValues,o=this.forma.bounds,i=new mt.TheoSize(o.width*n.xscale,o.height*n.xscale),r=new mt.TheoSize(i.width*t,i.height*t),a=this.forma.boundsInCoordSpace(this.forma.placement);Math.round(1e3*r.width)==Math.round(1e3*a.width)&&Math.round(1e3*r.height)==Math.round(1e3*a.height)||(this.onEvent(new w.BeginFormaResizeEvent(this.forma,gt.TheoPoint.ZERO)),this.onEvent(new w.FormaResizeEvent(this.forma,r,e)),this.onEvent(new w.EndFormaResizeEvent(this.forma)))},setFontSize:function(t,e){void 0===e&&(e=new gt.TheoPoint(.5,.5));var n=t/this.getCurrentFontSize();this.scale(n,e)},matchNextSize:function(t,e){for(var n=this.getCurrentFontSize(),o=n,i=!1,r=s.iter(t);!r.done;r.next()){var a=r.value,l=a/n;if(Math.round(o)<Math.round(a)&&(l<.99||l>1.01)){o=a,i=!0;break}}t.length>0&&(0==i||o>this.getSizeSliderMaxValue())&&(o=t[0]);var h=o/n;return(h<.99||h>1.01)&&this.scale(h,e),o},setSizeSliderValue:function(t,e,n){var o=t;if(this.styleController.targetedLockupStyle!==this.lockupStyle){o=t/100;for(var i=s.iter(e);!i.done;i.next())t>=(a=i.value)-5&&t<=a+5&&(o=a/100);this.styleController.targetedLockupStyle.spacing=1==o?-1:o,this.styleChanged(),this.selectCharStyleForma(),o*=100}else{for(var r=s.iter(e);!r.done;r.next()){var a;t>=(a=r.value)-5&&t<=a+5&&(o=a)}var l=o/this.getCurrentFontSize();this.scale(l,n)}return o},getSizeSliderValue:function(){return this.styleController.targetedLockupStyle!==this.lockupStyle?-1==this.styleController.targetedLockupStyle.spacing?100:100*this.styleController.targetedLockupStyle.spacing:this.getCurrentFontSize()},getSizeSliderMinValue:function(){if(this.styleController.targetedLockupStyle!==this.lockupStyle)return 20;var t=20,e=this.getCurrentFontSize();return e<20&&(t=e),t},getSizeSliderMaxValue:function(){if(this.styleController.targetedLockupStyle!==this.lockupStyle)return 400;var t=500,e=this.getCurrentFontSize();e>500&&(t=e+200);var n=t/e,o=1.2*this.forma.root.bounds.width/this.forma.bounds.width;return n>o?o*e:t}}}),r)},Cj3Q:function(t,e,n){var o,i,r=e,a=n("oAGj"),l=n("iCxV"),s=n("JgVS"),h=n("cEEQ"),u=n("c+uM"),c=n("tGKA"),g=n("JKVa"),p=n("8t9B"),d=n("hgLm"),f=n("oKlP"),m=n("sIWg"),y=n("1NAc");r.P=function(t,e){return new f.TheoPoint(t,e)},r.clockwiseRectanglePath=function(t,e,n){var o=d.TheoPathBuilder.init_d41d(),i=e.transformPoint(t.eval(r.P(0,0)));o.moveTo(i.x,i.y);var l=new m.TheoRect(i.x,i.y,i.x,i.y);if(n)for(var s=a.iter([r.P(0,1),r.P(1,1),r.P(1,0)]);!s.done;s.next()){var h=s.value;i=e.transformPoint(t.eval(h)),o.lineTo(i.x,i.y),l=l.expandToFit(i)}else for(var u=a.iter([r.P(1,0),r.P(1,1),r.P(0,1)]);!u.done;u.next()){h=u.value;i=e.transformPoint(t.eval(h)),o.lineTo(i.x,i.y),l=l.expandToFit(i)}return o.closePath(),{path:o.path,bounds:l}},r.RowsDecorationStrategy=(o=function(){this.paddingScalar=.6,s.BaseDecorationStrategy.call(this)},a.defineClass({name:"RowsDecorationStrategy",ctor:o,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{easeOutQuad:function(t,e,n,o){var i=t/o;return-n*i*(i-2)+e},easeOut:function(t,e,n){return this.easeOutQuad(n,t,e-t,1)},supportsConfiguration:function(t){return t.style.backing==u.LockupBacking.Rows},decorateNoKnockout:function(t,e){var n=t.style,o=[],i={},f={},k=0,L=this.paddingScalar,S=n.padding;0==n.spacing&&e.numberOfLines>1&&(L*=.5,0==n.padding&&(S=.1));var v,T,F=!1;(v=t.style.characterStyles[p.TypeLockupController.HIGHLIGHT_STYLE])&&(F=v.backing==u.LockupBacking.Rows&&n.backing==u.LockupBacking.Rows),n.backing!=u.LockupBacking.Rows&&(L=this.paddingScalar/2,(T=t.style.characterStyles[p.TypeLockupController.HIGHLIGHT_STYLE])&&T.padding>-1&&(S=T.padding));var C=e.avgLinePointSize*e.typographicBoundingRatios.heightRatio,x=C*S*L;S>=0&&(x=Math.max(.05*C,x));for(var R=e.typographicBoundingRatios.backingVerticalOffsetRatio*C,w=this.easeOut(0,R,S),A=x+e.typographicBoundingRatios.sideInsetRatio*e.avgLinePointSize,_=t.style.font.fontData,M=e.numberOfLines,I={},D=-1,B=a.iter(a.toSequence(e.items));!B.done;B.next()){var H=B.value,P=H.offset,b=H.element;if(b.type==h.LockupItemType.Text){var E=b.rowIndex,z=n.backing==u.LockupBacking.Rows,G=null;null!=b.characterStyle&&(K=t.style.characterStyles[b.characterStyle])&&(K.backing==u.LockupBacking.None&&n.backing!=u.LockupBacking.Rows?z=!1:(z=!0,K.backing==u.LockupBacking.UNSET||K.backing==u.LockupBacking.None||u.LockupStyle.isShadowLook(K.textLook)&&K.textLook!=u.LockupTextLook.KnockoutAndShadow||(G=b.characterStyle,n.backing==u.LockupBacking.Rows&&K.backing==u.LockupBacking.Rows&&(k=A))));var O=0;if(P>0&&(O=b.placement.tx-(e.items[P-1].placement.tx+e.items[P-1].size.width)),z&&I[E]==G||(null!=i[E]&&(i[M]=i[E],f[M]=f[E],I[M]=I[E],0!=k&&k>O/2&&(i[M]=new m.TheoRect(i[M].minX,i[M].minY,i[M].maxX-k+O/2,i[M].maxY)),M+=1,a.removeKey(i,E),a.removeKey(I,E),D=E),z)){I[E]=G;var N=b.pointSize*e.typographicBoundingRatios.heightRatio,U=F&&null==i[E]?A:0;0!=k&&D==E&&k>O/2&&(U=O/2);var Y=F?A:0,W=m.TheoRect.fromXYWH(b.placement.tx-U,b.placement.ty,b.size.width+(U+Y),N);null==(q=i[E])?(q=W,f[E]=b.typographicBoundingRatios):q=q.unionWith(W),i[E]=q}}}if(0==a.count(i))return new s.DecorationResults(a.clone(o));for(var V=s.BaseDecorationStrategy.getHorizontalOffsetForItalicAngle(e.avgLinePointSize*e.typographicBoundingRatios.heightFromBaselineRatio,_.italicAngle),X=a.iter(i,!0);!X.done;X.next()){var K,Q=X.key,q=X.value,j=f[Q],Z=q.size.height/e.typographicBoundingRatios.heightRatio,J=(e.typographicBoundingRatios.textVerticalOffsetRatio-_.capRatio)*Z,$=e.typographicBoundingRatios.textVerticalOffsetRatio,tt=e.typographicBoundingRatios.heightRatio,et=j.textVerticalOffsetRatio,nt=($-(tt/2-j.heightRatio/2)-et)*Z,ot=F?0:A,it=q.size.width+2*ot+V,rt=(N=q.size.height+2*x,q.minX-ot),at=q.minY+nt-J-x+w,lt=new y.TheoSize(it,N),st=c.Matrix2D.translationXY(rt,at),ht=!1;if(null!=I[Q]&&(K=t.style.characterStyles[I[Q]])&&K.backing==u.LockupBacking.SVGBackground){if(null==K.backingArtworkID)return a.opt(l.Host.logging,(function(t){return t.warning("artworkID or artworkInfo is nil ")})),new s.DecorationResults([]);var ut=new g.SVGBackgroundDecorationStrategy(K.backingArtworkID),ct=new h.LayoutResults(a.clone(e.items),q.size,e.placement,e.typographicBoundingRatios,e.avgRowAspect),gt=ut.calcSVGConfiguration(t.style,ct,K.padding),pt=gt.frame,dt=gt.preScale;o.push(h.LockupItem.init_9cc6(!1,pt.size,c.Matrix2D.translationXY(pt.minX+q.minX,pt.minY+q.minY+nt-J),K.backingArtworkID,dt,Q+e.numberOfLines,I[Q])),ht=!0}if(!ht||n.backing==u.LockupBacking.Rows){var ft=d.TheoPathBuilder.init_d41d(),mt=r.clockwiseRectanglePath(m.TheoRect.fromSize(lt),c.Matrix2D.Identity,!0).path;ft.addPath(mt,c.Matrix2D.Identity),o.push(h.LockupItem.init_708e(!1,lt,st,ft.path,Q,void 0,ht&&n.backing==u.LockupBacking.Rows?null:I[Q]))}}return o=a.sort(o,(function(t,e){return t.characterStyle!=e.characterStyle?null==t.characterStyle:t.rowIndex<e.rowIndex})),new s.DecorationResults(a.clone(o))},decorate:function(t,e){var n,o=t.style,i=!1;if((n=t.style.characterStyles[p.TypeLockupController.HIGHLIGHT_STYLE])&&(i=n.backing!=u.LockupBacking.Rows&&u.LockupStyle.isKnockoutLook(n.textLook)),!l.Host.textModelUtils.useOutlinesForKnockouts()||o.backing!=u.LockupBacking.Rows||!u.LockupStyle.isKnockoutLook(o.textLook)&&!i)return this.decorateNoKnockout(t,e);var r=[],g={},f=[],k={},L=d.TheoPathBuilder.init_d41d(),S=d.TheoPathBuilder.init_d41d(),v=this.paddingScalar,T=o.padding;0==o.spacing&&e.numberOfLines>1&&(v*=.5,0==o.padding&&(T=.1));var F=e.avgLinePointSize*e.typographicBoundingRatios.heightRatio,C=F*T*v;T>=0&&(C=Math.max(.05*F,C));for(var x=t.style.font.fontData,R=s.BaseDecorationStrategy.getHorizontalOffsetForItalicAngle(e.avgLinePointSize*e.typographicBoundingRatios.heightFromBaselineRatio,x.italicAngle),w=e.typographicBoundingRatios.backingVerticalOffsetRatio*F,A=this.easeOut(0,w,T),_=C+e.typographicBoundingRatios.sideInsetRatio*e.avgLinePointSize,M=e.typographicBoundingRatios.textVerticalOffsetRatio,I=e.typographicBoundingRatios.heightRatio,D=c.Matrix2D.translationXY(-_,-C),B=!1,H=e.numberOfLines,P=a.iter(a.range(0,e.items.length,!1));!P.done;P.next()){var b=P.value,E=e.items[b];if(E.type==h.LockupItemType.Text){var z=E.rowIndex,G=o.backing==u.LockupBacking.Rows;if(null!=E.characterStyle&&null!=t.style.characterStyles[E.characterStyle]&&(G=!0),G){var O=E.pointSize*e.typographicBoundingRatios.heightRatio,N=m.TheoRect.fromXYWH(E.placement.tx,E.placement.ty,E.size.width,O),U=g[z];null==U?(U=N,k[z]=E.typographicBoundingRatios):U=U.unionWith(N),g[z]=U;var Y=k[z],W=U.size.height/e.typographicBoundingRatios.heightRatio,V=(e.typographicBoundingRatios.textVerticalOffsetRatio-E.font.capRatio)*W,X=Y.textVerticalOffsetRatio,K=(M-(I/2-Y.heightRatio/2)-X)*W;if(B||(D=c.Matrix2D.translationXY(-_,U.minY+K-V-C+A),B=!0),b==e.items.length-1||z!=e.items[b+1].rowIndex){var Q=!0,q=U.size.width+2*_+R,j=U.size.height+2*C,Z=U.minX,J=U.minY+K-V+A,$=a.last(f),tt=m.TheoRect.fromXYWH(Z,J,q,j);f.push(tt),null!=$&&$.maxY<tt.minY?(S.lineTo($.maxX,$.maxY),S.lineTo($.minX,$.maxY),S.closePath(),S.moveTo(tt.minX,tt.minY),Q=!1):null==$?S.moveTo(tt.minX,tt.minY):$.maxX>tt.maxX?S.lineTo($.maxX,$.maxY):S.lineTo($.maxX,tt.minY),Q&&null!=$&&$.maxX>tt.maxX?S.lineTo(tt.maxX,$.maxY):S.lineTo(tt.maxX,tt.minY)}}else null!=g[z]&&(g[H]=g[z],k[H]=k[z],H+=1,a.removeKey(g,z))}}if(0==f.length)return new s.DecorationResults(a.clone(r));S.lineTo(f[f.length-1].maxX,f[f.length-1].maxY);for(var et=a.iter(a.stride(f.length-1,0,-1));!et.done;et.next()){var nt=et.value;f[nt-1].maxY>=f[nt].minY?(S.lineTo(f[nt].minX,f[nt].maxY),f[nt].minX<f[nt-1].minX?(S.lineTo(f[nt].minX,f[nt].minY),S.lineTo(f[nt-1].minX,f[nt].minY)):(S.lineTo(f[nt].minX,f[nt-1].maxY),S.lineTo(f[nt-1].minX,f[nt-1].maxY))):nt==f.length-1&&S.lineTo(f[nt].minX,f[nt].maxY)}1==f.length&&S.lineTo(f[0].minX,f[0].maxY),S.closePath();var ot=c.Matrix2D.translationXY(0,-f[0].minY),it=l.Host.textModelUtils.rewindPath(S.simplestForm)||S.simplestForm;L.addPath(it,ot);var rt=L.path,at=new y.TheoSize(a.opt(rt.bounds,(function(t){return t.width})),a.opt(rt.bounds,(function(t){return t.height})));return r.push(h.LockupItem.init_708e(!1,at,D,rt,null)),new s.DecorationResults(a.clone(r))}}}),o),r.KnockoutDecorationStrategy=(i=function(){s.BaseDecorationStrategy.call(this)},a.defineClass({name:"KnockoutDecorationStrategy",ctor:i,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{supportsConfiguration:function(t){return t.style.backing==u.LockupBacking.Knockout},decorate:function(t,e){var n,o,i=(n=a.opt(t.parentBounds,(function(t){return t.width})))||null!=n?n:5e3;null!=t.parentBounds&&a.opt(t.parentBounds,(function(t){return t.height}))>i&&(i=(o=a.opt(t.parentBounds,(function(t){return t.height})))||null!=o?o:5e3);var l=d.TheoPathBuilder.init_d41d(),u=e.placement,g=c.Matrix2D.translationXY(-i,-i),p=[],f=new y.TheoSize(e.size.width+2*i,e.size.height+2*i),k=m.TheoRect.fromSize(f),L=r.clockwiseRectanglePath(k,c.Matrix2D.Identity,!0).path;return l.addPath(L,u),p.push(h.LockupItem.init_708e(!1,k.size,g,l.path,null,!0)),new s.DecorationResults(a.clone(p))}}}),i)},JKVa:function(t,e,n){var o,i=e,r=n("oAGj"),a=n("iCxV"),l=n("IUM5"),s=n("fNpk"),h=n("JgVS"),u=n("cEEQ"),c=n("c+uM"),g=n("tGKA"),p=n("ezSu"),d=n("35Q0"),f=n("oKlP"),m=n("sIWg");i.SVGBackgroundDecorationStrategy=(o=function(t){if(this.artworkID_=null,this.artworkInfo_=null,this.spacingScalar=.75,this.paddingScalar=.6,this.artworkID_=t,null!=t){var e=a.Host.resourceUtils.urlForResource(l.CATEGORY_ID_SHAPE,t);null!=e?(this.artworkInfo_=a.Host.pathUtils.artworkFromURL(e,!1),s.LegacyCoreAssert.isTrue(null!=this.artworkInfo_,"Unable to load artwork!",void 0,"SVGBackgroundDecorationStrategy.init","SVGBackgroundDecorationStrategy.swift",47)):r.opt(a.Host.logging,(function(t){return t.warning("Invalid artwork ID provided!")}))}},r.defineClass({name:"SVGBackgroundDecorationStrategy",ctor:o,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{easeOutQuad:function(t,e,n,o){var i=t/o;return-n*i*(i-2)+e},easeOut:function(t,e,n){return this.easeOutQuad(n,t,e-t,1)},supportsConfiguration:function(t){return t.style.backing==c.LockupBacking.SVGBackground&&this.artworkID_==t.style.backingArtworkID&&!c.LockupStyle.isLetterGrid(t.style.layout)},decorate:function(t,e){if(null==this.artworkID_||null==this.artworkInfo_)return r.opt(a.Host.logging,(function(t){return t.warning("artworkID or artworkInfo is nil ")})),new h.DecorationResults([]);var n=[],o=this.calcSVGConfiguration(t.style,e),i=o.frame,l=o.preScale;return n.push(u.LockupItem.init_9cc6(!1,i.size,g.Matrix2D.translationXY(i.minX,i.minY),this.artworkID_,l)),new h.DecorationResults(r.clone(n))},calcSVGConfiguration:function(t,e,n){void 0===n&&(n=-1);var o=m.TheoRect.fromSize(e.size),i=e.typographicBoundingRatios.backingVerticalOffsetRatio*e.avgLinePointSize,r=t.font.fontData,a=h.BaseDecorationStrategy.getHorizontalOffsetForItalicAngle(e.avgLinePointSize*e.typographicBoundingRatios.heightFromBaselineRatio,r.italicAngle),l=((e.size.width+e.size.height)/4+e.avgLinePointSize)/2,s=t.padding*this.paddingScalar*l,u=t.padding;n>-1?(u=n/2,s=n*this.paddingScalar*l/2):e.numberOfLines>1&&(u+=t.spacing,s+=t.spacing*this.spacingScalar*e.avgLinePointSize),(t.padding>=0||n>-1)&&(s=Math.max(.05*l,s));var c,g=this.easeOut(0,i,Math.min(1,u)),p=o.minX-s,y=o.maxX+s+a,k=o.minY-s+g,L=o.maxY+s+g;if(o=new m.TheoRect(p,k,y,L),(c=d.ShapeLibrary.getShapeDataForArtworkId(this.artworkID_))&&c.category==d.ShapeCategory.Circle){var S=new f.TheoPoint(o.minX,o.minY),v=o.center,T=v.distanceTo(S),F=Math.sqrt(2*Math.pow(T,2))/2;p=v.x-F,y=v.x+F,k=v.y-F,L=v.y+F,o=new m.TheoRect(p,k,y,L)}return this.calcSVGFrame(o)},calcSVGFrame:function(t){var e,n,o=null!=this.artworkInfo_.sliceBox,i=null!=this.artworkInfo_.contentRegion,r=this.artworkInfo_.artwork.bounds,a=i?this.artworkInfo_.contentRegion:r,l=1,s=null;if(i)if(o){a=this.artworkInfo_.contentRegion;var h=t.width/a.width,u=t.height/a.height;s=Math.min(h,u);var c=p.NineSlicingFilter.calculateOuterBoundsForMapping(r,this.artworkInfo_.sliceBox,s,a,t);n=c.bounds,s=(e=c.prescribedPrescale)||null!=e?e:s}else h=t.width/a.width,u=t.height/a.height,l=Math.max(h,u),n=r.transform(g.Matrix2D.scalingXY(l,l));else o?n=t:(h=t.width/r.width,u=t.height/r.height,l=Math.max(h,u),n=r.transform(g.Matrix2D.scalingXY(l,l)));if(!o){var d=a.transform(g.Matrix2D.scalingXY(l,l));n=n.transform(g.Matrix2D.translation(t.center.subtract(d.center)))}return{frame:n,preScale:s}}}}),o)},X1F6:function(t,e,n){var o,i,r=e,a=n("oAGj"),l=n("EGPT"),s=n("QgZx"),h=n("53P9"),u=n("iCxV"),c=n("VDg0"),g=n("fNpk"),p=n("cEEQ"),d=n("c+uM"),f=n("tGKA"),m=n("8t9B"),y=n("3UhB"),k=n("oKlP"),L=n("oKI3"),S=n("uUew"),v=n("sIWg"),T=n("1NAc");r.PathLayoutStrategy=(o=function(){this.trackingScalar=1.5,this.precision=.003,this.ascentCoeff=.594,this.concavityCoeff=1,this.requiredCoverageClosed=.99,this.requiredCoverageOpen=.99,this.coverageThresholdMustCenter=.98,this.sampleFontSize=32,this.minFontSize=8,this.maxFontSize=600,this.maxIterations=100,p.BaseLockupLayoutStrategy.call(this)},a.defineClass({name:"PathLayoutStrategy",ctor:o,superName:"BaseLockupLayoutStrategy",statics:{_implements:function(t){return"LockupLayoutStrategy"==t}},props:{supportsConfiguration:function(t){return d.LockupStyle.isPath(t.style.layout)},fitText:function(t){return t.style.alignment!=d.LockupAlignment.Right},layout:function(t){var e,n=t.containerSize,o=t.style,i=o.tracking*this.trackingScalar,r=t.text;r=this.newLinesToSpaces(r);var l=o.font.fontData;l.allCapsAllowed&&(r=r.toUpperCase());var s=p.getTypographicBoundingRatiosOfString(r,l,!1),h=L.TextPathLibrary.getPathForLockupStyle(o),u=this.transformPath(h,n,c.LockupConfiguration.fitToContainerArea),g=u[0];h=u[1];var d=this.precision*g.hypotenuse,m=this.getCorrectedPathLen(h,s.heightFromBaselineRatio*this.sampleFontSize,d),y=h.isClosed()?this.requiredCoverageClosed:this.requiredCoverageOpen,F=this.measureLetters(r,a.clone(t.characterStyleRanges),this.sampleFontSize,o,l,i,s.hasUppercase,h.isClosed()),C=F.renderableItemCount,x=a.clone(F.letterInfos),R=F.truncatedText,w=this.estimateFontSizeToFit(h,R,x.length,l,s,i,d);w=Math.min(Math.max(this.minFontSize,w),this.maxFontSize);for(var A=0,_=this.minFontSize,M=this.maxFontSize,I=0,D=null;A<this.maxIterations&&_<M;){var B=h.clone();if(B=(D=this.placeLetters(B,a.clone(x),s,w,d)).path,D.placements.length<x.length)M=w;else{if((I=1-this.getCorrectedPathLen(B,s.heightFromBaselineRatio*this.sampleFontSize,d)/m)>=y)break;_=w}w=(_+M)/2,A+=1}((e=a.opt(D,(function(t){return 0==t.placements.length})))||null!=e)&&e&&(D.placements.push(f.Matrix2D.Identity),I=1),I<this.coverageThresholdMustCenter&&(D=this.placeLettersAndCenter(h,a.clone(x),s,w,d));var H=this.fitText(t),P=D.bounds,b=P.size,E=1;if(H){var z=c.LockupConfiguration.fitToContainerArea?g:n;(b.width>z.width||b.height>z.height)&&(E=(b=this.getFitSize(P,z)).width/P.width),h=(h=h.offset(k._minus_TheoPoint_TheoPoint(k.TheoPoint.ZERO,P.origin))).multiply(new T.TheoSize(E,E))}for(var G=h.getBounds(),O=s.heightFromBaselineRatio*w*E,N=[],U=a.iter(a.toSequence(D.placements));!U.done;U.next()){var Y=U.value,W=Y.offset,V=Y.element,X=x[W],K=H?P:G,Q=(V.tx-K.minX)*E,q=(V.ty-K.minY)*E,j=new f.Matrix2D(V.a,V.b,V.c,V.d,Q,q),Z=w*X.fontSizeAdjustRatio*E,J=p.LockupItem.init_38d4(!0,X.characterStyle,new T.TheoSize(X.unitWidth*Z,O),j,X.character,X.font,Z,Z,s,0,new S.TextRange(W,W+1));N.push(J)}var $=H?v.TheoRect.fromSize(b).unionWith(G).size:G.size;return new p.LayoutResults(a.clone(N),$,f.Matrix2D.Identity,s,$.aspectRatio,a.clone(this.getAnnotations(C,N.length)))},placeOneLetter:function(t,e,n,o,i){var r=t,l=o*this.ascentCoeff,s=this.concavityCoeff*l,h=t.findTValueByCorrectedPrefixLength(l,s,n,i);if(h>=a.toDouble(t.numSegments))return{placement:null,t:0,path:t};var u=t.findTValueByCorrectedPrefixLength(l,s,e/2,i);g.LegacyCoreAssert.isTrue(u<a.toDouble(t.numSegments),"t-value by corrected prefix length out of range",void 0,"PathLayoutStrategy.placeOneLetter","PathLayoutStrategy.swift",240);var c=t.pointAt(u),p=t.tangentUnitVectorAt(u),d=Math.atan2(p.y,p.x);return{placement:f.Matrix2D.translationXY(-e/2,-o).rotate(Math.cos(d),Math.sin(d)).translate(c),t:h,path:r=r.truncate(h).suffix}},placeLetters:function(t,e,n,o,i){for(var r=n.heightFromBaselineRatio*o,l=0,s=v.TheoRect.Zero,h=[],u=t,c=a.iter(e);!c.done;c.next()){var g=c.value,p=o*g.fontSizeAdjustRatio,d=g.unitWidth*p,f=g.unitTrackedWidth*p,m=g.unitYAdjust*p,y=this.placeOneLetter(u,d,f,r-m,i);u=y.path;var k=y.placement;if(null==k)break;h.push(k);var L=new v.TheoRect(0,0,f,r).transform(k);s=s.unionWith(L),l+=f}return{placements:h,bounds:s,composedWidth:l,path:u}},placeLettersAndCenter:function(t,e,n,o,i){var r=this.placeLetters(t,a.clone(e),n,o,i);if(r.placements.length<e.length)return r;for(var l=0,s=i,h=0;(Math.abs(l-s)>.01*(l+s)||r.placements.length<e.length)&&h<this.maxIterations;){l>s||r.placements.length<e.length?l-=(l-s)/2:l+=(s-l)/2;var u=t.truncate(t.findTValueByCorrectedPrefixLength(0,0,l,i)).suffix;s=(r=this.placeLetters(u,a.clone(e),n,o,i)).placements.length<e.length?0:r.path.getLength(i),h+=1}return r},calculateLeading:function(t,e){return t.style.spacing},adjustSizeForLeading:function(t,e,n,o){return T.TheoSize.Zero},calculateTracking:function(t,e){return t.style.tracking},adjustSizeForTracking:function(t,e,n,o){return null},getFitSize:function(t,e,n){void 0===n&&(n=1);var o,i,r=t.width,a=t.height,l=0==a?1/0:r/a,s=e.width,h=e.height,u=s/h,c=n>1?n:1/n;return l<u?(i=h,o=h*(u=Math.min(u,l*c))):(o=s,i=s/(u=Math.max(u,l/c))),new T.TheoSize(o,i)},transformPath:function(t,e,n){var o,i,r=t.getBounds();if(n){var a=r.size,l=Math.sqrt(e.width*e.height/(a.width*a.height));o=(i=t.multiply(new T.TheoSize(l,l))).getBounds().size}else{o=this.getFitSize(r,e,t.flex);var s=0==r.width?1:o.width/r.width,h=0==r.height?1:o.height/r.height;i=t.multiply(new T.TheoSize(s,h))}return[o,i]},getCorrectedPathLen:function(t,e,n){var o=e*this.ascentCoeff,i=this.concavityCoeff*o;return t.getCorrectedLength(o,i,n)},estimateFontSizeToFit:function(t,e,n,o,i,r,l){var s=a.clone(u.Host.textModelUtils.getGlyphPositions(e,o,32,!1)),h=a.toDouble(t.isClosed()?n:n-1)*r*32,c=a.last(s)+h,g=t.getLength(l);return 32*g/(c-(this.getCorrectedPathLen(t,32*i.heightFromBaselineRatio,l)-g))},getCharacterStyle:function(t,e,n){for(var o=a.iter(t);!o.done;o.next()){var i=o.value;if(e>=i.start&&e<i.end)return m.TypeLockupController.HIGHLIGHT_STYLE}return""},measureLetters:function(t,e,n,o,i,l,c,g){var p,d=a.clone(h.GraphemeUtils.splitGraphemes(t)),f=d.length,k=t;f>this.maxLetterLayoutGraphemeCount&&(k=(d=d.slice(0,this.maxLetterLayoutGraphemeCount)).join());var L=d.length,S=a.opt(a.opt(o.characterStyles[m.TypeLockupController.HIGHLIGHT_STYLE],(function(t){return t.font})),(function(t){return t.fontData}))||i,v=y.TypeLockupUtils.getCharFontAdjust(o,c,!1),T=y.TypeLockupUtils.getCharFontYAdjust(o,n,n*v),F=[],C=[],x=[],R=l<=.25;R&&(C=a.clone(u.Host.textModelUtils.getGlyphPositions(t,i,n,!1)),x=a.clone(a.eq(s._equality_FontDescriptor_FontDescriptor,S,i)?C:u.Host.textModelUtils.getGlyphPositions(t,S,n,!1)));for(var w,A,_=!1,M=a.iter(a.toSequence(d));!M.done;M.next()){var I=M.value,D=I.offset,B=I.element,H=(p=A)||null!=p?p:this.getCharacterStyle(a.clone(e),D,D+1);D<L-1&&(A=this.getCharacterStyle(a.clone(e),D+1,D+2));var P=H==m.TypeLockupController.HIGHLIGHT_STYLE,b=P?S:i,E=P?v:1,z=P?T/(n*E):0,G=0;if(R&&H==A){var O=a.clone(P?x:C);G=(O[D+1]-O[D])/n}else G=u.Host.textModelUtils.measureBoundsForLayout(B,b,n,0).width/n;var N=new r.LetterInfo(B,b,E,H,G,z,D!=L-1||g?l:0);(_=y.TypeLockupUtils.isWhiteSpace(B))&&(w=N),F.push(N)}return g&&!_&&null!=w&&F.push(w),{renderableItemCount:f,truncatedText:k,letterInfos:F}},newLinesToSpaces:function(t){return a.replaceAll(t,"\n"," ")},reflow:function(t,e,n,o){var i=n.style,r=n.text,l=Math.min(h.GraphemeUtils.countGraphemes(r),this.maxLetterLayoutGraphemeCount)>o.itemsForReflow.length;if(1==L.TextPathLibrary.getPathForLockupStyle(i).flex&&!l){for(var s=o.size,u=t.fitAspectRatioWithin(s.aspectRatio),c=u.width/s.width,g=[],d=a.iter(o.itemsForReflow);!d.done;d.next()){var m,y,k,S,v,T,F=d.value;if(null!=(r=F.text)&&(m=F.font)&&null!=(y=F.pointSize)&&null!=(k=F.rowPointSize)&&(S=F.typographicBoundingRatios)&&null!=(v=F.rowIndex)&&(T=F.rangeInLockup)){var C=y*c;if(C>this.maxFontSize||C<this.minFontSize)return null;var x=F.placement.transformValues,R=x.tx*c,w=x.ty*c,A=f.Matrix2D.rotation(x.rotCosine,x.rotSine).translateXY(R,w),_=p.LockupItem.init_38d4(F.hasPrimaryColor,F.characterStyle,F.size.multiply(c),A,r,m,y*c,k*c,S,v,T);g.push(_)}}return new p.LayoutResults(a.clone(g),u,o.placement,o.typographicBoundingRatios,o.avgRowAspect,a.clone(o.annotations))}return null},annotate:function(t,e,n,o){var i=h.GraphemeUtils.countGraphemes(t);return this.getAnnotations(i,o)},getAnnotations:function(t,e){return e<t?[new l.Annotation(l.AnnotationID.TextTruncated,l.AnnotationPriority.High)]:e>this.maxLetterLayoutRecommendedGraphemeCount?[new l.Annotation(l.AnnotationID.TooMuchCurvedText)]:null}}}),o),r.LetterInfo=(i=function(t,e,n,o,i,r,a){this.character=t,this.font=e,this.fontSizeAdjustRatio=n,this.characterStyle=o,this.unitWidth=i,this.unitYAdjust=r,this.unitTrackedWidth=i+a},a.defineClass({name:"LetterInfo",ctor:i}),i)}}]);
//# sourceMappingURL=vendors_npm_spark_6dd528bf-24822e7c.js.map